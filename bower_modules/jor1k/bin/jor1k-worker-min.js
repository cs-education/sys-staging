!function e(t,i,s){function r(n,h){if(!i[n]){if(!t[n]){var o="function"==typeof require&&require;if(!h&&o)return o(n,!0);if(a)return a(n,!0);var d=new Error("Cannot find module '"+n+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[n]={exports:{}};t[n][0].call(c.exports,function(e){var i=t[n][1][e];return r(i?i:e)},c,c.exports,e,t,i,s)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<s.length;n++)r(s[n]);return r}({1:[function(e,t,i){"use strict";function s(){this.stream=new Uint8Array(5),this.ofs=0,this.Put=function(e){switch(this.stream[this.ofs]=e,this.ofs++,this.ofs){case 1:if(this.stream[0]<128)return this.ofs=0,this.stream[0];break;case 2:if(192==(224&this.stream[0])&&128==(192&this.stream[1]))return this.ofs=0,(31&this.stream[0])<<6|(63&this.stream[1])<<0;break;case 3:if(224==(240&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2]))return this.ofs=0,(15&this.stream[0])<<12|(63&this.stream[1])<<6|(63&this.stream[2])<<0;break;case 4:return 240==(248&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2])&&128==(192&this.stream[3])?(this.ofs=0,(7&this.stream[0])<<18|(63&this.stream[1])<<12|(63&this.stream[2])<<6|(63&this.stream[3])<<0):(this.ofs=0,-1);default:return this.ofs=0,-1}return-1}}function r(e){return e=0|e,128>e?[e]:2047>=e?[e>>6|192,63&e|128]:65535>=e?[e>>12|224,e>>6&63|128,63&e|128]:1114111>=e?[e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128]:[]}function a(e){for(var t=0,i=0;i<e.length;i++){var s=e.charCodeAt(i);128>s?t+=1:2047>=s?t+=2:65535>=s?t+=3:1114111>=s&&(t+=4)}return t}t.exports.UTF8StreamToUnicode=s,t.exports.UTF8Length=a,t.exports.UnicodeToUTF8Stream=r},{}],2:[function(e,t,i){var s=e("./messagehandler"),r={};r.crcTable=[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188],r.array=function(e){var t=0,i=0,s=[0,1,3,7,15,31,63,127,255];return function(r){for(var a=0;r>0;){var n=8-t;r>=n?(a<<=n,a|=s[n]&e[i++],t=0,r-=n):(a<<=r,a|=(e[i]&s[r]<<8-r-t)>>8-r-t,t+=r,r=0)}return a}},r.IsBZIP2=function(e){return 66==e[0]&&90==e[1]&&104==e[2]?!0:!1},r.simple=function(e,t){var i=r.array(e),s=r.header(i),a=!1,n=1e5*s,h=new Int32Array(n);this.byteCount=new Int32Array(256),this.symToByte=new Uint8Array(256),this.mtfSymbol=new Int32Array(256),this.selectors=new Uint8Array(32768);do a=r.decompress(i,t,h,n);while(!a)},r.header=function(e){4348520!=e(24)&&s.Error("No magic number found");var t=e(8)-48;return(1>t||t>9)&&s.Error("Not a BZIP archive"),t},r.decompress=function(e,t,i,r){for(var a=20,n=258,h=0,o=1,d=50,c=-1,u="",f=0;6>f;f++)u+=e(8).toString(16);if("177245385090"==u)return!0;"314159265359"!=u&&s.Error("eek not valid bzip data");var p=0|e(32);e(1)&&s.Error("unsupported obsolete version");var l=e(24);l>r&&s.Error("Initial position larger than buffer size");var b=e(16),m=0;for(f=0;16>f;f++)if(b&1<<15-f){var R=e(16);for(k=0;16>k;k++)R&1<<15-k&&(this.symToByte[m++]=16*f+k)}var y=e(3);(2>y||y>6)&&s.Error("another error");var v=e(15);0==v&&s.Error("meh");for(var f=0;y>f;f++)this.mtfSymbol[f]=f;for(var f=0;v>f;f++){for(var k=0;e(1);k++)k>=y&&s.Error("whoops another error");for(var g=this.mtfSymbol[k],R=k-1;R>=0;R--)this.mtfSymbol[R+1]=this.mtfSymbol[R];this.mtfSymbol[0]=g,this.selectors[f]=g}for(var S,I=m+2,D=[],w=new Uint8Array(n),C=new Uint8Array(a+1),k=0;y>k;k++){b=e(5);for(var f=0;I>f;f++){for(;;){if((1>b||b>a)&&s.Error("I gave up a while ago on writing error messages"),!e(1))break;e(1)?b--:b++}w[f]=b}var T,A;T=A=w[0];for(var f=1;I>f;f++)w[f]>A?A=w[f]:w[f]<T&&(T=w[f]);S=D[k]={},S.permute=new Int32Array(n),S.limit=new Int32Array(a+1),S.base=new Int32Array(a+1),S.minLen=T,S.maxLen=A;for(var E=S.base.subarray(1),M=S.limit.subarray(1),_=0,f=T;A>=f;f++)for(var b=0;I>b;b++)w[b]==f&&(S.permute[_++]=b);for(f=T;A>=f;f++)C[f]=M[f]=0;for(f=0;I>f;f++)C[w[f]]++;for(_=b=0,f=T;A>f;f++)_+=C[f],M[f]=_-1,_<<=1,E[f+1]=_-(b+=C[f]);M[A]=_+C[A]-1,E[T]=0}for(var f=0;256>f;f++)this.mtfSymbol[f]=f,this.byteCount[f]=0;var x,L,I,U;for(x=L=I=U=0;;){for(I--||(I=d-1,U>=v&&s.Error("meow i'm a kitty, that's an error"),S=D[this.selectors[U++]],E=S.base.subarray(1),M=S.limit.subarray(1)),f=S.minLen,k=e(f);;){if(f>S.maxLen&&s.Error("rawr i'm a dinosaur"),k<=M[f])break;f++,k=k<<1|e(1)}k-=E[f],(0>k||k>=n)&&s.Error("moo i'm a cow");var P=S.permute[k];if(P!=h&&P!=o){if(x)for(x=0,L+b>=r&&s.Error("Boom."),g=this.symToByte[this.mtfSymbol[0]],this.byteCount[g]+=b;b--;)i[L++]=g;if(P>m)break;L>=r&&s.Error("I can't think of anything. Error"),f=P-1,g=this.mtfSymbol[f];for(var R=f-1;R>=0;R--)this.mtfSymbol[R+1]=this.mtfSymbol[R];this.mtfSymbol[0]=g,g=this.symToByte[g],this.byteCount[g]++,i[L++]=g}else x||(x=1,b=0),b+=P==h?x:2*x,x<<=1}(0>l||l>=L)&&s.Error("I'm a monkey and I'm throwing something at someone, namely you");for(var k=0,f=0;256>f;f++)R=k+this.byteCount[f],this.byteCount[f]=k,k=R;for(var f=0;L>f;f++)g=255&i[f],i[this.byteCount[g]]|=f<<8,this.byteCount[g]++;var F=0,z=0,G=0;L&&(F=i[l],z=255&F,F>>=8,G=-1),L=L;for(var B,O,N;L;){for(L--,O=z,F=i[F],z=255&F,F>>=8,3==G++?(B=z,N=O,z=-1):(B=1,N=z);B--;)c=4294967295&(c<<8^this.crcTable[255&(c>>24^N)]),t(N);z!=O&&(G=0)}return c=(-1^c)>>>0,(0|c)!=(0|p)&&s.Error("Error in bzip2: crc32 do not match"),!1},t.exports=r},{"./messagehandler":25}],3:[function(e,t,i){function s(e,t,i){"use asm";function s(){f(),r()}function r(){Xe=0,Ke=0,Qe=3,Ve=0,ue[be+(V<<2)>>2]=24,ue[be+(Y<<2)>>2]=24,ue[be+(J<<2)>>2]=72,ue[be+(Z<<2)>>2]=72,ue[be+($<<2)>>2]=301989889,ue[be+(j<<2)>>2]=1561,ve=0,ke=0,ge=-4,k(ie,0)}function a(){Te=-1,Ae=-1,Ee=-1,Me=-1,_e=-1,xe=-1,Le=-1,Ue=-1,Pe=-1,Fe=-1,ze=-1,Ge=-1,Be=-1,Oe=-1,Ne=-1,He=-1,We=-1,je=-1}function n(){return ye>>>2|0}function h(){ye=ue[64]<<2,De=ue[65]<<2,Ie=ue[66]|0,Xe=ue[68]|0,Ke=ue[69]|0,Qe=ue[70]|0,Ve=ue[71]|0,lt=ue[72]|0,bt=ue[73]|0,mt=ue[74]|0,ve=0,ke=0,Se=0,De=ye}function o(){ue[64]=ye>>>2,ue[65]=ye+4>>>2,(ve|0)==(Se|0)&&(ue[65]=De>>>2),ue[66]=Ie|0,ue[67]=0,ue[68]=Xe|0,ue[69]=Ke|0,ue[70]=Qe|0,ue[71]=Ve|0,ue[72]=lt|0,ue[73]=bt|0,ue[74]=mt|0}function d(){var e=0;return Xe>>30==0?-1:(e=(Xe&268435455)-(Ke&268435455)|0,(e|0)<0&&(e=e+268435455|0),e|0)}function c(e){e|=0,Ke=Ke+e|0}function u(){return Xe>>30==0?-1:Ke&268435455|0}function f(){lt=ue[le+2304>>2]|0,bt=ue[le+2560>>2]|0,mt=(ue[le+8208>>2]&4095)<<16|ue[le+8212>>2]&65535|0}function p(e){e|=0;var t=0;t=Ze,Ye=e&1,Je=e&2,Ze=e&4,$e=e&8,et=e&16,tt=e&32,it=e&64,st=e&128,rt=e&256,at=e&512,nt=e&1024,ht=e&2048,ot=e&4096,dt=e&8192,ct=e&16384,ut=1,ft=e&65536,pt=e>>28&15,st&&(T(P|0),A()),pt&&(T(F|0),A()),ct&&(T(z|0),A()),dt&&(T(G|0),A()),Ze&&(t|0)==0&&b()}function l(){var e=0;return e|=Ye?1:0,e|=Je?2:0,e|=Ze?4:0,e|=$e?8:0,e|=et?16:0,e|=tt?32:0,e|=it?64:0,e|=st?128:0,e|=rt?256:0,e|=at?512:0,e|=nt?1024:0,e|=ht?2048:0,e|=ot?4096:0,e|=dt?8192:0,e|=ct?16384:0,e|=ut?32768:0,e|=ft?65536:0,e|=pt<<28,e|0}function b(){Ze&&Qe&Ve&&(Rt=1)}function m(e,t){e|=0,t|=0;var i=0;i=1<<e|0,Ve|=i,b()}function R(e,t){e|=0,t|=0,Ve&=~(1<<e)}function y(e,t){e|=0,t|=0;var i=0,s=0;switch(i=e&2047,s=e>>11&31,s|0){case 0:(i|0)==(q|0)&&p(t),ue[be+(i<<2)>>2]=t;break;case 1:ue[me+(i<<2)>>2]=t;break;case 2:ue[Re+(i<<2)>>2]=t;break;case 3:case 4:break;case 8:yt=1;break;case 9:switch(i|0){case 0:Qe=t|3,Ze&&Qe&Ve&&(T(B|0),A());break;case 2:break;default:T(O|0),A()}break;case 10:switch(i|0){case 0:Xe=t|0,(Xe>>30&3)!=3&&(T(N|0),A());break;case 1:Ke=t|0;break;default:T(W|0),A()}break;default:T(W|0),A()}}function v(e){e|=0;var t=0,i=0;switch(t=e&2047,i=e>>11&31,i|0){case 0:return(t|0)==(q|0)?l()|0:ue[be+(t<<2)>>2]|0;case 1:return ue[me+(t<<2)>>2]|0;case 2:return ue[Re+(t<<2)>>2]|0;case 8:return 0;case 9:switch(t|0){case 0:return Qe|0;case 2:return Ve|0;default:T(W|0),A()}break;case 10:switch(t|0){case 0:return Xe|0;case 1:return Ke|0;default:T(W|0),A()}break;default:T(W|0),A()}return 0}function k(e,t){e|=0,t|=0;var i=0;switch(i=e|(ct?4026531840:0),y(X,t),y(Q,l()|0),qe=-1,ot=0,Ye=1,Ze=0,Je=0,tt=0,Te=0,Ae=0,Ee=0,Me=0,_e=0,xe=0,Le=0,Ue=0,Pe=0,Fe=0,ze=0,Be=0,Ge=0,Ne=0,Oe=0,He=0,We=0,je=0,Se=ve|0,De=i,e|0){case 256:break;case 768:case 2304:case 3584:case 512:ye=ge+ve|0,y(K,ye-(Ie?4:0)|0);break;case 2560:case 1024:case 1280:case 2048:y(K,ye-(Ie?4:0)|0);break;case 3072:ye=ge+ve|0,y(K,ye+4-(Ie?4:0)|0);break;default:T(H|0),A()}Ie=0,it=0}function g(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(ue[le+2304>>2]|0)==(lt|0)?(k(se,e),0):(i=e,s=ue[le+mt>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=ue[le+r>>2]|0,(s|0)==0?(k(re,e),0):(s=4294959104,r=ue[le+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=ue[le+s>>2]|0,(i&1)==0?(k(re,e),0):(r=i&4294960122,a&=t-1,ue[me+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,ue[me+((512|a)<<2)>>2]=r,1)))}function S(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(ue[le+2560>>2]|0)==(bt|0)?(k(ee,e),0):(i=e,s=ue[le+mt>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=ue[le+r>>2]|0,(s|0)==0?(k(te,e),0):(s=4294959104,r=ue[le+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=ue[le+s>>2]|0,(i&1)==0?(k(te,e),0):(r=i&4294959162,s=i&1984,(s|0)!=0&&(a&=t-1,r|=192),ue[Re+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,ue[Re+((512|a)<<2)>>2]=r,1)))}function I(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(!tt)return e|0;if(i=e>>13&63,s=ue[me+((512|i)<<2)>>2]|0,(s&1)==0){if(!(g(e,64)|0))return-1;s=ue[me+(512+i<<2)>>2]|0}if(s>>19!=e>>19){if(!(g(e,64)|0))return-1;s=ue[me+(512+i<<2)>>2]|0}if(r=ue[me+((640|i)<<2)>>2]|0,Ye){if(t){if(!(r&512))return k(re,e),-1}else if(!(r&256))return k(re,e),-1}else if(t){if(!(r&128))return k(re,e),-1}else if(!(r&64))return k(re,e),-1;return r&4294959104|e&8191|0}function D(e,t){e|=0,t|=0;for(var i=0,s=0,r=0,n=0,h=0,o=0,d=0,c=0,u=0,f=0,l=0,b=0,m=0,R=0;;){if((ve|0)==(Se|0)){if(ye=De,!Ce|0&&(Ie=0),R=R+(ve-ke>>2)|0,(R|0)>=64&&!(Ce|0)){if(R=R-64|0,e=e-64|0,(e|0)<0)return 0;Xe>>30!=0&&(m=(Xe&268435455)-(Ke&268435455)|0,(m|0)<0&&(m=m+268435455|0),Ke=Ke+t|0,(m|0)<(t|0)&&Xe&1<<29&&(Xe|=1<<28)),Xe&1<<28?Je&&(k(ae,ue[be+(X<<2)>>2]|0),ye=De):Ze|0&&Rt|0&&(Rt=0,k(ne,ue[be+(X<<2)>>2]|0),ye=De)}if((Fe^ye)&4294959104)if(Fe=ye,it){if(f=ye>>13&63,l=ue[Re+((512|f)<<2)>>2]|0,(l&1)==0){if(!(S(ye,64)|0)){ke=ve,Ce=0;continue}l=ue[Re+((512|f)<<2)>>2]|0}if(l>>19!=ye>>19){if(!(S(ye,64)|0)){ke=ve,Ce=0;continue}l=ue[Re+((512|f)<<2)>>2]|0}b=ue[Re+((640|f)<<2)>>2]|0,Te=(b^l)>>13<<13}else Te=0;ve=le+(Te^ye)|0,ke=ve,ge=ye-4-ke|0,Ce|0?(Ce=0,Se=ve+4|0,De=we):(Se=(ve>>13)+1<<13,De=(ye>>13)+1<<13)}switch(i=ue[ve>>2]|0,ve=ve+4|0,i>>26&63){case 0:ye=ge+ve|0,we=ye+(i<<6>>4)|0,(Se|0)==(ve|0)?Ce=1:(Se=ve+4|0,De=we|0),Ie=1;break;case 1:ye=ge+ve|0,we=ye+(i<<6>>4)|0,de[9]=ye+8|0,(Se|0)==(ve|0)?Ce=1:(Se=ve+4|0,De=we|0),Ie=1;break;case 3:if(at)break;ye=ge+ve|0,we=ye+(i<<6>>4)|0,(Se|0)==(ve|0)?Ce=1:(Se=ve+4|0,De=we|0),Ie=1;break;case 4:if(!at)break;ye=ge+ve|0,we=ye+(i<<6>>4)|0,(Se|0)==(ve|0)?Ce=1:(Se=ve+4|0,De=we|0),Ie=1;break;case 5:break;case 6:n=i>>21&31,de[n<<2>>2]=(i&65535)<<16;break;case 8:(i&4294901760)==553648128?k(oe,ue[be+X>>2]|0):k(he,ue[be+X>>2]|0);break;case 9:we=v(K)|0,a(),Se=ve,De=we,p(v(Q)|0);break;case 17:we=de[(i>>9&124)>>2]|0,(Se|0)==(ve|0)?Ce=1:(Se=ve+4|0,De=we|0),Ie=1;break;case 18:ye=ge+ve|0,we=de[(i>>9&124)>>2]|0,de[9]=ye+8|0,(Se|0)==(ve|0)?Ce=1:(Se=ve+4|0,De=we|0),Ie=1;break;case 27:if(c=(de[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(ze^c)>>13){if(u=I(c,0)|0,(u|0)==-1)break;ze=c,Ae=(u^c)>>13<<13}u=Ae^c,qe=u,de[(i>>19&124)>>2]=(u|0)>0?ue[le+u>>2]|0:E(u|0)|0;break;case 33:if(c=(de[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(ze^c)>>13){if(u=I(c,0)|0,(u|0)==-1)break;ze=c,Ae=(u^c)>>13<<13}u=Ae^c,de[(i>>19&124)>>2]=(u|0)>0?ue[le+u>>2]|0:E(u|0)|0;break;case 35:if(c=(de[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Be^c)>>13){if(u=I(c,0)|0,(u|0)==-1)break;Be=c,Me=(u^c)>>13<<13}u=Me^c,(u|0)>=0?de[(i>>19&124)>>2]=fe[le+(u^3)|0]|0:de[(i>>19&124)>>2]=L(u|0)|0;break;case 36:if(c=(de[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ge^c)>>13){if(u=I(c,0)|0,(u|0)==-1)break;Ge=c,Ee=(u^c)>>13<<13}u=Ee^c,(u|0)>=0?de[(i>>19&124)>>2]=fe[le+(u^3)|0]<<24>>24:de[(i>>19&124)>>2]=(L(u|0)|0)<<24>>24;break;case 37:if(c=(de[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ne^c)>>13){if(u=I(c,0)|0,(u|0)==-1)break;Ne=c,xe=(u^c)>>13<<13}u=xe^c,(u|0)>=0?de[(i>>19&124)>>2]=pe[le+(u^2)>>1]:de[(i>>19&124)>>2]=_(u|0)|0;break;case 38:if(c=(de[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Oe^c)>>13){if(u=I(c,0)|0,(u|0)==-1)break;Oe=c,_e=(u^c)>>13<<13}u=_e^c,(u|0)>=0?de[(i>>19&124)>>2]=pe[le+(u^2)>>1]<<16>>16:de[(i>>19&124)>>2]=(_(u|0)|0)<<16>>16;break;case 39:s=i<<16>>16,h=de[(i>>14&124)>>2]|0,de[(i>>19&124)>>2]=h+s|0;break;case 41:de[(i>>19&124)>>2]=de[(i>>14&124)>>2]&(i&65535);break;case 42:de[(i>>19&124)>>2]=de[(i>>14&124)>>2]|i&65535;break;case 43:h=de[(i>>14&124)>>2]|0,de[(i>>19&124)>>2]=h^i<<16>>16;break;case 45:de[(i>>19&124)>>2]=v(de[(i>>14&124)>>2]|i&65535)|0;break;case 46:switch(i>>6&3){case 0:de[(i>>19&124)>>2]=de[(i>>14&124)>>2]<<(i&31);break;case 1:de[(i>>19&124)>>2]=de[(i>>14&124)>>2]>>>(i&31);break;case 2:de[(i>>19&124)>>2]=de[(i>>14&124)>>2]>>(i&31);break;default:T(W|0),A()}break;case 47:switch(s=i<<16>>16,i>>21&31){case 0:at=(de[(i>>14&124)>>2]|0)==(s|0);break;case 1:at=(de[(i>>14&124)>>2]|0)!=(s|0);break;case 2:at=de[(i>>14&124)>>2]>>>0>s>>>0;break;case 3:at=de[(i>>14&124)>>2]>>>0>=s>>>0;break;case 4:at=de[(i>>14&124)>>2]>>>0<s>>>0;break;case 5:at=de[(i>>14&124)>>2]>>>0<=s>>>0;break;case 10:at=(de[(i>>14&124)>>2]|0)>(s|0);break;case 11:at=(de[(i>>14&124)>>2]|0)>=(s|0);break;case 12:at=(de[(i>>14&124)>>2]|0)<(s|0);break;case 13:at=(de[(i>>14&124)>>2]|0)<=(s|0);break;default:T(W|0),A()}break;case 48:if(s=i&2047|i>>10&63488,y(de[(i>>14&124)>>2]|s,de[(i>>9&124)>>2]|0),yt&&(yt=0,!(Xe&1<<28)))return e|0;break;case 50:switch(h=i>>14&124,o=i>>9&124,d=i>>19&124,i&255){case 0:ce[d>>2]=+ce[h>>2]+ +ce[o>>2];break;case 1:ce[d>>2]=+ce[h>>2]-+ce[o>>2];break;case 2:ce[d>>2]=+ce[h>>2]*+ce[o>>2];break;case 3:ce[d>>2]=+ce[h>>2]/+ce[o>>2];break;case 4:ce[d>>2]=+(de[h>>2]|0);break;case 5:de[d>>2]=~~+w(+ce[h>>2]);break;case 7:ce[d>>2]=+ce[d>>2]+ +ce[h>>2]*+ce[o>>2];break;case 8:at=+ce[h>>2]==+ce[o>>2];break;case 9:at=+ce[h>>2]!=+ce[o>>2];break;case 10:at=+ce[h>>2]>+ce[o>>2];break;case 11:at=+ce[h>>2]>=+ce[o>>2];break;case 12:at=+ce[h>>2]<+ce[o>>2];break;case 13:at=+ce[h>>2]<=+ce[o>>2];break;default:T(W|0),A()}break;case 51:if(s=(i>>10&63488|i&2047)<<16>>16,c=(de[(i>>14&124)>>2]|0)+s|0,(He^c)>>13){if(u=I(c,1)|0,(u|0)==-1)break;He=c,Le=(u^c)>>13<<13}if(u=Le^c,at=(u|0)==(qe|0)?1:0,qe=-1,(at|0)==0)break;(u|0)>0?ue[le+u>>2]=de[(i>>9&124)>>2]|0:M(u|0,de[(i>>9&124)>>2]|0);break;case 53:if(s=(i>>10&63488|i&2047)<<16>>16,c=(de[(i>>14&124)>>2]|0)+s|0,(He^c)>>13){if(u=I(c,1)|0,(u|0)==-1)break;He=c,Le=(u^c)>>13<<13}u=Le^c,(u|0)>0?ue[le+u>>2]=de[(i>>9&124)>>2]|0:M(u|0,de[(i>>9&124)>>2]|0);break;case 54:if(s=(i>>10&63488|i&2047)<<16>>16,c=(de[(i>>14&124)>>2]|0)+s|0,(We^c)>>13){if(u=I(c,1)|0,(u|0)==-1)break;We=c,Ue=(u^c)>>13<<13}u=Ue^c,(u|0)>0?fe[le+(u^3)|0]=de[(i>>9&124)>>2]|0:U(u|0,de[(i>>9&124)>>2]|0);break;case 55:if(s=(i>>10&63488|i&2047)<<16>>16,c=(de[(i>>14&124)>>2]|0)+s|0,(je^c)>>13){if(u=I(c,1)|0,(u|0)==-1)break;je=c,Pe=(u^c)>>13<<13}u=Pe^c,(u|0)>=0?pe[le+(u^2)>>1]=de[(i>>9&124)>>2]:x(u|0,de[(i>>9&124)>>2]|0);break;case 56:switch(h=de[(i>>14&124)>>2]|0,o=de[(i>>9&124)>>2]|0,n=i>>19&124,i&975){case 0:de[n>>2]=h+o;break;case 2:de[n>>2]=h-o;break;case 3:de[n>>2]=h&o;break;case 4:de[n>>2]=h|o;break;case 5:de[n>>2]=h^o;break;case 8:de[n>>2]=h<<(o&31);break;case 72:de[n>>2]=h>>>(o&31);break;case 15:for(de[n>>2]=0,r=0;(r|0)<32;r=r+1|0)if(h&1<<r){de[n>>2]=r+1;break}break;case 136:de[n>>2]=h>>(o&31);break;case 271:for(de[n>>2]=0,r=31;(r|0)>=0;r=r-1|0)if(h&1<<r){de[n>>2]=r+1;break}break;case 774:de[n>>2]=C(h|0,o|0)|0;break;case 778:nt=(o|0)==0,ht=0,nt||(de[n>>2]=(h>>>0)/(o>>>0));break;case 777:nt=(o|0)==0,ht=0,nt||(de[n>>2]=(h|0)/(o|0));break;default:T(W|0),A()}break;case 57:switch(i>>21&31){case 0:at=(de[(i>>14&124)>>2]|0)==(de[(i>>9&124)>>2]|0);break;case 1:at=(de[(i>>14&124)>>2]|0)!=(de[(i>>9&124)>>2]|0);break;case 2:at=de[(i>>14&124)>>2]>>>0>de[(i>>9&124)>>2]>>>0;break;case 3:at=de[(i>>14&124)>>2]>>>0>=de[(i>>9&124)>>2]>>>0;break;case 4:at=de[(i>>14&124)>>2]>>>0<de[(i>>9&124)>>2]>>>0;break;case 5:at=de[(i>>14&124)>>2]>>>0<=de[(i>>9&124)>>2]>>>0;break;case 10:at=(de[(i>>14&124)>>2]|0)>(de[(i>>9&124)>>2]|0);break;case 11:at=(de[(i>>14&124)>>2]|0)>=(de[(i>>9&124)>>2]|0);break;case 12:at=(de[(i>>14&124)>>2]|0)<(de[(i>>9&124)>>2]|0);break;case 13:at=(de[(i>>14&124)>>2]|0)<=(de[(i>>9&124)>>2]|0);break;default:T(W|0),A()}break;default:T(W|0),A()}}return e|0}var w=e.Math.floor,C=t.imul,T=t.DebugMessage,A=t.abort,E=t.ReadMemory32,M=t.WriteMemory32,_=t.ReadMemory16,x=t.WriteMemory16,L=t.ReadMemory8,U=t.WriteMemory8,P=0,F=1,z=2,G=3,B=4,O=5,N=6,H=7,W=8,j=1,q=17,X=48,K=32,Q=64,V=4,Y=3,J=6,Z=5,$=0,ee=2560,te=1024,ie=256,se=2304,re=768,ae=1280,ne=2048,he=3072,oe=3584,de=new e.Int32Array(i),ce=new e.Float32Array(i),ue=new e.Int32Array(i),fe=new e.Uint8Array(i),pe=new e.Uint16Array(i),le=1048576,be=8192,me=16384,Re=24576,ye=0,ve=0,ke=0,ge=-4,Se=0,Ie=0,De=0,we=0,Ce=0,Te=-1,Ae=-1,Ee=-1,Me=-1,_e=-1,xe=-1,Le=-1,Ue=-1,Pe=-1,Fe=-1,ze=-1,Ge=-1,Be=-1,Oe=-1,Ne=-1,He=-1,We=-1,je=-1,qe=-1,Xe=0,Ke=0,Qe=3,Ve=0,Ye=1,Je=0,Ze=0,$e=0,et=0,tt=0,it=0,st=0,rt=0,at=0,nt=0,ht=0,ot=0,dt=0,ct=0,ut=1,ft=0,pt=0,lt=0,bt=0,mt=0,Rt=0,yt=0;return{Init:s,Reset:r,InvalidateTLB:a,Step:D,GetFlags:l,SetFlags:p,PutState:h,GetState:o,GetTimeToNextInterrupt:d,ProgressTime:c,GetTicks:u,RaiseInterrupt:m,ClearInterrupt:R,AnalyzeImage:f,GetStat:n}}e("../messagehandler");t.exports=s},{"../messagehandler":25}],4:[function(e,t,i){"use strict";function s(e,t,i,s){var r={DebugMessage:n.Debug,abort:n.Abort,imul:o,ReadMemory32:t.ReadMemory32.bind(t),WriteMemory32:t.WriteMemory32.bind(t),ReadMemory16:t.ReadMemory16.bind(t),WriteMemory16:t.WriteMemory16.bind(t),ReadMemory8:t.ReadMemory8.bind(t),WriteMemory8:t.WriteMemory8.bind(t)};return"asm"===e?(null===f&&(f=d(l,r,i),f.Init()),f):"smp"===e?(null===p&&(p=u(l,r,i),p.Init(s)),p):void 0}function r(e,t,i,r){var a=null;if("safe"===e)return new c(t);if("asm"===e)return a=s(e,t,i,r),a.Init(),a;if("smp"===e)return a=s(e,t,i,r),a.Init(r),a;throw new Error("invalid CPU name:"+e)}function a(e,t,i,s){return this.cpu=r(e,t,i,s),this.name=e,this.ncores=s,this.ram=t,this.heap=i,this}var n=e("../messagehandler"),h=e("../utils").ToHex,o=e("../imul"),d=e("./fastcpu.js"),c=e("./safecpu.js"),u=e("./smpcpu.js"),f=null,p=null,l={Int32Array:Int32Array,Float32Array:Float32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Math:Math};a.prototype.switchImplementation=function(e){var t=this.cpu,i=this.name;if("smp"!=i){this.cpu=r(e,this.ram,this.heap,this.ncores),this.cpu.InvalidateTLB();var s=t.GetFlags();this.cpu.SetFlags(0|s);var a;"asm"===i?(a=new Int32Array(this.heap),t.GetState(),this.cpu.pc=a[64],this.cpu.nextpc=a[65],this.cpu.delayedins=a[66]?!0:!1,this.cpu.TTMR=a[68],this.cpu.TTCR=a[69],this.cpu.PICMR=a[70],this.cpu.PICSR=a[71],this.cpu.boot_dtlb_misshandler_address=a[72],this.cpu.boot_itlb_misshandler_address=a[73],this.cpu.current_pgd=a[74]):"asm"===e?(a=new Int32Array(this.heap),a[64]=t.pc,a[65]=t.nextpc,a[66]=t.delayedins,a[67]=0,a[68]=t.TTMR,a[69]=t.TTCR,a[70]=t.PICMR,a[71]=t.PICSR,a[72]=t.boot_dtlb_misshandler_address,a[73]=t.boot_itlb_misshandler_address,a[74]=t.current_pgd,this.cpu.PutState()):(this.cpu.pc=t.pc,this.cpu.nextpc=t.nextpc,this.cpu.delayedins=t.delayedins,this.cpu.TTMR=t.TTMR,this.cpu.TTCR=t.TTCR,this.cpu.PICMR=t.PICMR,this.cpu.PICSR=t.PICSR,this.cpu.boot_dtlb_misshandler_address=t.boot_dtlb_misshandler_address,this.cpu.boot_itlb_misshandler_address=t.itlb_misshandler_address,this.cpu.current_pgd=t.current_pgd)}},a.prototype.toString=function(){var e=new Uint32Array(this.heap),t="";t+="Current state of the machine\n",t+="PC: "+h(this.cpu.pc<<2)+"\n",t+="next PC: "+h(this.cpu.nextpc<<2)+"\n";for(var i=0;32>i;i+=4)t+="   r"+(i+0)+": "+h(e[i+0])+"   r"+(i+1)+": "+h(e[i+1])+"   r"+(i+2)+": "+h(e[i+2])+"   r"+(i+3)+": "+h(e[i+3])+"\n";return this.cpu.delayedins&&(t+="delayed instruction\n"),t+=this.cpu.SR_SM?"Supervisor mode\n":"User mode\n",this.cpu.SR_TEE&&(t+="tick timer exception enabled\n"),this.cpu.SR_IEE&&(t+="interrupt exception enabled\n"),this.cpu.SR_DME&&(t+="data mmu enabled\n"),this.cpu.SR_IME&&(t+="instruction mmu enabled\n"),this.cpu.SR_LEE&&(t+="little endian enabled\n"),this.cpu.SR_CID&&(t+="context id enabled\n"),this.cpu.SR_F&&(t+="flag set\n"),this.cpu.SR_CY&&(t+="carry set\n"),this.cpu.SR_OV&&(t+="overflow set\n"),t};var b=["Reset","Step","RaiseInterrupt","Step","AnalyzeImage","GetTicks","GetTimeToNextInterrupt","ProgressTime","ClearInterrupt"];b.forEach(function(e){a.prototype[e]=function(){return this.cpu[e].apply(this.cpu,arguments)}}),t.exports=a},{"../imul":24,"../messagehandler":25,"../utils":29,"./fastcpu.js":3,"./safecpu.js":5,"./smpcpu.js":6}],5:[function(e,t,i){"use strict";function s(e){this.ram=e,this.r=new Int32Array(this.ram.heap,0,136),this.f=new Float32Array(this.ram.heap,0,128),this.group0=new Int32Array(this.ram.heap,8192,8192),this.group1=new Int32Array(this.ram.heap,16384,8192),this.group2=new Int32Array(this.ram.heap,24576,8192),this.pc=0,this.nextpc=0,this.delayedins=!1,this.clock=0,this.EA=-1,this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.SR_SM=!0,this.SR_TEE=!1,this.SR_IEE=!1,this.SR_DCE=!1,this.SR_ICE=!1,this.SR_DME=!1,this.SR_IME=!1,this.SR_LEE=!1,this.SR_CE=!1,this.SR_F=!1,this.SR_CY=!1,this.SR_OV=!1,this.SR_OVE=!1,this.SR_DSX=!1,this.SR_EPH=!1,this.SR_FO=!0,this.SR_SUMRA=!1,this.SR_CID=0,this.Reset()}var r=e("../messagehandler"),a=e("../utils"),n=1,h=17,o=48,d=32,c=64,u=4,f=3,p=6,l=5,b=0,m=2560,R=1024,y=256,v=2304,k=768,g=512,S=1280,I=2048,D=3072,w=3584;s.prototype.Reset=function(){this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.group0[u]=24,this.group0[f]=24,this.group0[p]=72,this.group0[l]=72,this.group0[b]=301989889,this.group0[n]=1561,this.Exception(y,0),this.pc=this.nextpc,this.nextpc++},s.prototype.InvalidateTLB=function(){},s.prototype.GetTimeToNextInterrupt=function(){if(this.TTMR>>30==0)return-1;var e=(268435455&this.TTMR)-(268435455&this.TTCR);return e+=0>e?268435455:0},s.prototype.GetTicks=function(){return this.TTMR>>30==0?-1:268435455&this.TTCR},s.prototype.ProgressTime=function(e){this.TTCR=this.TTCR+e&4294967295},s.prototype.AnalyzeImage=function(){this.boot_dtlb_misshandler_address=0,this.boot_itlb_misshandler_address=0,this.current_pgd=0},s.prototype.SetFlags=function(e){this.SR_SM=1&e?!0:!1,this.SR_TEE=2&e?!0:!1;var t=this.SR_IEE;this.SR_IEE=4&e?!0:!1,this.SR_DCE=8&e?!0:!1,this.SR_ICE=16&e?!0:!1;this.SR_DME;this.SR_DME=32&e?!0:!1;this.SR_IME;this.SR_IME=64&e?!0:!1,this.SR_LEE=128&e?!0:!1,this.SR_CE=256&e?!0:!1,this.SR_F=512&e?!0:!1,this.SR_CY=1024&e?!0:!1,this.SR_OV=2048&e?!0:!1,this.SR_OVE=4096&e?!0:!1,this.SR_DSX=8192&e?!0:!1,this.SR_EPH=16384&e?!0:!1,this.SR_FO=!0,this.SR_SUMRA=65536&e?!0:!1,this.SR_CID=e>>28&15,this.SR_LEE&&(r.Debug("little endian not supported"),r.Abort()),this.SR_CID&&(r.Debug("context id not supported"),r.Abort()),this.SR_EPH&&(r.Debug("exception prefix not supported"),r.Abort()),this.SR_DSX&&(r.Debug("delay slot exception not supported"),r.Abort()),this.SR_IEE&&!t&&this.CheckForInterrupt()},s.prototype.GetFlags=function(){var e=0;return e|=this.SR_SM?1:0,e|=this.SR_TEE?2:0,e|=this.SR_IEE?4:0,e|=this.SR_DCE?8:0,e|=this.SR_ICE?16:0,e|=this.SR_DME?32:0,e|=this.SR_IME?64:0,e|=this.SR_LEE?128:0,e|=this.SR_CE?256:0,e|=this.SR_F?512:0,e|=this.SR_CY?1024:0,e|=this.SR_OV?2048:0,e|=this.SR_OVE?4096:0,e|=this.SR_DSX?8192:0,e|=this.SR_EPH?16384:0,e|=this.SR_FO?32768:0,e|=this.SR_SUMRA?65536:0,e|=this.SR_CID<<28},s.prototype.CheckForInterrupt=function(){this.SR_IEE&&this.PICMR&this.PICSR&&(this.Exception(I,this.group0[o]),this.pc=this.nextpc++)},s.prototype.RaiseInterrupt=function(e,t){var i=1<<e;this.PICSR|=i,this.CheckForInterrupt()},s.prototype.ClearInterrupt=function(e,t){this.PICSR&=~(1<<e)},s.prototype.SetSPR=function(e,t){var i=2047&e,s=e>>11&31;switch(s){case 0:i==h&&this.SetFlags(t),this.group0[i]=t;break;case 1:this.group1[i]=t;break;case 2:this.group2[i]=t;break;case 3:case 4:break;case 8:break;case 9:switch(i){case 0:this.PICMR=3|t,this.SR_IEE&&this.PICMR&this.PICSR&&(r.Debug("Error in SetSPR: Direct triggering of interrupt exception not supported?"),r.Abort());break;case 2:break;default:r.Debug("Error in SetSPR: interrupt address not supported"),r.Abort()}break;case 10:switch(i){case 0:this.TTMR=t,3!=(this.TTMR>>30&3);break;case 1:this.TTCR=t;break;default:r.Debug("Error in SetSPR: Tick timer address not supported"),r.Abort()}break;default:r.Debug("Error in SetSPR: group "+s+" not found"),r.Abort()}},s.prototype.GetSPR=function(e){var t=2047&e,i=e>>11&31;switch(i){case 0:return t==h?this.GetFlags():this.group0[t];case 1:return this.group1[t];case 2:return this.group2[t];case 8:return 0;case 9:switch(t){case 0:return this.PICMR;case 2:return this.PICSR;default:r.Debug("Error in GetSPR: PIC address unknown"),r.Abort()}break;case 10:switch(t){case 0:return this.TTMR;case 1:return this.TTCR;default:r.Debug("Error in GetSPR: Tick timer address unknown"),r.Abort()}break;default:r.Debug("Error in GetSPR: group "+i+" unknown"),r.Abort()}},s.prototype.Exception=function(e,t){var i=e|(this.SR_EPH?4026531840:0);switch(this.SetSPR(o,t),this.SetSPR(c,this.GetFlags()),this.EA=-1,this.SR_OVE=!1,this.SR_SM=!0,this.SR_IEE=!1,this.SR_TEE=!1,this.SR_DME=!1,this.nextpc=i>>2,e){case y:break;case m:case R:case v:case k:case g:case S:case I:case w:this.SetSPR(d,(this.pc<<2)-(this.delayedins?4:0));break;case D:this.SetSPR(d,(this.pc<<2)+4-(this.delayedins?4:0));break;default:r.Debug("Error in Exception: exception type not supported"),r.Abort()}e==S&&this.TTMR>>30==1&&(this.TTCR=0),this.delayedins=!1,this.SR_IME=!1},s.prototype.DTLBLookup=function(e,t){if(!this.SR_DME)return e;var i=e>>13&63,s=this.group1[512|i];if(0==(1&s)||s>>19!=e>>19)return this.Exception(v,e),-1;192&s&&(r.Debug("Error: LRU ist not supported"),r.Abort());var a=this.group1[640|i];if(this.SR_SM){if(!t&&!(256&a)||t&&!(512&a))return this.Exception(k,e),-1}else if(!t&&!(64&a)||t&&!(128&a))return this.Exception(k,e),-1;return 4294959104&a|8191&e},s.prototype.GetInstruction=function(e){if(!this.SR_IME)return this.ram.ReadMemory32(e);var t=e>>13&63;t&=63;var i=this.group2[512|t];if(0==(1&i)||i>>19!=e>>19)return this.Exception(m,this.pc<<2),-1;192&i&&(r.Debug("Error: LRU ist not supported"),r.Abort());var s=this.group2[640|t];if(this.SR_SM){if(!(64&s))return this.Exception(R,this.pc<<2),-1}else if(!(128&s))return this.Exception(R,this.pc<<2),-1;return this.ram.ReadMemory32(4294959104&s|8191&e)},s.prototype.Step=function(e,t){var i=0,s=0,n=0,h=0,u=0,f=0,p=0,l=this.r,b=this.f,m=this.ram,R=this.ram.int32mem,y=(this.group2,0),v=0;do if(this.clock++,63&e||(this.TTMR>>30!=0&&(v=(268435455&this.TTMR)-(268435455&this.TTCR),v+=0>v?268435455:0,this.TTCR=this.TTCR+t&4294967295,t>v&&this.TTMR&1<<29&&(this.TTMR|=1<<28)),this.SR_TEE&&this.TTMR&1<<28&&(this.Exception(S,this.group0[o]),this.pc=this.nextpc++)),i=this.GetInstruction(this.pc<<2),-1!=i){switch(i>>26&63){case 0:y=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=y,this.delayedins=!0;continue;case 1:y=this.pc+(i<<6>>6),l[9]=(this.nextpc<<2)+4,this.pc=this.nextpc,this.nextpc=y,this.delayedins=!0;continue;case 3:if(this.SR_F)break;y=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=y,this.delayedins=!0;continue;case 4:if(!this.SR_F)break;y=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=y,this.delayedins=!0;continue;case 5:break;case 6:h=i>>21&31,65536&i?(r.Debug("Error: macrc not supported\n"),r.Abort()):l[h]=(65535&i)<<16;break;case 8:553648128==(4294901760&i)?(r.Debug("Trap at "+a.ToHex(this.pc<<2)),this.Exception(w,this.group0[o])):this.Exception(D,this.group0[o]);break;case 9:this.nextpc=this.GetSPR(d)>>2,this.pc=this.nextpc++,this.delayedins=!1,this.SetFlags(this.GetSPR(c));continue;case 17:y=l[i>>11&31]>>2,this.pc=this.nextpc,this.nextpc=y,this.delayedins=!0;continue;case 18:y=l[i>>11&31]>>2,l[9]=(this.nextpc<<2)+4,this.pc=this.nextpc,this.nextpc=y,this.delayedins=!0;continue;case 27:if(l[32]=l[i>>16&31]+(i<<16>>16),0!=(3&l[32])&&(r.Debug("Error in lwz: no unaligned access allowed"),abort()),l[33]=this.DTLBLookup(l[32],!1),-1==l[33])break;this.EA=l[33],l[i>>21&31]=l[33]>0?m.int32mem[l[33]>>2]:m.ReadMemory32(l[33]);break;case 33:if(l[32]=l[i>>16&31]+(i<<16>>16),0!=(3&l[32])&&(r.Debug("Error in lwz: no unaligned access allowed"),abort()),l[33]=this.DTLBLookup(l[32],!1),-1==l[33])break;l[i>>21&31]=l[33]>0?m.int32mem[l[33]>>2]:m.ReadMemory32(l[33]);break;case 35:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),-1==l[33])break;l[i>>21&31]=m.ReadMemory8(l[33]);break;case 36:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),-1==l[33])break;l[i>>21&31]=m.ReadMemory8(l[33])<<24>>24;break;case 37:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),-1==l[33])break;l[i>>21&31]=m.ReadMemory16(l[33]);break;case 38:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),-1==l[33])break;l[i>>21&31]=m.ReadMemory16(l[33])<<16>>16;break;case 39:s=i<<16>>16,u=l[i>>16&31],h=i>>21&31,l[h]=u+s,this.SR_CY=l[h]<u,this.SR_OV=(u^s^-1)&(u^l[h])&2147483648?!0:!1;break;case 41:l[i>>21&31]=l[i>>16&31]&(65535&i);break;case 42:l[i>>21&31]=l[i>>16&31]|65535&i;break;case 43:u=l[i>>16&31],l[i>>21&31]=u^i<<16>>16;break;case 45:l[i>>21&31]=this.GetSPR(l[i>>16&31]|65535&i);break;case 46:switch(i>>6&3){case 0:l[i>>21&31]=l[i>>16&31]<<(31&i);break;case 1:l[i>>21&31]=l[i>>16&31]>>>(31&i);break;case 2:l[i>>21&31]=l[i>>16&31]>>(31&i);
break;default:r.Debug("Error: opcode 2E function not implemented"),abort()}break;case 47:switch(s=i<<16>>16,i>>21&31){case 0:this.SR_F=l[i>>16&31]==s?!0:!1;break;case 1:this.SR_F=l[i>>16&31]!=s?!0:!1;break;case 2:this.SR_F=l[i>>16&31]>>>0>s>>>0?!0:!1;break;case 3:this.SR_F=l[i>>16&31]>>>0>=s>>>0?!0:!1;break;case 4:this.SR_F=l[i>>16&31]>>>0<s>>>0?!0:!1;break;case 5:this.SR_F=l[i>>16&31]>>>0<=s>>>0?!0:!1;break;case 10:this.SR_F=l[i>>16&31]>s?!0:!1;break;case 11:this.SR_F=l[i>>16&31]>=s?!0:!1;break;case 12:this.SR_F=l[i>>16&31]<s?!0:!1;break;case 13:this.SR_F=l[i>>16&31]<=s?!0:!1;break;default:r.Debug("Error: sf...i not supported yet"),abort()}break;case 48:s=2047&i|i>>10&63488,this.pc=this.nextpc++,this.delayedins=!1,this.SetSPR(l[i>>16&31]|s,l[i>>11&31]);continue;case 50:switch(u=i>>16&31,f=i>>11&31,p=i>>21&31,255&i){case 0:b[p]=b[u]+b[f];break;case 1:b[p]=b[u]-b[f];break;case 2:b[p]=b[u]*b[f];break;case 3:b[p]=b[u]/b[f];break;case 4:b[p]=l[u];break;case 5:l[p]=b[u];break;case 7:b[p]+=b[u]*b[f];break;case 8:this.SR_F=b[u]==b[f]?!0:!1;break;case 9:this.SR_F=b[u]!=b[f]?!0:!1;break;case 10:this.SR_F=b[u]>b[f]?!0:!1;break;case 11:this.SR_F=b[u]>=b[f]?!0:!1;break;case 12:this.SR_F=b[u]<b[f]?!0:!1;break;case 13:this.SR_F=b[u]<=b[f]?!0:!1;break;default:r.Debug("Error: lf. function "+a.ToHex(255&i)+" not supported yet"),r.Abort()}break;case 51:if(s=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+s,3&l[32]&&(r.Debug("Error in sw: no aligned memory access"),abort()),l[33]=this.DTLBLookup(l[32],!0),-1==l[33])break;if(this.SR_F=l[33]==this.EA?!0:!1,this.EA=-1,0==this.SR_F)break;l[33]>0?R[l[33]>>2]=l[i>>11&31]:m.WriteMemory32(l[33],l[i>>11&31]);break;case 53:if(s=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+s,3&l[32]&&(r.Debug("Error in sw: no aligned memory access"),r.Abort()),l[33]=this.DTLBLookup(l[32],!0),-1==l[33])break;l[33]>0?R[l[33]>>2]=l[i>>11&31]:m.WriteMemory32(l[33],l[i>>11&31]);break;case 54:if(s=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+s,l[33]=this.DTLBLookup(l[32],!0),-1==l[33])break;m.WriteMemory8(l[33],l[i>>11&31]);break;case 55:if(s=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+s,l[33]=this.DTLBLookup(l[32],!0),-1==l[33])break;m.WriteMemory16(l[33],l[i>>11&31]);break;case 56:switch(u=l[i>>16&31],f=l[i>>11&31],h=i>>21&31,975&i){case 0:l[h]=u+f,this.SR_CY=l[h]<u,this.SR_OV=(u^f^-1)&(u^l[h])&2147483648?!0:!1;break;case 2:l[h]=u-f,this.SR_CY=f>u,this.SR_OV=(u^f)&(u^l[h])&2147483648?!0:!1;break;case 3:l[h]=u&f;break;case 4:l[h]=u|f;break;case 5:l[h]=u^f;break;case 8:l[h]=u<<(31&f);break;case 72:l[h]=u>>>(31&f);break;case 15:for(l[h]=0,n=0;32>n;n++)if(u&1<<n){l[h]=n+1;break}break;case 136:l[h]=u>>(31&f);break;case 271:for(l[h]=0,n=31;n>=0;n--)if(u&1<<n){l[h]=n+1;break}break;case 774:l[h]=a.int32(u>>0)*a.int32(f);var k=65535&u,g=65535&f;l[h]=4294901760&l[h]|k*g&65535;var I=Number(a.int32(u))*Number(a.int32(f));this.SR_OV=-2147483648>I||I>2147483647;var C=a.uint32(u)*a.uint32(f);this.SR_CY=C>4294967295;break;case 778:this.SR_CY=0==f,this.SR_OV=!1,this.SR_CY||(l[h]=(u>>>0)/(f>>>0));break;case 777:this.SR_CY=0==f,this.SR_OV=!1,this.SR_CY||(l[h]=u/f);break;default:r.Debug("Error: op38 opcode not supported yet"),r.Abort()}break;case 57:switch(i>>21&31){case 0:this.SR_F=l[i>>16&31]==l[i>>11&31]?!0:!1;break;case 1:this.SR_F=l[i>>16&31]!=l[i>>11&31]?!0:!1;break;case 2:this.SR_F=l[i>>16&31]>>>0>l[i>>11&31]>>>0?!0:!1;break;case 3:this.SR_F=l[i>>16&31]>>>0>=l[i>>11&31]>>>0?!0:!1;break;case 4:this.SR_F=l[i>>16&31]>>>0<l[i>>11&31]>>>0?!0:!1;break;case 5:this.SR_F=l[i>>16&31]>>>0<=l[i>>11&31]>>>0?!0:!1;break;case 10:this.SR_F=l[i>>16&31]>l[i>>11&31]?!0:!1;break;case 11:this.SR_F=l[i>>16&31]>=l[i>>11&31]?!0:!1;break;case 12:this.SR_F=l[i>>16&31]<l[i>>11&31]?!0:!1;break;case 13:this.SR_F=l[i>>16&31]<=l[i>>11&31]?!0:!1;break;default:r.Debug("Error: sf.... function supported yet"),r.Abort()}break;default:r.Debug("Error: Instruction with opcode "+a.ToHex(i>>>26)+" not supported"),r.Abort()}this.pc=this.nextpc++,this.delayedins=!1}else this.pc=this.nextpc++;while(--e);return 0},t.exports=s},{"../messagehandler":25,"../utils":29}],6:[function(e,t,i){function s(e,t,i){"use asm";function s(e){e|=0,ge=e|0,Se=(ge|0)==32?4294967295:(1<<ge)-1|0,b(),r()}function r(){var e=0;for(Ie=Se,Mt=0,e=0;(e|0)<(ge|0);e=e+1|0)ye[we+st>>2]=0,ye[we+rt>>2]=0,ye[we+at>>2]=3,ye[we+nt>>2]=0,ye[we+Te+(ee<<2)>>2]=24,ye[we+Te+(te<<2)>>2]=24,ye[we+Te+(ie<<2)>>2]=0,ye[we+Te+(se<<2)>>2]=0,ye[we+Te+(re<<2)>>2]=301989889,ye[we+Te+(ae<<2)>>2]=De|0,ye[we+Te+(ne<<2)>>2]=2,ye[we+Te+(V<<2)>>2]=1561,_e=0,xe=0,Le=-4,D(de,0),a()}function a(){var e=0;if((ge|0)!=1&&(e=De|0,(Ie|0)==0&&(_(Q|0),x()),!((Ie&Ie-1)==0&&Ie&1<<De))){do e=e+1|0,(e|0)>=(ge|0)&&(e=0);while((Ie&1<<e)==0);(e|0)!=(De|0)&&(ye[we+288>>2]=y()|0,ye[we+292>>2]=Me,ye[we+296>>2]=_e,ye[we+300>>2]=xe,ye[we+304>>2]=Le,ye[we+308>>2]=Ue,ye[we+312>>2]=Fe,ye[we+316>>2]=ze,ye[we+400>>2]=Pe,ye[we+404>>2]=Ge,ye[we+320>>2]=Be,ye[we+324>>2]=Oe,ye[we+328>>2]=Ne,ye[we+332>>2]=He,ye[we+336>>2]=We,ye[we+340>>2]=je,ye[we+344>>2]=qe,ye[we+348>>2]=Xe,ye[we+352>>2]=Ke,ye[we+356>>2]=Qe,ye[we+360>>2]=Ve,ye[we+364>>2]=Ye,ye[we+368>>2]=Je,ye[we+372>>2]=Ze,ye[we+376>>2]=$e,ye[we+380>>2]=et,ye[we+384>>2]=tt,ye[we+388>>2]=it,De=e|0,we=De<<15,m(ye[we+288>>2]|0),Me=ye[we+292>>2]|0,_e=ye[we+296>>2]|0,xe=ye[we+300>>2]|0,Le=ye[we+304>>2]|0,Ue=ye[we+308>>2]|0,Fe=ye[we+312>>2]|0,ze=ye[we+316>>2]|0,Pe=ye[we+400>>2]|0,Ge=ye[we+404>>2]|0,Be=ye[we+320>>2]|0,Oe=ye[we+324>>2]|0,Ne=ye[we+328>>2]|0,He=ye[we+332>>2]|0,We=ye[we+336>>2]|0,je=ye[we+340>>2]|0,qe=ye[we+344>>2]|0,Xe=ye[we+348>>2]|0,Ke=ye[we+352>>2]|0,Qe=ye[we+356>>2]|0,Ve=ye[we+360>>2]|0,Ye=ye[we+364>>2]|0,Je=ye[we+368>>2]|0,Ze=ye[we+372>>2]|0,$e=ye[we+376>>2]|0,et=ye[we+380>>2]|0,tt=ye[we+384>>2]|0,it=ye[we+388>>2]|0)}}function n(){Be=-1,Oe=-1,Ne=-1,He=-1,We=-1,je=-1,qe=-1,Xe=-1,Ke=-1,Qe=-1,Ve=-1,Ye=-1,Je=-1,Ze=-1,$e=-1,et=-1,tt=-1,it=-1}function h(){}function o(){}function d(e){e|=0,Ie|=1<<e,ye[(e<<15)+st>>2]=ye[(e<<15)+st>>2]|0|1<<28}function c(e){e|=0;var t=0;return t=ye[(e<<15)+st>>2]>>29?1:0,t|0}function u(e){e|=0;var t=0;return t=(ye[(e<<15)+st>>2]&268435455)-(ye[rt>>2]&268435455)|0,(t|0)<0&&(t=t+268435455|0),t|0}function f(){var e=268435455,t=0,i=0;for(i=0;(i|0)<(ge|0);i=i+1|0)c(i)|0&&(t=u(i)|0,(t|0)<(e|0)&&(e=t|0));return e|0}function p(e){e|=0;ye[rt>>2]=(ye[rt>>2]|0)+e|0,Ie=Se}function l(){return ye[rt>>2]&268435455|0}function b(){Tt=ye[Ce+2304>>2]|0,At=ye[Ce+2560>>2]|0,Et=(ye[Ce+8208>>2]&4095)<<16|ye[Ce+8212>>2]&65535|0}function m(e){e|=0,dt=e&1,ct=e&2,ut=e&4,ft=e&8,pt=e&16,lt=e&32,bt=e&64,mt=e&128,Rt=e&256,yt=e&512,vt=e&1024,kt=e&2048,gt=e&4096,St=e&8192,It=e&16384,Dt=1,wt=e&65536,Ct=e>>28&15}function R(e){e|=0;var t=0;t=ut,m(e),mt&&(_(B|0),x()),Ct&&(_(O|0),x()),It&&(_(N|0),x()),St&&(_(H|0),x()),ut&&(t|0)==0&&v(De)}function y(){var e=0;return e|=dt?1:0,e|=ct?2:0,e|=ut?4:0,e|=ft?8:0,e|=pt?16:0,e|=lt?32:0,e|=bt?64:0,e|=mt?128:0,e|=Rt?256:0,e|=yt?512:0,e|=vt?1024:0,e|=kt?2048:0,e|=gt?4096:0,e|=St?8192:0,e|=It?16384:0,e|=Dt?32768:0,e|=wt?65536:0,e|=Ct<<28,e|0}function v(e){e|=0;var t=0;ye[we+288>>2]=y()|0,t=ye[(e<<15)+288>>2]|0,t&4&&ye[(e<<15)+at>>2]&ye[(e<<15)+nt>>2]&&(Ie|=1<<e,ye[(e<<15)+ht>>2]=1)}function k(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(s=1<<e|0,(t|0)==-1)for(i=0;(i|0)<(ge|0);i=i+1|0)r=(i<<15)+nt|0,ye[r>>2]=ye[r>>2]|0|s,v(i);else r=(t<<15)+nt|0,ye[r>>2]=ye[r>>2]|0|s,v(t)}function g(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(s=1<<e|0,(t|0)==-1)for(i=0;(i|0)<(ge|0);i=i+1|0)r=(i<<15)+nt|0,ye[r>>2]=ye[r>>2]&~s;else r=(t<<15)+nt|0,ye[r>>2]=ye[r>>2]&~s}function S(e,t){e|=0,t|=0;var i=0,s=0;switch(i=e&2047,s=e>>11&31,s|0){case 0:(i|0)==(Y|0)&&R(t),ye[we+Te+(i<<2)>>2]=t;break;case 1:ye[we+Ae+(i<<2)>>2]=t;break;case 2:ye[we+Ee+(i<<2)>>2]=t;break;case 3:case 4:break;case 8:Ie&=~(1<<De);break;case 9:switch(i|0){case 0:ye[we+at>>2]=t|3,ut&&ye[we+at>>2]&ye[we+nt>>2]&&(_(W|0),x());break;case 2:break;default:_(j|0),x()}break;case 10:switch(i|0){case 0:ye[we+st>>2]=t|0,(ye[we+st>>2]>>30&3)!=3&&(_(q|0),x());break;case 1:break;default:_(K|0),x()}break;default:_(K|0),x()}}function I(e){e|=0;var t=0,i=0;switch(t=e&2047,i=e>>11&31,i|0){case 0:return(t|0)==(Y|0)?y()|0:ye[we+Te+(t<<2)>>2]|0;case 1:return ye[we+Ae+(t<<2)>>2]|0;case 2:return ye[we+Ee+(t<<2)>>2]|0;case 8:return 0;case 9:switch(t|0){case 0:return ye[we+at>>2]|0;case 2:return ye[we+nt>>2]|0;default:_(K|0),x()}break;case 10:switch(t|0){case 0:return ye[we+st>>2]|0;case 1:return ye[rt>>2]|0;default:_(K|0),x()}break;default:_(K|0),x()}return 0}function D(e,t){e|=0,t|=0;var i=0;switch(i=e|(It?4026531840:0),Ie|=1<<De,S(J,t),S($,y()|0),gt=0,dt=1,ut=0,ct=0,lt=0,Be=0,Oe=0,Ne=0,He=0,We=0,je=0,qe=0,Xe=0,Ke=0,Qe=0,Ve=0,Je=0,Ye=0,$e=0,Ze=0,et=0,tt=0,it=0,Ue=_e|0,Fe=i,e|0){case 256:break;case 768:case 2304:case 3584:case 512:Me=Le+_e|0,S(Z,Me-(Pe?4:0)|0);break;case 2560:case 1024:case 1280:case 2048:S(Z,Me-(Pe?4:0)|0);break;case 3072:Me=Le+_e|0,S(Z,Me+4-(Pe?4:0)|0);break;default:_(X|0),x()}Pe=0,bt=0,ye[we+ot>>2]=-1,Mt&=~(1<<De)}function w(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(ye[Ce+2304>>2]|0)==(Tt|0)?(D(ce,e),0):(i=e,s=ye[Ce+Et+(De<<2)>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=ye[Ce+r>>2]|0,(s|0)==0?(D(ue,e),0):(s=4294959104,r=ye[Ce+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=ye[Ce+s>>2]|0,(i&1)==0?(D(ue,e),0):(r=i&4294960122,a&=t-1,ye[we+Ae+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,ye[we+Ae+((512|a)<<2)>>2]=r,1)))}function C(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(ye[Ce+2560>>2]|0)==(At|0)?(D(he,e),0):(i=e,s=ye[Ce+Et+(De<<2)>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=ye[Ce+r>>2]|0,(s|0)==0?(D(oe,e),0):(s=4294959104,r=ye[Ce+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=ye[Ce+s>>2]|0,(i&1)==0?(D(oe,e),0):(r=i&4294959162,s=i&1984,(s|0)!=0&&(a&=t-1,r|=192),ye[we+Ee+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,ye[we+Ee+((512|a)<<2)>>2]=r,1)))}function T(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(!lt)return e|0;if(i=e>>13&63,s=ye[we+Ae+((512|i)<<2)>>2]|0,(s&1)==0){if(!(w(e,64)|0))return-1;s=ye[we+Ae+(512+i<<2)>>2]|0}if(s>>19!=e>>19){if(!(w(e,64)|0))return-1;s=ye[we+Ae+(512+i<<2)>>2]|0}if(r=ye[we+Ae+((640|i)<<2)>>2]|0,dt){if(t){if(!(r&512))return D(ue,e),-1}else if(!(r&256))return D(ue,e),-1}else if(t){if(!(r&128))return D(ue,e),-1}else if(!(r&64))return D(ue,e),-1;return r&4294959104|e&8191|0}function A(e,t){e|=0,t|=0;for(var i=0,s=0,r=0,h=0,o=0,f=0,p=0,l=0,b=0,m=0,y=0,v=0,k=0,g=0,w=0;;){if((_e|0)==(Ue|0)){if(Me=Fe,!Ge|0&&(Pe=0),w=w-(_e-xe>>2)|0,(w|0)<=0&&!(Ge|0)){for(w=w+64|0,e=e-64|0,r=0;(r|0)<(ge|0);r=r+1|0)c(r)|0&&(g=u(r)|0,(g|0)<(t|0)&&d(r));if(ye[rt>>2]=(ye[rt>>2]|0)+t|0,(e|0)<0)return 0}if(ut|0&&(ye[we+st>>2]&1<<28?(D(fe,ye[we+Te+(J<<2)>>2]|0),Me=Fe):ye[we+ht>>2]|0&&(ye[we+ht>>2]=0,D(pe,ye[we+Te+(J<<2)>>2]|0),Me=Fe)),(Qe^Me)&4294959104)if(Qe=Me,bt){if(y=Me>>13&63,v=ye[we+Ee+((512|y)<<2)>>2]|0,(v&1)==0){if(!(C(Me,64)|0)){xe=_e,Ge=0;continue}v=ye[we+Ee+((512|y)<<2)>>2]|0}if(v>>19!=Me>>19){if(!(C(Me,64)|0)){xe=_e,Ge=0;continue}v=ye[we+Ee+((512|y)<<2)>>2]|0}k=ye[we+Ee+((640|y)<<2)>>2]|0,Be=(k^v)>>13<<13}else Be=0;if(_e=Ce+(Be^Me)|0,xe=_e,Le=Me-4-xe|0,Ge|0?(Ge=0,Ue=_e+4|0,Fe=ze):(Ue=(_e>>13)+1<<13,Fe=(Me>>13)+1<<13),m=m+1|0,(m&7)==0){a();continue}}switch(i=ye[_e>>2]|0,_e=_e+4|0,i>>26&63){case 0:Me=Le+_e|0,ze=Me+(i<<6>>4)|0,(Ue|0)==(_e|0)?Ge=1:(Ue=_e+4|0,Fe=ze|0),Pe=1;break;case 1:Me=Le+_e|0,ze=Me+(i<<6>>4)|0,me[we+36>>2]=Me+8|0,(Ue|0)==(_e|0)?Ge=1:(Ue=_e+4|0,Fe=ze|0),Pe=1;break;case 3:if(yt)break;Me=Le+_e|0,ze=Me+(i<<6>>4)|0,(Ue|0)==(_e|0)?Ge=1:(Ue=_e+4|0,Fe=ze|0),Pe=1;break;case 4:if(!yt)break;Me=Le+_e|0,ze=Me+(i<<6>>4)|0,(Ue|0)==(_e|0)?Ge=1:(Ue=_e+4|0,Fe=ze|0),Pe=1;break;case 5:break;case 6:h=i>>21&31,me[we+(h<<2)>>2]=(i&65535)<<16;break;case 8:(i&4294901760)==553648128?D(be,ye[we+Te+J>>2]|0):D(le,ye[we+Te+J>>2]|0);break;case 9:ze=I(Z)|0,n(),Ue=_e,Fe=ze,R(I($)|0);break;case 17:ze=me[we+(i>>9&124)>>2]|0,(Ue|0)==(_e|0)?Ge=1:(Ue=_e+4|0,Fe=ze|0),Pe=1;break;case 18:Me=Le+_e|0,ze=me[we+(i>>9&124)>>2]|0,me[we+36>>2]=Me+8|0,(Ue|0)==(_e|0)?Ge=1:(Ue=_e+4|0,Fe=ze|0),Pe=1;break;case 27:if(l=(me[we+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ve^l)>>13){if(b=T(l,0)|0,(b|0)==-1)break;Ve=l,Oe=(b^l)>>13<<13}b=Oe^l,Mt|=1<<De,ye[we+ot>>2]=b,me[we+(i>>19&124)>>2]=(b|0)>0?ye[Ce+b>>2]|0:L(b|0)|0;break;case 33:if(l=(me[we+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ve^l)>>13){if(b=T(l,0)|0,(b|0)==-1)break;Ve=l,Oe=(b^l)>>13<<13}b=Oe^l,me[we+(i>>19&124)>>2]=(b|0)>0?ye[Ce+b>>2]|0:L(b|0)|0;break;case 35:if(l=(me[we+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Je^l)>>13){if(b=T(l,0)|0,(b|0)==-1)break;Je=l,He=(b^l)>>13<<13}b=He^l,(b|0)>=0?me[we+(i>>19&124)>>2]=ve[Ce+(b^3)|0]|0:me[we+(i>>19&124)>>2]=z(b|0)|0;break;case 36:if(l=(me[we+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ye^l)>>13){if(b=T(l,0)|0,(b|0)==-1)break;Ye=l,Ne=(b^l)>>13<<13}b=Ne^l,(b|0)>=0?me[we+(i>>19&124)>>2]=ve[Ce+(b^3)|0]<<24>>24:me[we+(i>>19&124)>>2]=(z(b|0)|0)<<24>>24;break;case 37:if(l=(me[we+(i>>14&124)>>2]|0)+(i<<16>>16)|0,($e^l)>>13){if(b=T(l,0)|0,(b|0)==-1)break;$e=l,je=(b^l)>>13<<13}b=je^l,(b|0)>=0?me[we+(i>>19&124)>>2]=ke[Ce+(b^2)>>1]:me[we+(i>>19&124)>>2]=P(b|0)|0;break;case 38:if(l=(me[we+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ze^l)>>13){if(b=T(l,0)|0,(b|0)==-1)break;Ze=l,We=(b^l)>>13<<13}b=We^l,(b|0)>=0?me[we+(i>>19&124)>>2]=ke[Ce+(b^2)>>1]<<16>>16:me[we+(i>>19&124)>>2]=(P(b|0)|0)<<16>>16;break;case 39:s=i<<16>>16,o=me[we+(i>>14&124)>>2]|0,me[we+(i>>19&124)>>2]=o+s|0;break;case 41:me[we+(i>>19&124)>>2]=me[we+(i>>14&124)>>2]&(i&65535);break;case 42:me[we+(i>>19&124)>>2]=me[we+(i>>14&124)>>2]|i&65535;break;case 43:o=me[we+(i>>14&124)>>2]|0,me[we+(i>>19&124)>>2]=o^i<<16>>16;break;case 45:me[we+(i>>19&124)>>2]=I(me[we+(i>>14&124)>>2]|i&65535)|0;break;case 46:switch(i>>6&3){case 0:me[we+(i>>19&124)>>2]=me[we+(i>>14&124)>>2]<<(i&31);break;case 1:me[we+(i>>19&124)>>2]=me[we+(i>>14&124)>>2]>>>(i&31);break;case 2:me[we+(i>>19&124)>>2]=me[we+(i>>14&124)>>2]>>(i&31);break;default:_(K|0),x()}break;case 47:switch(s=i<<16>>16,i>>21&31){case 0:yt=(me[we+(i>>14&124)>>2]|0)==(s|0);break;case 1:yt=(me[we+(i>>14&124)>>2]|0)!=(s|0);break;case 2:yt=me[we+(i>>14&124)>>2]>>>0>s>>>0;break;case 3:yt=me[we+(i>>14&124)>>2]>>>0>=s>>>0;break;case 4:yt=me[we+(i>>14&124)>>2]>>>0<s>>>0;break;case 5:yt=me[we+(i>>14&124)>>2]>>>0<=s>>>0;break;case 10:yt=(me[we+(i>>14&124)>>2]|0)>(s|0);break;case 11:yt=(me[we+(i>>14&124)>>2]|0)>=(s|0);break;case 12:yt=(me[we+(i>>14&124)>>2]|0)<(s|0);break;case 13:yt=(me[we+(i>>14&124)>>2]|0)<=(s|0);break;default:_(K|0),x()}break;case 48:if(s=i&2047|i>>10&63488,S(me[we+(i>>14&124)>>2]|s,me[we+(i>>9&124)>>2]|0),(Ie|0)==0){if(Ie=Se,ye[(De<<15)+st>>2]&1<<28)break;return e|0}(Ie&1<<De)==0&&a();break;case 50:switch(o=i>>14&124,f=i>>9&124,p=i>>19&124,i&255){case 0:Re[we+p>>2]=+Re[we+o>>2]+ +Re[we+f>>2];break;case 1:Re[we+p>>2]=+Re[we+o>>2]-+Re[we+f>>2];break;case 2:Re[we+p>>2]=+Re[we+o>>2]*+Re[we+f>>2];break;case 3:Re[we+p>>2]=+Re[we+o>>2]/+Re[we+f>>2];break;case 4:Re[we+p>>2]=+(me[we+o>>2]|0);break;case 5:me[we+p>>2]=~~+E(+Re[we+o>>2]);break;case 7:Re[we+p>>2]=+Re[we+p>>2]+ +Re[we+o>>2]*+Re[we+f>>2];break;case 8:yt=+Re[we+o>>2]==+Re[we+f>>2];break;case 9:yt=+Re[we+o>>2]!=+Re[we+f>>2];break;case 10:yt=+Re[we+o>>2]>+Re[we+f>>2];break;case 11:yt=+Re[we+o>>2]>=+Re[we+f>>2];break;case 12:yt=+Re[we+o>>2]<+Re[we+f>>2];break;case 13:yt=+Re[we+o>>2]<=+Re[we+f>>2];break;default:_(K|0),x()}break;case 51:if(s=(i>>10&63488|i&2047)<<16>>16,l=(me[we+(i>>14&124)>>2]|0)+s|0,(et^l)>>13){if(b=T(l,1)|0,(b|0)==-1)break;et=l,qe=(b^l)>>13<<13}if(b=qe^l,yt=(b|0)==(ye[we+ot>>2]|0)?1:0,ye[we+ot>>2]=-1,Mt&=~(1<<De))for(r=0;(r|0)<(ge|0);r=r+1|0)(ye[(r<<15)+ot>>2]|0)==(b|0)&&(ye[(r<<15)+ot>>2]=-1,Mt&=~(1<<r));if((yt|0)==0)break;(b|0)>0?ye[Ce+b>>2]=me[we+(i>>9&124)>>2]|0:U(b|0,me[we+(i>>9&124)>>2]|0);break;case 53:if(s=(i>>10&63488|i&2047)<<16>>16,l=(me[we+(i>>14&124)>>2]|0)+s|0,(et^l)>>13){if(b=T(l,1)|0,(b|0)==-1)break;et=l,qe=(b^l)>>13<<13}if(b=qe^l,Mt)for(r=0;(r|0)<(ge|0);r=r+1|0)(ye[(r<<15)+ot>>2]|0)==(b|0)&&(ye[(r<<15)+ot>>2]=-1,Mt&=~(1<<r));(b|0)>0?ye[Ce+b>>2]=me[we+(i>>9&124)>>2]|0:U(b|0,me[we+(i>>9&124)>>2]|0);break;case 54:if(s=(i>>10&63488|i&2047)<<16>>16,l=(me[we+(i>>14&124)>>2]|0)+s|0,(tt^l)>>13){if(b=T(l,1)|0,(b|0)==-1)break;tt=l,Xe=(b^l)>>13<<13}if(b=Xe^l,Mt)for(r=0;(r|0)<(ge|0);r=r+1|0)(ye[(r<<15)+ot>>2]|0)==(b&-4)&&(ye[(r<<15)+ot>>2]=-1,Mt&=~(1<<r));(b|0)>0?ve[Ce+(b^3)|0]=me[we+(i>>9&124)>>2]|0:G(b|0,me[we+(i>>9&124)>>2]|0);break;case 55:if(s=(i>>10&63488|i&2047)<<16>>16,l=(me[we+(i>>14&124)>>2]|0)+s|0,(it^l)>>13){if(b=T(l,1)|0,(b|0)==-1)break;it=l,Ke=(b^l)>>13<<13}if(b=Ke^l,Mt)for(r=0;(r|0)<(ge|0);r=r+1|0)(ye[(r<<15)+ot>>2]|0)==(b&-4)&&(ye[(r<<15)+ot>>2]=-1,Mt&=~(1<<r));(b|0)>=0?ke[Ce+(b^2)>>1]=me[we+(i>>9&124)>>2]:F(b|0,me[we+(i>>9&124)>>2]|0);break;case 56:switch(o=me[we+(i>>14&124)>>2]|0,f=me[we+(i>>9&124)>>2]|0,h=i>>19&124,i&975){case 0:me[we+h>>2]=o+f;break;case 2:me[we+h>>2]=o-f;break;case 3:me[we+h>>2]=o&f;break;case 4:me[we+h>>2]=o|f;break;case 5:me[we+h>>2]=o^f;break;case 8:me[we+h>>2]=o<<(f&31);break;case 72:me[we+h>>2]=o>>>(f&31);break;case 15:for(me[we+h>>2]=0,r=0;(r|0)<32;r=r+1|0)if(o&1<<r){me[we+h>>2]=r+1;break}break;case 136:me[we+h>>2]=o>>(f&31);break;case 271:for(me[we+h>>2]=0,r=31;(r|0)>=0;r=r-1|0)if(o&1<<r){me[we+h>>2]=r+1;break}break;case 774:me[we+h>>2]=M(o|0,f|0)|0;break;case 778:vt=(f|0)==0,kt=0,vt||(me[we+h>>2]=(o>>>0)/(f>>>0));break;case 777:vt=(f|0)==0,kt=0,vt||(me[we+h>>2]=(o|0)/(f|0));break;default:_(K|0),x()}break;case 57:switch(i>>21&31){case 0:yt=(me[we+(i>>14&124)>>2]|0)==(me[we+(i>>9&124)>>2]|0);break;case 1:yt=(me[we+(i>>14&124)>>2]|0)!=(me[we+(i>>9&124)>>2]|0);break;case 2:yt=me[we+(i>>14&124)>>2]>>>0>me[we+(i>>9&124)>>2]>>>0;break;case 3:yt=me[we+(i>>14&124)>>2]>>>0>=me[we+(i>>9&124)>>2]>>>0;break;case 4:yt=me[we+(i>>14&124)>>2]>>>0<me[we+(i>>9&124)>>2]>>>0;break;case 5:yt=me[we+(i>>14&124)>>2]>>>0<=me[we+(i>>9&124)>>2]>>>0;break;case 10:yt=(me[we+(i>>14&124)>>2]|0)>(me[we+(i>>9&124)>>2]|0);break;case 11:yt=(me[we+(i>>14&124)>>2]|0)>=(me[we+(i>>9&124)>>2]|0);break;case 12:yt=(me[we+(i>>14&124)>>2]|0)<(me[we+(i>>9&124)>>2]|0);break;case 13:yt=(me[we+(i>>14&124)>>2]|0)<=(me[we+(i>>9&124)>>2]|0);break;default:_(K|0),x()}break;default:_(K|0),x()}}return e|0}var E=e.Math.floor,M=t.imul,_=t.DebugMessage,x=t.abort,L=t.ReadMemory32,U=t.WriteMemory32,P=t.ReadMemory16,F=t.WriteMemory16,z=t.ReadMemory8,G=t.WriteMemory8,B=0,O=1,N=2,H=3,W=4,j=5,q=6,X=7,K=8,Q=9,V=1,Y=17,J=48,Z=32,$=64,ee=4,te=3,ie=6,se=5,re=0,ae=128,ne=129,he=2560,oe=1024,de=256,ce=2304,ue=768,fe=1280,pe=2048,le=3072,be=3584,me=new e.Int32Array(i),Re=new e.Float32Array(i),ye=new e.Int32Array(i),ve=new e.Uint8Array(i),ke=new e.Uint16Array(i),ge=4,Se=15,Ie=15,De=0,we=0,Ce=1048576,Te=8192,Ae=16384,Ee=24576,Me=0,_e=0,xe=0,Le=-4,Ue=0,Pe=0,Fe=0,ze=0,Ge=0,Be=-1,Oe=-1,Ne=-1,He=-1,We=-1,je=-1,qe=-1,Xe=-1,Ke=-1,Qe=-1,Ve=-1,Ye=-1,Je=-1,Ze=-1,$e=-1,et=-1,tt=-1,it=-1,st=256,rt=260,at=264,nt=268,ht=272,ot=276,dt=1,ct=0,ut=0,ft=0,pt=0,lt=0,bt=0,mt=0,Rt=0,yt=0,vt=0,kt=0,gt=0,St=0,It=0,Dt=1,wt=0,Ct=0,Tt=0,At=0,Et=0,Mt=0;return{Init:s,Reset:r,InvalidateTLB:n,Step:A,GetFlags:y,SetFlags:R,PutState:h,GetState:o,GetTimeToNextInterrupt:f,ProgressTime:p,GetTicks:l,RaiseInterrupt:k,ClearInterrupt:g,AnalyzeImage:b}}e("../messagehandler");t.exports=s},{"../messagehandler":25}],7:[function(e,t,i){"use strict";function s(e){this.intdev=e;var t=new ArrayBuffer(512);this.identifybuffer=new Uint16Array(t),this.Reset();var t=new ArrayBuffer(65536);this.SetBuffer(t)}var r=e("../utils"),a=e("../messagehandler"),n=4,h=8,o=12,d=16,c=20,u=24,f=28,p=n,l=f,b=4,m=2,R=128,y=64,v=16,k=8;s.prototype.Reset=function(){this.DCR=8,this.DR=160,this.SCR=1,this.SNR=1,this.SR=y,this.FR=0,this.ER=1,this.CR=0,this.lcyl=0,this.hcyl=0,this.select=160,this.driveselected=!0,this.readbuffer=this.identifybuffer,this.readbufferindex=0,this.readbuffermax=256},s.prototype.SetBuffer=function(e){this.diskbuffer=new Uint16Array(e),this.heads=16,this.sectors=64,this.cylinders=e.byteLength/(this.heads*this.sectors*512),this.nsectors=this.heads*this.sectors*this.cylinders,this.BuildIdentifyBuffer(this.identifybuffer)},s.prototype.BuildIdentifyBuffer=function(e){for(var t=0;256>t;t++)e[t]=0;e[0]=64,e[1]=this.cylinders,e[3]=this.heads,e[4]=512*this.sectors,e[5]=512,e[6]=this.sectors,e[20]=3,e[21]=512,e[22]=4,e[27]=27247,e[28]=29233,e[29]=27437,e[30]=25705,e[31]=29547;for(var t=32;46>=t;t++)e[t]=8224;e[47]=32896,e[48]=0,e[49]=512,e[51]=512,e[52]=512,e[54]=this.cylinders,e[55]=this.heads,e[56]=this.sectors,e[57]=this.nsectors>>0&65535,e[58]=this.nsectors>>16&65535,e[59]=0,e[60]=this.nsectors>>0&65535,e[61]=this.nsectors>>16&65535,e[80]=6,e[82]=16384,e[83]=16384,e[84]=16384,e[85]=16384,e[86]=0,e[87]=16384},s.prototype.ReadReg8=function(e){if(!this.driveselected)return 255;switch(e){case n:return this.ER;case h:return this.SNR;case o:return this.SCR;case d:return this.lcyl;case c:return this.hcyl;case u:return this.DR;case f:return this.intdev.ClearInterrupt(15),this.SR;case 256:return this.SR;default:a.Debug("ATADev: Error in ReadRegister8: register "+r.ToHex(e)+" not supported"),a.Abort()}return 0},s.prototype.GetSector=function(){return 64&this.DR||(a.Debug("ATADev: CHS mode not supported"),a.Abort()),(15&this.DR)<<24|this.hcyl<<16|this.lcyl<<8|this.SCR},s.prototype.SetSector=function(e){64&this.DR||(a.Debug("ATADev: CHS mode not supported"),a.Abort()),this.SCR=255&e,this.lcyl=e>>8&255,this.hcyl=e>>16&255,this.DR=240&this.DR|e>>24&15},s.prototype.ExecuteCommand=function(){switch(this.CR){case 236:this.readbuffer=this.identifybuffer,this.readbufferindex=0,this.readbuffermax=256,this.SR=y|v|k,this.DCR&m||this.intdev.RaiseInterrupt(15);break;case 145:this.SR=y|v,this.ER=0,this.DCR&m||this.intdev.RaiseInterrupt(15);break;case 32:case 48:var e=this.GetSector();0==this.SNR&&(this.SNR=256),this.readbuffer=this.diskbuffer,this.readbufferindex=256*e,this.readbuffermax=this.readbufferindex+256,this.SR=y|v|k,this.ER=0,32==this.CR&&(this.DCR&m||this.intdev.RaiseInterrupt(15));break;case 196:case 197:var e=this.GetSector();0==this.SNR&&(this.SNR=256),this.readbuffer=this.diskbuffer,this.readbufferindex=256*e,this.readbuffermax=this.readbufferindex+256*this.SNR,this.SR=y|v|k,this.ER=0,196==this.CR&&(this.DCR&m||this.intdev.RaiseInterrupt(15));break;default:a.Debug("ATADev: Command "+r.ToHex(this.CR)+" not supported"),a.Abort()}},s.prototype.WriteReg8=function(e,t){if(e==u)return this.DR=t,void(this.driveselected=t>>4&1?!1:!0);if(256==e)return!(t&b)&&this.DCR&b?(this.DR&=240,this.SR=y|v,this.SCR=1,this.SNR=1,this.lcyl=0,this.hcyl=0,this.ER=1,this.CR=0):t&b&&!(this.DCR&b)&&(this.ER=1,this.SR=R|v),void(this.DCR=t);if(this.driveselected)switch(e){case p:this.FR=t;break;case h:this.SNR=t;break;case o:this.SCR=t;break;case d:this.lcyl=t;break;case c:this.hcyl=t;break;case l:this.CR=t,this.ExecuteCommand();break;default:a.Debug("ATADev: Error in WriteRegister8: register "+r.ToHex(e)+" not supported (value: "+r.ToHex(t)+")"),a.Abort()}},s.prototype.ReadReg16=function(e){0!=e&&(a.Debug("ATADev: Error in ReadRegister16: register "+r.ToHex(e)+" not supported"),a.Abort());var t=r.Swap16(this.readbuffer[this.readbufferindex]);return this.readbufferindex++,this.readbufferindex>=this.readbuffermax&&(this.SR=y|v,32==this.CR&&this.SNR>1&&(this.SNR--,this.SetSector(this.GetSector()+1),this.readbuffermax+=256,this.SR=y|v|k,this.DCR&m||this.intdev.RaiseInterrupt(15))),t},s.prototype.WriteReg16=function(e,t){0!=e&&(a.Debug("ATADev: Error in WriteRegister16: register "+r.ToHex(e)+" not supported"),a.Abort()),this.readbuffer[this.readbufferindex]=r.Swap16(t),this.readbufferindex++,this.readbufferindex>=this.readbuffermax&&(this.SR=y|v,this.DCR&m||this.intdev.RaiseInterrupt(15),48==this.CR&&this.SNR>1&&(this.SNR--,this.SetSector(this.GetSector()+1),this.readbuffermax+=256,this.SR=y|v|k))},s.prototype.ReadReg32=function(e){a.Debug("ATADev: Error in ReadRegister32: register "+r.ToHex(e)+" not supported"),this.mesage.Abort()},s.prototype.WriteReg32=function(e,t){a.Debug("ATADev: Error in WriteRegister32: register "+r.ToHex(e)+" not supported"),a.Abort()},t.exports=s},{"../messagehandler":25,"../utils":29}],8:[function(e,t,i){"use strict";function s(e,t,i){this.ram=e,this.intdev=t,this.TransmitCallback=function(e){},this.toTxStat=function(e){return{LEN:e>>>16,RD:e>>>15&1,IRQ:e>>>14&1,WR:e>>>13&1,PAD:e>>>12&1,CRC:e>>>11&1,UR:e>>>8&1,RTRY:e>>>4&15,RL:e>>>3&1,LC:e>>>2&1,DF:e>>>1&1,CS:1&e}},this.fromTxStat=function(e){var t=e.LEN<<16;return t|=(1&e.RD)<<15,t|=(1&e.IRQ)<<14,t|=(1&e.WR)<<13,t|=(1&e.PAD)<<12,t|=(1&e.CRC)<<11,t|=(1&e.UR)<<8,t|=(15&e.RTRY)<<4,t|=(1&e.RL)<<3,t|=(1&e.LC)<<2,t|=(1&e.CDF)<<1,t|=1&e.CS},this.toRxStat=function(e){return{LEN:e>>>16,E:e>>>15&1,IRQ:e>>>14&1,WR:e>>>13&1,CF:e>>>8&1,M:e>>>7&1,OR:e>>>6&1,IS:e>>>5&1,DN:e>>>4&1,TL:e>>>3&1,SF:e>>>2&1,CRC:e>>>1&1,LC:1&e}},this.fromRxStat=function(e){var t=e.LEN<<16;return t|=(1&e.E)<<15,t|=(1&e.IRQ)<<14,t|=(1&e.WR)<<13,t|=(1&e.CF)<<8,t|=(1&e.M)<<7,t|=(1&e.OR)<<6,t|=(1&e.IS)<<5,t|=(1&e.DN)<<4,t|=(1&e.TL)<<3,t|=(1&e.SF)<<2,t|=(1&e.CRC)<<1,t|=1&e.LC},this.makeCRCTable=function(){for(var e,t=[],i=0;256>i;i++){e=i;for(var s=0;8>s;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t},this.crcTable=this.makeCRCTable(),this.crc32=function(e,t,i){var s=-1,r=4;e instanceof Uint16Array||e instanceof Int16Array?r=2:(e instanceof Uint8Array||e instanceof Int8Array)&&(r=1),i||(i=e.length),t||(t=0);for(var a=0,n=t;i>n;n++)a=255&e[n],s=s>>>8^this.crcTable[255&(s^a)],r>1&&(a=e[n]>>>8&255,s=s>>>8^this.crcTable[255&(s^a)],r>2&&(a=e[n]>>>16&255,s=s>>>8^this.crcTable[255&(s^a)],a=e[n]>>>24&255,s=s>>>8^this.crcTable[255&(s^a)]));return(-1^s)>>>0},this.Reset=function(){this.MODER=40960,this.INT_SOURCE=0,this.INT_MASK=0,this.IPGT=18,this.IPGR1=12,this.IPGR2=18,this.PACKETLEN=4195840,this.COLLCONF=983103,this.TX_BD_NUM=64,this.CTRLMODER=0,this.MIIMODER=100,this.MIICOMMAND=0,this.MIIADDRESS=0,this.MIITX_DATA=0,this.MIIRX_DATA=34,this.MIISTATUS=0,this.MAC_ADDR0|=Math.floor(256*Math.random())<<24,this.MAC_ADDR0|=Math.floor(256*Math.random())<<16,this.MAC_ADDR0|=Math.floor(256*Math.random())<<8,this.MAC_ADDR0|=Math.floor(256*Math.random()),this.MAC_ADDR1|=Math.floor(256*Math.random())<<8&254|2,this.MAC_ADDR1|=Math.floor(256*Math.random()),this.ETH_HASH0_ADR=0,this.ETH_HASH1_ADR=0,this.ETH_TXCTRL=0,this.BD=new Uint32Array(256);for(var e=0;256>e;e++)this.BD[e]=0;this.MIIregs=new Uint16Array(16),this.MIIregs[A]=256,this.MIIregs[E]=30756,this.MIIregs[M]=8192,this.MIIregs[_]=23696,this.MIIregs[x]=481,this.MIIregs[L]=0,this.currRX=this.TX_BD_NUM<<1},this.Receive=function(t){if(0!=(1&this.MODER)){var i=new Uint8Array(t),s=!1,r=!1,a=!1,n=0,h=0;n|=i[2]<<24,n|=i[3]<<16,n|=i[4]<<8,n|=i[5],h|=i[0]<<8,h|=i[1],n==this.MAC_ADDR0&&h==this.MAC_ADDR1?r=!0:32768&h&&(a=!0),32&this.MODER&&(s=!0);var o=this.currRX;if(s||a||r){var d=!1;if(32768&this.BD[o]){var c=this.toRxStat(this.BD[o]);r||a||!s||(c.M=1),c.DN=0,i.length>(65535&this.PACKETLEN)&&16384&this.MODER?c.TL=1:c.TL=0,0==c.DN&&(c.CRC=0);var u=0;if(u|=i[i.length-4]<<24,u|=i[i.length-3]<<16,u|=i[i.length-2]<<8,u|=i[i.length-1],!d){c.LEN=i.length;c.LEN>(65535&this.PACKETLEN)&&(c.LEN=65535&this.PACKETLEN);for(var f=this.BD[o+1],p=0;p<c.LEN;p++)e.WriteMemory8(f+p,i[p]);c.LEN+=4,c.E=0}this.BD[o]=this.fromRxStat(c),c.IRQ&&(d&&(this.INT_SOURCE|=8),this.INT_SOURCE|=4,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4))}else this.INT_SOURCE|=16,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);8192&this.BD[this.currRX]||this.currRX+2>=this.BD.length?this.currRX=this.TX_BD_NUM<<1:this.currRX+=2}}},this.Transmit=function(t){if(0!=(2&this.MODER)){var i=this.toTxStat(this.BD[t<<1]),s=this.BD[(t<<1)+1];if(0!=i.RD){var r=i.LEN,a=!1;i.CRC||8192&this.MODER;var n=!1;(i.PAD||32768&this.MODER)&&(n=!0,this.PACKETLEN>>>16>i.LEN&&(r=this.PACKETLEN>>>16));for(var h=new Uint8Array(r),o=0;o<h.length;o++)o<i.LEN?h[o]=e.ReadMemory8(s+o):h[o]=0;if(a){var d=0;d=4096&this.MODER?this.crc32(h,4,h.length-4):this.crc32(h,0,h.length-4),h[h.length-1]=d>>24,h[h.length-2]=d>>16&255,h[h.length-3]=d>>8&255,h[h.length-4]=255&d}this.TransmitCallback(h.buffer),i.UR=0,i.RTRY=0,i.RL=0,i.LC=0,i.DF=0,i.CS=0,i.RD=0,this.BD[t<<1]=this.fromTxStat(i),this.INT_SOURCE|=1,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4)}}},this.ReadReg32=function(e){var t=0;switch(e){case a:t=this.MODER;break;case n:t=this.INT_SOURCE;break;case h:t=this.INT_MASK;break;case o:t=this.IPGT;break;case d:t=this.IPGR1;break;case c:t=this.IPGR2;break;case u:t=this.PACKETLEN;break;case f:t=this.COLLCONF;break;case p:t=this.TX_BD_NUM;break;case l:t=this.CTRLMODER;break;case b:t=this.MIIMODER;break;case m:t=this.MIICOMMAND;break;case R:t=this.MIIADDRESS;break;case y:t=this.MIITX_DATA;break;case v:t=this.MIIRX_DATA;break;case k:t=this.MIISTATUS;break;case g:t=this.MAC_ADDR0;break;case S:t=this.MAC_ADDR1;break;case I:t=this.ETH_HASH0_ADR;break;case D:t=this.ETH_HASH1_ADR;break;case w:t=this.ETH_TXCTRL;break;default:e>=C&&T>=e?t=this.BD[e-C>>>2]:r.Debug("Attempt to access ethmac register beyond 0x800")}return t},this.HandleMIICommand=function(){var e=31&this.MIIADDRESS,t=this.MIIADDRESS>>8&31,i=0;switch(this.MIICOMMAND){case 0:break;case 1:break;case 2:e!=i?this.MIIRX_DATA=65535:this.MIIRX_DATA=this.MIIregs[t];break;case 4:break;default:r.Debug("Error in ethmac: Unknown mii command detected")}},this.WriteReg32=function(e,t){switch(e){case a:this.MODER=t;break;case n:this.INT_SOURCE=this.INT_SOURCE&~t,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);break;case h:this.INT_MASK=t,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);break;case o:this.IPGT=t;break;case d:this.IPGR1=t;break;case c:this.IPGR2=t;break;case u:this.PACKETLEN=t;break;case f:this.COLLCONF=t;break;case p:this.TX_BD_NUM=t,this.currRX=t<<1;break;case l:this.CTRLMODER=t;break;case b:this.MIIMODER=t;break;case m:this.MIICOMMAND=t,this.HandleMIICommand();break;case R:this.MIIADDRESS=t;break;case y:this.MIITX_DATA=t;break;case v:this.MIIRX_DATA=t;break;case k:this.MIISTATUS=t;break;case g:this.MAC_ADDR0=t;break;case S:this.MAC_ADDR1=t;break;case I:this.ETH_HASH0_ADR=t;break;case D:this.ETH_HASH1_ADR=t;break;case w:this.ETH_TXCTRL=t;break;default:if(e>=C&&T>=e){this.BD[e-C>>>2]=t;var i=e-C>>>3;(i<<3)+C==e&&0!=(32768&t)&&i<this.TX_BD_NUM&&this.Transmit(i)}else r.Debug("Attempt to access ethmac register beyond 0x800")}},this.Reset(),r.Register("ethmac",this.Receive.bind(this))}var r=e("../messagehandler"),a=(e("../utils"),0),n=4,h=8,o=12,d=16,c=20,u=24,f=28,p=32,l=36,b=40,m=44,R=48,y=52,v=56,k=60,g=64,S=68,I=72,D=76,w=80,C=1024,T=2047,A=0,E=1,M=2,_=3,x=4,L=25;t.exports=s},{"../messagehandler":25,"../utils":29}],9:[function(e,t,i){"use strict";function s(e){this.ram=e,this.width=640,this.height=400,this.addr=16e6,this.n=this.width*this.height>>1,this.buffer=new Int32Array(this.n),a.Register("GetFB",this.OnGetFB.bind(this))}var r=e("../utils"),a=e("../messagehandler");s.prototype.Reset=function(){},s.prototype.ReadReg32=function(e){return 0},s.prototype.WriteReg32=function(e,t){switch(e){case 20:this.addr=r.Swap32(t);break;default:return}},s.prototype.OnGetFB=function(){a.Send("GetFB",this.GetBuffer())},s.prototype.GetBuffer=function(){var e=0,t=this.buffer.length,i=this.buffer,s=this.ram.int32mem,r=this.addr>>2;for(e=0;t>e;++e)i[e]=s[r+e];return this.buffer},t.exports=s},{"../messagehandler":25,"../utils":29}],10:[function(e,t,i){"use strict";function s(e){this.intdev=e,this.regs=new Uint32Array(64),this.Reset()}var r=e("../messagehandler"),a=e("../utils"),n=1<<30;s.prototype.Reset=function(){for(var e=0;64>e;e++)this.regs[e]=0},s.prototype.ReadReg32=function(e){return e>>=2,e>64?(r.Debug("IRQDev: Unknown ReadReg32: "+a.ToHex(e)),0):this.regs[e]},s.prototype.WriteReg32=function(e,t){if(e>>=2,e>64)return void r.Debug("IRQDev: unknown  WriteReg32: "+a.ToHex(e)+": "+a.ToHex(t));var i=e>>1;if(1&e)r.Debug("Error in IRQDev: Write STAT of CPU "+i+" : "+a.ToHex(t));else{this.regs[e]=t;var s=65535&t,h=t>>16&16383,o=t>>30&3;
if(1&o){if(h==i&&r.Debug("Warning in IRQDev: Try to raise its own IRQ"),this.regs[(h<<1)+1]&n){r.Debug("Warning in IRQDev: CPU "+i+" raised irq on cpu "+h+" without previous acknowledge");var d=new Int32Array(this.intdev.heap);r.Debug("The pc of cpu "+h+" is "+a.ToHex(d[(h<<15)+292>>2])),r.Debug("The IEE flag of cpu "+h+" is "+(4&d[(h<<15)+288>>2])),r.Debug("r9 of cpu "+h+" is "+a.ToHex(d[(h<<15)+36>>2]))}this.regs[(h<<1)+1]=n|(16383&i)<<16|s,this.intdev.RaiseSoftInterrupt(1,h)}2&o&&(this.regs[e+1]&=~n,this.intdev.ClearSoftInterrupt(1,i))}},t.exports=s},{"../messagehandler":25,"../utils":29}],11:[function(e,t,i){"use strict";function s(e){this.intdev=e,r.Register("keydown",this.OnKeyDown.bind(this)),r.Register("keyup",this.OnKeyUp.bind(this)),this.Reset()}var r=e("../messagehandler"),a=[0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,119,58,0,0,0,0,0,0,1,0,0,0,0,57,104,109,107,102,105,103,106,108,0,0,0,0,110,111,0,11,2,3,4,5,6,7,8,9,10,0,39,,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,0,0,0,0,0,82,79,80,81,75,76,77,71,72,73,55,77,0,12,83,181,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,0,0,0,0,0,0];s.prototype.Reset=function(){this.key=0,this.fifo=[]},s.prototype.OnKeyDown=function(e){this.key=0|a[e.keyCode],0!=this.key&&(this.fifo.push(this.key),this.intdev.RaiseInterrupt(5))},s.prototype.OnKeyUp=function(e){this.key=a[e.keyCode],0!=this.key&&(this.key=128|this.key,this.fifo.push(this.key),this.intdev.RaiseInterrupt(5))},s.prototype.ReadReg8=function(e){var t=this.fifo.shift();return 0==this.fifo.length&&this.intdev.ClearInterrupt(5),t},t.exports=s},{"../messagehandler":25}],12:[function(e,t,i){"use strict";function s(e){this.intdev=e,this.Reset()}var r=e("../messagehandler"),a=e("../utils"),n=0,h=8,o=16,d=20,c=24;s.prototype.Reset=function(){this.ctrl=0},s.prototype.ReadReg32=function(e){switch(e){case n:return Math.floor((new Date).getTime()/1e3);case o:return this.ctrl;case c:return 3049340711;case h:return 0;case d:return 0;default:return r.Debug("RTC: unknown ReadReg32: "+a.ToHex(e)),0}return 0},s.prototype.WriteReg32=function(e,t){switch(e){case o:this.ctrl=t;break;default:return void r.Debug("RTC: unknown  WriteReg32: "+a.ToHex(e)+": "+a.ToHex(t))}},t.exports=s},{"../messagehandler":25,"../utils":29}],13:[function(e,t,i){"use strict";function s(e,t){r.Debug("Start sound"),this.intdev=e,this.ramdev=t,this.Reset()}var r=e("../messagehandler"),a=e("../utils"),n=0,h=4,o=8,d=12,c=16,u=20,f=24,p=28;s.prototype.Reset=function(){this.addr=0,this.status=0,this.periods=0,this.period_size=0,this.rate=22050,this.channels=1,this.offset=0,this.playing=!1,this.nextperiod=0,this.starttime=0,this.lasttotalframe=0},s.prototype.GetTimeToNextInterrupt=function(){return this.playing?1e3*this.nextperiod/this.rate:-1},s.prototype.Progress=function(){return},s.prototype.Elapsed=function(){var e=new Int8Array(this.period_size),t=this.periods*this.period_size;if(1==this.format)for(var i=0;i<this.period_size;i++)e[i]=this.ramdev.uint8mem[this.addr+(this.offset++<<0^3)]-128,this.offset==t&&(this.offset=0);else for(var i=0;i<this.period_size;i++)e[i]=this.ramdev.sint8mem[this.addr+1+(this.offset++<<1^3)],this.offset==t&&(this.offset=0);r.Send("sound",e)},s.prototype.ReadReg32=function(e){switch(e){case n:return this.intdev.ClearInterrupt(7),this.Elapsed(),this.playing?1:0;case c:return this.offset;default:return r.Debug("Sound: unknown ReadReg32: "+a.ToHex(e)),0}return 0},s.prototype.WriteReg32=function(e,t){switch(e){case n:this.playing=t?!0:!1,this.nextperiod=this.period_size,this.starttime=a.GetMilliseconds(),this.lasttotalframe=0,this.offset=0,r.Send("sound.rate",this.rate),this.Elapsed();break;case h:this.addr=t;break;case o:this.periods=t;break;case d:this.period_size=t;break;case u:this.rate=t;break;case f:this.channels=t;break;case p:this.format=t;break;default:return void r.Debug("sound: unknown  WriteReg32: "+a.ToHex(e)+": "+a.ToHex(t))}},t.exports=s},{"../messagehandler":25,"../utils":29}],14:[function(e,t,i){"use strict";function s(){this.Reset()}var r=e("../messagehandler");s.prototype.Reset=function(){this.sync=0},s.prototype.ReadReg32=function(e){return this.sync},s.prototype.WriteReg32=function(e,t){r.Debug("Error in Timer: Write reg "+e+" : "+t)},t.exports=s},{"../messagehandler":25}],15:[function(e,t,i){"use strict";function s(e){this.intdev=e,this.Reset(),r.Register("tsmousedown",this.onmousedown.bind(this)),r.Register("tsmouseup",this.onmouseup.bind(this)),r.Register("tsmousemove",this.onmousemove.bind(this))}var r=e("../messagehandler"),a=(e("../utils"),0),n=4,h=8,o=12,d=16,c=20,u=24,f=28,p=32,l=36,b=40,m=44,R=48,y=52,v=56,k=60,g=1,S=128,I=1<<31;s.prototype.Reset=function(){this.control=0,this.status=S,this.ispressed=!1,this.mousemovecount=0,this.fifo=0,this.fifosize=0},s.prototype.onmousedown=function(e){if(this.control&g){var t=e.x,i=e.y;this.status&=~S,this.fifosize=4,this.fifo=0,this.fifo|=(1023-t&1023)<<16,this.fifo|=1023-i&1023,this.ispressed=!0,this.intdev.RaiseInterrupt(9)}},s.prototype.onmousemove=function(e){if(this.control&g&&this.ispressed&&(this.mousemovecount++,!(3&this.mousemovecount))){var t=e.x,i=e.y;this.status&=~S,this.fifosize=4,this.fifo=0,this.fifo|=(1023-t&1023)<<16,this.fifo|=1023-i&1023,this.intdev.RaiseInterrupt(9)}},s.prototype.onmouseup=function(e){if(this.control&g){e.x,e.y;this.status&=~S,this.fifosize=0,this.fifo=I,this.ispressed=!1,this.intdev.RaiseInterrupt(9)}},s.prototype.ReadReg32=function(e){switch(e){case h:return this.control;case a:return this.intdev.ClearInterrupt(9),this.status;case o:return this.fifosize<=0&&(this.status|=S),this.fifosize--,this.fifo}return 0},s.prototype.WriteReg32=function(e,t){switch(e){case h:return void(this.control=t);case n:case l:case b:case m:case R:case y:case v:case k:case c:case d:case f:case p:case u:return}},t.exports=s},{"../messagehandler":25,"../utils":29}],16:[function(e,t,i){"use strict";function s(e,t,i){this.intno=i,this.intdev=t,this.id=e,r.Register("tty"+e,this.ReceiveChar.bind(this)),this.Reset()}var r=e("../messagehandler"),a=(e("../utils"),0),n=0,h=0,o=1,d=1,c=2,u=2,f=3,p=4,l=5,b=6,m=1,R=32,y=64,v=8,k=2,g=1,S=0,I=1,D=2,w=12,C=128,T=128,A=32,E=16,M=["DataTerminalReady","RTS","AuxOut1","AuxOut2","Loopback","Autoflow"],_=["FIFO enable","Reset","XMIT-FIFO-Reset","DMA-Mode","Reserved","Reserved","RecrTrig(LSB)","RecrTrig(MSB)"],x=["WordLen","WordLen","StopBits","Parity","EvenParity","StickParity","Break","DivisorLatch"],L=["DeltaCTS","DeltaDataSetReady","DeltaRingIndicator","DeltaCarrierDetect","ClearToSend","DataSetReady","RingIndicator","CarrierDetect"];s.prototype.ToBitDescription=function(e,t){e&=255;for(var i=("00000000"+e.toString(2)).substr(-8)+":",s=0;s<t.length;s++)i+=" "+t[s]+":"+(e>>s&1);return i},s.prototype.Reset=function(){this.LCR=3,this.LSR=y|R,this.MSR=T|A|E,this.ints=0,this.IIR=I,this.IER=0,this.DLL=0,this.DLH=0,this.FCR=0,this.MCR=0,this.rxbuf=new Array,this.txbuf=new Array},s.prototype.Step=function(){0!=this.txbuf.length&&(r.Send("tty"+this.id,this.txbuf),this.txbuf=new Array)},s.prototype.ReceiveChar=function(e){e.forEach(function(e){this.rxbuf.push(255&e)}.bind(this)),this.rxbuf.length>0&&(this.LSR|=m,this.ThrowInterrupt(w))},s.prototype.CheckInterrupt=function(){this.ints&1<<w&&this.IER&g?(this.IIR=w,this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<D&&this.IER&k?(this.IIR=D,this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<S&&this.IER&v?(this.IIR=S,this.intdev.RaiseInterrupt(this.intno)):(this.IIR=I,this.intdev.ClearInterrupt(this.intno))},s.prototype.ThrowInterrupt=function(e){this.ints|=1<<e,this.CheckInterrupt()},s.prototype.ClearInterrupt=function(e){this.ints&=~(1<<e),this.CheckInterrupt()},s.prototype.ReadReg8=function(e){if(this.LCR&C)switch(e){case h:return this.DLL;case o:return this.DLH}switch(e){case a:var t=0;return this.rxbuf.length>0&&(t=this.rxbuf.shift()),0==this.rxbuf.length&&(this.LSR&=~m,this.ClearInterrupt(w)),255&t;case d:return 15&this.IER;case b:var t=this.MSR;return this.MSR&=240,this.verboseuart&&r.Debug("Get UART_MSR "+this.ToBitDescription(t,L)),t;case c:var t=15&this.IIR|192;return this.IIR==D&&this.ClearInterrupt(D),t;case f:return this.LCR;case l:return this.LSR;default:r.Debug("Error in ReadRegister: not supported"),r.Abort()}},s.prototype.WriteReg8=function(e,t){if(t&=255,this.LCR&C)switch(e){case h:return void(this.DLL=t);case o:return void(this.DLH=t)}switch(e){case n:this.LSR&=~y,this.txbuf.push(t),this.LSR|=y|R,this.ThrowInterrupt(D);break;case d:this.IER=15&t,this.CheckInterrupt();break;case u:this.verboseuart&&r.Debug("Set UART_FCR "+this.ToBitDescription(t,_)),this.FCR=201&t,2&this.FCR&&(this.ClearInterrupt(w),this.rxbuf=new Array),4&this.FCR&&(this.txbuf=new Array);break;case f:this.verboseuart&&r.Debug("Set UART_LCR "+this.ToBitDescription(t,x)),3!=(3&this.LCR)&&r.Debug("Warning in UART: Data word length other than 8 bits are not supported"),this.LCR=t;break;case p:this.verboseuart&&r.Debug("Set UART_MCR "+this.ToBitDescription(t,M)),this.MCR=t;break;default:r.Debug("Error in WriteRegister: not supported"),r.Abort()}},t.exports=s},{"../messagehandler":25,"../utils":29}],17:[function(e,t,i){"use strict";function s(e,t,i,s){for(var r=0;s>r;r++)t[r]=e.ReadMemory8(i+r)}function r(e,t,i){this.dev=i,this.dev.SendReply=this.SendReply.bind(this),this.intdev=e,this.ramdev=t,this.Reset()}var a=e("../utils"),n=e("./virtio/marshall"),h=e("../messagehandler"),o=0,d=4,c=8,u=12,f=16,p=20,l=32,b=36,m=40,R=48,y=52,v=56,k=60,g=64,S=80,I=96,D=100,w=112,C=2;r.prototype.Reset=function(){this.status=0,this.queuepfn=0,this.intstatus=0,this.pagesize=0,this.queuenum=256,this.align=0,this.availidx=0,this.descaddr=0,this.usedaddr=0,this.availaddr=0},r.prototype.UpdateAddr=function(){if(this.descaddr=this.queuepfn*this.pagesize,this.availaddr=this.descaddr+16*this.queuenum,this.usedaddr=this.availaddr+2+2+2*this.queuenum+2,this.usedaddr&this.align-1){var e=~(this.align-1);this.usedaddr=(this.usedaddr&e)+this.align}},r.prototype.ReadReg8=function(e){return this.dev.configspace[e-256]},r.prototype.ReadReg32=function(e){var t=0;switch(e){case o:t=1953655158;break;case d:t=1;break;case u:t=4294967295;break;case c:t=this.dev.deviceid;break;case f:t=this.dev.hostfeature;break;case y:t=this.queuenum;break;case g:t=this.queuepfn;break;case w:t=this.status;break;case I:t=this.intstatus;break;default:h.Debug("Error in VirtIODev: Attempt to read register "+a.ToHex(e)),h.Abort()}return a.Swap32(t)},r.prototype.GetDescriptor=function(e){var t=this.queuepfn*this.pagesize+16*e,i=new Uint8Array(16);s(this.ramdev,i,t,16);var r=n.Unmarshall(["w","w","w","h","h"],i,0);return{addrhigh:a.Swap32(r[0]),addr:a.Swap32(r[1]),len:a.Swap32(r[2]),flags:a.Swap16(r[3]),next:a.Swap16(r[4])}},r.prototype.PrintRing=function(){for(var e=this.GetDescriptor(0),t=0;10>t&&(h.Debug("next: "+e.next+" flags:"+e.flags+" addr:"+a.ToHex(e.addr)),1&e.flags);t++)e=this.GetDescriptor(e.next);var i=this.ramdev.ReadMemory16(this.availaddr+2)&this.queuenum-1;h.Debug("avail idx: "+i),h.Debug("avail buffer index: "+this.ramdev.ReadMemory16(this.availaddr+4+2*(i-4))),h.Debug("avail buffer index: "+this.ramdev.ReadMemory16(this.availaddr+4+2*(i-3))),h.Debug("avail buffer index: "+this.ramdev.ReadMemory16(this.availaddr+4+2*(i-2))),h.Debug("avail buffer index: "+this.ramdev.ReadMemory16(this.availaddr+4+2*(i-1)));var s=this.ramdev.ReadMemory16(this.usedaddr+2)&this.queuenum-1;h.Debug("used idx: "+s)},r.prototype.ConsumeDescriptor=function(e,t){var i=this.ramdev.ReadMemory16(this.usedaddr+2),s=this.usedaddr+4+8*(i&this.queuenum-1);this.ramdev.WriteMemory32(s+0,e),this.ramdev.WriteMemory32(s+4,t),this.ramdev.WriteMemory16(this.usedaddr+2,i+1)},r.prototype.SendReply=function(e){this.ConsumeDescriptor(e,this.dev.replybuffersize);for(var t=this.GetDescriptor(e);0==(t.flags&C);)1&t.flags?t=this.GetDescriptor(t.next):(h.Debug("Error in virtiodev: Descriptor is not continuing"),h.Abort());0==(t.flags&C)&&(h.Debug("Error in virtiodev: Descriptor is not allowed to write"),h.Abort());for(var i=0,s=0;s<this.dev.replybuffersize;s++)i>=t.len&&(t=this.GetDescriptor(t.next),i=0,0==(t.flags&C)&&(h.Debug("Error in virtiodev: Descriptor is not allowed to write"),h.Abort())),this.ramdev.WriteMemory8(t.addr+i,this.dev.replybuffer[s]),i++;this.intstatus=1,this.intdev.RaiseInterrupt(6)},r.prototype.WriteReg32=function(e,t){switch(t=a.Swap32(t),e){case m:this.pagesize=t,this.UpdateAddr();break;case w:this.status=t;break;case p:break;case b:break;case l:break;case R:break;case v:this.queuenum=t,this.UpdateAddr();break;case k:this.align=t,this.UpdateAddr();break;case g:this.queuepfn=t,this.UpdateAddr();break;case S:if(this.UpdateAddr(),0!=t)return h.Debug("Error in virtiodev: Untested case of queuenotify "+t),void h.Abort();var i=this.ramdev.ReadMemory16(this.availaddr+2)-1&this.queuenum-1;t=this.ramdev.ReadMemory16(this.availaddr+4+2*i);var s=t,r=0,n=this.GetDescriptor(s);this.GetByte=function(){r>=n.len&&(r=0,1&n.flags?n=this.GetDescriptor(n.next):(h.Debug("Error in virtiodev: Descriptor is not continuing"),h.Abort()));var e=this.ramdev.ReadMemory8(n.addr+r);return r++,e}.bind(this),this.dev.ReceiveRequest(s,this.GetByte);break;case D:this.intstatus&=~t,this.intdev.ClearInterrupt(6);break;default:h.Debug("Error in VirtIODev: Attempt to write register "+a.ToHex(e)+":"+a.ToHex(t)),h.Abort()}},t.exports=r},{"../messagehandler":25,"../utils":29,"./virtio/marshall":19}],18:[function(e,t,i){"use strict";function s(e,t){this.fs=t,this.SendReply=function(){},this.deviceid=9,this.hostfeature=1,this.configspace=[0,9,47,100,101,118,47,114,111,111,116],this.VERSION="9P2000.L",this.BLOCKSIZE=8192,this.msize=8192,this.replybuffer=new Uint8Array(2*this.msize),this.replybuffersize=0,this.Reset()}var r=e("./marshall"),a=e("../../messagehandler"),n=(e("../../utils"),16384),h=2,o=39,d=1,c=2,u=4,f=8,p=16,l=32,b=64,m=128,R=256,y=-1,v=1,k=2;s.prototype.Createfid=function(e,t,i){return{inodeid:e,type:t,uid:i}},s.prototype.Reset=function(){this.fids=[]},s.prototype.BuildReply=function(e,t,i){r.Marshall(["w","b","h"],[i+7,e+1,t],this.replybuffer,0),i+7>=this.replybuffer.length&&a.Debug("Error in 9p: payloadsize exceeds maximum length"),this.replybuffersize=i+7},s.prototype.SendError=function(e,t,i){var s=r.Marshall(["w"],[i],this.replybuffer,7);this.BuildReply(6,e,s)},s.prototype.ReceiveRequest=function(e,t){var i=r.Unmarshall2(["w","b","h"],t),s=i[0],g=i[1],S=i[2];switch(g){case 8:var s=this.fs.GetTotalSize(),I=[];I[0]=16914839,I[1]=this.BLOCKSIZE,I[2]=Math.floor(1073741824/I[1]),I[3]=I[2]-Math.floor(s/I[1]),I[4]=I[2]-Math.floor(s/I[1]),I[5]=this.fs.inodes.length,I[6]=1048576,I[7]=0,I[8]=256;var s=r.Marshall(["w","w","d","d","d","d","d","d","w"],I,this.replybuffer,7);this.BuildReply(g,S,s),this.SendReply(e);break;case 112:case 12:var I=r.Unmarshall2(["w","w"],t),D=I[0],w=I[1],C=this.fs.GetInode(this.fids[D].inodeid);I[0]=C.qid,I[1]=this.msize-24,r.Marshall(["Q","w"],I,this.replybuffer,7),this.BuildReply(g,S,17);var T=this.fs.OpenInode(this.fids[D].inodeid,w);this.fs.AddEvent(this.fids[D].inodeid,function(){I[0]=C.qid,I[1]=this.msize-24,r.Marshall(["Q","w"],I,this.replybuffer,7),this.BuildReply(g,S,17),this.SendReply(e)}.bind(this));break;case 70:var I=r.Unmarshall2(["w","w","s"],t),A=I[0],D=I[1],E=I[2],C=this.fs.CreateInode(),M=this.fs.GetInode(this.fids[D].inodeid);C.mode=M.mode,C.size=M.size,C.symlink=M.symlink,C.data=new Uint8Array(C.size);for(var _=0;_<C.size;_++)C.data[_]=this.fs.ReadByte(M,_);C.name=E,C.parentid=this.fids[A].inodeid,this.fs.PushInode(C),this.BuildReply(g,S,0),this.SendReply(e);break;case 16:var I=r.Unmarshall2(["w","s","s","w"],t),D=I[0],E=I[1],x=I[2],L=I[3],U=this.fs.CreateSymlink(E,this.fids[D].inodeid,x),C=this.fs.GetInode(U);C.uid=this.fids[D].uid,C.gid=L,r.Marshall(["Q"],[C.qid],this.replybuffer,7),this.BuildReply(g,S,13),this.SendReply(e);break;case 18:var I=r.Unmarshall2(["w","s","w","w","w","w"],t),D=I[0],E=I[1],w=I[2],P=I[3],F=I[4],L=I[5],U=this.fs.CreateNode(E,this.fids[D].inodeid,P,F),C=this.fs.GetInode(U);C.mode=w,C.uid=this.fids[D].uid,C.gid=L,r.Marshall(["Q"],[C.qid],this.replybuffer,7),this.BuildReply(g,S,13),this.SendReply(e);break;case 22:var I=r.Unmarshall2(["w"],t),D=I[0],C=this.fs.GetInode(this.fids[D].inodeid),s=r.Marshall(["s"],[C.symlink],this.replybuffer,7);this.BuildReply(g,S,s),this.SendReply(e);break;case 72:var I=r.Unmarshall2(["w","s","w","w"],t),D=I[0],E=I[1],w=I[2],L=I[3],U=this.fs.CreateDirectory(E,this.fids[D].inodeid),C=this.fs.GetInode(U);C.mode=w|n,C.uid=this.fids[D].uid,C.gid=L,r.Marshall(["Q"],[C.qid],this.replybuffer,7),this.BuildReply(g,S,13),this.SendReply(e);break;case 14:var I=r.Unmarshall2(["w","s","w","w","w"],t),D=I[0],E=I[1],w=(I[2],I[3]),L=I[4],U=this.fs.CreateFile(E,this.fids[D].inodeid);this.fids[D].inodeid=U,this.fids[D].type=v;var C=this.fs.GetInode(U);C.uid=this.fids[D].uid,C.gid=L,C.mode=w,r.Marshall(["Q","w"],[C.qid,this.msize-24],this.replybuffer,7),this.BuildReply(g,S,17),this.SendReply(e);break;case 52:r.Marshall(["w"],[0],this.replybuffer,7),this.BuildReply(g,S,1),this.SendReply(e);break;case 24:var I=r.Unmarshall2(["w","d"],t),D=I[0],C=this.fs.GetInode(this.fids[D].inodeid);I[0]|=4096,I[0]=I[1],I[1]=C.qid,I[2]=C.mode,I[3]=C.uid,I[4]=C.gid,I[5]=1,I[6]=C.major<<8|C.minor,I[7]=C.size,I[8]=this.BLOCKSIZE,I[9]=Math.floor(C.size/512+1),I[10]=C.atime,I[11]=0,I[12]=C.mtime,I[13]=0,I[14]=C.ctime,I[15]=0,I[16]=0,I[17]=0,I[18]=0,I[19]=0,r.Marshall(["d","Q","w","w","w","d","d","d","d","d","d","d","d","d","d","d","d","d","d","d"],I,this.replybuffer,7),this.BuildReply(g,S,153),this.SendReply(e);break;case 26:var I=r.Unmarshall2(["w","w","w","w","w","d","d","d","d","d"],t),D=I[0],C=this.fs.GetInode(this.fids[D].inodeid);I[1]&d&&(C.mode=I[2]),I[1]&c&&(C.uid=I[3]),I[1]&u&&(C.gid=I[4]),I[1]&m&&(C.atime=I[6]),I[1]&R&&(C.atime=I[8]),I[1]&p&&(C.atime=Math.floor((new Date).getTime()/1e3)),I[1]&l&&(C.mtime=Math.floor((new Date).getTime()/1e3)),I[1]&b&&(C.ctime=Math.floor((new Date).getTime()/1e3)),I[1]&f&&this.fs.ChangeSize(this.fids[D].inodeid,I[5]),this.BuildReply(g,S,0),this.SendReply(e);break;case 50:var I=r.Unmarshall2(["w","d"],t),D=I[0];this.BuildReply(g,S,0),this.SendReply(e);break;case 40:case 116:var I=r.Unmarshall2(["w","d","w"],t),D=I[0],z=I[1],G=I[2],C=this.fs.GetInode(this.fids[D].inodeid);if(this.fids[D].type==k){C.caps.length<z+G&&(G=C.caps.length-z);for(var _=0;G>_;_++)this.replybuffer[11+_]=C.caps[z+_]}else{C.size<z+G&&(G=C.size-z);for(var _=0;G>_;_++)this.replybuffer[11+_]=this.fs.ReadByte(C,z+_)}r.Marshall(["w"],[G],this.replybuffer,7),this.BuildReply(g,S,4+G),this.SendReply(e);break;case 118:var I=r.Unmarshall2(["w","d","w"],t),D=I[0],z=I[1],G=I[2];this.fs.Write(this.fids[D].inodeid,z,G,t),r.Marshall(["w"],[G],this.replybuffer,7),this.BuildReply(g,S,4),this.SendReply(e);break;case 74:var I=r.Unmarshall2(["w","s","w","s"],t),B=I[0],O=I[1],N=I[2],H=I[3],T=this.fs.Rename(this.fids[B].inodeid,O,this.fids[N].inodeid,H);if(0==T){this.SendError(S,"No such file or directory",h),this.SendReply(e);break}this.BuildReply(g,S,0),this.SendReply(e);break;case 76:var I=r.Unmarshall2(["w","s","w"],t),W=I[0],E=I[1],g=(I[2],this.fs.Search(this.fids[W].inodeid,E));if(-1==g){this.SendError(S,"No such file or directory",h),this.SendReply(e);break}var T=this.fs.Unlink(g);if(!T){this.SendError(S,"Directory not empty",o),this.SendReply(e);break}this.BuildReply(g,S,0),this.SendReply(e);break;case 100:var j=r.Unmarshall2(["w","s"],t);this.msize=j[0];var s=r.Marshall(["w","s"],[this.msize,this.VERSION],this.replybuffer,7);this.BuildReply(g,S,s),this.SendReply(e);break;case 104:var I=r.Unmarshall2(["w","w","s","s","w"],t),D=I[0],q=I[4];this.fids[D]=this.Createfid(0,v,q);var C=this.fs.GetInode(this.fids[D].inodeid);r.Marshall(["Q"],[C.qid],this.replybuffer,7),this.BuildReply(g,S,13),this.SendReply(e);break;case 108:var I=r.Unmarshall2(["h"],t);I[0];this.BuildReply(g,S,0),this.SendReply(e);break;case 110:var I=r.Unmarshall2(["w","w","h"],t),D=I[0],X=I[1],K=I[2];if(0==K){this.fids[X]=this.Createfid(this.fids[D].inodeid,v,this.fids[D].uid),this.fids[X].inodeid=this.fids[D].inodeid,r.Marshall(["h"],[0],this.replybuffer,7),this.BuildReply(g,S,2),this.SendReply(e);break}for(var Q=[],_=0;K>_;_++)Q.push("s");for(var V=r.Unmarshall2(Q,t),U=this.fids[D].inodeid,z=9,Y=0,_=0;K>_&&(U=this.fs.Search(U,V[_]),-1!=U);_++)z+=r.Marshall(["Q"],[this.fs.inodes[U].qid],this.replybuffer,z),Y++,this.fids[X]=this.Createfid(U,v,this.fids[D].uid);r.Marshall(["h"],[Y],this.replybuffer,7),this.BuildReply(g,S,z-7),this.SendReply(e);break;case 120:var I=r.Unmarshall2(["w"],t);this.fids[I[0]]&&this.fids[I[0]].inodeid>=0&&(this.fs.CloseInode(this.fids[I[0]].inodeid),this.fids[I[0]].inodeid=-1,this.fids[I[0]].type=y),this.BuildReply(g,S,0),this.SendReply(e);break;case 30:var I=r.Unmarshall2(["w","w","s"],t),D=I[0],J=I[1],E=I[2];this.fids[J]=this.Createfid(this.fids[D].inodeid,y,this.fids[D].uid);var Z=0;"security.capability"==E&&(Z=this.fs.PrepareCAPs(this.fids[D].inodeid),this.fids[J].type=k),r.Marshall(["d"],[Z],this.replybuffer,7),this.BuildReply(g,S,8),this.SendReply(e);break;default:a.Debug("Error in Virtio9p: Unknown id "+g+" received"),a.Abort()}},t.exports=s},{"../../messagehandler":25,"../../utils":29,"./marshall":19}],19:[function(e,t,i){function s(e,t,i,r){for(var a,o=0,d=0;d<e.length;d++)switch(a=t[d],e[d]){case"w":i[r++]=255&a,i[r++]=a>>8&255,i[r++]=a>>16&255,i[r++]=a>>24&255,o+=4;break;case"d":i[r++]=255&a,i[r++]=a>>8&255,i[r++]=a>>16&255,i[r++]=a>>24&255,i[r++]=0,i[r++]=0,i[r++]=0,i[r++]=0,o+=8;break;case"h":i[r++]=255&a,i[r++]=a>>8,o+=2;break;case"b":i[r++]=a,o+=1;break;case"s":var c=r,u=0;i[r++]=0,i[r++]=0,o+=2;for(var f in a){var p=n.UnicodeToUTF8Stream(a.charCodeAt(f));p.forEach(function(e){i[r++]=e,o+=1,u++})}i[c+0]=255&u,i[c+1]=u>>8&255;break;case"Q":s(["b","w","d"],[a.type,a.version,a.path],i,r),r+=13,o+=13;break;default:h.Debug("Marshall: Unknown type="+type[d])}return o}function r(e,t,i){for(var s=[],r=0;r<e.length;r++)switch(e[r]){case"w":var a=t[i++];a+=t[i++]<<8,a+=t[i++]<<16,a+=t[i++]<<24>>>0,s.push(a);break;case"d":var a=t[i++];a+=t[i++]<<8,a+=t[i++]<<16,a+=t[i++]<<24>>>0,i+=4,s.push(a);break;case"h":var a=t[i++];s.push(a+(t[i++]<<8));break;case"b":s.push(t[i++]);break;case"s":var o=t[i++];o+=t[i++]<<8;for(var d="",c=new n.UTF8StreamToUnicode,u=0;o>u;u++){var f=c.Put(t[i++]);-1!=f&&(d+=String.fromCharCode(f))}s.push(d);break;default:h.Debug("Error in Unmarshall: Unknown type="+e[r])}return s}function a(e,t){for(var i=[],s=0;s<e.length;s++)switch(e[s]){case"w":var r=t();r+=t()<<8,r+=t()<<16,r+=t()<<24>>>0,i.push(r);break;case"d":var r=t();r+=t()<<8,r+=t()<<16,r+=t()<<24>>>0,t(),t(),t(),t(),i.push(r);break;case"h":var r=t();i.push(r+(t()<<8));break;case"b":i.push(t());break;case"s":var a=t();a+=t()<<8;for(var o="",d=new n.UTF8StreamToUnicode,c=0;a>c;c++){var u=d.Put(t());-1!=u&&(o+=String.fromCharCode(u))}i.push(o);break;default:h.Debug("Error in Unmarshall2: Unknown type="+e[s])}return i}var n=e("../../../lib/utf8"),h=e("../../messagehandler");t.exports.Marshall=s,t.exports.Unmarshall=r,t.exports.Unmarshall2=a},{"../../../lib/utf8":1,"../../messagehandler":25}],20:[function(e,t,i){"use strict";function s(){this.inodes=[],this.events=[],this.qidnumber=0,this.filesinloadingqueue=0,this.OnLoaded=function(){},this.tar=new r(this),this.fsloader=new a(this),this.userinfo=[],this.watchFiles={},c.Register("LoadFilesystem",this.LoadFilesystem.bind(this)),c.Register("MergeFile",this.MergeFile.bind(this)),c.Register("WatchFile",function(e){this.watchFiles[e.name]=!0}.bind(this)),c.Register("ReadFile",function(e){c.Send("ReadFile",this.ReadFile.bind(this)(e))}.bind(this)),c.Register("tar",function(e){c.Send("tar",this.tar.Pack(e))}.bind(this)),c.Register("sync",function(e){c.Send("sync",this.tar.Pack(e))}.bind(this)),this.CreateDirectory("",-1)}var r=e("./tar.js"),a=e("./fsloader.js"),n=e("../utils.js"),h=e("../bzip2.js"),o=e("../dev/virtio/marshall.js"),d=e("../../lib/utf8.js"),c=e("../messagehandler"),u=e("./lazyUint8Array.js"),f=61440,p=49152,l=40960,b=32768,m=16384,R=-1,y=0,v=2,k=3,g=4;s.prototype.LoadFilesystem=function(e){this.userinfo=e,this.fsloader.LoadJSON(this.userinfo.basefsURL),this.OnLoaded=function(){this.userinfo.extendedfsURL&&this.fsloader.LoadJSON(this.userinfo.extendedfsURL);for(var e=0;e<this.userinfo.lazyloadimages.length;e++)this.LoadImage(this.userinfo.lazyloadimages[e])}.bind(this)},s.prototype.AddEvent=function(e,t){var i=this.inodes[e];return i.status==y?void t():void this.events.push({id:e,OnEvent:t})},s.prototype.HandleEvent=function(e){0==this.filesinloadingqueue&&(this.OnLoaded(),this.OnLoaded=function(){});for(var t=this.events.length-1;t>=0;t--)this.events[t].id==e&&(this.events[t].OnEvent(),this.events.splice(t,1))},s.prototype.LoadImage=function(e){e&&n.LoadBinaryResource(e,function(e){var t=new Uint8Array(e);0!=e.byteLength&&h.simple(t,this.tar.Unpack.bind(this.tar))}.bind(this),function(t){c.Debug("Error: Could not load "+e+". Skipping.")}.bind(this))},s.prototype.CheckEarlyload=function(e){for(var t=0;t<this.userinfo.earlyload.length;t++)if(this.userinfo.earlyload[t]==e)return!0;return!1},s.prototype.AppendDateHack=function(e){if("etc/init.d/rcS"==this.GetFullPath(e)){var t=this.inodes[e],i=new Date,s='\ndate -s "'+i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+'"\n',r=t.size;this.ChangeSize(e,r+s.length);for(var a=0;a<s.length;a++)t.data[a+r]=s.charCodeAt(a)}},s.prototype.LoadFile=function(e){var t=this.inodes[e];if(t.status==v){if(t.status=k,this.filesinloadingqueue++,t.compressed)return t.data=new Uint8Array(t.size),void n.LoadBinaryResource(t.url+".bz2",function(i){var s=new Uint8Array(i),r=0;h.simple(s,function(e){t.data[r++]=e}.bind(this)),t.status=y,this.filesinloadingqueue--,this.HandleEvent(e)}.bind(this),function(e){throw e});if(t.lazy){c.Debug("Using lazy file for "+t.url),t.data=new u(t.url,t.size);var i=t.size;return t.size=t.data.length,i!=t.size&&c.Warning("Size wrong for lazy loaded file: "+t.name),t.status=y,this.filesinloadingqueue--,void this.HandleEvent(e)}n.LoadBinaryResource(t.url,function(i){t.data=new Uint8Array(i),t.size!=this.inodes[e].data.length&&c.Warning("Size wrong for uncompressed non-lazily loaded file: "+t.name),t.size=this.inodes[e].data.length,t.status=y,"rcS"==t.name&&this.AppendDateHack(e),this.filesinloadingqueue--,this.HandleEvent(e)}.bind(this),function(e){throw e})}},s.prototype.PushInode=function(e){return-1!=e.parentid?(this.inodes.push(e),this.inodes[e.parentid].updatedir=!0,e.nextid=this.inodes[e.parentid].firstid,void(this.inodes[e.parentid].firstid=this.inodes.length-1)):0==this.inodes.length?void this.inodes.push(e):(c.Debug("Error in Filesystem: Pushed inode with name = "+e.name+" has no parent"),void c.Abort())},s.prototype.CreateInode=function(){return this.qidnumber++,{updatedir:!1,parentid:-1,firstid:-1,nextid:-1,status:0,name:"",size:0,uid:0,gid:0,ctime:Math.floor((new Date).getTime()/1e3),atime:Math.floor((new Date).getTime()/1e3),mtime:Math.floor((new Date).getTime()/1e3),major:0,minor:0,data:new Uint8Array(0),symlink:"",mode:493,qid:{type:0,version:0,path:this.qidnumber},url:"",compressed:!1}},s.prototype.CreateDirectory=function(e,t){var i=this.CreateInode();return i.name=e,i.parentid=t,i.mode=511|m,i.updatedir=!0,t>=0&&(i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.mode=511&this.inodes[t].mode|m),i.qid.type=m>>8,this.PushInode(i),this.inodes.length-1},s.prototype.CreateFile=function(e,t){var i=this.CreateInode();return i.name=e,i.parentid=t,i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.qid.type=b>>8,i.mode=438&this.inodes[t].mode|b,this.PushInode(i),this.inodes.length-1},s.prototype.CreateNode=function(e,t,i,s){var r=this.CreateInode();return r.name=e,r.parentid=t,r.major=i,r.minor=s,r.uid=this.inodes[t].uid,r.gid=this.inodes[t].gid,r.qid.type=p>>8,r.mode=438&this.inodes[t].mode,this.PushInode(r),this.inodes.length-1},s.prototype.CreateSymlink=function(e,t,i){var s=this.CreateInode();return s.name=e,s.parentid=t,s.uid=this.inodes[t].uid,s.gid=this.inodes[t].gid,s.qid.type=l>>8,s.symlink=i,s.mode=l,this.PushInode(s),this.inodes.length-1},s.prototype.CreateTextFile=function(e,t,i){var s=this.CreateFile(e,t),r=this.inodes[s];r.data=new Uint8Array(i.length),r.size=i.length;for(var a in i)r.data[a]=i.charCodeAt(a);return s},s.prototype.OpenInode=function(e,t){var i=this.GetInode(e);return(i.mode&f)==m&&this.FillDirectory(e),i.status==v?(this.LoadFile(e),!1):!0},s.prototype.CloseInode=function(e){var t=this.GetInode(e);t.status==g&&(t.status==R,t.data=new Uint8Array(0),t.size=0)},s.prototype.Rename=function(e,t,i,s){if(e==i&&t==s)return!0;var r=this.Search(e,t);if(-1==r)return!1;var a=this.Search(i,s);-1!=a&&this.Unlink(a);var n=r,h=this.inodes[n];if(this.inodes[h.parentid].firstid==n)this.inodes[h.parentid].firstid=h.nextid;else{var o=this.FindPreviousID(n);-1==o&&(c.Debug("Error in Filesystem: Cannot find previous id of inode"),c.Abort()),this.inodes[o].nextid=h.nextid}return h.parentid=i,h.name=s,h.qid.version++,h.nextid=this.inodes[h.parentid].firstid,this.inodes[h.parentid].firstid=n,this.inodes[e].updatedir=!0,this.inodes[i].updatedir=!0,!0},s.prototype.Write=function(e,t,i,s){var r=this.GetFullPath(e);1==this.watchFiles[r]&&c.Send("WatchFileEvent",r);var a=this.inodes[e];if(a.data.length<t+i?(this.ChangeSize(e,Math.floor(3*(t+i)/2)),a.size=t+i):a.size<t+i&&(a.size=t+i),a.data instanceof Uint8Array)for(var n=0;i>n;n++)a.data[t+n]=s();else for(var n=0;i>n;n++)a.data.Set(t+n,s())},s.prototype.Search=function(e,t){for(var i=this.inodes[e].firstid;-1!=i;){if(this.inodes[i].parentid!=e&&c.Debug("Error in Filesystem: Found inode with wrong parent id"),this.inodes[i].name==t)return i;i=this.inodes[i].nextid}return-1},s.prototype.GetTotalSize=function(){for(var e=0,t=0;t<this.inodes.length;t++)e+=this.inodes[t].data.length;return e},s.prototype.GetFullPath=function(e){for(var t="";0!=e;)t="/"+this.inodes[e].name+t,e=this.inodes[e].parentid;return t.substring(1)},s.prototype.FindPreviousID=function(e){for(var t=this.GetInode(e),i=this.inodes[t.parentid].firstid;-1!=i;){if(this.inodes[i].nextid==e)return i;i=this.inodes[i].nextid}return i},s.prototype.Unlink=function(e){if(0==e)return!1;var t=this.GetInode(e);if((t.mode&f)==m&&-1!=t.firstid)return!1;if(this.inodes[t.parentid].firstid==e)this.inodes[t.parentid].firstid=t.nextid;else{var i=this.FindPreviousID(e);-1==i&&(c.Debug("Error in Filesystem: Cannot find previous id of inode"),c.Abort()),this.inodes[i].nextid=t.nextid}return this.inodes[t.parentid].updatedir=!0,t.status=g,t.nextid=-1,t.firstid=-1,t.parentid=-1,!0},s.prototype.GetInode=function(e){return isNaN(e)?(c.Debug("Error in filesystem: id is not a number "),0):0>e||e>this.inodes.length?(c.Debug("Error in filesystem: Attempt to get inode with id "+e),0):this.inodes[e]},s.prototype.ChangeSize=function(e,t){var i=this.GetInode(e);if(t!=i.size){var s=new Uint8Array(t);i.size=t;for(var r=Math.min(i.data.length,i.size),a=0;r>a;a++)s[a]=this.ReadByte(i,a);i.data=s}},s.prototype.ReadByte=function(e,t){return e.data instanceof Uint8Array?e.data[t]:e.data.Get(t)},s.prototype.SearchPath=function(e){e=e.replace("//","/");var t=e.split("/"),i=t.length;0==t[i-1].length&&t.pop(),0==t[0].length&&t.shift();for(var i=t.length,s=0,r=-1,a=0;i>a;a++){if(r=this.Search(s,t[a]),-1==r)return i-1>a?{id:-1,parentid:-1,name:t[a]}:{id:-1,parentid:s,name:t[a]};s=r}return{id:r,parentid:s,name:t[a]}},s.prototype.GetRecursiveList=function(e,t){for(var i=this.inodes[e].firstid;-1!=i;)t.push(i),(this.inodes[i].mode&f)==m&&this.GetRecursiveList(i,t),i=this.inodes[i].nextid},s.prototype.ReadFile=function(e){var t=this.SearchPath(e.name);if(-1!=t.parentid)return-1==t.id?null:(e.data=this.inodes[t.id].data,e.size=this.inodes[t.id].size,e)},s.prototype.MergeFile=function(e){
c.Debug("Merge path:"+e.name);var t=this.SearchPath(e.name);-1!=t.parentid&&(-1==t.id&&(t.id=this.CreateFile(t.name,t.parentid)),this.inodes[t.id].data=e.data,this.inodes[t.id].size=e.data.length)},s.prototype.Check=function(){for(var e=1;e<this.inodes.length;e++)if(this.inodes[e].status!=R){this.inodes[e].nextid==e&&(c.Debug("Error in filesystem: file points to itself"),c.Abort());var t=this.GetInode(e);t.parentid<0&&c.Debug("Error in filesystem: negative parent id "+e);var i=t.name.length;0==i&&c.Debug("Error in filesystem: inode with no name and id "+e);for(var s in t.name){var r=t.name.charCodeAt(s);32>r&&c.Debug("Error in filesystem: Unallowed char in filename")}}},s.prototype.FillDirectory=function(e){var t=this.GetInode(e);if(t.updatedir){var i=t.parentid;-1==i&&(i=0);for(var s=0,r=this.inodes[e].firstid;-1!=r;)s+=24+d.UTF8Length(this.inodes[r].name),r=this.inodes[r].nextid;s+=25,s+=26,t.data=new Uint8Array(s),t.size=s;var a=0;a+=o.Marshall(["Q","d","b","s"],[this.inodes[e].qid,a+13+8+1+2+1,this.inodes[e].mode>>12,"."],t.data,a),a+=o.Marshall(["Q","d","b","s"],[this.inodes[i].qid,a+13+8+1+2+2,this.inodes[i].mode>>12,".."],t.data,a);for(var r=this.inodes[e].firstid;-1!=r;)a+=o.Marshall(["Q","d","b","s"],[this.inodes[r].qid,a+13+8+1+2+d.UTF8Length(this.inodes[r].name),this.inodes[r].mode>>12,this.inodes[r].name],t.data,a),r=this.inodes[r].nextid;t.updatedir=!1}},s.prototype.PrepareCAPs=function(e){var t=this.GetInode(e);return t.caps?t.caps.length:(t.caps=new Uint8Array(12),t.caps[0]=0,t.caps[1]=0,t.caps[2]=0,t.caps[3]=1,t.caps[4]=255,t.caps[5]=255,t.caps[6]=255,t.caps[7]=255,t.caps[8]=255,t.caps[9]=255,t.caps[10]=255,t.caps[11]=255,t.caps.length)},t.exports=s},{"../../lib/utf8.js":1,"../bzip2.js":2,"../dev/virtio/marshall.js":19,"../messagehandler":25,"../utils.js":29,"./fsloader.js":21,"./lazyUint8Array.js":22,"./tar.js":23}],21:[function(e,t,i){"use strict";function s(e){this.fs=e}var r=e("../messagehandler"),a=e("../utils"),n=511,h=40960,o=32768,d=16384,c=2;s.prototype.HandleDirContents=function(e,t){for(var i in e){var s=e[i],a=this.fs.Search(t,s.name);if(-1!=a){if(!s.path&&!s.size){s.child&&this.HandleDirContents(s.child,a);continue}r.Debug("Overwriting non-directory!")}var u=this.fs.CreateInode();if(u.name=s.name,u.uid=0|s.uid,u.gid=0|s.gid,u.parentid=t,u.mode=parseInt(s.mode,8),s.path)u.mode=h|n,u.symlink=s.path,this.fs.PushInode(u);else if(s.size){s.lazy&&(u.lazy=s.lazy),u.mode|=o;var f=this.fs.inodes.length;u.status=c,u.compressed=!!s.c,u.size=0|s.size,this.fs.PushInode(u);var p=this.sysrootdir+(s.src?s.src:this.fs.GetFullPath(f));u.url=p,(s.load||this.fs.CheckEarlyload(this.fs.GetFullPath(f)))&&this.fs.LoadFile(f)}else u.mode|=d,u.updatedir=!0,this.fs.PushInode(u),s.child&&this.HandleDirContents(s.child,-1!=a?a:this.fs.inodes.length-1)}},s.prototype.OnJSONLoaded=function(e){var t=JSON.parse(e);this.sysrootdir=t.src,String(this.sysrootdir)!==this.sysrootdir&&r.Debug("No sysroot (src tag)!"),this.sysrootdir+="/",this.HandleDirContents(t.fs,0),r.Debug("processed "+this.fs.inodes.length+" inodes"),this.fs.Check()},s.prototype.LoadJSON=function(e){r.Debug("Load filesystem information from "+e),a.LoadTextResource(e,this.OnJSONLoaded.bind(this),function(e){throw e})},t.exports=s},{"../messagehandler":25,"../utils":29}],22:[function(e,t,i){"use strict";function s(){return this.lengthKnown||this.CacheLength(),this._length}function r(){return this.lengthKnown||this.CacheLength(),this._chunkSize}function a(e,t){this.fallbackLength=t,this.overlay=[],this.url=e,this.lengthKnown=!1,this.chunks=[],Object.defineProperty(this,"length",{get:s}),Object.defineProperty(this,"chunkSize",{get:r})}var n=e("../messagehandler");a.prototype.Set=function(e,t){return e>this.length-1||0>e?void 0:void(this.overlay[e]=t)},a.prototype.Get=function(e){if(e>this.length-1||0>e)return void 0;if("undefined"!=typeof this.overlay[e])return this.overlay[e];var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.GetChunk(i)[t]},a.prototype.DoXHR=function(e,t){e>t&&n.Error("Invalid range ("+e+", "+t+") or no bytes requested!"),t>this._length-1&&n.Error("Only "+this._length+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",this.url,!1),this._length!==this._chunkSize&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+this.url+". Status: "+i.status);return new Uint8Array(i.response||[])},a.prototype.GetChunk=function(e){var t=e*this._chunkSize,i=(e+1)*this._chunkSize-1;return i=Math.min(i,this._length-1),"undefined"==typeof this.chunks[e]&&(this.chunks[e]=this.DoXHR(t,i)),this.chunks[e]},a.prototype.CacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",this.url+"?"+(new Date).getTime(),!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+this.url+". Status: "+e.status);this._length=Number(e.getResponseHeader("Content-length")),0===this._length&&(n.Warning("Server doesn't return Content-length, even though we have a cache defeating URL query-string appended"),this._length=this.fallbackLength),this._chunkSize=1048576;var t,i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t;i||(this._chunkSize=this._length),this.lengthKnown=!0},t.exports=a},{"../messagehandler":25}],23:[function(e,t,i){"use strict";function s(e){this.fs=e,this.tarbuffer=new Uint8Array(512),this.tarbufferofs=0,this.tarmode=0,this.tarfileoffset=0}function r(e,t,i){for(var s="",r=0;i>r;r++){if(e[t+r]<32)return s;s+=String.fromCharCode(e[t+r])}return s}function a(e,t,i,s){for(var r=Math.min(s,e.length+1),a=0;r>a;a++)t[i+a]=e.charCodeAt(a);t[i+r-1]=0}var n=e("../messagehandler"),h=61440,o=40960,d=32768,c=16384;s.prototype.Unpack=function(e){if(this.tarbuffer[this.tarbufferofs++]=e,512==this.tarbufferofs){if(this.tarbufferofs=0,1==this.tarmode){for(var t=Math.min(512,this.tarfilebuffer.length-this.tarfileoffset),i=0;t>i;i++)this.tarfilebuffer[this.tarfileoffset++]=this.tarbuffer[i];return void(this.tarfileoffset>=this.tarfilebuffer.length&&(this.tarmode=0))}var s=r(this.tarbuffer,257,5);if("ustar"==s){var a=String.fromCharCode(this.tarbuffer[156]),n=r(this.tarbuffer,0,100),h=n.split("/"),t=h.length;0==h[t-1].length&&h.pop();for(var t=h.length,u=0,f=-1,i=0;t-1>i;i++){if(f=this.fs.Search(u,h[i]),-1==f)throw"Error in untar: Could not find inode.";u=f}if(f=this.fs.Search(u,h[h.length-1]),-1==f&&!(-1!=f&&"5"!=a||-1!=f&&"5"==a)){var p=this.fs.CreateInode();p.name=h[t-1],p.parentid=u,p.mode=parseInt(r(this.tarbuffer,100,8),8),p.uid=parseInt(r(this.tarbuffer,108,8),8),p.gid=parseInt(r(this.tarbuffer,116,8),8),p.atime=parseInt(r(this.tarbuffer,136,12),8),p.ctime=this.atime,p.mtime=this.atime;var l=parseInt(r(this.tarbuffer,124,12),8);switch(a){case"5":p.mode|=c;break;case"0":if(p.mode|=d,p.data=new Uint8Array(l),p.size=l,0==l)break;this.tarmode=1,this.tarfileoffset=0,this.tarfilebuffer=p.data;break;case"1":p.mode|=o,p.symlink="/"+r(this.tarbuffer,157,100);break;case"2":p.mode|=o,p.symlink=r(this.tarbuffer,157,100)}this.fs.PushInode(p)}}}},s.prototype.Pack=function(e){n.Debug("tar: "+e);var t=this.fs.SearchPath(e).id;if(-1==t)return new Uint8Array(0);var i=[];this.fs.GetRecursiveList(t,i);for(var s=0,r=0;r<i.length;r++)switch(this.fs.inodes[i[r]].mode&h){case o:case c:s+=512;break;case d:s+=512,s+=this.fs.inodes[i[r]].size,511&s&&(s=-512&s,s+=512)}n.Debug("tar: "+this.fs.GetFullPath(t)+" size: "+s+" files: "+i.length),n.Debug(i);for(var u=new Uint8Array(s),f=0,r=0;r<i.length;r++){var p=this.fs.inodes[i[r]],l=p.mode&h;if(l==o||l==c||l==d){switch(a("ustar  ",u,f+257,8),a(this.fs.GetFullPath(i[r]),u,f+0,100),a("00000000000",u,f+124,12),a((4095&p.mode).toString(8),u,f+100,8),a(p.uid.toString(8),u,f+108,8),a(p.gid.toString(8),u,f+116,8),a(p.mtime.toString(8),u,f+136,12),u[f+148+0]=32,u[f+148+1]=32,u[f+148+2]=32,u[f+148+3]=32,u[f+148+4]=32,u[f+148+5]=32,u[f+148+6]=32,u[f+148+7]=32,l){case o:u[f+156]="2".charCodeAt(0),a(p.symlink,u,f+157,100);break;case c:u[f+156]="5".charCodeAt(0);break;case d:u[f+156]="0".charCodeAt(0),a(p.size.toString(8),u,f+124,12)}for(var b=0,m=0;512>m;m++)b+=u[f+m];if(a(b.toString(8),u,f+148,7),f+=512,l==d){for(var m=0;m<p.size;m++)u[f++]=p.data[m];511&f&&(f=-512&f,f+=512)}}}return u},t.exports=s},{"../messagehandler":25}],24:[function(e,t,i){t.exports=Math.imul||function(e,t){var i=e>>>16&65535,s=65535&e,r=t>>>16&65535,a=65535&t;return s*a+(i*a+s*r<<16>>>0)|0}},{}],25:[function(e,t,i){"use strict";function s(e,t){postMessage({command:e,data:t})}function r(e){s("Debug",e)}function a(){throw r("Worker: Abort execution."),s("Abort",{}),d=!1,new Error("Kill worker")}function n(e){s("Debug","Error: "+e),a()}function h(e){s("Debug","Warning: "+e)}function o(e,t){c[e]=t}var d=!0,c=new Object;onmessage=function(e){if(d){var t=e.data.command;if("function"!=typeof c[t]);else try{c[t](e.data.data)}catch(i){r('Worker: Unhandled exception in command "'+t+'": '+i.message),d=!1}}},o("Abort",function(){d=!1}),t.exports.Register=o,t.exports.Debug=r,t.exports.Error=n,t.exports.Warning=h,t.exports.Abort=a,t.exports.Send=s},{}],26:[function(e,t,i){function s(e,t){this.heap=e,this.int32mem=new Int32Array(this.heap,t),this.uint8mem=new Uint8Array(this.heap,t),this.sint8mem=new Int8Array(this.heap,t),this.devices=new Array(256)}var r=e("./messagehandler");e("./utils");s.prototype.AddDevice=function(e,t,i){16777215&t&&(r.Debug("Error: The device address not in the allowed memory region"),r.Abort()),this.devices[t>>24&255]=e},s.prototype.ReadMemory32=function(e){return e>=0?this.int32mem[e>>2]:this.devices[e>>24&255].ReadReg32(16777215&e)},s.prototype.WriteMemory32=function(e,t){return e>=0?void(this.int32mem[e>>2]=t):void this.devices[e>>24&255].WriteReg32(16777215&e,t)},s.prototype.ReadMemory8=function(e){return e>=0?this.uint8mem[3^e]:this.devices[e>>24&255].ReadReg8(16777215&e)},s.prototype.WriteMemory8=function(e,t){return e>=0?void(this.uint8mem[3^e]=t):void this.devices[e>>24&255].WriteReg8(16777215&e,t)},s.prototype.ReadMemory16=function(e){return e>=0?this.uint8mem[(2^e)+1]<<8|this.uint8mem[2^e]:this.devices[e>>24&255].ReadReg16(16777215&e)},s.prototype.WriteMemory16=function(e,t){return e>=0?(this.uint8mem[(2^e)+1]=t>>8&255,void(this.uint8mem[2^e]=255&t)):void this.devices[e>>24&255].WriteReg16(16777215&e,t)},t.exports=s},{"./messagehandler":25,"./utils":29}],27:[function(e,t,i){"use strict";function s(){r.Register("LoadAndStart",this.LoadImageAndStart.bind(this)),r.Register("execute",this.MainLoop.bind(this)),r.Register("Init",this.Init.bind(this)),r.Register("Reset",this.Reset.bind(this)),r.Register("ChangeCore",this.ChangeCPU.bind(this)),r.Register("GetIPS",function(e){r.Send("GetIPS",this.ips),this.ips=0}.bind(this))}var r=e("./messagehandler.js"),a=e("./utils.js"),n=e("./ram.js"),h=e("./bzip2.js"),o=e("./timer.js"),d=e("./cpu"),c=e("./dev/uart.js"),u=e("./dev/irq.js"),f=e("./dev/timer.js"),p=e("./dev/framebuffer.js"),l=e("./dev/ethmac.js"),b=e("./dev/ata.js"),m=e("./dev/rtc.js"),R=e("./dev/touchscreen.js"),y=e("./dev/keyboard.js"),v=e("./dev/sound.js"),k=e("./dev/virtio.js"),g=e("./dev/virtio/9p.js"),S=e("./filesystem/filesystem.js"),I=1,D=2,w=3;s.prototype.CreateCPU=function(e){try{this.cpu=new d(e,this.ram,this.heap,this.ncores)}catch(t){r.Debug("Error: failed to create CPU:"+t)}},s.prototype.ChangeCPU=function(e){this.cpu.switchImplementation(e)},s.prototype.Reset=function(){this.status=D,this.irqdev.Reset(),this.timerdev.Reset(),this.uartdev0.Reset(),this.uartdev1.Reset(),this.ethdev.Reset(),this.fbdev.Reset(),this.atadev.Reset(),this.tsdev.Reset(),this.snddev.Reset(),this.rtcdev.Reset(),this.kbddev.Reset(),this.virtiodev.Reset(),this.virtio9pdev.Reset(),this.cpu.Reset(),this.ips=0},s.prototype.Init=function(e){this.status=D,this.memorysize=e.memorysize,this.ncores=e.ncores,e.ncores||(e.ncores=1);var t=1048576;this.heap=new ArrayBuffer(1048576*this.memorysize),this.memorysize--,this.ram=new n(this.heap,t),this.CreateCPU(e.cpu,this.ram,this.heap,e.ncores),this.irqdev=new u(this),this.timerdev=new f,this.uartdev0=new c(0,this,2),this.uartdev1=new c(1,this,3),this.ethdev=new l(this.ram,this),this.ethdev.TransmitCallback=function(e){r.Send("ethmac",e)},this.fbdev=new p(this.ram),this.atadev=new b(this),this.tsdev=new R(this),this.kbddev=new y(this),this.snddev=new v(this,this.ram),this.rtcdev=new m(this),this.filesystem=new S,this.virtio9pdev=new g(this.ram,this.filesystem),this.virtiodev=new k(this,this.ram,this.virtio9pdev),this.ram.AddDevice(this.atadev,2650800128,4096),this.ram.AddDevice(this.uartdev0,2415919104,7),this.ram.AddDevice(this.uartdev1,2516582400,7),this.ram.AddDevice(this.snddev,2550136832,1024),this.ram.AddDevice(this.ethdev,2449473536,4096),this.ram.AddDevice(this.virtiodev,2533359616,4096),this.ram.AddDevice(this.fbdev,2432696320,4096),this.ram.AddDevice(this.tsdev,2466250752,4096),this.ram.AddDevice(this.kbddev,2483027968,256),this.ram.AddDevice(this.rtcdev,2566914048,4096),this.ram.AddDevice(this.irqdev,2583691264,4096),this.ram.AddDevice(this.timerdev,2600468480,4096),this.ips=0,this.idletime=0,this.idlemaxwait=0,this.ticksperms=2e4,this.loopspersecond=100,this.timer=new o(this.ticksperms,this.loopspersecond)},s.prototype.RaiseInterrupt=function(e){if(this.cpu.RaiseInterrupt(e,-1),this.status==w){this.status=I,clearTimeout(this.idletimeouthandle);var t=(a.GetMilliseconds()-this.idletime)*this.ticksperms;t>this.idlemaxwait&&(t=this.idlemaxwait),this.cpu.ProgressTime(t),this.MainLoop()}},s.prototype.ClearInterrupt=function(e){this.cpu.ClearInterrupt(e,-1)},s.prototype.RaiseSoftInterrupt=function(e,t){this.cpu.RaiseInterrupt(e,t)},s.prototype.ClearSoftInterrupt=function(e,t){this.cpu.ClearInterrupt(e,t)},s.prototype.PrintState=function(){r.Debug(this.cpu.toString())},s.prototype.SendStringToTerminal=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e.charCodeAt(i));r.Send("tty0",t)},s.prototype.LoadImageAndStart=function(e){this.SendStringToTerminal("\r================================================================================"),"string"==typeof e?(this.SendStringToTerminal("\r\nLoading kernel and hard and basic file system from web server. Please wait ...\r\n"),a.LoadBinaryResource(e,this.OnKernelLoaded.bind(this),function(e){throw e})):this.OnKernelLoaded(e)},s.prototype.PatchKernel=function(e){for(var t=this.ram.uint8mem,i=0;e>i;i++)109===t[i+0]&&101===t[i+1]&&109===t[i+2]&&111===t[i+3]&&114===t[i+4]&&121===t[i+5]&&0===t[i+6]&&1===t[i+24]&&240===t[i+25]&&0===t[i+26]&&0===t[i+27]&&(t[i+24]=1048576*this.memorysize>>24,t[i+25]=1048576*this.memorysize>>16,t[i+26]=0,t[i+27]=0)},s.prototype.OnKernelLoaded=function(e){this.SendStringToTerminal("Decompressing kernel...\r\n");var t=new Uint8Array(e),i=0;if(h.IsBZIP2(t))h.simple(t,function(e){this.ram.uint8mem[i++]=e}.bind(this));else{i=t.length;for(var s=0;i>s;s++)this.ram.uint8mem[s]=t[s]}this.PatchKernel(i);for(var s=0;i>>2>s;s++)this.ram.int32mem[s]=a.Swap32(this.ram.int32mem[s]);r.Debug("Kernel loaded: "+i+" bytes"),this.SendStringToTerminal("Booting\r\n"),this.SendStringToTerminal("================================================================================"),this.cpu.Reset(),this.cpu.AnalyzeImage(),r.Debug("Starting emulation"),this.status=I,r.Send("execute",0)},s.prototype.HandleHalt=function(){var e=this.cpu.GetTimeToNextInterrupt();if(-1!=e){this.idlemaxwait=e;var t=Math.floor(e/this.ticksperms/this.timer.correction+.5);1>=t||(t>1e3&&r.Debug("Warning: idle for "+t+"ms"),this.idletime=a.GetMilliseconds(),this.status=w,this.idletimeouthandle=setTimeout(function(){this.status==w&&(this.status=I,this.cpu.ProgressTime(e),this.MainLoop())}.bind(this),t))}},s.prototype.MainLoop=function(){if(this.status==I){r.Send("execute",0);var e=this.cpu.Step(this.timer.instructionsperloop,this.timer.timercyclesperinstruction),t=this.timer.instructionsperloop-e;t++,this.ips+=t,this.uartdev0.Step(),this.uartdev1.Step();var i=e?!0:!1;this.timer.Update(t,this.cpu.GetTicks(),i),i&&this.HandleHalt()}},t.exports=s},{"./bzip2.js":2,"./cpu":4,"./dev/ata.js":7,"./dev/ethmac.js":8,"./dev/framebuffer.js":9,"./dev/irq.js":10,"./dev/keyboard.js":11,"./dev/rtc.js":12,"./dev/sound.js":13,"./dev/timer.js":14,"./dev/touchscreen.js":15,"./dev/uart.js":16,"./dev/virtio.js":17,"./dev/virtio/9p.js":18,"./filesystem/filesystem.js":20,"./messagehandler.js":25,"./ram.js":26,"./timer.js":28,"./utils.js":29}],28:[function(e,t,i){"use strict";function s(e,t){this.ticksperms=e,this.loopspersecond=t,this.baserealtime=0,this.realtime=0,this.lastsystemticks=0,this.systemtime=0,this.correction=1,this.oldcorrection=1,this.steps=0,this.nins=0,this.lastlooptime=-1,this.ipms=5e3,this.instructionsperloop=0,this.timercyclesperinstruction=10,this.UpdateTimings()}var r=(e("./messagehandler.js"),e("./utils.js"));s.prototype.Update=function(e,t,i){this.GlobalUpdate(t),this.LocalUpdate(e,i)},s.prototype.UpdateTimings=function(e,t){this.instructionsperloop=Math.floor(1e3*this.ipms/this.loopspersecond),this.instructionsperloop=this.instructionsperloop<2e3?2e3:this.instructionsperloop,this.instructionsperloop=this.instructionsperloop>4e6?4e6:this.instructionsperloop,this.timercyclesperinstruction=Math.floor(64*this.ticksperms/this.ipms*this.correction),this.timercyclesperinstruction=this.timercyclesperinstruction<=1?1:this.timercyclesperinstruction,this.timercyclesperinstruction=this.timercyclesperinstruction>=1e3?1e3:this.timercyclesperinstruction},s.prototype.LocalUpdate=function(e,t){if(this.nins+=e,t)return this.lastlooptime=-1,void(this.nins=0);if(this.lastlooptime<0)return this.lastlooptime=r.GetMilliseconds(),void(this.nins=0);var i=r.GetMilliseconds()-this.lastlooptime;i>50&&this.nins>2e3&&(this.ipms=this.nins/i,this.UpdateTimings(),this.lastlooptime=r.GetMilliseconds(),this.nins=0)},s.prototype.GlobalUpdate=function(e){if(!(0>e)){e/=this.ticksperms,this.baserealtime<=0&&(this.baserealtime=r.GetMilliseconds()),this.realtime=r.GetMilliseconds()-this.baserealtime,this.lastsystemticks>e?this.systemtime+=e-this.lastsystemticks+268435456/this.ticksperms:this.systemtime+=e-this.lastsystemticks,this.lastsystemticks=e;var t=Math.abs(this.systemtime-this.realtime);t>500&&(this.baserealtime=r.GetMilliseconds(),this.systemtime=0,this.lastsystemticks=0),this.correction=1,this.systemtime>this.realtime+50&&(this.correction=.9),this.realtime>this.systemtime+50&&(this.correction=1.1),t>200&&(this.correction=this.correction*this.correction),t>400&&(this.correction=this.correction*this.correction),this.oldcorrection!=this.correction&&(this.UpdateTimings(),this.oldcorrection=this.correction)}},t.exports=s},{"./messagehandler.js":25,"./utils.js":29}],29:[function(e,t,i){function s(){return(new Date).getTime()}function r(e){return(255&e)<<24|(65280&e)<<8|e>>>8&65280|e>>>24&255}function a(e){return(255&e)<<8|e>>8&255}function n(e){return e>>0}function h(e){return e>>>0}function o(e){var t=h(e);return"0x"+("00000000"+t.toString(16)).substr(-8).toUpperCase()}function d(e,t,i){var s=new XMLHttpRequest;try{s.open("GET",e,!0)}catch(r){return void i(r)}s.responseType="arraybuffer",s.onreadystatechange=function(){if(4==s.readyState){if(200!=s.status&&0!=s.status)return void i("Error: Could not load file "+e);var r=s.response;r?t(r):i("Error: No data received from: "+e)}},s.send(null)}function c(e,t,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.onreadystatechange=function(){return 4==s.readyState?200!=s.status&&0!=s.status?void i("Error: Could not load text file "+e):void t(s.responseText):void 0},s.send(null)}t.exports.GetMilliseconds=s,t.exports.Swap32=r,t.exports.Swap16=a,t.exports.int32=n,t.exports.uint32=h,t.exports.ToHex=o,t.exports.LoadBinaryResource=d,t.exports.LoadTextResource=c},{}],30:[function(e,t,i){var s=e("./system.js");new s},{"./system.js":27}]},{},[30]);