/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.22 Copyright (c) 2010-2015, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */
var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,s){return t&&eachProp(t,function(t,r){(i||!hasProp(e,r))&&(!s||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,i,s)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,s){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=s,i&&(r.originalError=i),r}function newContext(e){function t(e){var t,i;for(t=0;t<e.length;t++)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,s){var r,a,n,o,c,h,u,d,f,l,p,b,m=i&&i.split("/"),v=S.map,g=v&&v["*"];if(e&&(e=e.split("/"),u=e.length-1,S.nodeIdCompat&&jsSuffixRegExp.test(e[u])&&(e[u]=e[u].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&m&&(b=m.slice(0,m.length-1),e=b.concat(e)),t(e),e=e.join("/")),s&&v&&(m||g)){n=e.split("/");e:for(o=n.length;o>0;o-=1){if(h=n.slice(0,o).join("/"),m)for(c=m.length;c>0;c-=1)if(a=getOwn(v,m.slice(0,c).join("/")),a&&(a=getOwn(a,h))){d=a,f=o;break e}!l&&g&&getOwn(g,h)&&(l=getOwn(g,h),p=o)}!d&&l&&(d=l,f=p),d&&(n.splice(0,f,d),e=n.join("/"))}return r=getOwn(S.pkgs,e),r?r:e}function s(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===R.contextName?(t.parentNode.removeChild(t),!0):void 0})}function r(e){var t=getOwn(S.paths,e);return t&&isArray(t)&&t.length>1?(t.shift(),R.require.undef(e),R.makeRequire(null,{skipMap:!0})([e]),!0):void 0}function a(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function n(e,t,s,r){var n,o,c,h,u=null,d=t?t.name:null,f=e,l=!0,p="";return e||(l=!1,e="_@r"+(j+=1)),h=a(e),u=h[0],e=h[1],u&&(u=i(u,d,r),o=getOwn(I,u)),e&&(u?p=o&&o.normalize?o.normalize(e,function(e){return i(e,d,r)}):-1===e.indexOf("!")?i(e,d,r):e:(p=i(e,d,r),h=a(p),u=h[0],p=h[1],s=!0,n=R.nameToUrl(p))),c=!u||o||s?"":"_unnormalized"+(M+=1),{prefix:u,name:p,parentMap:t,unnormalized:!!c,url:n,originalName:f,isDefine:l,id:(u?u+"!"+p:p)+c}}function o(e){var t=e.id,i=getOwn(T,t);return i||(i=T[t]=new R.Module(e)),i}function c(e,t,i){var s=e.id,r=getOwn(T,s);!hasProp(I,s)||r&&!r.defineEmitComplete?(r=o(e),r.error&&"error"===t?i(r.error):r.on(t,i)):"defined"===t&&i(I[s])}function h(e,t){var i=e.requireModules,s=!1;t?t(e):(each(i,function(t){var i=getOwn(T,t);i&&(i.error=e,i.events.error&&(s=!0,i.emit("error",e)))}),s||req.onError(e))}function u(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(R.defQueueMap[t]=!0),E.push(e)}),globalDefQueue=[])}function d(e){delete T[e],delete D[e]}function f(e,t,i){var s=e.map.id;e.error?e.emit("error",e.error):(t[s]=!0,each(e.depMaps,function(s,r){var a=s.id,n=getOwn(T,a);!n||e.depMatched[r]||i[a]||(getOwn(t,a)?(e.defineDep(r,I[a]),e.check()):f(n,t,i))}),i[s]=!0)}function l(){var e,t,i=1e3*S.waitSeconds,a=i&&R.startTime+i<(new Date).getTime(),n=[],o=[],c=!1,u=!0;if(!g){if(g=!0,eachProp(D,function(e){var i=e.map,h=i.id;if(e.enabled&&(i.isDefine||o.push(e),!e.error))if(!e.inited&&a)r(h)?(t=!0,c=!0):(n.push(h),s(h));else if(!e.inited&&e.fetched&&i.isDefine&&(c=!0,!i.prefix))return u=!1}),a&&n.length)return e=makeError("timeout","Load timeout for modules: "+n,null,n),e.contextName=R.contextName,h(e);u&&each(o,function(e){f(e,{},{})}),a&&!t||!c||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,l()},50)),g=!1}}function p(e){hasProp(I,e[0])||o(n(e[0],null,!0)).init(e[1],e[2])}function b(e,t,i,s){e.detachEvent&&!isOpera?s&&e.detachEvent(s,t):e.removeEventListener(i,t,!1)}function m(e){var t=e.currentTarget||e.srcElement;return b(t,R.onScriptLoad,"load","onreadystatechange"),b(t,R.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function v(){var e;for(u();E.length;){if(e=E.shift(),null===e[0])return h(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));p(e)}R.defQueueMap={}}var g,k,R,y,w,S={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},T={},D={},x={},E=[],I={},A={},C={},j=1,M=1;return y={require:function(e){return e.require?e.require:e.require=R.makeRequire(e.map)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports?I[e.map.id]=e.exports:e.exports=I[e.map.id]={}:void 0},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(S.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},k=function(e){this.events=getOwn(x,e.id)||{},this.map=e,this.shim=getOwn(S.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},k.prototype={init:function(e,t,i,s){s=s||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=s.ignore,s.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,R.startTime=(new Date).getTime();var e=this.map;return this.shim?void R.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;A[e]||(A[e]=!0,R.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,s=this.depExports,r=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){try{r=R.execCb(i,a,s,r)}catch(n){e=n}if(this.map.isDefine&&void 0===r&&(t=this.module,t?r=t.exports:this.usingExports&&(r=this.exports)),e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",h(this.error=e);"undefined"!=typeof console&&console.error?console.error(e):req.onError(e)}}else r=a;if(this.exports=r,this.map.isDefine&&!this.ignore&&(I[i]=r,req.onResourceLoad)){var o=[];each(this.depMaps,function(e){o.push(e.normalizedMap||e)}),req.onResourceLoad(R,this.map,o)}d(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(R.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,s=n(e.prefix);this.depMaps.push(s),c(s,"defined",bind(this,function(s){var r,a,u,f=getOwn(C,this.map.id),l=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null,b=R.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(s.normalize&&(l=s.normalize(l,function(e){return i(e,p,!0)})||""),a=n(e.prefix+"!"+l,this.map.parentMap),c(a,"defined",bind(this,function(e){this.map.normalizedMap=a,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),u=getOwn(T,a.id),void(u&&(this.depMaps.push(a),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):f?(this.map.url=R.nameToUrl(f),void this.load()):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(T,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&d(e.map.id)}),h(e)}),r.fromText=bind(this,function(i,s){var a=e.name,c=n(a),u=useInteractive;s&&(i=s),u&&(useInteractive=!1),o(c),hasProp(S.config,t)&&(S.config[a]=S.config[t]);try{req.exec(i)}catch(d){return h(makeError("fromtexteval","fromText eval for "+t+" failed: "+d,d,[t]))}u&&(useInteractive=!0),this.depMaps.push(c),R.completeLoad(a),b([a],r)}),void s.load(e.name,b,r,S))})),R.enable(s,this),this.pluginMaps[s.id]=s},enable:function(){D[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,s,r;if("string"==typeof e){if(e=n(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,r=getOwn(y,e.id))return void(this.depExports[t]=r(this));this.depCount+=1,c(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?c(e,"error",bind(this,this.errback)):this.events.error&&c(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,s=T[i],hasProp(y,i)||!s||s.enabled||R.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(T,e.id);t&&!t.enabled&&R.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},R={config:S,contextName:e,registry:T,defined:I,urlFetched:A,defQueue:E,defQueueMap:{},Module:k,makeModuleMap:n,nextTick:req.nextTick,onError:h,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=S.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(S[t]||(S[t]={}),mixin(S[t],e,!0,!0)):S[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(C[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,i){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=R.makeShimExports(e)),t[i]=e}),S.shim=t),e.packages&&each(e.packages,function(e){var t,i;e="string"==typeof e?{name:e}:e,i=e.name,t=e.location,t&&(S.paths[i]=e.location),S.pkgs[i]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(T,function(e,t){e.inited||e.map.unnormalized||(e.map=n(t,null,!0))}),(e.deps||e.callback)&&R.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,r){function a(i,s,c){var u,d,f;return r.enableBuildCallback&&s&&isFunction(s)&&(s.__requireJsBuild=!0),"string"==typeof i?isFunction(s)?h(makeError("requireargs","Invalid require call"),c):t&&hasProp(y,i)?y[i](T[t.id]):req.get?req.get(R,i,t,a):(d=n(i,t,!1,!0),u=d.id,hasProp(I,u)?I[u]:h(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(v(),R.nextTick(function(){v(),f=o(n(null,t)),f.skipMap=r.skipMap,f.init(i,s,c,{enabled:!0}),l()}),a)}return r=r||{},mixin(a,{isBrowser:isBrowser,toUrl:function(e){var s,r=e.lastIndexOf("."),a=e.split("/")[0],n="."===a||".."===a;return-1!==r&&(!n||r>1)&&(s=e.substring(r,e.length),e=e.substring(0,r)),R.nameToUrl(i(e,t&&t.id,!0),s,!0)},defined:function(e){return hasProp(I,n(e,t,!1,!0).id)},specified:function(e){return e=n(e,t,!1,!0).id,hasProp(I,e)||hasProp(T,e)}}),t||(a.undef=function(e){u();var i=n(e,t,!0),r=getOwn(T,e);r.undefed=!0,s(e),delete I[e],delete A[i.url],delete x[e],eachReverse(E,function(t,i){t[0]===e&&E.splice(i,1)}),delete R.defQueueMap[e],r&&(r.events.defined&&(x[e]=r.events),d(e))}),a},enable:function(e){var t=getOwn(T,e.id);t&&o(e).enable()},completeLoad:function(e){var t,i,s,a=getOwn(S.shim,e)||{},n=a.exports;for(u();E.length;){if(i=E.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);p(i)}if(R.defQueueMap={},s=getOwn(T,e),!t&&!hasProp(I,e)&&s&&!s.inited){if(!(!S.enforceDefine||n&&getGlobal(n)))return r(e)?void 0:h(makeError("nodefine","No define call for "+e,null,[e]));p([e,a.deps||[],a.exportsFn])}l()},nameToUrl:function(e,t,i){var s,r,a,n,o,c,h,u=getOwn(S.pkgs,e);if(u&&(e=u),h=getOwn(C,e))return R.nameToUrl(h,t,i);if(req.jsExtRegExp.test(e))o=e+(t||"");else{for(s=S.paths,r=e.split("/"),a=r.length;a>0;a-=1)if(n=r.slice(0,a).join("/"),c=getOwn(s,n)){isArray(c)&&(c=c[0]),r.splice(0,a,c);break}o=r.join("/"),o+=t||(/^data\:|\?/.test(o)||i?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":S.baseUrl)+o}return S.urlArgs?o+((-1===o.indexOf("?")?"?":"&")+S.urlArgs):o},load:function(e,t){req.load(R,e,t)},execCb:function(e,t,i,s){return t.apply(s,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=m(e);R.completeLoad(t.id)}},onScriptError:function(e){var t=m(e);if(!r(t.id)){var i=[];return eachProp(T,function(e,s){0!==s.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id&&i.push(s),!0})}),h(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}},R.require=R.makeRequire(),R}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,s){var r,a,n=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=i,i=s):e=[]),a&&a.context&&(n=a.context),r=getOwn(contexts,n),r||(r=contexts[n]=req.s.newContext(n)),a&&r.configure(a),r.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var s=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return s.type=e.scriptType||"text/javascript",s.charset="utf-8",s.async=!0,s},req.load=function(e,t,i){var s,r=e&&e.config||{};if(isBrowser)return s=req.createNode(r,t,i),r.onNodeCreated&&r.onNodeCreated(s,r,t,i),s.setAttribute("data-requirecontext",e.contextName),s.setAttribute("data-requiremodule",t),!s.attachEvent||s.attachEvent.toString&&s.attachEvent.toString().indexOf("[native code")<0||isOpera?(s.addEventListener("load",e.onScriptLoad,!1),s.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,s.attachEvent("onreadystatechange",e.onScriptLoad)),s.src=i,currentlyAddingScript=s,baseElement?head.insertBefore(s,baseElement):head.appendChild(s),currentlyAddingScript=null,s;if(isWebWorker)try{importScripts(i),e.completeLoad(t)}catch(a){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,a,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(e,t,i){var s,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(s=currentlyAddingScript||getInteractiveScript(),s&&(e||(e=s.getAttribute("data-requiremodule")),r=contexts[s.getAttribute("data-requirecontext")])),r?(r.defQueue.push([e,t,i]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("amd-loader",[],function(){var e=function(t,i,s,r){return 3==arguments.length?(r=s,s=void 0):2==arguments.length&&(r=i,i=s=void 0),{buildCache:{},load:function(a,n,o,c){var h=n.toUrl(a);if(c.precompiled instanceof Array){for(var u=0;u<c.precompiled.length;u++)if(h.substr(0,c.precompiled[u].length)==c.precompiled[u])return require([h+"."+t+".js"],o,o.error)}else if(c.precompiled===!0)return require([h+"."+t+".js"],o,o.error);if(i&&"/"!=a.substr(0,1)&&!a.match(/:\/\//)){var d=!1;if(s)for(var u=0;u<s.length;u++)a.substr(a.length-s[u].length-1)=="."+s[u]&&(d=!0);d||(h+="."+i)}var f=this;e.fetch(h,function(e){r(a,e,n,function(e){"string"==typeof e?(c.isBuild&&(f.buildCache[a]=e),o.fromText(e)):o(e)},o.error,c)},o.error)},write:function(e,t,i){var s=this.buildCache[t];s&&i.asModule(e+"!"+t,s)},writeFile:function(e,i,s,r){r.asModule(e+"!"+i,s.toUrl(i+"."+t+".js"),this.buildCache[i])}}};if("undefined"!=typeof window){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=function(e){var i=!0,s=/^(\w+:)?\/\/([^\/]+)/.exec(e);"undefined"!=typeof window&&s&&(i=s[2]===window.location.host,s[1]&&(i&=s[1]===window.location.protocol));var r;if("undefined"!=typeof XMLHttpRequest)r=new XMLHttpRequest;else for(var a,n=0;3>n;n+=1){a=t[n];try{r=new ActiveXObject(a)}catch(o){}if(r){t=[a];break}}if(!i)if("undefined"!=typeof XDomainRequest)r=new XDomainRequest;else if(!("withCredentials"in r))throw new Error("getXhr(): Cross Origin XHR not supported.");if(!r)throw new Error("getXhr(): XMLHttpRequest not available");return r};e.fetch=function(e,t,s){var r=i(e);r.open("GET",e,!requirejs.inlineRequire),r.onreadystatechange=function(i){var a,n;if(4===r.readyState)if(a=r.status,a>399&&600>a)n=new Error(e+" HTTP status: "+a),n.xhr=r,s&&s(n);else{if(""==r.responseText)return s(new Error(e+" empty response"));t(r.responseText)}},r.send(null)}}else if("undefined"!=typeof process&&process.versions&&process.versions.node){var s=requirejs.nodeRequire("fs");e.fetch=function(e,t){t(s.readFileSync(e,"utf8"))}}else"undefined"!=typeof Packages?e.fetch=function(e,t,i){var s,r,a="utf-8",n=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),a)),h="";try{for(s=new java.lang.StringBuffer,r=c.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),s.append(r);null!==(r=c.readLine());)s.append(o),s.append(r);h=String(s.toString())}catch(u){i&&i(u)}finally{c.close()}t(h)}:e.fetch=function(){throw new Error("Environment unsupported.")};return e}),define("cjs",["amd-loader"],function(e){var t=/\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g;return e("cjs","js",function(e,i,s,r,a,n){i=i.replace(t,function(e,t){return"."==t.substr(0,1)?" require('cjs!"+t+"')":" require('"+t+"')"}),r("define(function(require, exports, module) { (function(){var define=undefined;"+i+" \n//# sourceURL="+s.toUrl(e)+"\n})() });")})}),define("cjs!jor1k/worker/messagehandler",["require","exports","module"],function(e,t,i){!function(){function e(e,t){postMessage({command:e,data:t})}function t(t){e("Debug",t)}function s(){throw t("Worker: Abort execution."),"function"==typeof c.PrintOnAbort&&c.PrintOnAbort(),e("Abort",{}),o=!1,new Error("Kill worker")}function r(t){e("Debug","Error: "+t),s()}function a(t){e("Debug","Warning: "+t)}function n(e,t){c[e]=t}var o=!0,c=new Object;onmessage=function(e){if(o){var i=e.data.command;if("function"!=typeof c[i]);else try{c[i](e.data.data)}catch(s){t('Worker: Unhandled exception in command "'+i+'": '+s.message),o=!1}}},n("Abort",function(){o=!1}),i.exports.Register=n,i.exports.Debug=t,i.exports.Error=r,i.exports.Warning=a,i.exports.Abort=s,i.exports.Send=e}()}),define("cjs!jor1k/worker/utils",["require","exports","module"],function(e,t,i){!function(){function e(){return(new Date).getTime()}function t(e){return(255&e)<<24|(65280&e)<<8|e>>>8&65280|e>>>24&255}function s(e){return(255&e)<<8|e>>8&255}function r(e){return e>>0}function a(e){return e>>>0}function n(e){var t=a(e);return"0x"+("00000000"+t.toString(16)).substr(-8).toUpperCase()}function o(e){var t=a(e),i=("00000000000000000000000000000000"+t.toString(2)).substr(-32)+"b";return i.replace(/./g,function(e,t){return 3==(3&t)?e+" ":e})}function c(e,t,i){var s=new XMLHttpRequest;try{s.open("GET",e,!0)}catch(r){return void i(r)}s.responseType="arraybuffer",s.onreadystatechange=function(){if(4==s.readyState){if(200!=s.status&&0!=s.status)return void i("Error: Could not load file "+e);var r=s.response;r?t(r):i("Error: No data received from: "+e)}},s.send(null)}function h(e,t,i,s){var r=new XMLHttpRequest;try{r.open("GET",e,i)}catch(a){return void s(a)}r.responseType="arraybuffer",r.onreadystatechange=function(){if(4==r.readyState){if(200!=r.status&&0!=r.status)return void s("Error: Could not load file "+e);var i=r.response;i?t(i):s("Error: No data received from: "+e)}},r.send(null)}function u(e,t,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.onreadystatechange=function(){return 4==s.readyState?200!=s.status&&0!=s.status?void i("Error: Could not load text file "+e):void t(s.responseText):void 0},s.send(null)}i.exports.GetMilliseconds=e,i.exports.Swap32=t,i.exports.Swap16=s,i.exports.int32=r,i.exports.uint32=a,i.exports.ToHex=n,i.exports.ToBin=o,i.exports.LoadBinaryResource=c,i.exports.LoadBinaryResourceII=h,i.exports.LoadTextResource=u}()}),define("cjs!jor1k/worker/ram",["require","exports","module","cjs!./messagehandler","cjs!./utils"],function(e,t,i){!function(){function t(e,t){this.heap=e,this.int32mem=new Int32Array(this.heap,t),this.uint8mem=new Uint8Array(this.heap,t),this.sint8mem=new Int8Array(this.heap,t),this.devices=new Array(256),this.nativeendian="little",this.Read32Little=this.Read32LittleTemplate,this.Write32Little=this.Write32LittleTemplate,this.Read16Little=this.Read16LittleTemplate,this.Write16Little=this.Write16LittleTemplate,this.Read8Little=this.Read8LittleTemplate,this.Write8Little=this.Write8LittleTemplate,this.Read32=this.Read32LittleTemplate,this.Write32=this.Write32LittleTemplate,this.Read16=this.Read16LittleTemplate,this.Write16=this.Write16LittleTemplate,this.Read8=this.Read8LittleTemplate,this.Write8=this.Write8LittleTemplate,this.Read32Big=this.Read32BigTemplate,this.Write32Big=this.Write32BigTemplate,this.Read16Big=this.Read16BigTemplate,this.Write16Big=this.Write16BigTemplate,this.Read8Big=this.Read8BigTemplate,this.Write8Big=this.Write8BigTemplate}var s=e("cjs!./messagehandler"),r=e("cjs!./utils");t.prototype.AddDevice=function(e,t,i){16777215&t&&(s.Debug("Error: The device address not in the allowed memory region"),s.Abort()),this.devices[t>>24&255]=e},t.prototype.Little2Big=function(e){for(var t=0;e>>2>t;t++)this.int32mem[t]=r.Swap32(this.int32mem[t]);this.Read32=this.Read32BigTemplate,this.Write32=this.Write32BigTemplate,this.Read16=this.Read16BigTemplate,this.Write16=this.Write16BigTemplate,this.Read8=this.Read8BigTemplate,this.Write8=this.Write8BigTemplate,this.Read32Little=function(e){return r.Swap32(this.Read32BigTemplate(e))}.bind(this),this.Write32Little=function(e,t){this.Write32BigTemplate(e,r.Swap32(t))}.bind(this),this.Read16Little=function(e){return r.Swap16(this.Read16BigTemplate(e))}.bind(this),this.Write16Little=function(e,t){this.Write16BigTemplate(e,r.Swap16(t))}.bind(this),this.Read8Little=this.Read8BigTemplate.bind(this),this.Write8Little=this.Write8BigTemplate.bind(this),this.nativeendian="big"},t.prototype.Read32BigTemplate=function(e){return e=0|e,e>=0?(this.int32mem.byteLength<=e&&(s.Debug("Error in Read32Big: read above upper boundary"),s.Abort()),this.int32mem[e>>2]):this.devices[e>>24&255].ReadReg32(16777215&e)},t.prototype.Read32LittleTemplate=function(e){return e=0|e,e>=0?(this.int32mem.byteLength<=e&&(s.Debug("Error in Read32Little: read above upper boundary"),s.Abort()),this.int32mem[e>>2]):this.devices[e>>24&255].ReadReg32(16777215&e)},t.prototype.Write32BigTemplate=function(e,t){return e=0|e,e>=0?(this.int32mem.byteLength<=e&&(s.Debug("Error in Write32Big: write above upper boundary"),s.Abort()),void(this.int32mem[e>>2]=0|t)):void this.devices[e>>24&255].WriteReg32(16777215&e,0|t)},t.prototype.Write32LittleTemplate=function(e,t){return e=0|e,e>=0?(this.int32mem.byteLength<=e&&(s.Debug("Error in Write32Little: write above upper boundary"),s.Abort()),void(this.int32mem[e>>2]=0|t)):void this.devices[e>>24&255].WriteReg32(16777215&e,0|t)},t.prototype.Read8BigTemplate=function(e){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Read8Big: read above upper boundary"),s.Abort()),this.uint8mem[3^e]):this.devices[e>>24&255].ReadReg8(16777215&e)},t.prototype.Read8LittleTemplate=function(e){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Read8Little: read above upper boundary"),s.Abort()),this.uint8mem[e]):this.devices[e>>24&255].ReadReg8(16777215&e)},t.prototype.Write8BigTemplate=function(e,t){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Write8Big: write above upper boundary"),s.Abort()),void(this.uint8mem[3^e]=0|t)):void this.devices[e>>24&255].WriteReg8(16777215&e,0|t)},t.prototype.Write8LittleTemplate=function(e,t){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Write8Little: write above upper boundary"),s.Abort()),void(this.uint8mem[e]=0|t)):void this.devices[e>>24&255].WriteReg8(16777215&e,0|t)},t.prototype.Read16BigTemplate=function(e){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Read16Big: read above upper boundary"),s.Abort()),this.uint8mem[(2^e)+1]<<8|this.uint8mem[2^e]):this.devices[e>>24&255].ReadReg16(16777215&e)},t.prototype.Read16LittleTemplate=function(e){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Read16Little: read above upper boundary"),s.Abort()),this.uint8mem[e+1]<<8|this.uint8mem[e]):this.devices[e>>24&255].ReadReg16(16777215&e)},t.prototype.Write16BigTemplate=function(e,t){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Write16Big: write above upper boundary"),s.Abort()),this.uint8mem[(2^e)+1]=t>>8&255,void(this.uint8mem[2^e]=255&t)):void this.devices[e>>24&255].WriteReg16(16777215&e,0|t)},t.prototype.Write16LittleTemplate=function(e,t){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(s.Debug("Error in Write16Little: write above upper boundary"),s.Abort()),this.uint8mem[e+1]=t>>8&255,void(this.uint8mem[e]=255&t)):void this.devices[e>>24&255].WriteReg16(16777215&e,0|t)},i.exports=t}()}),define("cjs!jor1k/worker/bzip2",["require","exports","module","cjs!./messagehandler"],function(e,t,i){!function(){var t=e("cjs!./messagehandler"),s={};s.crcTable=[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188],s.array=function(e){var t=0,i=0,s=[0,1,3,7,15,31,63,127,255];return function(r){for(var a=0;r>0;){var n=8-t;r>=n?(a<<=n,a|=s[n]&e[i++],t=0,r-=n):(a<<=r,a|=(e[i]&s[r]<<8-r-t)>>8-r-t,t+=r,r=0)}return a}},s.IsBZIP2=function(e){return 66==e[0]&&90==e[1]&&104==e[2]?!0:!1},s.simple=function(e,t){var i=s.array(e),r=s.header(i),a=!1,n=1e5*r,o=new Int32Array(n);this.byteCount=new Int32Array(256),this.symToByte=new Uint8Array(256),this.mtfSymbol=new Int32Array(256),this.selectors=new Uint8Array(32768);do a=s.decompress(i,t,o,n);while(!a)},s.header=function(e){4348520!=e(24)&&t.Error("No magic number found");var i=e(8)-48;return(1>i||i>9)&&t.Error("Not a BZIP archive"),i},s.decompress=function(e,i,s,r){for(var a=20,n=258,o=0,c=1,h=50,u=-1,d="",f=0;6>f;f++)d+=e(8).toString(16);if("177245385090"==d)return!0;"314159265359"!=d&&t.Error("eek not valid bzip data");var l=0|e(32);e(1)&&t.Error("unsupported obsolete version");var p=e(24);p>r&&t.Error("Initial position larger than buffer size");var b=e(16),m=0;for(f=0;16>f;f++)if(b&1<<15-f){var v=e(16);for(R=0;16>R;R++)v&1<<15-R&&(this.symToByte[m++]=16*f+R)}var g=e(3);(2>g||g>6)&&t.Error("another error");var k=e(15);0==k&&t.Error("meh");
for(var f=0;g>f;f++)this.mtfSymbol[f]=f;for(var f=0;k>f;f++){for(var R=0;e(1);R++)R>=g&&t.Error("whoops another error");for(var y=this.mtfSymbol[R],v=R-1;v>=0;v--)this.mtfSymbol[v+1]=this.mtfSymbol[v];this.mtfSymbol[0]=y,this.selectors[f]=y}for(var w,S=m+2,T=[],D=new Uint8Array(n),x=new Uint8Array(a+1),R=0;g>R;R++){b=e(5);for(var f=0;S>f;f++){for(;;){if((1>b||b>a)&&t.Error("I gave up a while ago on writing error messages"),!e(1))break;e(1)?b--:b++}D[f]=b}var E,I;E=I=D[0];for(var f=1;S>f;f++)D[f]>I?I=D[f]:D[f]<E&&(E=D[f]);w=T[R]={},w.permute=new Int32Array(n),w.limit=new Int32Array(a+1),w.base=new Int32Array(a+1),w.minLen=E,w.maxLen=I;for(var A=w.base.subarray(1),C=w.limit.subarray(1),j=0,f=E;I>=f;f++)for(var b=0;S>b;b++)D[b]==f&&(w.permute[j++]=b);for(f=E;I>=f;f++)x[f]=C[f]=0;for(f=0;S>f;f++)x[D[f]]++;for(j=b=0,f=E;I>f;f++)j+=x[f],C[f]=j-1,j<<=1,A[f+1]=j-(b+=x[f]);C[I]=j+x[I]-1,A[E]=0}for(var f=0;256>f;f++)this.mtfSymbol[f]=f,this.byteCount[f]=0;var M,_,S,H;for(M=_=S=H=0;;){for(S--||(S=h-1,H>=k&&t.Error("meow i'm a kitty, that's an error"),w=T[this.selectors[H++]],A=w.base.subarray(1),C=w.limit.subarray(1)),f=w.minLen,R=e(f);;){if(f>w.maxLen&&t.Error("rawr i'm a dinosaur"),R<=C[f])break;f++,R=R<<1|e(1)}R-=A[f],(0>R||R>=n)&&t.Error("moo i'm a cow");var q=w.permute[R];if(q!=o&&q!=c){if(M)for(M=0,_+b>=r&&t.Error("Boom."),y=this.symToByte[this.mtfSymbol[0]],this.byteCount[y]+=b;b--;)s[_++]=y;if(q>m)break;_>=r&&t.Error("I can't think of anything. Error"),f=q-1,y=this.mtfSymbol[f];for(var v=f-1;v>=0;v--)this.mtfSymbol[v+1]=this.mtfSymbol[v];this.mtfSymbol[0]=y,y=this.symToByte[y],this.byteCount[y]++,s[_++]=y}else M||(M=1,b=0),b+=q==o?M:2*M,M<<=1}(0>p||p>=_)&&t.Error("I'm a monkey and I'm throwing something at someone, namely you");for(var R=0,f=0;256>f;f++)v=R+this.byteCount[f],this.byteCount[f]=R,R=v;for(var f=0;_>f;f++)y=255&s[f],s[this.byteCount[y]]|=f<<8,this.byteCount[y]++;var L=0,U=0,P=0;_&&(L=s[p],U=255&L,L>>=8,P=-1),_=_;for(var W,B,F;_;){for(_--,B=U,L=s[L],U=255&L,L>>=8,3==P++?(W=U,F=B,U=-1):(W=1,F=U);W--;)u=4294967295&(u<<8^this.crcTable[255&(u>>24^F)]),i(F);U!=B&&(P=0)}return u=(-1^u)>>>0,(0|u)!=(0|l)&&t.Error("Error in bzip2: crc32 do not match"),!1},i.exports=s}()}),define("cjs!jor1k/lib/utf8",["require","exports","module"],function(e,t,i){!function(){function e(){this.stream=new Uint8Array(5),this.ofs=0,this.Put=function(e){switch(this.stream[this.ofs]=e,this.ofs++,this.ofs){case 1:if(this.stream[0]<128)return this.ofs=0,this.stream[0];break;case 2:if(192==(224&this.stream[0])&&128==(192&this.stream[1]))return this.ofs=0,(31&this.stream[0])<<6|(63&this.stream[1])<<0;break;case 3:if(224==(240&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2]))return this.ofs=0,(15&this.stream[0])<<12|(63&this.stream[1])<<6|(63&this.stream[2])<<0;break;case 4:return 240==(248&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2])&&128==(192&this.stream[3])?(this.ofs=0,(7&this.stream[0])<<18|(63&this.stream[1])<<12|(63&this.stream[2])<<6|(63&this.stream[3])<<0):(this.ofs=0,-1);default:return this.ofs=0,-1}return-1}}function t(e){return e=0|e,128>e?[e]:2047>=e?[e>>6|192,63&e|128]:65535>=e?[e>>12|224,e>>6&63|128,63&e|128]:1114111>=e?[e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128]:[]}function s(e){for(var t=0,i=0;i<e.length;i++){var s=e.charCodeAt(i);128>s?t+=1:2047>=s?t+=2:65535>=s?t+=3:1114111>=s&&(t+=4)}return t}i.exports.UTF8StreamToUnicode=e,i.exports.UTF8Length=s,i.exports.UnicodeToUTF8Stream=t}()}),define("cjs!jor1k/worker/dev/virtio/marshall",["require","exports","module","cjs!../../../lib/utf8","cjs!../../messagehandler"],function(e,t,i){!function(){function t(e,i,s,r){for(var o,c=0,h=0;h<e.length;h++)switch(o=i[h],e[h]){case"w":s[r++]=255&o,s[r++]=o>>8&255,s[r++]=o>>16&255,s[r++]=o>>24&255,c+=4;break;case"d":s[r++]=255&o,s[r++]=o>>8&255,s[r++]=o>>16&255,s[r++]=o>>24&255,s[r++]=0,s[r++]=0,s[r++]=0,s[r++]=0,c+=8;break;case"h":s[r++]=255&o,s[r++]=o>>8,c+=2;break;case"b":s[r++]=o,c+=1;break;case"s":var u=r,d=0;s[r++]=0,s[r++]=0,c+=2;for(var f in o){var l=a.UnicodeToUTF8Stream(o.charCodeAt(f));l.forEach(function(e){s[r++]=e,c+=1,d++})}s[u+0]=255&d,s[u+1]=d>>8&255;break;case"Q":t(["b","w","d"],[o.type,o.version,o.path],s,r),r+=13,c+=13;break;default:n.Debug("Marshall: Unknown type="+type[h])}return c}function s(e,t,i){for(var s=[],r=0;r<e.length;r++)switch(e[r]){case"w":var o=t[i++];o+=t[i++]<<8,o+=t[i++]<<16,o+=t[i++]<<24>>>0,s.push(o);break;case"d":var o=t[i++];o+=t[i++]<<8,o+=t[i++]<<16,o+=t[i++]<<24>>>0,i+=4,s.push(o);break;case"h":var o=t[i++];s.push(o+(t[i++]<<8));break;case"b":s.push(t[i++]);break;case"s":var c=t[i++];c+=t[i++]<<8;for(var h="",u=new a.UTF8StreamToUnicode,d=0;c>d;d++){var f=u.Put(t[i++]);-1!=f&&(h+=String.fromCharCode(f))}s.push(h);break;default:n.Debug("Error in Unmarshall: Unknown type="+e[r])}return s}function r(e,t){for(var i=[],s=0;s<e.length;s++)switch(e[s]){case"w":var r=t();r+=t()<<8,r+=t()<<16,r+=t()<<24>>>0,i.push(r);break;case"d":var r=t();r+=t()<<8,r+=t()<<16,r+=t()<<24>>>0,t(),t(),t(),t(),i.push(r);break;case"h":var r=t();i.push(r+(t()<<8));break;case"b":i.push(t());break;case"s":var o=t();o+=t()<<8;for(var c="",h=new a.UTF8StreamToUnicode,u=0;o>u;u++){var d=h.Put(t());-1!=d&&(c+=String.fromCharCode(d))}i.push(c);break;default:n.Debug("Error in Unmarshall2: Unknown type="+e[s])}return i}var a=e("cjs!../../../lib/utf8"),n=e("cjs!../../messagehandler");i.exports.Marshall=t,i.exports.Unmarshall=s,i.exports.Unmarshall2=r}()}),define("cjs!jor1k/worker/elf",["require","exports","module","cjs!./messagehandler","cjs!./utils","cjs!./dev/virtio/marshall"],function(e,t,i){!function(){var t=e("cjs!./messagehandler"),s=(e("cjs!./utils"),e("cjs!./dev/virtio/marshall")),r={};r.IsELF=function(e){return 127==e[0]&&69==e[1]&&76==e[2]&&70==e[3]?!0:!1},r.Extract=function(e,i){var r=0,a=[];a=s.Unmarshall(["w","b","b","b","b"],e,r);var n=a[1];1!=n&&(t.Debug("Error reading elf binary: 64-Bit not supported"),t.Abort()),r=16,a=s.Unmarshall(["h","h","w","w","w","w"],e,r);var o=(a[3],a[4],a[5]);r=46,a=s.Unmarshall(["h","h","h"],e,r);for(var c=a[0],h=a[1],u=(a[2],[]),d=0;h>d;d++){r=o+d*c,a=s.Unmarshall(["w","w","w","w","w","w"],e,r);var f={};f.name=a[0],f.type=a[1],f.flags=a[2],f.addr=a[3],f.offs=a[4],f.size=a[5],u.push(f)}for(var d=0;d<u.length;d++)if(1==(u[d].flags>>1&1)&&8!=u[d].type)for(var l=0;l<u[d].size;l++)i[u[d].addr+l]=e[u[d].offs+l];else if(1==(u[d].flags>>1&1)&&8==u.type)for(var l=0;l<u[d].size;l++)i[u[d].addr+l]=0},i.exports=r}()}),define("cjs!jor1k/worker/timer",["require","exports","module","cjs!./messagehandler","cjs!./utils"],function(e,t,i){!function(){function t(e,t){this.ticksperms=e,this.loopspersecond=t,this.baserealtime=0,this.realtime=0,this.lastsystemticks=0,this.systemtime=0,this.correction=1,this.oldcorrection=1,this.steps=0,this.nins=0,this.lastlooptime=-1,this.ipms=5e3,this.instructionsperloop=0,this.timercyclesperinstruction=10,this.UpdateTimings()}var s=(e("cjs!./messagehandler"),e("cjs!./utils"));t.prototype.Update=function(e,t,i){this.GlobalUpdate(t),this.LocalUpdate(e,i)},t.prototype.UpdateTimings=function(e,t){this.instructionsperloop=Math.floor(1e3*this.ipms/this.loopspersecond),this.instructionsperloop=this.instructionsperloop<2e3?2e3:this.instructionsperloop,this.instructionsperloop=this.instructionsperloop>4e6?4e6:this.instructionsperloop,this.timercyclesperinstruction=Math.floor(64*this.ticksperms/this.ipms*this.correction),this.timercyclesperinstruction=this.timercyclesperinstruction<=1?1:this.timercyclesperinstruction,this.timercyclesperinstruction=this.timercyclesperinstruction>=1e3?1e3:this.timercyclesperinstruction},t.prototype.LocalUpdate=function(e,t){if(this.nins+=e,t)return this.lastlooptime=-1,void(this.nins=0);if(this.lastlooptime<0)return this.lastlooptime=s.GetMilliseconds(),void(this.nins=0);var i=s.GetMilliseconds()-this.lastlooptime;i>50&&this.nins>2e3&&(this.ipms=this.nins/i,this.UpdateTimings(),this.lastlooptime=s.GetMilliseconds(),this.nins=0)},t.prototype.GlobalUpdate=function(e){if(!(0>e)){e/=this.ticksperms,this.baserealtime<=0&&(this.baserealtime=s.GetMilliseconds()),this.realtime=s.GetMilliseconds()-this.baserealtime,this.lastsystemticks>e?this.systemtime+=e-this.lastsystemticks+268435456/this.ticksperms:this.systemtime+=e-this.lastsystemticks,this.lastsystemticks=e;var t=Math.abs(this.systemtime-this.realtime);t>500&&(this.baserealtime=s.GetMilliseconds(),this.systemtime=0,this.lastsystemticks=0),this.correction=1,this.systemtime>this.realtime+50&&(this.correction=.9),this.realtime>this.systemtime+50&&(this.correction=1.1),t>200&&(this.correction=this.correction*this.correction),t>400&&(this.correction=this.correction*this.correction),this.oldcorrection!=this.correction&&(this.UpdateTimings(),this.oldcorrection=this.correction)}},i.exports=t}()}),define("cjs!jor1k/worker/riscv/syscalls",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.ram=e,this.elf8mem=[],this.file_descriptor_table=[],this.file_size=[],this.file_pointer=[],this.file_descriptor_offset=9,this.elf8mem_offset=0}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=56,n=57,o=67,c=64,h=80,u=93,d=2011;t.prototype.HandleSysCall=function(e){e=0|e;var t=(this.ram,this.ram.Read32(e)),i=["spike","-m31","-p1","vmlinux"];switch(t){case a:for(var f,l=this.ram.Read32(e+16),p="",b=0;f=this.ram.Read8(l+b),0!=f;b++)p+=String.fromCharCode(f);var m=p;r.LoadBinaryResourceII("../sys/riscv/"+m,this.OnFileLoaded.bind(this),!1,function(e){throw e}),this.ram.Write32(e,this.file_descriptor_offset);break;case o:for(var v,g=this.ram.Read32(e+8),k=this.file_descriptor_table[g],R=this.ram.Read32(e+16),y=this.ram.Read32(e+24),w=this.ram.Read32(e+32),S=this.file_size[g],b=0;y>b&&!(b+w>=S);b++)v=this.elf8mem[k+b+w],this.ram.Write8(R+b,v);this.file_pointer[g]+=b,this.ram.Write32(e,b);break;case n:this.ram.Write32(e,0);break;case h:var g=this.ram.Read32(e+8),T=this.ram.Read32(e+16);this.ram.Write32(T,0),this.ram.Write32(T+4,0),this.ram.Write16(T+8,33279),this.ram.Write16(T+10,0),this.ram.Write16(T+12,0),this.ram.Write16(T+14,0),this.ram.Write32(T+16,0),this.ram.Write32(T+20,0),this.ram.Write32(T+24,this.file_size[g]),this.ram.Write16(T+28,512),this.ram.Write16(T+30,0),this.ram.Write32(T+32,0),this.ram.Write32(T+36,0),this.ram.Write32(T+40,0),this.ram.Write32(T+44,0),this.ram.Write32(T+48,0),this.ram.Write32(T+52,0),this.ram.Write32(T+56,0),this.ram.Write16(T+60,0),this.ram.Write16(T+62,0),this.ram.Write32(e,1);break;case c:for(var D=this.ram.Read32(e+24),b=0,x=this.ram.Read32(e+16);D>b;){var f=this.ram.Read8(x+b++);this.ram.Write8Little(-1879048192,f),10==f&&this.ram.Write8(-1879048192,13)}this.ram.Write32(e,b);break;case u:s.Debug("Program exited with sys_exit for inst at PC "+r.ToHex(this.pc)),s.Abort();break;case d:var E=this.ram.Read32(e+8),D=this.ram.Read32(e+16);this.ram.Write32(E,i.length);for(var I=8*i.length+32,b=0;b<i.length;b++)this.ram.Write32(E+8+8*b,E+I),I+=i[b].length+1;I=8*i.length+32;for(var b=0;b<i.length;b++){for(var A=0;A<i[b].length;A++)this.ram.Write8(E+I,i[b].charCodeAt(A)),I++;I++}this.ram.Write32(e,0);break;default:s.Debug("unkown SysCall "+r.ToHex(t)+" at PC "+r.ToHex(this.pc)),s.Abort()}},t.prototype.OnFileLoaded=function(e){var t=new Uint8Array(e),i=t.length;s.Debug("On File Loaded "+i);for(var r=0;i>r;r++)this.elf8mem[r+this.elf8mem_offset]=t[r];this.file_descriptor_table[++this.file_descriptor_offset]=this.elf8mem_offset,this.elf8mem_offset+=i,this.file_size[this.file_descriptor_offset]=i,this.file_pointer[this.file_descriptor_offset]=0},i.exports=t}()}),define("cjs!jor1k/worker/riscv/htif",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!../bzip2","cjs!./syscalls"],function(e,t,i){!function(){function t(e,t,i){for(var s=0;s<e.length;s++)t.Write8(i+s,e.charCodeAt(s));t.Write8(i+e.length,0)}function s(e,t){this.ram=e,this.identify="rfb",this.Send=t,this.width=640,this.height=400,this.paddr=0,this.Read=function(e){this.width=e>>0&65535,this.height=e>>16&65535,this.n=this.width*this.height>>1,this.buffer=new Int32Array(this.n),this.Send(3,0,1)},this.Write=function(e){this.paddr=e,this.Send(3,1,1)},this.OnGetFB=function(){0!=this.paddr&&c.Send("GetFB",this.GetBuffer())},this.GetBuffer=function(){var e=0,t=this.buffer.length,i=this.buffer,s=this.ram.int32mem,r=this.paddr>>2;for(e=0;t>e;++e)i[e]=s[r+e];return this.buffer},c.Register("GetFB",this.OnGetFB.bind(this))}function r(e,t){this.ram=e,this.identify="bcd",this.Send=t,this.charqueue=[],this.readpresent=!1,this.Read=function(e){this.readpresent=!0,0!=this.charqueue.length&&(this.Send(1,0,this.charqueue.shift()),this.readpresent=!1)},this.Write=function(e){this.ram.Write8(-1879048192,e),10==e&&this.ram.Write8(-1879048192,13),this.Send(1,1,1)},this.ReceiveChar=function(e){this.charqueue=this.charqueue.concat(e),this.readpresent&&(this.Send(1,0,this.charqueue.shift()),this.readpresent=!1)},c.Register("htif.term0.Transfer",this.ReceiveChar.bind(this))}function a(e,t){this.ram=e,this.Send=t,this.syscallHandler=new d(this.ram),this.identify="syscall_proxy",this.Read=function(e){e>>>0>256?this.syscallHandler.HandleSysCall(e):(this.ram.Write8(-1879048192,e+48),c.Debug("return value: "+e),c.Abort()),this.Send(0,0,1)}}function n(e,t){this.ram=e,this.Send=t,this.buffer=new Uint8Array(1048576),this.identify="disk size="+this.buffer.length,h.LoadBinaryResourceII("../sys/riscv/ext2fsimage.bz2",function(e){this.buffer=new Uint8Array(20971520);var t=0,i=new Uint8Array(e);u.simple(i,function(e){this.buffer[t++]=e}.bind(this)),this.identify="disk size="+this.buffer.length}.bind(this),!1,function(e){throw e}),this.Read=function(e){for(var t=this.ram.Read32(e+0),i=this.ram.Read32(e+8),s=this.ram.Read32(e+16),r=this.ram.Read32(e+24),a=0;s>a;a++)this.ram.Write8(t+a,this.buffer[i+a]);this.Send(2,0,r)},this.Write=function(e){for(var t=this.ram.Read32(e+0),i=this.ram.Read32(e+8),s=this.ram.Read32(e+16),r=this.ram.Read32(e+24),a=0;s>a;a++)this.buffer[i+a]=this.ram.Read8(t+a);this.Send(2,1,r)}}function o(e,t){this.ram=e,this.irqdev=t,this.device=[],this.device.push(new a(this.ram,this.Send.bind(this))),this.device.push(new r(this.ram,this.Send.bind(this))),this.device.push(new n(this.ram,this.Send.bind(this))),this.device.push(new s(this.ram,this.Send.bind(this))),this.devid=0,this.cmd=0,this.reg_tohost=0,this.reg_devcmdfromhost=0,this.fromhostqueue=[]}var c=e("cjs!../messagehandler"),h=e("cjs!../utils"),u=e("cjs!../bzip2"),d=e("cjs!./syscalls");o.prototype.Send=function(e,t,i){this.fromhostqueue.push({devid:e,cmd:t,data:i}),1==this.fromhostqueue.length&&(this.reg_devcmdfromhost=this.fromhostqueue[0].devid<<16|this.fromhostqueue[0].cmd),this.irqdev.RaiseInterrupt(15)},o.prototype.ReadDEVCMDToHost=function(){return this.devid<<16|this.cmd},o.prototype.WriteDEVCMDToHost=function(e){this.devid=e>>>16,this.cmd=65535&e},o.prototype.WriteDEVCMDFromHost=function(e){this.reg_devcmdfromhost=e},o.prototype.ReadDEVCMDFromHost=function(){return 0!=this.fromhostqueue.length?this.reg_devcmdfromhost:0},o.prototype.ReadToHost=function(){return 0},o.prototype.WriteToHost=function(e){this.reg_tohost=0|e,this.HandleRequest()},o.prototype.ReadFromHost=function(){return 0!=this.fromhostqueue.length?this.fromhostqueue[0].data:0},o.prototype.WriteFromHost=function(e){0==e&&0==this.reg_devcmdfromhost&&(this.fromhostqueue.shift(),this.fromhostqueue.length>0&&(this.reg_devcmdfromhost=this.fromhostqueue[0].devid<<16|this.fromhostqueue[0].cmd,this.irqdev.RaiseInterrupt(15)))},o.prototype.IsQueueEmpty=function(){return 0==this.fromhostqueue.length?!0:!1},o.prototype.HandleRequest=function(){if(255==this.cmd){var e=this.reg_tohost;return this.device[this.devid]?t(this.device[this.devid].identify,this.ram,e):this.ram.Write8(e+0,0),this.Send(this.devid,255,1),void(this.reg_tohost=0)}return 0==this.cmd?(this.device[this.devid]?this.device[this.devid].Read(this.reg_tohost):(c.Debug("Error in HTIF: unknown read from device"),c.Abort()),void(this.reg_tohost=0)):1==this.cmd?(this.device[this.devid]?this.device[this.devid].Write(this.reg_tohost):(c.Debug("Error in HTIF: unknown write from device"),c.Abort()),void(this.reg_tohost=0)):(c.Debug("Error HTIF: unknown request"),void c.Abort())},i.exports=o}()}),define("cjs!jor1k/worker/imul",["require","exports","module"],function(e,t,i){!function(){i.exports=Math.imul||function(e,t){var i=e>>>16&65535,s=65535&e,r=t>>>16&65535,a=65535&t;return s*a+(i*a+s*r<<16>>>0)|0}}()}),define("cjs!jor1k/worker/or1k/fastcpu",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e,t,i){"use asm";function s(){f(),r()}function r(){Ve=0,Xe=0,Qe=3,Ke=0,de[be+(K<<2)>>2]=24,de[be+(Y<<2)>>2]=24,de[be+(J<<2)>>2]=72,de[be+(Z<<2)>>2]=72,de[be+($<<2)>>2]=301989889,de[be+(G<<2)>>2]=1561,ke=0,Re=0,ye=-4,R(ie,0)}function a(){Ee=-1,Ie=-1,Ae=-1,Ce=-1,je=-1,Me=-1,_e=-1,He=-1,qe=-1,Le=-1,Ue=-1,Pe=-1,We=-1,Be=-1,Fe=-1,ze=-1,Oe=-1,Ge=-1}function n(){return ge>>>2|0}function o(){ge=de[64]<<2,Te=de[65]<<2,Se=de[66]|0,Ve=de[68]|0,Xe=de[69]|0,Qe=de[70]|0,Ke=de[71]|0,pt=de[72]|0,bt=de[73]|0,mt=de[74]|0,ke=0,Re=0,we=0,Te=ge}function c(){de[64]=ge>>>2,de[65]=ge+4>>>2,(ke|0)==(we|0)&&(de[65]=Te>>>2),de[66]=Se|0,de[67]=0,de[68]=Ve|0,de[69]=Xe|0,de[70]=Qe|0,de[71]=Ke|0,de[72]=pt|0,de[73]=bt|0,de[74]=mt|0}function h(){var e=0;return Ve>>30==0?-1:(e=(Ve&268435455)-(Xe&268435455)|0,(e|0)<0&&(e=e+268435455|0),e|0)}function u(e){e|=0,Xe=Xe+e|0}function d(){return Ve>>30==0?-1:Xe&268435455|0}function f(){pt=de[pe+2304>>2]|0,bt=de[pe+2560>>2]|0,mt=(de[pe+8208>>2]&4095)<<16|de[pe+8212>>2]&65535|0}function l(e){e|=0;var t=0;t=Ze,Ye=e&1,Je=e&2,Ze=e&4,$e=e&8,et=e&16,tt=e&32,it=e&64,st=e&128,rt=e&256,at=e&512,nt=e&1024,ot=e&2048,ct=e&4096,ht=e&8192,ut=e&16384,dt=1,ft=e&65536,lt=e>>28&15,st&&(E(q|0),I()),lt&&(E(L|0),I()),ut&&(E(U|0),I()),ht&&(E(P|0),I()),Ze&&(t|0)==0&&b()}function p(){var e=0;return e|=Ye?1:0,e|=Je?2:0,e|=Ze?4:0,e|=$e?8:0,e|=et?16:0,e|=tt?32:0,e|=it?64:0,e|=st?128:0,e|=rt?256:0,e|=at?512:0,e|=nt?1024:0,e|=ot?2048:0,e|=ct?4096:0,e|=ht?8192:0,e|=ut?16384:0,e|=dt?32768:0,e|=ft?65536:0,e|=lt<<28,e|0}function b(){Ze&&Qe&Ke&&(vt=1)}function m(e,t){e|=0,t|=0;var i=0;i=1<<e|0,Ke|=i,b()}function v(e,t){e|=0,t|=0,Ke&=~(1<<e)}function g(e,t){e|=0,t|=0;var i=0,s=0;switch(i=e&2047,s=e>>11&31,s|0){case 0:(i|0)==(N|0)&&l(t),de[be+(i<<2)>>2]=t;break;case 1:de[me+(i<<2)>>2]=t;break;case 2:de[ve+(i<<2)>>2]=t;break;case 3:case 4:break;case 8:gt=1;break;case 9:switch(i|0){case 0:Qe=t|3,Ze&&Qe&Ke&&(E(W|0),I());break;case 2:break;default:E(B|0),I()}break;case 10:switch(i|0){case 0:Ve=t|0,(Ve>>30&3)!=3&&(E(F|0),I());break;case 1:Xe=t|0;break;default:E(O|0),I()}break;default:E(O|0),I()}}function k(e){e|=0;var t=0,i=0;switch(t=e&2047,i=e>>11&31,i|0){case 0:return(t|0)==(N|0)?p()|0:de[be+(t<<2)>>2]|0;case 1:return de[me+(t<<2)>>2]|0;case 2:return de[ve+(t<<2)>>2]|0;case 8:return 0;case 9:switch(t|0){case 0:return Qe|0;case 2:return Ke|0;default:E(O|0),I()}break;case 10:switch(t|0){case 0:return Ve|0;case 1:return Xe|0;default:E(O|0),I()}break;default:E(O|0),I()}return 0}function R(e,t){e|=0,t|=0;var i=0;switch(i=e|(ut?4026531840:0),g(V,t),g(Q,p()|0),Ne=-1,ct=0,Ye=1,Ze=0,Je=0,tt=0,Ee=0,Ie=0,Ae=0,Ce=0,je=0,Me=0,_e=0,He=0,qe=0,Le=0,Ue=0,We=0,Pe=0,Fe=0,Be=0,ze=0,Oe=0,Ge=0,we=ke|0,Te=i,e|0){case 256:break;case 768:case 2304:case 3584:case 512:ge=ye+ke|0,g(X,ge-(Se?4:0)|0);break;case 2560:case 1024:case 1280:case 2048:g(X,ge-(Se?4:0)|0);break;case 3072:ge=ye+ke|0,g(X,ge+4-(Se?4:0)|0);break;default:E(z|0),I()}Se=0,it=0}function y(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(de[pe+2304>>2]|0)==(pt|0)?(R(se,e),0):(i=e,s=de[pe+mt>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=de[pe+r>>2]|0,(s|0)==0?(R(re,e),0):(s=4294959104,r=de[pe+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=de[pe+s>>2]|0,(i&1)==0?(R(re,e),0):(r=i&4294960122,a&=t-1,de[me+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,de[me+((512|a)<<2)>>2]=r,1)))}function w(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(de[pe+2560>>2]|0)==(bt|0)?(R(ee,e),0):(i=e,s=de[pe+mt>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=de[pe+r>>2]|0,(s|0)==0?(R(te,e),0):(s=4294959104,r=de[pe+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=de[pe+s>>2]|0,(i&1)==0?(R(te,e),0):(r=i&4294959162,s=i&1984,(s|0)!=0&&(a&=t-1,r|=192),de[ve+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,de[ve+((512|a)<<2)>>2]=r,1)))}function S(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(!tt)return e|0;if(i=e>>13&63,s=de[me+((512|i)<<2)>>2]|0,(s&1)==0){if(!(y(e,64)|0))return-1;s=de[me+(512+i<<2)>>2]|0}if(s>>19!=e>>19){if(!(y(e,64)|0))return-1;s=de[me+(512+i<<2)>>2]|0}if(r=de[me+((640|i)<<2)>>2]|0,Ye){if(t){if(!(r&512))return R(re,e),-1}else if(!(r&256))return R(re,e),-1}else if(t){if(!(r&128))return R(re,e),-1}else if(!(r&64))return R(re,e),-1;return r&4294959104|e&8191|0}function T(e,t){e|=0,t|=0;for(var i=0,s=0,r=0,n=0,o=0,c=0,h=0,u=0,d=0,f=0,p=0,b=0,m=0,v=0;;)if((ke|0)!=(we|0))switch(i=de[ke>>2]|0,ke=ke+4|0,i>>26&63){case 0:ge=ye+ke|0,De=ge+(i<<6>>4)|0,(we|0)==(ke|0)?xe=1:(we=ke+4|0,Te=De|0),Se=1;continue;case 1:ge=ye+ke|0,De=ge+(i<<6>>4)|0,he[9]=ge+8|0,(we|0)==(ke|0)?xe=1:(we=ke+4|0,Te=De|0),Se=1;continue;case 3:if(at)break;ge=ye+ke|0,De=ge+(i<<6>>4)|0,(we|0)==(ke|0)?xe=1:(we=ke+4|0,Te=De|0),Se=1;continue;case 4:if(!at)continue;ge=ye+ke|0,De=ge+(i<<6>>4)|0,(we|0)==(ke|0)?xe=1:(we=ke+4|0,Te=De|0),Se=1;continue;case 5:continue;case 6:n=i>>21&31,he[n<<2>>2]=(i&65535)<<16;continue;case 8:(i&4294901760)==553648128?R(ce,de[be+V>>2]|0):R(oe,de[be+V>>2]|0);continue;case 9:De=k(X)|0,a(),we=ke,Te=De,l(k(Q)|0);continue;case 17:De=he[(i>>9&124)>>2]|0,(we|0)==(ke|0)?xe=1:(we=ke+4|0,Te=De|0),Se=1;continue;case 18:ge=ye+ke|0,De=he[(i>>9&124)>>2]|0,he[9]=ge+8|0,(we|0)==(ke|0)?xe=1:(we=ke+4|0,Te=De|0),Se=1;continue;case 27:if(u=(he[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ue^u)>>13){if(d=S(u,0)|0,(d|0)==-1)break;Ue=u,Ie=(d^u)>>13<<13}d=Ie^u,Ne=d,he[(i>>19&124)>>2]=(d|0)>0?de[pe+d>>2]|0:A(d|0)|0;continue;case 33:if(u=(he[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ue^u)>>13){if(d=S(u,0)|0,(d|0)==-1)break;Ue=u,Ie=(d^u)>>13<<13}d=Ie^u,he[(i>>19&124)>>2]=(d|0)>0?de[pe+d>>2]|0:A(d|0)|0;continue;case 35:if(u=(he[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(We^u)>>13){if(d=S(u,0)|0,(d|0)==-1)break;We=u,Ce=(d^u)>>13<<13}d=Ce^u,(d|0)>=0?he[(i>>19&124)>>2]=fe[pe+(d^3)|0]|0:he[(i>>19&124)>>2]=_(d|0)|0;continue;case 36:if(u=(he[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Pe^u)>>13){if(d=S(u,0)|0,(d|0)==-1)break;Pe=u,Ae=(d^u)>>13<<13}d=Ae^u,(d|0)>=0?he[(i>>19&124)>>2]=fe[pe+(d^3)|0]<<24>>24:he[(i>>19&124)>>2]=(_(d|0)|0)<<24>>24;continue;case 37:if(u=(he[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Fe^u)>>13){if(d=S(u,0)|0,(d|0)==-1)break;Fe=u,Me=(d^u)>>13<<13}d=Me^u,(d|0)>=0?he[(i>>19&124)>>2]=le[pe+(d^2)>>1]:he[(i>>19&124)>>2]=j(d|0)|0;continue;case 38:if(u=(he[(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Be^u)>>13){if(d=S(u,0)|0,(d|0)==-1)break;Be=u,je=(d^u)>>13<<13}d=je^u,(d|0)>=0?he[(i>>19&124)>>2]=le[pe+(d^2)>>1]<<16>>16:he[(i>>19&124)>>2]=(j(d|0)|0)<<16>>16;continue;case 39:o=he[(i>>14&124)>>2]|0,he[(i>>19&124)>>2]=o+(i<<16>>16)|0;continue;case 41:he[(i>>19&124)>>2]=he[(i>>14&124)>>2]&(i&65535);continue;case 42:he[(i>>19&124)>>2]=he[(i>>14&124)>>2]|i&65535;continue;case 43:o=he[(i>>14&124)>>2]|0,he[(i>>19&124)>>2]=o^i<<16>>16;continue;case 45:he[(i>>19&124)>>2]=k(he[(i>>14&124)>>2]|i&65535)|0;continue;case 46:switch(i>>6&3){case 0:he[(i>>19&124)>>2]=he[(i>>14&124)>>2]<<(i&31);continue;case 1:he[(i>>19&124)>>2]=he[(i>>14&124)>>2]>>>(i&31);continue;case 2:he[(i>>19&124)>>2]=he[(i>>14&124)>>2]>>(i&31);continue;default:E(O|0),I()}break;case 47:switch(s=i<<16>>16,i>>21&31){case 0:at=(he[(i>>14&124)>>2]|0)==(s|0);continue;case 1:at=(he[(i>>14&124)>>2]|0)!=(s|0);continue;case 2:at=he[(i>>14&124)>>2]>>>0>s>>>0;continue;case 3:at=he[(i>>14&124)>>2]>>>0>=s>>>0;continue;case 4:at=he[(i>>14&124)>>2]>>>0<s>>>0;continue;case 5:at=he[(i>>14&124)>>2]>>>0<=s>>>0;continue;case 10:at=(he[(i>>14&124)>>2]|0)>(s|0);continue;case 11:at=(he[(i>>14&124)>>2]|0)>=(s|0);continue;case 12:at=(he[(i>>14&124)>>2]|0)<(s|0);continue;case 13:at=(he[(i>>14&124)>>2]|0)<=(s|0);continue;default:E(O|0),I()}break;case 48:if(s=i&2047|i>>10&63488,g(he[(i>>14&124)>>2]|s,he[(i>>9&124)>>2]|0),gt&&(gt=0,(vt|0)==0&&!(Ve&1<<28)))return e|0;continue;case 50:switch(o=i>>14&124,c=i>>9&124,h=i>>19&124,i&255){case 0:ue[h>>2]=+ue[o>>2]+ +ue[c>>2];continue;case 1:ue[h>>2]=+ue[o>>2]-+ue[c>>2];continue;case 2:ue[h>>2]=+ue[o>>2]*+ue[c>>2];continue;case 3:ue[h>>2]=+ue[o>>2]/+ue[c>>2];continue;case 4:ue[h>>2]=+(he[o>>2]|0);continue;case 5:he[h>>2]=~~+D(+ue[o>>2]);continue;case 7:ue[h>>2]=+ue[h>>2]+ +ue[o>>2]*+ue[c>>2];continue;case 8:at=+ue[o>>2]==+ue[c>>2];continue;case 9:at=+ue[o>>2]!=+ue[c>>2];continue;case 10:at=+ue[o>>2]>+ue[c>>2];continue;case 11:at=+ue[o>>2]>=+ue[c>>2];continue;case 12:at=+ue[o>>2]<+ue[c>>2];continue;case 13:at=+ue[o>>2]<=+ue[c>>2];continue;default:E(O|0),I()}break;case 51:if(s=(i>>10&63488|i&2047)<<16>>16,u=(he[(i>>14&124)>>2]|0)+s|0,(ze^u)>>13){if(d=S(u,1)|0,(d|0)==-1)break;ze=u,_e=(d^u)>>13<<13}if(d=_e^u,at=(d|0)==(Ne|0)?1:0,Ne=-1,(at|0)==0)break;(d|0)>0?de[pe+d>>2]=he[(i>>9&124)>>2]|0:C(d|0,he[(i>>9&124)>>2]|0);continue;case 53:if(s=(i>>10&63488|i&2047)<<16>>16,u=(he[(i>>14&124)>>2]|0)+s|0,(ze^u)>>13){if(d=S(u,1)|0,(d|0)==-1)break;ze=u,_e=(d^u)>>13<<13}d=_e^u,(d|0)>0?de[pe+d>>2]=he[(i>>9&124)>>2]|0:C(d|0,he[(i>>9&124)>>2]|0);continue;case 54:if(s=(i>>10&63488|i&2047)<<16>>16,u=(he[(i>>14&124)>>2]|0)+s|0,(Oe^u)>>13){if(d=S(u,1)|0,(d|0)==-1)break;Oe=u,He=(d^u)>>13<<13}d=He^u,(d|0)>0?fe[pe+(d^3)|0]=he[(i>>9&124)>>2]|0:H(d|0,he[(i>>9&124)>>2]|0);continue;case 55:if(s=(i>>10&63488|i&2047)<<16>>16,u=(he[(i>>14&124)>>2]|0)+s|0,(Ge^u)>>13){if(d=S(u,1)|0,(d|0)==-1)break;Ge=u,qe=(d^u)>>13<<13}d=qe^u,(d|0)>=0?le[pe+(d^2)>>1]=he[(i>>9&124)>>2]:M(d|0,he[(i>>9&124)>>2]|0);continue;case 56:switch(o=he[(i>>14&124)>>2]|0,c=he[(i>>9&124)>>2]|0,n=i>>19&124,i&975){case 0:he[n>>2]=o+c;continue;case 2:he[n>>2]=o-c;continue;case 3:he[n>>2]=o&c;continue;case 4:he[n>>2]=o|c;continue;case 5:he[n>>2]=o^c;continue;case 8:he[n>>2]=o<<(c&31);break;case 72:he[n>>2]=o>>>(c&31);continue;case 15:for(he[n>>2]=0,r=0;(r|0)<32;r=r+1|0)if(o&1<<r){he[n>>2]=r+1;break}continue;case 136:he[n>>2]=o>>(c&31);continue;case 271:for(he[n>>2]=0,r=31;(r|0)>=0;r=r-1|0)if(o&1<<r){he[n>>2]=r+1;break}continue;case 774:he[n>>2]=x(o|0,c|0)|0;continue;case 778:nt=(c|0)==0,ot=0,nt||(he[n>>2]=(o>>>0)/(c>>>0));continue;case 777:nt=(c|0)==0,ot=0,nt||(he[n>>2]=(o|0)/(c|0));continue;default:E(O|0),I()}break;case 57:switch(i>>21&31){case 0:at=(he[(i>>14&124)>>2]|0)==(he[(i>>9&124)>>2]|0);continue;case 1:at=(he[(i>>14&124)>>2]|0)!=(he[(i>>9&124)>>2]|0);continue;case 2:at=he[(i>>14&124)>>2]>>>0>he[(i>>9&124)>>2]>>>0;continue;case 3:at=he[(i>>14&124)>>2]>>>0>=he[(i>>9&124)>>2]>>>0;continue;case 4:at=he[(i>>14&124)>>2]>>>0<he[(i>>9&124)>>2]>>>0;continue;case 5:at=he[(i>>14&124)>>2]>>>0<=he[(i>>9&124)>>2]>>>0;continue;case 10:at=(he[(i>>14&124)>>2]|0)>(he[(i>>9&124)>>2]|0);continue;case 11:at=(he[(i>>14&124)>>2]|0)>=(he[(i>>9&124)>>2]|0);continue;case 12:at=(he[(i>>14&124)>>2]|0)<(he[(i>>9&124)>>2]|0);continue;case 13:at=(he[(i>>14&124)>>2]|0)<=(he[(i>>9&124)>>2]|0);continue;default:E(O|0),I()}break;default:E(O|0),I()}else{if(ge=Te,!xe|0&&(Se=0),v=v+(ke-Re>>2)|0,(v|0)>=64&&!(xe|0)){if(v=v-64|0,e=e-64|0,(e|0)<0)return 0;Ve>>30!=0&&(m=(Ve&268435455)-(Xe&268435455)|0,(m|0)<0&&(m=m+268435455|0),Xe=Xe+t|0,(m|0)<(t|0)&&Ve&1<<29&&(Ve|=1<<28)),Ve&1<<28?Je&&(R(ae,de[be+(V<<2)>>2]|0),ge=Te):Ze|0&&vt|0&&(vt=0,R(ne,de[be+(V<<2)>>2]|0),ge=Te)}if((Le^ge)&4294959104)if(Le=ge,it){if(f=ge>>13&63,p=de[ve+((512|f)<<2)>>2]|0,(p&1)==0){if(!(w(ge,64)|0)){Re=ke,xe=0;continue}p=de[ve+((512|f)<<2)>>2]|0}if(p>>19!=ge>>19){if(!(w(ge,64)|0)){Re=ke,xe=0;continue}p=de[ve+((512|f)<<2)>>2]|0}b=de[ve+((640|f)<<2)>>2]|0,Ee=(b^p)>>13<<13}else Ee=0;ke=pe+(Ee^ge)|0,Re=ke,ye=ge-4-Re|0,xe|0?(xe=0,we=ke+4|0,Te=De):(we=(ke>>13)+1<<13,Te=(ge>>13)+1<<13)}return e|0}var D=e.Math.floor,x=t.imul,E=t.DebugMessage,I=t.abort,A=t.Read32,C=t.Write32,j=t.Read16,M=t.Write16,_=t.Read8,H=t.Write8,q=0,L=1,U=2,P=3,W=4,B=5,F=6,z=7,O=8,G=1,N=17,V=48,X=32,Q=64,K=4,Y=3,J=6,Z=5,$=0,ee=2560,te=1024,ie=256,se=2304,re=768,ae=1280,ne=2048,oe=3072,ce=3584,he=new e.Int32Array(i),ue=new e.Float32Array(i),de=new e.Int32Array(i),fe=new e.Uint8Array(i),le=new e.Uint16Array(i),pe=1048576,be=8192,me=16384,ve=24576,ge=0,ke=0,Re=0,ye=-4,we=0,Se=0,Te=0,De=0,xe=0,Ee=-1,Ie=-1,Ae=-1,Ce=-1,je=-1,Me=-1,_e=-1,He=-1,qe=-1,Le=-1,Ue=-1,Pe=-1,We=-1,Be=-1,Fe=-1,ze=-1,Oe=-1,Ge=-1,Ne=-1,Ve=0,Xe=0,Qe=3,Ke=0,Ye=1,Je=0,Ze=0,$e=0,et=0,tt=0,it=0,st=0,rt=0,at=0,nt=0,ot=0,ct=0,ht=0,ut=0,dt=1,ft=0,lt=0,pt=0,bt=0,mt=0,vt=0,gt=0;return{Init:s,Reset:r,InvalidateTLB:a,Step:T,GetFlags:p,SetFlags:l,PutState:o,GetState:c,GetTimeToNextInterrupt:h,ProgressTime:u,GetTicks:d,RaiseInterrupt:m,ClearInterrupt:v,AnalyzeImage:f,GetStat:n}}e("cjs!../messagehandler");i.exports=t}()}),define("cjs!jor1k/worker/or1k/safecpu",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.ram=e,this.r=new Int32Array(this.ram.heap,0,136),this.f=new Float32Array(this.ram.heap,0,128),this.group0=new Int32Array(this.ram.heap,8192,8192),this.group1=new Int32Array(this.ram.heap,16384,8192),this.group2=new Int32Array(this.ram.heap,24576,8192),this.pc=0,this.nextpc=0,this.delayedins=!1,this.clock=0,this.EA=-1,this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.SR_SM=!0,this.SR_TEE=!1,this.SR_IEE=!1,this.SR_DCE=!1,this.SR_ICE=!1,this.SR_DME=!1,this.SR_IME=!1,this.SR_LEE=!1,this.SR_CE=!1,this.SR_F=!1,this.SR_CY=!1,this.SR_OV=!1,this.SR_OVE=!1,this.SR_DSX=!1,this.SR_EPH=!1,this.SR_FO=!0,this.SR_SUMRA=!1,this.SR_CID=0,this.Reset()}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=1,n=17,o=48,c=32,h=64,u=4,d=3,f=6,l=5,p=0,b=2560,m=1024,v=256,g=2304,k=768,R=512,y=1280,w=2048,S=3072,T=3584;t.prototype.Reset=function(){this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.group0[u]=24,this.group0[d]=24,this.group0[f]=72,this.group0[l]=72,this.group0[p]=301989889,this.group0[a]=1561,this.Exception(v,0),this.pc=this.nextpc,this.nextpc++},t.prototype.InvalidateTLB=function(){},t.prototype.GetTimeToNextInterrupt=function(){if(this.TTMR>>30==0)return-1;var e=(268435455&this.TTMR)-(268435455&this.TTCR);return e+=0>e?268435455:0},t.prototype.GetTicks=function(){return this.TTMR>>30==0?-1:268435455&this.TTCR},t.prototype.ProgressTime=function(e){this.TTCR=this.TTCR+e&4294967295},t.prototype.AnalyzeImage=function(){this.boot_dtlb_misshandler_address=0,this.boot_itlb_misshandler_address=0,this.current_pgd=0},t.prototype.SetFlags=function(e){this.SR_SM=1&e?!0:!1,this.SR_TEE=2&e?!0:!1;var t=this.SR_IEE;this.SR_IEE=4&e?!0:!1,this.SR_DCE=8&e?!0:!1,this.SR_ICE=16&e?!0:!1;this.SR_DME;this.SR_DME=32&e?!0:!1;this.SR_IME;this.SR_IME=64&e?!0:!1,this.SR_LEE=128&e?!0:!1,this.SR_CE=256&e?!0:!1,this.SR_F=512&e?!0:!1,this.SR_CY=1024&e?!0:!1,this.SR_OV=2048&e?!0:!1,this.SR_OVE=4096&e?!0:!1,this.SR_DSX=8192&e?!0:!1,this.SR_EPH=16384&e?!0:!1,this.SR_FO=!0,this.SR_SUMRA=65536&e?!0:!1,this.SR_CID=e>>28&15,this.SR_LEE&&(s.Debug("little endian not supported"),s.Abort()),this.SR_CID&&(s.Debug("context id not supported"),s.Abort()),this.SR_EPH&&(s.Debug("exception prefix not supported"),s.Abort()),this.SR_DSX&&(s.Debug("delay slot exception not supported"),s.Abort()),this.SR_IEE&&!t&&this.CheckForInterrupt()},t.prototype.GetFlags=function(){var e=0;return e|=this.SR_SM?1:0,e|=this.SR_TEE?2:0,e|=this.SR_IEE?4:0,e|=this.SR_DCE?8:0,e|=this.SR_ICE?16:0,e|=this.SR_DME?32:0,e|=this.SR_IME?64:0,e|=this.SR_LEE?128:0,e|=this.SR_CE?256:0,e|=this.SR_F?512:0,e|=this.SR_CY?1024:0,e|=this.SR_OV?2048:0,e|=this.SR_OVE?4096:0,e|=this.SR_DSX?8192:0,e|=this.SR_EPH?16384:0,e|=this.SR_FO?32768:0,e|=this.SR_SUMRA?65536:0,e|=this.SR_CID<<28},t.prototype.CheckForInterrupt=function(){this.SR_IEE&&this.PICMR&this.PICSR&&(this.Exception(w,this.group0[o]),this.pc=this.nextpc++)},t.prototype.RaiseInterrupt=function(e,t){var i=1<<e;this.PICSR|=i,this.CheckForInterrupt();
},t.prototype.ClearInterrupt=function(e,t){this.PICSR&=~(1<<e)},t.prototype.SetSPR=function(e,t){var i=2047&e,r=e>>11&31;switch(r){case 0:i==n&&this.SetFlags(t),this.group0[i]=t;break;case 1:this.group1[i]=t;break;case 2:this.group2[i]=t;break;case 3:case 4:break;case 8:break;case 9:switch(i){case 0:this.PICMR=3|t,this.SR_IEE&&this.PICMR&this.PICSR&&(s.Debug("Error in SetSPR: Direct triggering of interrupt exception not supported?"),s.Abort());break;case 2:break;default:s.Debug("Error in SetSPR: interrupt address not supported"),s.Abort()}break;case 10:switch(i){case 0:this.TTMR=t,3!=(this.TTMR>>30&3);break;case 1:this.TTCR=t;break;default:s.Debug("Error in SetSPR: Tick timer address not supported"),s.Abort()}break;default:s.Debug("Error in SetSPR: group "+r+" not found"),s.Abort()}},t.prototype.GetSPR=function(e){var t=2047&e,i=e>>11&31;switch(i){case 0:return t==n?this.GetFlags():this.group0[t];case 1:return this.group1[t];case 2:return this.group2[t];case 8:return 0;case 9:switch(t){case 0:return this.PICMR;case 2:return this.PICSR;default:s.Debug("Error in GetSPR: PIC address unknown"),s.Abort()}break;case 10:switch(t){case 0:return this.TTMR;case 1:return this.TTCR;default:s.Debug("Error in GetSPR: Tick timer address unknown"),s.Abort()}break;default:s.Debug("Error in GetSPR: group "+i+" unknown"),s.Abort()}},t.prototype.Exception=function(e,t){var i=e|(this.SR_EPH?4026531840:0);switch(this.SetSPR(o,t),this.SetSPR(h,this.GetFlags()),this.EA=-1,this.SR_OVE=!1,this.SR_SM=!0,this.SR_IEE=!1,this.SR_TEE=!1,this.SR_DME=!1,this.nextpc=i>>2,e){case v:break;case b:case m:case g:case k:case R:case y:case w:case T:this.SetSPR(c,(this.pc<<2)-(this.delayedins?4:0));break;case S:this.SetSPR(c,(this.pc<<2)+4-(this.delayedins?4:0));break;default:s.Debug("Error in Exception: exception type not supported"),s.Abort()}e==y&&this.TTMR>>30==1&&(this.TTCR=0),this.delayedins=!1,this.SR_IME=!1},t.prototype.DTLBLookup=function(e,t){if(!this.SR_DME)return e;var i=e>>13&63,r=this.group1[512|i];if(0==(1&r)||r>>19!=e>>19)return this.Exception(g,e),-1;192&r&&(s.Debug("Error: LRU ist not supported"),s.Abort());var a=this.group1[640|i];if(this.SR_SM){if(!t&&!(256&a)||t&&!(512&a))return this.Exception(k,e),-1}else if(!t&&!(64&a)||t&&!(128&a))return this.Exception(k,e),-1;return 4294959104&a|8191&e},t.prototype.GetInstruction=function(e){if(!this.SR_IME)return this.ram.Read32Big(e);var t=e>>13&63;t&=63;var i=this.group2[512|t];if(0==(1&i)||i>>19!=e>>19)return this.Exception(b,this.pc<<2),-1;192&i&&(s.Debug("Error: LRU ist not supported"),s.Abort());var r=this.group2[640|t];if(this.SR_SM){if(!(64&r))return this.Exception(m,this.pc<<2),-1}else if(!(128&r))return this.Exception(m,this.pc<<2),-1;return this.ram.Read32Big(4294959104&r|8191&e)},t.prototype.Step=function(e,t){var i=0,a=0,n=0,u=0,d=0,f=0,l=0,p=this.r,b=this.f,m=this.ram,v=this.ram.int32mem,g=(this.group2,0),k=0;do if(this.clock++,63&e||(this.TTMR>>30!=0&&(k=(268435455&this.TTMR)-(268435455&this.TTCR),k+=0>k?268435455:0,this.TTCR=this.TTCR+t&4294967295,t>k&&this.TTMR&1<<29&&(this.TTMR|=1<<28)),this.SR_TEE&&this.TTMR&1<<28&&(this.Exception(y,this.group0[o]),this.pc=this.nextpc++)),i=this.GetInstruction(this.pc<<2),-1!=i){switch(i>>26&63){case 0:g=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=g,this.delayedins=!0;continue;case 1:g=this.pc+(i<<6>>6),p[9]=(this.nextpc<<2)+4,this.pc=this.nextpc,this.nextpc=g,this.delayedins=!0;continue;case 3:if(this.SR_F)break;g=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=g,this.delayedins=!0;continue;case 4:if(!this.SR_F)break;g=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=g,this.delayedins=!0;continue;case 5:break;case 6:u=i>>21&31,65536&i?(s.Debug("Error: macrc not supported\n"),s.Abort()):p[u]=(65535&i)<<16;break;case 8:553648128==(4294901760&i)?(s.Debug("Trap at "+r.ToHex(this.pc<<2)),this.Exception(T,this.group0[o])):this.Exception(S,this.group0[o]);break;case 9:this.nextpc=this.GetSPR(c)>>2,this.pc=this.nextpc++,this.delayedins=!1,this.SetFlags(this.GetSPR(h));continue;case 17:g=p[i>>11&31]>>2,this.pc=this.nextpc,this.nextpc=g,this.delayedins=!0;continue;case 18:g=p[i>>11&31]>>2,p[9]=(this.nextpc<<2)+4,this.pc=this.nextpc,this.nextpc=g,this.delayedins=!0;continue;case 27:if(p[32]=p[i>>16&31]+(i<<16>>16),0!=(3&p[32])&&(s.Debug("Error in lwz: no unaligned access allowed"),abort()),p[33]=this.DTLBLookup(p[32],!1),-1==p[33])break;this.EA=p[33],p[i>>21&31]=p[33]>0?m.int32mem[p[33]>>2]:m.Read32Big(p[33]);break;case 33:if(p[32]=p[i>>16&31]+(i<<16>>16),0!=(3&p[32])&&(s.Debug("Error in lwz: no unaligned access allowed"),abort()),p[33]=this.DTLBLookup(p[32],!1),-1==p[33])break;p[i>>21&31]=p[33]>0?m.int32mem[p[33]>>2]:m.Read32Big(p[33]);break;case 35:if(p[32]=p[i>>16&31]+(i<<16>>16),p[33]=this.DTLBLookup(p[32],!1),-1==p[33])break;p[i>>21&31]=m.Read8Big(p[33]);break;case 36:if(p[32]=p[i>>16&31]+(i<<16>>16),p[33]=this.DTLBLookup(p[32],!1),-1==p[33])break;p[i>>21&31]=m.Read8Big(p[33])<<24>>24;break;case 37:if(p[32]=p[i>>16&31]+(i<<16>>16),p[33]=this.DTLBLookup(p[32],!1),-1==p[33])break;p[i>>21&31]=m.Read16Big(p[33]);break;case 38:if(p[32]=p[i>>16&31]+(i<<16>>16),p[33]=this.DTLBLookup(p[32],!1),-1==p[33])break;p[i>>21&31]=m.Read16Big(p[33])<<16>>16;break;case 39:a=i<<16>>16,d=p[i>>16&31],u=i>>21&31,p[u]=d+a,this.SR_CY=p[u]<d,this.SR_OV=(d^a^-1)&(d^p[u])&2147483648?!0:!1;break;case 41:p[i>>21&31]=p[i>>16&31]&(65535&i);break;case 42:p[i>>21&31]=p[i>>16&31]|65535&i;break;case 43:d=p[i>>16&31],p[i>>21&31]=d^i<<16>>16;break;case 45:p[i>>21&31]=this.GetSPR(p[i>>16&31]|65535&i);break;case 46:switch(i>>6&3){case 0:p[i>>21&31]=p[i>>16&31]<<(31&i);break;case 1:p[i>>21&31]=p[i>>16&31]>>>(31&i);break;case 2:p[i>>21&31]=p[i>>16&31]>>(31&i);break;default:s.Debug("Error: opcode 2E function not implemented"),abort()}break;case 47:switch(a=i<<16>>16,i>>21&31){case 0:this.SR_F=p[i>>16&31]==a?!0:!1;break;case 1:this.SR_F=p[i>>16&31]!=a?!0:!1;break;case 2:this.SR_F=p[i>>16&31]>>>0>a>>>0?!0:!1;break;case 3:this.SR_F=p[i>>16&31]>>>0>=a>>>0?!0:!1;break;case 4:this.SR_F=p[i>>16&31]>>>0<a>>>0?!0:!1;break;case 5:this.SR_F=p[i>>16&31]>>>0<=a>>>0?!0:!1;break;case 10:this.SR_F=p[i>>16&31]>a?!0:!1;break;case 11:this.SR_F=p[i>>16&31]>=a?!0:!1;break;case 12:this.SR_F=p[i>>16&31]<a?!0:!1;break;case 13:this.SR_F=p[i>>16&31]<=a?!0:!1;break;default:s.Debug("Error: sf...i not supported yet"),abort()}break;case 48:a=2047&i|i>>10&63488,this.pc=this.nextpc++,this.delayedins=!1,this.SetSPR(p[i>>16&31]|a,p[i>>11&31]);continue;case 50:switch(d=i>>16&31,f=i>>11&31,l=i>>21&31,255&i){case 0:b[l]=b[d]+b[f];break;case 1:b[l]=b[d]-b[f];break;case 2:b[l]=b[d]*b[f];break;case 3:b[l]=b[d]/b[f];break;case 4:b[l]=p[d];break;case 5:p[l]=b[d];break;case 7:b[l]+=b[d]*b[f];break;case 8:this.SR_F=b[d]==b[f]?!0:!1;break;case 9:this.SR_F=b[d]!=b[f]?!0:!1;break;case 10:this.SR_F=b[d]>b[f]?!0:!1;break;case 11:this.SR_F=b[d]>=b[f]?!0:!1;break;case 12:this.SR_F=b[d]<b[f]?!0:!1;break;case 13:this.SR_F=b[d]<=b[f]?!0:!1;break;default:s.Debug("Error: lf. function "+r.ToHex(255&i)+" not supported yet"),s.Abort()}break;case 51:if(a=(i>>10&63488|2047&i)<<16>>16,p[32]=p[i>>16&31]+a,3&p[32]&&(s.Debug("Error in sw: no aligned memory access"),abort()),p[33]=this.DTLBLookup(p[32],!0),-1==p[33])break;if(this.SR_F=p[33]==this.EA?!0:!1,this.EA=-1,0==this.SR_F)break;p[33]>0?v[p[33]>>2]=p[i>>11&31]:m.Write32Big(p[33],p[i>>11&31]);break;case 53:if(a=(i>>10&63488|2047&i)<<16>>16,p[32]=p[i>>16&31]+a,3&p[32]&&(s.Debug("Error in sw: no aligned memory access"),s.Abort()),p[33]=this.DTLBLookup(p[32],!0),-1==p[33])break;p[33]>0?v[p[33]>>2]=p[i>>11&31]:m.Write32Big(p[33],p[i>>11&31]);break;case 54:if(a=(i>>10&63488|2047&i)<<16>>16,p[32]=p[i>>16&31]+a,p[33]=this.DTLBLookup(p[32],!0),-1==p[33])break;m.Write8Big(p[33],p[i>>11&31]);break;case 55:if(a=(i>>10&63488|2047&i)<<16>>16,p[32]=p[i>>16&31]+a,p[33]=this.DTLBLookup(p[32],!0),-1==p[33])break;m.Write16Big(p[33],p[i>>11&31]);break;case 56:switch(d=p[i>>16&31],f=p[i>>11&31],u=i>>21&31,975&i){case 0:p[u]=d+f,this.SR_CY=p[u]<d,this.SR_OV=(d^f^-1)&(d^p[u])&2147483648?!0:!1;break;case 2:p[u]=d-f,this.SR_CY=f>d,this.SR_OV=(d^f)&(d^p[u])&2147483648?!0:!1;break;case 3:p[u]=d&f;break;case 4:p[u]=d|f;break;case 5:p[u]=d^f;break;case 8:p[u]=d<<(31&f);break;case 72:p[u]=d>>>(31&f);break;case 15:for(p[u]=0,n=0;32>n;n++)if(d&1<<n){p[u]=n+1;break}break;case 136:p[u]=d>>(31&f);break;case 271:for(p[u]=0,n=31;n>=0;n--)if(d&1<<n){p[u]=n+1;break}break;case 774:p[u]=r.int32(d>>0)*r.int32(f);var R=65535&d,w=65535&f;p[u]=4294901760&p[u]|R*w&65535;var D=Number(r.int32(d))*Number(r.int32(f));this.SR_OV=-2147483648>D||D>2147483647;var x=r.uint32(d)*r.uint32(f);this.SR_CY=x>4294967295;break;case 778:this.SR_CY=0==f,this.SR_OV=!1,this.SR_CY||(p[u]=(d>>>0)/(f>>>0));break;case 777:this.SR_CY=0==f,this.SR_OV=!1,this.SR_CY||(p[u]=d/f);break;default:s.Debug("Error: op38 opcode not supported yet"),s.Abort()}break;case 57:switch(i>>21&31){case 0:this.SR_F=p[i>>16&31]==p[i>>11&31]?!0:!1;break;case 1:this.SR_F=p[i>>16&31]!=p[i>>11&31]?!0:!1;break;case 2:this.SR_F=p[i>>16&31]>>>0>p[i>>11&31]>>>0?!0:!1;break;case 3:this.SR_F=p[i>>16&31]>>>0>=p[i>>11&31]>>>0?!0:!1;break;case 4:this.SR_F=p[i>>16&31]>>>0<p[i>>11&31]>>>0?!0:!1;break;case 5:this.SR_F=p[i>>16&31]>>>0<=p[i>>11&31]>>>0?!0:!1;break;case 10:this.SR_F=p[i>>16&31]>p[i>>11&31]?!0:!1;break;case 11:this.SR_F=p[i>>16&31]>=p[i>>11&31]?!0:!1;break;case 12:this.SR_F=p[i>>16&31]<p[i>>11&31]?!0:!1;break;case 13:this.SR_F=p[i>>16&31]<=p[i>>11&31]?!0:!1;break;default:s.Debug("Error: sf.... function supported yet"),s.Abort()}break;default:s.Debug("Error: Instruction with opcode "+r.ToHex(i>>>26)+" not supported"),s.Abort()}this.pc=this.nextpc++,this.delayedins=!1}else this.pc=this.nextpc++;while(--e);return 0},i.exports=t}()}),define("cjs!jor1k/worker/or1k/smpcpu",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e,t,i){"use asm";function s(e){e|=0,ye=e|0,we=(ye|0)==32?4294967295:(1<<ye)-1|0,b(),r()}function r(){var e=0;for(Se=we,Ct=0,e=0;(e|0)<(ye|0);e=e+1|0)ge[De+st>>2]=0,ge[De+rt>>2]=0,ge[De+at>>2]=3,ge[De+nt>>2]=0,ge[De+Ee+(ee<<2)>>2]=24,ge[De+Ee+(te<<2)>>2]=24,ge[De+Ee+(ie<<2)>>2]=0,ge[De+Ee+(se<<2)>>2]=0,ge[De+Ee+(re<<2)>>2]=301989889,ge[De+Ee+(ae<<2)>>2]=Te|0,ge[De+Ee+(ne<<2)>>2]=2,ge[De+Ee+(K<<2)>>2]=1561,je=0,Me=0,_e=-4,T(he,0),a()}function a(){var e=0;if((ye|0)!=1&&(e=Te|0,(Se|0)==0&&(j(Q|0),M()),!((Se&Se-1)==0&&Se&1<<Te))){do e=e+1|0,(e|0)>=(ye|0)&&(e=0);while((Se&1<<e)==0);(e|0)!=(Te|0)&&(ge[De+288>>2]=g()|0,ge[De+292>>2]=Ce,ge[De+296>>2]=je,ge[De+300>>2]=Me,ge[De+304>>2]=_e,ge[De+308>>2]=He,ge[De+312>>2]=Le,ge[De+316>>2]=Ue,ge[De+400>>2]=qe,ge[De+404>>2]=Pe,ge[De+320>>2]=We,ge[De+324>>2]=Be,ge[De+328>>2]=Fe,ge[De+332>>2]=ze,ge[De+336>>2]=Oe,ge[De+340>>2]=Ge,ge[De+344>>2]=Ne,ge[De+348>>2]=Ve,ge[De+352>>2]=Xe,ge[De+356>>2]=Qe,ge[De+360>>2]=Ke,ge[De+364>>2]=Ye,ge[De+368>>2]=Je,ge[De+372>>2]=Ze,ge[De+376>>2]=$e,ge[De+380>>2]=et,ge[De+384>>2]=tt,ge[De+388>>2]=it,Te=e|0,De=Te<<15,m(ge[De+288>>2]|0),Ce=ge[De+292>>2]|0,je=ge[De+296>>2]|0,Me=ge[De+300>>2]|0,_e=ge[De+304>>2]|0,He=ge[De+308>>2]|0,Le=ge[De+312>>2]|0,Ue=ge[De+316>>2]|0,qe=ge[De+400>>2]|0,Pe=ge[De+404>>2]|0,We=ge[De+320>>2]|0,Be=ge[De+324>>2]|0,Fe=ge[De+328>>2]|0,ze=ge[De+332>>2]|0,Oe=ge[De+336>>2]|0,Ge=ge[De+340>>2]|0,Ne=ge[De+344>>2]|0,Ve=ge[De+348>>2]|0,Xe=ge[De+352>>2]|0,Qe=ge[De+356>>2]|0,Ke=ge[De+360>>2]|0,Ye=ge[De+364>>2]|0,Je=ge[De+368>>2]|0,Ze=ge[De+372>>2]|0,$e=ge[De+376>>2]|0,et=ge[De+380>>2]|0,tt=ge[De+384>>2]|0,it=ge[De+388>>2]|0)}}function n(){We=-1,Be=-1,Fe=-1,ze=-1,Oe=-1,Ge=-1,Ne=-1,Ve=-1,Xe=-1,Qe=-1,Ke=-1,Ye=-1,Je=-1,Ze=-1,$e=-1,et=-1,tt=-1,it=-1}function o(){}function c(){}function h(e){e|=0,Se|=1<<e,ge[(e<<15)+st>>2]=ge[(e<<15)+st>>2]|0|1<<28}function u(e){e|=0;var t=0;return t=ge[(e<<15)+st>>2]>>29?1:0,t|0}function d(e){e|=0;var t=0;return t=(ge[(e<<15)+st>>2]&268435455)-(ge[rt>>2]&268435455)|0,(t|0)<0&&(t=t+268435455|0),t|0}function f(){var e=268435455,t=0,i=0;for(i=0;(i|0)<(ye|0);i=i+1|0)u(i)|0&&(t=d(i)|0,(t|0)<(e|0)&&(e=t|0));return e|0}function l(e){e|=0;ge[rt>>2]=(ge[rt>>2]|0)+e|0,Se=we}function p(){return ge[rt>>2]&268435455|0}function b(){Et=ge[xe+2304>>2]|0,It=ge[xe+2560>>2]|0,At=(ge[xe+8208>>2]&4095)<<16|ge[xe+8212>>2]&65535|0}function m(e){e|=0,ht=e&1,ut=e&2,dt=e&4,ft=e&8,lt=e&16,pt=e&32,bt=e&64,mt=e&128,vt=e&256,gt=e&512,kt=e&1024,Rt=e&2048,yt=e&4096,wt=e&8192,St=e&16384,Tt=1,Dt=e&65536,xt=e>>28&15}function v(e){e|=0;var t=0;t=dt,m(e),mt&&(j(W|0),M()),xt&&(j(B|0),M()),St&&(j(F|0),M()),wt&&(j(z|0),M()),dt&&(t|0)==0&&k(Te)}function g(){var e=0;return e|=ht?1:0,e|=ut?2:0,e|=dt?4:0,e|=ft?8:0,e|=lt?16:0,e|=pt?32:0,e|=bt?64:0,e|=mt?128:0,e|=vt?256:0,e|=gt?512:0,e|=kt?1024:0,e|=Rt?2048:0,e|=yt?4096:0,e|=wt?8192:0,e|=St?16384:0,e|=Tt?32768:0,e|=Dt?65536:0,e|=xt<<28,e|0}function k(e){e|=0;var t=0;ge[De+288>>2]=g()|0,t=ge[(e<<15)+288>>2]|0,t&4&&ge[(e<<15)+at>>2]&ge[(e<<15)+nt>>2]&&(Se|=1<<e,ge[(e<<15)+ot>>2]=1)}function R(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(s=1<<e|0,(t|0)==-1)for(i=0;(i|0)<(ye|0);i=i+1|0)r=(i<<15)+nt|0,ge[r>>2]=ge[r>>2]|0|s,k(i);else r=(t<<15)+nt|0,ge[r>>2]=ge[r>>2]|0|s,k(t)}function y(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(s=1<<e|0,(t|0)==-1)for(i=0;(i|0)<(ye|0);i=i+1|0)r=(i<<15)+nt|0,ge[r>>2]=ge[r>>2]&~s;else r=(t<<15)+nt|0,ge[r>>2]=ge[r>>2]&~s}function w(e,t){e|=0,t|=0;var i=0,s=0;switch(i=e&2047,s=e>>11&31,s|0){case 0:(i|0)==(Y|0)&&v(t),ge[De+Ee+(i<<2)>>2]=t;break;case 1:ge[De+Ie+(i<<2)>>2]=t;break;case 2:ge[De+Ae+(i<<2)>>2]=t;break;case 3:case 4:break;case 8:Se&=~(1<<Te);break;case 9:switch(i|0){case 0:ge[De+at>>2]=t|3,dt&&ge[De+at>>2]&ge[De+nt>>2]&&(j(O|0),M());break;case 2:break;default:j(G|0),M()}break;case 10:switch(i|0){case 0:ge[De+st>>2]=t|0,(ge[De+st>>2]>>30&3)!=3&&(j(N|0),M());break;case 1:break;default:j(X|0),M()}break;default:j(X|0),M()}}function S(e){e|=0;var t=0,i=0;switch(t=e&2047,i=e>>11&31,i|0){case 0:return(t|0)==(Y|0)?g()|0:ge[De+Ee+(t<<2)>>2]|0;case 1:return ge[De+Ie+(t<<2)>>2]|0;case 2:return ge[De+Ae+(t<<2)>>2]|0;case 8:return 0;case 9:switch(t|0){case 0:return ge[De+at>>2]|0;case 2:return ge[De+nt>>2]|0;default:j(X|0),M()}break;case 10:switch(t|0){case 0:return ge[De+st>>2]|0;case 1:return ge[rt>>2]|0;default:j(X|0),M()}break;default:j(X|0),M()}return 0}function T(e,t){e|=0,t|=0;var i=0;switch(i=e|(St?4026531840:0),Se|=1<<Te,w(J,t),w($,g()|0),yt=0,ht=1,dt=0,ut=0,pt=0,We=0,Be=0,Fe=0,ze=0,Oe=0,Ge=0,Ne=0,Ve=0,Xe=0,Qe=0,Ke=0,Je=0,Ye=0,$e=0,Ze=0,et=0,tt=0,it=0,He=je|0,Le=i,e|0){case 256:break;case 768:case 2304:case 3584:case 512:Ce=_e+je|0,w(Z,Ce-(qe?4:0)|0);break;case 2560:case 1024:case 1280:case 2048:w(Z,Ce-(qe?4:0)|0);break;case 3072:Ce=_e+je|0,w(Z,Ce+4-(qe?4:0)|0);break;default:j(V|0),M()}qe=0,bt=0,ge[De+ct>>2]=-1,Ct&=~(1<<Te)}function D(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(ge[xe+2304>>2]|0)==(Et|0)?(T(ue,e),0):(i=e,s=ge[xe+At+(Te<<2)>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=ge[xe+r>>2]|0,(s|0)==0?(T(de,e),0):(s=4294959104,r=ge[xe+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=ge[xe+s>>2]|0,(i&1)==0?(T(de,e),0):(r=i&4294960122,a&=t-1,ge[De+Ie+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,ge[De+Ie+((512|a)<<2)>>2]=r,1)))}function x(e,t){e|=0,t|=0;var i=0,s=0,r=0,a=0;return(ge[xe+2560>>2]|0)==(It|0)?(T(oe,e),0):(i=e,s=ge[xe+At+(Te<<2)>>2]|0,r=i>>>24<<2,a=r+s|0,r=1073741824+a&4294967295,s=ge[xe+r>>2]|0,(s|0)==0?(T(ce,e),0):(s=4294959104,r=ge[xe+r>>2]|0,r&=s,a=i>>>13,s=a&2047,s<<=2,s=s+r|0,i=ge[xe+s>>2]|0,(i&1)==0?(T(ce,e),0):(r=i&4294959162,s=i&1984,(s|0)!=0&&(a&=t-1,r|=192),ge[De+Ae+((640|a)<<2)>>2]=r,i=e,r=i&4294959104,r|=1,ge[De+Ae+((512|a)<<2)>>2]=r,1)))}function E(e,t){e|=0,t|=0;var i=0,s=0,r=0;if(!pt)return e|0;if(i=e>>13&63,s=ge[De+Ie+((512|i)<<2)>>2]|0,(s&1)==0){if(!(D(e,64)|0))return-1;s=ge[De+Ie+(512+i<<2)>>2]|0}if(s>>19!=e>>19){if(!(D(e,64)|0))return-1;s=ge[De+Ie+(512+i<<2)>>2]|0}if(r=ge[De+Ie+((640|i)<<2)>>2]|0,ht){if(t){if(!(r&512))return T(de,e),-1}else if(!(r&256))return T(de,e),-1}else if(t){if(!(r&128))return T(de,e),-1}else if(!(r&64))return T(de,e),-1;return r&4294959104|e&8191|0}function I(e,t){e|=0,t|=0;for(var i=0,s=0,r=0,o=0,c=0,f=0,l=0,p=0,b=0,m=0,g=0,k=0,R=0,y=0,D=0;;){if((je|0)==(He|0)){if(Ce=Le,!Pe|0&&(qe=0),D=D-(je-Me>>2)|0,(D|0)<=0&&!(Pe|0)){for(D=D+64|0,e=e-64|0,r=0;(r|0)<(ye|0);r=r+1|0)u(r)|0&&(y=d(r)|0,(y|0)<(t|0)&&h(r));if(ge[rt>>2]=(ge[rt>>2]|0)+t|0,(e|0)<0)return 0}if(dt|0&&(ge[De+st>>2]&1<<28?(T(fe,ge[De+Ee+(J<<2)>>2]|0),Ce=Le):ge[De+ot>>2]|0&&(ge[De+ot>>2]=0,T(le,ge[De+Ee+(J<<2)>>2]|0),Ce=Le)),(Qe^Ce)&4294959104)if(Qe=Ce,bt){if(g=Ce>>13&63,k=ge[De+Ae+((512|g)<<2)>>2]|0,(k&1)==0){if(!(x(Ce,64)|0)){Me=je,Pe=0;continue}k=ge[De+Ae+((512|g)<<2)>>2]|0}if(k>>19!=Ce>>19){if(!(x(Ce,64)|0)){Me=je,Pe=0;continue}k=ge[De+Ae+((512|g)<<2)>>2]|0}R=ge[De+Ae+((640|g)<<2)>>2]|0,We=(R^k)>>13<<13}else We=0;if(je=xe+(We^Ce)|0,Me=je,_e=Ce-4-Me|0,Pe|0?(Pe=0,He=je+4|0,Le=Ue):(He=(je>>13)+1<<13,Le=(Ce>>13)+1<<13),m=m+1|0,(m&7)==0){a();continue}}switch(i=ge[je>>2]|0,je=je+4|0,i>>26&63){case 0:Ce=_e+je|0,Ue=Ce+(i<<6>>4)|0,(He|0)==(je|0)?Pe=1:(He=je+4|0,Le=Ue|0),qe=1;break;case 1:Ce=_e+je|0,Ue=Ce+(i<<6>>4)|0,me[De+36>>2]=Ce+8|0,(He|0)==(je|0)?Pe=1:(He=je+4|0,Le=Ue|0),qe=1;break;case 3:if(gt)break;Ce=_e+je|0,Ue=Ce+(i<<6>>4)|0,(He|0)==(je|0)?Pe=1:(He=je+4|0,Le=Ue|0),qe=1;break;case 4:if(!gt)break;Ce=_e+je|0,Ue=Ce+(i<<6>>4)|0,(He|0)==(je|0)?Pe=1:(He=je+4|0,Le=Ue|0),qe=1;break;case 5:break;case 6:o=i>>21&31,me[De+(o<<2)>>2]=(i&65535)<<16;break;case 8:(i&4294901760)==553648128?T(be,ge[De+Ee+J>>2]|0):T(pe,ge[De+Ee+J>>2]|0);break;case 9:Ue=S(Z)|0,n(),He=je,Le=Ue,v(S($)|0);break;case 17:Ue=me[De+(i>>9&124)>>2]|0,(He|0)==(je|0)?Pe=1:(He=je+4|0,Le=Ue|0),qe=1;break;case 18:Ce=_e+je|0,Ue=me[De+(i>>9&124)>>2]|0,me[De+36>>2]=Ce+8|0,(He|0)==(je|0)?Pe=1:(He=je+4|0,Le=Ue|0),qe=1;break;case 27:if(p=(me[De+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ke^p)>>13){if(b=E(p,0)|0,(b|0)==-1)break;Ke=p,Be=(b^p)>>13<<13}b=Be^p,Ct|=1<<Te,ge[De+ct>>2]=b,me[De+(i>>19&124)>>2]=(b|0)>0?ge[xe+b>>2]|0:_(b|0)|0;break;case 33:if(p=(me[De+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ke^p)>>13){if(b=E(p,0)|0,(b|0)==-1)break;Ke=p,Be=(b^p)>>13<<13}b=Be^p,me[De+(i>>19&124)>>2]=(b|0)>0?ge[xe+b>>2]|0:_(b|0)|0;break;case 35:if(p=(me[De+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Je^p)>>13){if(b=E(p,0)|0,(b|0)==-1)break;Je=p,ze=(b^p)>>13<<13}b=ze^p,(b|0)>=0?me[De+(i>>19&124)>>2]=ke[xe+(b^3)|0]|0:me[De+(i>>19&124)>>2]=U(b|0)|0;break;case 36:if(p=(me[De+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ye^p)>>13){if(b=E(p,0)|0,(b|0)==-1)break;Ye=p,Fe=(b^p)>>13<<13}b=Fe^p,(b|0)>=0?me[De+(i>>19&124)>>2]=ke[xe+(b^3)|0]<<24>>24:me[De+(i>>19&124)>>2]=(U(b|0)|0)<<24>>24;break;case 37:if(p=(me[De+(i>>14&124)>>2]|0)+(i<<16>>16)|0,($e^p)>>13){if(b=E(p,0)|0,(b|0)==-1)break;$e=p,Ge=(b^p)>>13<<13}b=Ge^p,(b|0)>=0?me[De+(i>>19&124)>>2]=Re[xe+(b^2)>>1]:me[De+(i>>19&124)>>2]=q(b|0)|0;break;case 38:if(p=(me[De+(i>>14&124)>>2]|0)+(i<<16>>16)|0,(Ze^p)>>13){if(b=E(p,0)|0,(b|0)==-1)break;Ze=p,Oe=(b^p)>>13<<13}b=Oe^p,(b|0)>=0?me[De+(i>>19&124)>>2]=Re[xe+(b^2)>>1]<<16>>16:me[De+(i>>19&124)>>2]=(q(b|0)|0)<<16>>16;break;case 39:s=i<<16>>16,c=me[De+(i>>14&124)>>2]|0,me[De+(i>>19&124)>>2]=c+s|0;break;case 41:me[De+(i>>19&124)>>2]=me[De+(i>>14&124)>>2]&(i&65535);break;case 42:me[De+(i>>19&124)>>2]=me[De+(i>>14&124)>>2]|i&65535;break;case 43:c=me[De+(i>>14&124)>>2]|0,me[De+(i>>19&124)>>2]=c^i<<16>>16;break;case 45:me[De+(i>>19&124)>>2]=S(me[De+(i>>14&124)>>2]|i&65535)|0;break;case 46:switch(i>>6&3){case 0:me[De+(i>>19&124)>>2]=me[De+(i>>14&124)>>2]<<(i&31);break;case 1:me[De+(i>>19&124)>>2]=me[De+(i>>14&124)>>2]>>>(i&31);break;case 2:me[De+(i>>19&124)>>2]=me[De+(i>>14&124)>>2]>>(i&31);break;default:j(X|0),M()}break;case 47:switch(s=i<<16>>16,i>>21&31){case 0:gt=(me[De+(i>>14&124)>>2]|0)==(s|0);break;case 1:gt=(me[De+(i>>14&124)>>2]|0)!=(s|0);break;case 2:gt=me[De+(i>>14&124)>>2]>>>0>s>>>0;break;case 3:gt=me[De+(i>>14&124)>>2]>>>0>=s>>>0;break;case 4:gt=me[De+(i>>14&124)>>2]>>>0<s>>>0;break;case 5:gt=me[De+(i>>14&124)>>2]>>>0<=s>>>0;break;case 10:gt=(me[De+(i>>14&124)>>2]|0)>(s|0);break;case 11:gt=(me[De+(i>>14&124)>>2]|0)>=(s|0);break;case 12:gt=(me[De+(i>>14&124)>>2]|0)<(s|0);break;case 13:gt=(me[De+(i>>14&124)>>2]|0)<=(s|0);break;default:j(X|0),M()}break;case 48:if(s=i&2047|i>>10&63488,w(me[De+(i>>14&124)>>2]|s,me[De+(i>>9&124)>>2]|0),(Se|0)==0){if(Se=we,ge[(Te<<15)+st>>2]&1<<28)break;return e|0}(Se&1<<Te)==0&&a();break;case 50:switch(c=i>>14&124,f=i>>9&124,l=i>>19&124,i&255){case 0:ve[De+l>>2]=+ve[De+c>>2]+ +ve[De+f>>2];break;case 1:ve[De+l>>2]=+ve[De+c>>2]-+ve[De+f>>2];break;case 2:ve[De+l>>2]=+ve[De+c>>2]*+ve[De+f>>2];break;case 3:ve[De+l>>2]=+ve[De+c>>2]/+ve[De+f>>2];break;case 4:ve[De+l>>2]=+(me[De+c>>2]|0);break;case 5:me[De+l>>2]=~~+A(+ve[De+c>>2]);break;case 7:ve[De+l>>2]=+ve[De+l>>2]+ +ve[De+c>>2]*+ve[De+f>>2];break;case 8:gt=+ve[De+c>>2]==+ve[De+f>>2];break;case 9:gt=+ve[De+c>>2]!=+ve[De+f>>2];break;case 10:gt=+ve[De+c>>2]>+ve[De+f>>2];break;case 11:gt=+ve[De+c>>2]>=+ve[De+f>>2];break;case 12:gt=+ve[De+c>>2]<+ve[De+f>>2];break;case 13:gt=+ve[De+c>>2]<=+ve[De+f>>2];break;default:j(X|0),M()}break;case 51:if(s=(i>>10&63488|i&2047)<<16>>16,p=(me[De+(i>>14&124)>>2]|0)+s|0,(et^p)>>13){if(b=E(p,1)|0,(b|0)==-1)break;et=p,Ne=(b^p)>>13<<13}if(b=Ne^p,gt=(b|0)==(ge[De+ct>>2]|0)?1:0,ge[De+ct>>2]=-1,Ct&=~(1<<Te))for(r=0;(r|0)<(ye|0);r=r+1|0)(ge[(r<<15)+ct>>2]|0)==(b|0)&&(ge[(r<<15)+ct>>2]=-1,Ct&=~(1<<r));if((gt|0)==0)break;(b|0)>0?ge[xe+b>>2]=me[De+(i>>9&124)>>2]|0:H(b|0,me[De+(i>>9&124)>>2]|0);break;case 53:if(s=(i>>10&63488|i&2047)<<16>>16,p=(me[De+(i>>14&124)>>2]|0)+s|0,(et^p)>>13){if(b=E(p,1)|0,(b|0)==-1)break;et=p,Ne=(b^p)>>13<<13}if(b=Ne^p,Ct)for(r=0;(r|0)<(ye|0);r=r+1|0)(ge[(r<<15)+ct>>2]|0)==(b|0)&&(ge[(r<<15)+ct>>2]=-1,Ct&=~(1<<r));(b|0)>0?ge[xe+b>>2]=me[De+(i>>9&124)>>2]|0:H(b|0,me[De+(i>>9&124)>>2]|0);break;case 54:if(s=(i>>10&63488|i&2047)<<16>>16,p=(me[De+(i>>14&124)>>2]|0)+s|0,(tt^p)>>13){if(b=E(p,1)|0,(b|0)==-1)break;tt=p,Ve=(b^p)>>13<<13}if(b=Ve^p,Ct)for(r=0;(r|0)<(ye|0);r=r+1|0)(ge[(r<<15)+ct>>2]|0)==(b&-4)&&(ge[(r<<15)+ct>>2]=-1,Ct&=~(1<<r));(b|0)>0?ke[xe+(b^3)|0]=me[De+(i>>9&124)>>2]|0:P(b|0,me[De+(i>>9&124)>>2]|0);break;case 55:if(s=(i>>10&63488|i&2047)<<16>>16,p=(me[De+(i>>14&124)>>2]|0)+s|0,(it^p)>>13){if(b=E(p,1)|0,(b|0)==-1)break;it=p,Xe=(b^p)>>13<<13}if(b=Xe^p,Ct)for(r=0;(r|0)<(ye|0);r=r+1|0)(ge[(r<<15)+ct>>2]|0)==(b&-4)&&(ge[(r<<15)+ct>>2]=-1,Ct&=~(1<<r));(b|0)>=0?Re[xe+(b^2)>>1]=me[De+(i>>9&124)>>2]:L(b|0,me[De+(i>>9&124)>>2]|0);break;case 56:switch(c=me[De+(i>>14&124)>>2]|0,f=me[De+(i>>9&124)>>2]|0,o=i>>19&124,i&975){case 0:me[De+o>>2]=c+f;break;case 2:me[De+o>>2]=c-f;break;case 3:me[De+o>>2]=c&f;break;case 4:me[De+o>>2]=c|f;break;case 5:me[De+o>>2]=c^f;break;case 8:me[De+o>>2]=c<<(f&31);break;case 72:me[De+o>>2]=c>>>(f&31);break;case 15:for(me[De+o>>2]=0,r=0;(r|0)<32;r=r+1|0)if(c&1<<r){me[De+o>>2]=r+1;break}break;case 136:me[De+o>>2]=c>>(f&31);break;case 271:for(me[De+o>>2]=0,r=31;(r|0)>=0;r=r-1|0)if(c&1<<r){me[De+o>>2]=r+1;break}break;case 774:me[De+o>>2]=C(c|0,f|0)|0;break;case 778:kt=(f|0)==0,Rt=0,kt||(me[De+o>>2]=(c>>>0)/(f>>>0));break;case 777:kt=(f|0)==0,Rt=0,kt||(me[De+o>>2]=(c|0)/(f|0));break;default:j(X|0),M()}break;case 57:switch(i>>21&31){case 0:gt=(me[De+(i>>14&124)>>2]|0)==(me[De+(i>>9&124)>>2]|0);break;case 1:gt=(me[De+(i>>14&124)>>2]|0)!=(me[De+(i>>9&124)>>2]|0);break;case 2:gt=me[De+(i>>14&124)>>2]>>>0>me[De+(i>>9&124)>>2]>>>0;break;case 3:gt=me[De+(i>>14&124)>>2]>>>0>=me[De+(i>>9&124)>>2]>>>0;break;case 4:gt=me[De+(i>>14&124)>>2]>>>0<me[De+(i>>9&124)>>2]>>>0;break;case 5:gt=me[De+(i>>14&124)>>2]>>>0<=me[De+(i>>9&124)>>2]>>>0;break;case 10:gt=(me[De+(i>>14&124)>>2]|0)>(me[De+(i>>9&124)>>2]|0);break;case 11:gt=(me[De+(i>>14&124)>>2]|0)>=(me[De+(i>>9&124)>>2]|0);break;case 12:gt=(me[De+(i>>14&124)>>2]|0)<(me[De+(i>>9&124)>>2]|0);break;case 13:gt=(me[De+(i>>14&124)>>2]|0)<=(me[De+(i>>9&124)>>2]|0);break;default:j(X|0),M()}break;default:j(X|0),M()}}return e|0}var A=e.Math.floor,C=t.imul,j=t.DebugMessage,M=t.abort,_=t.Read32,H=t.Write32,q=t.Read16,L=t.Write16,U=t.Read8,P=t.Write8,W=0,B=1,F=2,z=3,O=4,G=5,N=6,V=7,X=8,Q=9,K=1,Y=17,J=48,Z=32,$=64,ee=4,te=3,ie=6,se=5,re=0,ae=128,ne=129,oe=2560,ce=1024,he=256,ue=2304,de=768,fe=1280,le=2048,pe=3072,be=3584,me=new e.Int32Array(i),ve=new e.Float32Array(i),ge=new e.Int32Array(i),ke=new e.Uint8Array(i),Re=new e.Uint16Array(i),ye=4,we=15,Se=15,Te=0,De=0,xe=1048576,Ee=8192,Ie=16384,Ae=24576,Ce=0,je=0,Me=0,_e=-4,He=0,qe=0,Le=0,Ue=0,Pe=0,We=-1,Be=-1,Fe=-1,ze=-1,Oe=-1,Ge=-1,Ne=-1,Ve=-1,Xe=-1,Qe=-1,Ke=-1,Ye=-1,Je=-1,Ze=-1,$e=-1,et=-1,tt=-1,it=-1,st=256,rt=260,at=264,nt=268,ot=272,ct=276,ht=1,ut=0,dt=0,ft=0,lt=0,pt=0,bt=0,mt=0,vt=0,gt=0,kt=0,Rt=0,yt=0,wt=0,St=0,Tt=1,Dt=0,xt=0,Et=0,It=0,At=0,Ct=0;return{Init:s,Reset:r,InvalidateTLB:n,Step:I,GetFlags:g,SetFlags:v,PutState:o,GetState:c,GetTimeToNextInterrupt:f,ProgressTime:l,GetTicks:p,RaiseInterrupt:R,ClearInterrupt:y,AnalyzeImage:b}}e("cjs!../messagehandler");i.exports=t}()}),define("cjs!jor1k/worker/or1k/index",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!../imul","cjs!./fastcpu","cjs!./safecpu","cjs!./smpcpu"],function(e,t,i){!function(){function t(e,t,i,s){var r={DebugMessage:a.Debug,abort:a.Abort,imul:Math.imul||o,Read32:t.Read32Big.bind(t),Write32:t.Write32Big.bind(t),Read16:t.Read16Big.bind(t),Write16:t.Write16Big.bind(t),Read8:t.Read8Big.bind(t),Write8:t.Write8Big.bind(t)};return"asm"===e?(null===d&&(d=c(l,r,i),d.Init()),d):"smp"===e?(null===f&&(f=u(l,r,i),f.Init(s)),f):void 0}function s(e,i,s,r){var a=null;if("safe"===e)return new h(i);if("asm"===e)return a=t(e,i,s,r),a.Init(),a;if("smp"===e)return a=t(e,i,s,r),a.Init(r),a;throw new Error("invalid CPU name:"+e)}function r(e,t,i,r){return this.cpu=s(e,t,i,r),this.name=e,this.ncores=r,this.ram=t,this.heap=i,this.littleendian=!1,this}var a=e("cjs!../messagehandler"),n=e("cjs!../utils").ToHex,o=e("cjs!../imul"),c=e("cjs!./fastcpu"),h=e("cjs!./safecpu"),u=e("cjs!./smpcpu"),d=null,f=null,l={Int32Array:Int32Array,Float32Array:Float32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Math:Math};r.prototype.switchImplementation=function(e){var t=this.cpu,i=this.name;if("smp"!=i){this.cpu=s(e,this.ram,this.heap,this.ncores),this.cpu.InvalidateTLB();var r=t.GetFlags();this.cpu.SetFlags(0|r);var a;"asm"===i?(a=new Int32Array(this.heap),t.GetState(),this.cpu.pc=a[64],this.cpu.nextpc=a[65],this.cpu.delayedins=a[66]?!0:!1,this.cpu.TTMR=a[68],this.cpu.TTCR=a[69],this.cpu.PICMR=a[70],this.cpu.PICSR=a[71],this.cpu.boot_dtlb_misshandler_address=a[72],this.cpu.boot_itlb_misshandler_address=a[73],this.cpu.current_pgd=a[74]):"asm"===e?(a=new Int32Array(this.heap),a[64]=t.pc,a[65]=t.nextpc,a[66]=t.delayedins,a[67]=0,a[68]=t.TTMR,a[69]=t.TTCR,a[70]=t.PICMR,a[71]=t.PICSR,a[72]=t.boot_dtlb_misshandler_address,a[73]=t.boot_itlb_misshandler_address,a[74]=t.current_pgd,this.cpu.PutState()):(this.cpu.pc=t.pc,this.cpu.nextpc=t.nextpc,this.cpu.delayedins=t.delayedins,this.cpu.TTMR=t.TTMR,this.cpu.TTCR=t.TTCR,this.cpu.PICMR=t.PICMR,this.cpu.PICSR=t.PICSR,this.cpu.boot_dtlb_misshandler_address=t.boot_dtlb_misshandler_address,this.cpu.boot_itlb_misshandler_address=t.itlb_misshandler_address,this.cpu.current_pgd=t.current_pgd)}},r.prototype.toString=function(){var e=new Uint32Array(this.heap),t="";t+="Current state of the machine\n",t+="PC: "+n(this.cpu.pc<<2)+"\n",t+="next PC: "+n(this.cpu.nextpc<<2)+"\n";for(var i=0;32>i;i+=4)t+="   r"+(i+0)+": "+n(e[i+0])+"   r"+(i+1)+": "+n(e[i+1])+"   r"+(i+2)+": "+n(e[i+2])+"   r"+(i+3)+": "+n(e[i+3])+"\n";return this.cpu.delayedins&&(t+="delayed instruction\n"),t+=this.cpu.SR_SM?"Supervisor mode\n":"User mode\n",this.cpu.SR_TEE&&(t+="tick timer exception enabled\n"),this.cpu.SR_IEE&&(t+="interrupt exception enabled\n"),this.cpu.SR_DME&&(t+="data mmu enabled\n"),this.cpu.SR_IME&&(t+="instruction mmu enabled\n"),this.cpu.SR_LEE&&(t+="little endian enabled\n"),this.cpu.SR_CID&&(t+="context id enabled\n"),this.cpu.SR_F&&(t+="flag set\n"),this.cpu.SR_CY&&(t+="carry set\n"),this.cpu.SR_OV&&(t+="overflow set\n"),t};var p=["Reset","Step","RaiseInterrupt","Step","AnalyzeImage","GetTicks","GetTimeToNextInterrupt","ProgressTime","ClearInterrupt"];p.forEach(function(e){r.prototype[e]=function(){return this.cpu[e].apply(this.cpu,arguments)}}),i.exports=r}()}),define("cjs!jor1k/worker/riscv/disassemble",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t,i,u){switch(127&e){case 3:switch(e>>12&7){case 0:s.Debug("lb - "+r.ToHex(e));break;case 1:s.Debug("lh - "+r.ToHex(e));break;case 2:s.Debug("lw - "+r.ToHex(e));break;case 4:s.Debug("lbu - "+r.ToHex(e));break;case 5:s.Debug("lhu - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 35:switch(e>>12&7){case 0:s.Debug("sb - "+r.ToHex(e));break;case 1:s.Debug("sh - "+r.ToHex(e));break;case 2:s.Debug("sw - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 19:switch(e>>12&7){case 0:s.Debug("addi - "+r.ToHex(e));break;case 2:s.Debug("slti - "+r.ToHex(e));break;case 3:s.Debug("sltiu - "+r.ToHex(e));break;case 4:s.Debug("xori - "+r.ToHex(e));break;case 6:s.Debug("ori - "+r.ToHex(e));break;case 7:s.Debug("andi - "+r.ToHex(e));break;case 1:s.Debug("slli - "+r.ToHex(e));break;case 5:0==(e>>25&127)?s.Debug("srli - "+r.ToHex(e)):32==(e>>25&127)&&s.Debug("srai - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 51:switch(e>>25&127){case 0:switch(e>>12&7){case 0:s.Debug("add - "+r.ToHex(e));break;case 2:s.Debug("slt - "+r.ToHex(e));break;case 3:s.Debug("sltu - "+r.ToHex(e));break;case 7:s.Debug("and - "+r.ToHex(e));break;case 6:s.Debug("or - "+r.ToHex(e));break;case 4:s.Debug("xor - "+r.ToHex(e));break;case 1:s.Debug("sll - "+r.ToHex(e));break;case 5:s.Debug("srl - "+r.ToHex(e))}break;case 32:switch(e>>12&7){case 0:s.Debug("sub - "+r.ToHex(e));break;case 5:s.Debug("sra - "+r.ToHex(e))}break;case 1:switch(e>>12&7){case 0:s.Debug("mul - "+r.ToHex(e));break;case 1:s.Debug("mulh - "+r.ToHex(e));break;case 2:s.Debug("mulhsu - "+r.ToHex(e));break;case 3:s.Debug("mulhu - "+r.ToHex(e));break;case 4:s.Debug("div - "+r.ToHex(e));break;case 5:s.Debug("divu - "+r.ToHex(e));break;case 6:s.Debug("rem - "+r.ToHex(e));break;case 7:s.Debug("remu - "+r.ToHex(e))}break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 55:s.Debug("Lui - "+r.ToHex(e));break;case 23:s.Debug("auipc - "+r.ToHex(e));break;case 111:s.Debug("jal - "+r.ToHex(e));break;case 103:s.Debug("jalr - "+r.ToHex(e));break;case 99:switch(e>>12&7){case 0:s.Debug("beq - "+r.ToHex(e));break;case 1:s.Debug("bne - "+r.ToHex(e));break;case 4:s.Debug("blt - "+r.ToHex(e));break;case 5:s.Debug("bge - "+r.ToHex(e));break;case 6:s.Debug("bltu - "+r.ToHex(e));break;case 7:s.Debug("bgeu - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 115:switch(e>>12&7){case 1:s.Debug("csrrw - "+r.ToHex(e));break;case 2:s.Debug("csrrs - "+r.ToHex(e));break;case 3:s.Debug("csrrc - "+r.ToHex(e));break;case 5:s.Debug("csrrwi - "+r.ToHex(e));break;case 6:s.Debug("csrrsi - "+r.ToHex(e));break;case 7:s.Debug("csrrci - "+r.ToHex(e));break;case 0:switch(e>>20&4095){case 0:var d=(6&i[h])>>1;switch(d){case a:s.Debug("ecall PRV_U -"+r.ToHex(e));break;case n:s.Debug("ecall PRV_S -"+r.ToHex(e));break;case o:s.Debug("Not supported ecall PRV_H -"+r.ToHex(e));break;case c:s.Debug("ecall PRV_M -"+r.ToHex(e));break;default:s.Debug("Error in ecall: Don't know how to handle privilege level "+d)}break;case 1:s.Debug("ebreak - "+r.ToHex(e)+" at PC"+r.ToHex(this.pc));break;case 256:var d=(6&i[h])>>1;if(n>d){s.Debug("Error in eret: current_privilege_level isn't allowed access");break}switch(d){case n:s.Debug("eret PRV_S -"+r.ToHex(e));break;case o:s.Debug("Not supported eret PRV_H -"+r.ToHex(e));break;case c:s.Debug("eret PRV_M -"+r.ToHex(e));break;default:s.Debug("Error in eret: Don't know how to handle privilege level "+d)}break;case 773:if(d!=c){s.Debug("Error in mrts: current_privilege_level isn't allowed access");
break}s.Debug("mrts - "+r.ToHex(e));break;case 257:s.Debug("sfence.vm - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 7:switch(e>>12&7){case 2:s.Debug("flw - "+r.ToHex(e));break;case 3:s.Debug("fld - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 39:switch(e>>12&7){case 2:s.Debug("fsw - "+r.ToHex(e));break;case 3:s.Debug("fsw - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 83:switch(e>>25&127){case 0:s.Debug("fadd.s - "+r.ToHex(e));break;case 4:s.Debug("fsub.s - "+r.ToHex(e));break;case 96:s.Debug("fcvt.w.s - "+r.ToHex(e));break;case 1:s.Debug("fadd.d - "+r.ToHex(e));break;case 5:s.Debug("fsub.d - "+r.ToHex(e));break;case 97:s.Debug("fcvt.w.s - "+r.ToHex(e));break;case 120:s.Debug("fmv.s.x - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+"not found")}break;case 47:switch(e>>27&31){case 1:s.Debug("amoswap - "+r.ToHex(e));break;case 0:s.Debug("amoadd - "+r.ToHex(e));break;case 4:s.Debug("amoxor - "+r.ToHex(e));break;case 12:s.Debug("amoand - "+r.ToHex(e));break;case 8:s.Debug("amoor - "+r.ToHex(e));break;case 16:s.Debug("amomin - "+r.ToHex(e));break;case 20:s.Debug("amomax - "+r.ToHex(e));break;case 24:s.Debug("amominu - "+r.ToHex(e));break;case 28:s.Debug("amomaxu - "+r.ToHex(e));break;case 2:s.Debug("lr.d - "+r.ToHex(e));break;case 3:s.Debug("sc.d - "+r.ToHex(e));break;default:s.Debug("Error in Atomic Memory Instruction "+r.ToHex(e)+"not found")}break;case 15:s.Debug("fence - "+r.ToHex(e));break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(e)+" not found at "+r.ToHex(this.pc))}s.Debug(r.ToHex(u))}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=0,n=1,o=2,c=3,h=768;i.exports.Disassemble=t}()}),define("cjs!jor1k/worker/riscv/safecpu",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!./disassemble"],function(e,t,i){!function(){function t(e,t){s.Debug("Initialize RISCV CPU"),this.ram=e,this.htif=t,this.r=new Int32Array(this.ram.heap,0,32),this.f=new Float64Array(this.ram.heap,128,32),this.fi=new Int32Array(this.ram.heap,128,64),this.ff=new Float32Array(this.ram.heap,0,1),this.csr=new Int32Array(this.ram.heap,8192,4096),this.pc=512,this.Reset()}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=(e("cjs!./disassemble"),0),n=1,o=2,c=3,h=0,u=1,d=2,f=1<<31|1,l=1<<31|2,p=1<<31|0,b=1,m=3,v=5,g=7,k=8,R=9,y=10,w=11,S=3072,T=2304,D=1,x=2,E=3,I=256,A=257,C=260,j=289,M=320,_=321,H=324,q=384,L=577,U=768,P=769,W=772,B=801,F=865,z=833,O=832,G=834,N=835,V=836,X=837,Q=1793,K=1857,Y=1920,J=1921,Z=1936,$=1937,ee=2305,te=2561,ie=3457,se=2689,re=3329,ae=3394,ne=3395,oe=3840,ce=3841,he=3856,oe=3840,ce=3841,he=3856,ue=3073;t.prototype.Reset=function(){this.ticks=0,this.csr[U]=150,this.csr[Y]=1920,this.csr[oe]=266541,this.csr[ce]=1,this.csr[he]=0,this.csr[P]=256,this.csr[W]=0,this.csr[z]=0,this.csr[G]=0,this.csr[N]=0,this.csr[I]=12304,this.csr[A]=0,this.csr[C]=0,this.csr[ue]=0,this.csr[q]=262144,this.amoaddr=0,this.amovalue=0},t.prototype.InvalidateTLB=function(){},t.prototype.GetTimeToNextInterrupt=function(){var e=(this.csr[B]>>>0)-(4294967295&this.ticks);return e=e+(0>e?4294967295:0)|0},t.prototype.GetTicks=function(){return this.ticks},t.prototype.ProgressTime=function(e){this.ticks=this.ticks+e|0},t.prototype.AnalyzeImage=function(){},t.prototype.CheckForInterrupt=function(){},t.prototype.RaiseInterrupt=function(e,t){},t.prototype.ClearInterrupt=function(e,t){},t.prototype.Trap=function(e,t){var i=(6&this.csr[U])>>1;this.PushPrivilegeStack(),this.csr[z]=t,this.csr[G]=e,this.pc=256+64*i|0},t.prototype.MemTrap=function(e,t){switch(this.csr[N]=e,t){case h:this.Trap(v,this.pc-4|0);break;case u:this.Trap(g,this.pc-4|0);break;case d:this.Trap(b,this.pc)}},t.prototype.CheckVMPrivilege=function(e,t){var i=(6&this.csr[U])>>1;switch(e){case 2:return t==h?!0:i==a&&t==d?!0:!1;case 3:if(i!=n||t!=d)return!0;break;case 4:return t==h?!0:!1;case 5:if(t!=d)return!0;break;case 6:if(t!=u)return!0;break;case 7:return!0;case 11:return i==n?!0:!1;case 13:if(i==n&&t!=d)return!0;break;case 14:if(i==n&&t!=u)return!0;break;case 15:if(i==n)return!0}return s.Debug("Inside CheckVMPrivilege for PC "+r.ToHex(this.pc)+" and type "+e+" and op "+t),s.Abort(),!1},t.prototype.TranslateVM=function(e,t){var i=this.csr[U]>>17&31,a=(6&this.csr[U])>>1,n=1;if(0==i||a==c)return e;8!=i&&(s.Debug("unkown VM Mode "+i+" at PC "+r.ToHex(this.pc)),s.Abort());var o=4095&e,h=this.ram.Read32(this.csr[q]+(e>>>22<<2)),u=h>>1&15,d=1&h;if(0==d)return this.MemTrap(e,t),-1;if(u>=2)return this.CheckVMPrivilege(u,t)?h>>10<<12|4194303&e:(this.MemTrap(e,t),-1);n-=1;var o=4095&e,f=(4294966272&h)<<2,l=e>>12&1023,p=this.ram.Read32(f+(l<<2)),b=p>>1&15,m=1&p;return 0==m?(this.MemTrap(e,t),-1):this.CheckVMPrivilege(b,t)?p>>10<<12|o:(this.MemTrap(e,t),-1)},t.prototype.SetCSR=function(e,t){var i=this.csr;switch(e){case E:i[e]=t;break;case Z:i[e]=t,this.htif.WriteDEVCMDToHost(t);break;case $:i[e]=t,this.htif.WriteDEVCMDFromHost(t);break;case Y:i[e]=t,this.htif.WriteToHost(t);break;case X:this.ram.Write8(-1879048192,t),10==t&&this.ram.Write8(-1879048192,13);break;case J:i[e]=t,this.htif.WriteFromHost(t);break;case U:i[e]=t;break;case oe:break;case ce:i[e]=t;break;case he:i[e]=t;break;case P:i[e]=t;break;case V:var a=10;i[V]=i[V]&~a|t&a;break;case W:var a=42;i[W]=i[W]&~a|t&a;break;case _:case z:i[e]=t;break;case G:i[e]=t;break;case ae:i[e]=t;break;case N:i[e]=t;break;case ne:i[e]=t;break;case I:i[e]=t,i[U]&=-127034,i[U]|=1&i[I],i[U]|=8&i[I],i[U]|=16&i[I],i[U]|=61440&i[I],i[U]|=65536&i[I];break;case A:i[e]=t;break;case H:var a=2;i[V]=i[V]&~a|t&a;break;case C:var a=34;i[W]=i[W]&~a|t&a;break;case O:i[e]=t;break;case M:i[e]=t;break;case T:i[e]=t;break;case S:this.ticks=t,i[e]=t;break;case Q:case re:case te:i[e]=t;break;case K:case ie:case se:i[e]=t;break;case ue:case ee:i[e]=t;break;case B:case j:i[V]&=-33,i[e]=t;break;case F:i[e]=t;break;case q:i[e]=t;break;case x:i[e]=t;break;case D:i[e]=t;break;case E:i[e]=t;break;default:i[e]=t,s.Debug("Error in SetCSR: PC "+r.ToHex(this.pc)+" Address "+r.ToHex(e)+" unkown"),s.Abort()}},t.prototype.GetCSR=function(e){var t=this.csr;(6&t[U])>>1;switch(e){case E:return 0;case Z:return this.htif.ReadDEVCMDToHost();case $:return this.htif.ReadDEVCMDFromHost();case Y:return this.htif.ReadToHost();case X:return 0;case J:return this.htif.ReadFromHost();case U:return t[e];case oe:return t[e];case ce:return t[e];case he:return t[e];case P:return t[e];case W:return t[e];case _:case z:return t[e];case G:return t[e];case ae:return t[e];case N:return t[e];case ne:return t[e];case I:return t[I]=0,t[I]|=1&t[U],t[I]|=8&t[U],t[I]|=16&t[U],t[I]|=61440&t[U],t[I]|=65536&t[U],t[I];case A:return t[e];case V:return t[e];case W:return t[e];case H:return 34&t[V];case C:return 34&t[W];case O:return t[e];case M:return t[e];case T:return this.ticks;case S:return this.ticks;case Q:case re:case te:return this.ticks;case K:case ie:case se:return this.ticks>>32;case ue:case ee:return this.ticks;case B:case j:case F:return t[e];case q:return t[e];case x:return t[e];case D:return t[e];case E:return t[e];default:return s.Debug("Error in GetCSR: PC "+r.ToHex(this.pc)+" Address "+r.ToHex(e)+" unkown"),s.Abort(),t[e]}},t.prototype.UMul64=function(e,t){var i=[0,0];if(e>>>=0,t>>>=0,32767>e&&65536>t)return i[0]=e*t,i[1]=i[0]<0?-1:0,i;var s=65535&e,r=e>>>16,a=65535&t,n=t>>>16,o=s*a,c=(o>>>16)+r*a,h=c>>>16;c=(65535&c)+s*n,h+=c>>>16;var u=h>>>16;return h=(65535&h)+r*n,u+=h>>>16,i[0]=(65535&c)<<16|65535&o,i[1]=(65535&u)<<16|65535&h,i},t.prototype.IMul64=function(e,t){var i=[0,0];if(0==e)return i[0]=i[1]=0,i;if(0==t)return i[0]=i[1]=0,i;if(e|=0,t|=0,e>=-32768&&32767>=e&&t>=-32768&&32767>=t)return i[0]=e*t,i[1]=i[0]<0?-1:0,i;var s=0>e^0>t;return i=this.UMul64(Math.abs(e),Math.abs(t)),s&&(i[0]=~i[0],i[1]=~i[1],i[0]=i[0]+1|0,0==i[0]&&(i[1]=i[1]+1|0)),i},t.prototype.SUMul64=function(e,t){var i=[0,0];if(0==e)return i[0]=i[1]=0,i;if(0==t)return i[0]=i[1]=0,i;if(e|=0,t>>>=0,e>=-32768&&32767>=e&&65536>t)return i[0]=e*t,i[1]=i[0]<0?-1:0,i;var s=0>e;return i=this.UMul64(Math.abs(e),Math.abs(t)),s&&(i[0]=~i[0],i[1]=~i[1],i[0]=i[0]+1|0,0==i[0]&&(i[1]=i[1]+1|0)),i},t.prototype.PushPrivilegeStack=function(){var e=this.csr,t=e[U],i=511&t,s=(i<<2|c)<<1&511;e[U]=(-4096&t)+s&4294901759},t.prototype.PopPrivilegeStack=function(){var e=this.csr,t=e[U],i=511&t,s=i>>>3|(a<<1|1)<<6;e[U]=(-4096&t)+s},t.prototype.Step=function(e,t){var i=this.r,b=this.fi,v=this.ff,g=this.f,S=this.csr,T=0,D=0,x=0,E=0,I=0,C=0,j=0,M=0,H=0,q=0,P=0,F=0,O=0,X=0,Q=0,K=0,Y=0,J=0;e=0|e,t=0|t;var Z=0;do{i[0]=0;var $=(6&this.csr[U])>>1;if(!(63&e)){var Z=S[B]-this.ticks|0;if(Z=Z+(0>Z?4294967295:0)|0,this.ticks=this.ticks+t|0,t>Z&&(S[V]=32|S[V]),Q=S[W]&S[V],K=1&S[U],3>$||3==$&&K){if(8&Q){this.Trap(p,this.pc);continue}if(!this.htif.IsQueueEmpty()){this.Trap(l,this.pc);continue}}if(1>$||1==$&&K){if(2&Q){this.Trap(p,this.pc);continue}if(32&Q){this.Trap(f,this.pc);continue}}}if(J=this.TranslateVM(this.pc,d),-1!=J)switch(Y=this.ram.Read32(J),this.pc=this.pc+4|0,127&Y){case 3:switch(D=Y>>20,q=i[Y>>15&31],T=Y>>7&31,Y>>12&7){case 0:if(J=this.TranslateVM(q+D|0,h),-1==J)break;i[T]=this.ram.Read8(J)<<24>>24;break;case 1:if(q+D&1&&(s.Debug("Error in lh: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,h),-1==J)break;i[T]=this.ram.Read16(J)<<16>>16;break;case 2:if(q+D&3&&(s.Debug("Error in lw: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,h),-1==J)break;i[T]=this.ram.Read32(J);break;case 4:if(J=this.TranslateVM(q+D|0,h),-1==J)break;i[T]=255&this.ram.Read8(J);break;case 5:if(q+D&1&&(s.Debug("Error in lhu: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,h),-1==J)break;i[T]=65535&this.ram.Read16(J);break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 35:switch(x=Y>>25,E=Y>>7&31,D=x<<5|E,q=i[Y>>15&31],T=Y>>20&31,Y>>12&7){case 0:if(J=this.TranslateVM(q+D|0,u),-1==J)break;this.ram.Write8(J,255&i[T]);break;case 1:if(q+D&1&&(s.Debug("Error in sh: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,u),-1==J)break;this.ram.Write16(J,65535&i[T]);break;case 2:if(q+D&3&&(s.Debug("Error in sw: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,u),-1==J)break;this.ram.Write32(J,i[T]);break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 19:switch(T=Y>>7&31,q=i[Y>>15&31],D=Y>>20,Y>>12&7){case 0:i[T]=q+D;break;case 2:D>q?i[T]=1:i[T]=0;break;case 3:D>>>0>q>>>0?i[T]=1:i[T]=0;break;case 4:i[T]=q^D;break;case 6:i[T]=q|D;break;case 7:i[T]=q&D;break;case 1:i[T]=q<<D;break;case 5:0==(Y>>25&127)?i[T]=q>>>D:32==(Y>>25&127)?i[T]=q>>D:(s.Debug("Error in safecpu: Instruction (sra, srl)"+r.ToHex(Y)+" not found"),s.Abort());break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 51:switch(Y>>25&127){case 0:switch(q=i[Y>>15&31],P=i[Y>>20&31],T=Y>>7&31,Y>>12&7){case 0:i[T]=q+P;break;case 2:P>q?i[T]=1:i[T]=0;break;case 3:P>>>0>q>>>0?i[T]=1:i[T]=0;break;case 7:i[T]=q&P;break;case 6:i[T]=q|P;break;case 4:i[T]=q^P;break;case 1:i[T]=q<<(31&P);break;case 5:i[T]=q>>>(31&P)}break;case 32:switch(q=i[Y>>15&31],P=i[Y>>20&31],T=Y>>7&31,Y>>12&7){case 0:i[T]=q-P;break;case 5:i[T]=q>>(31&P);break;default:s.Debug("Error in safecpu: Instruction (sub,sra) "+r.ToHex(Y)+" not found"),s.Abort()}break;case 1:switch(q=i[Y>>15&31],P=i[Y>>20&31],T=Y>>7&31,Y>>12&7){case 0:var ee=this.IMul64(q,P);i[T]=ee[0];break;case 1:var ee=this.IMul64(q,P);i[T]=ee[1];break;case 2:var ee=this.SUMul64(q,P>>>0);i[T]=ee[1];break;case 3:var ee=this.UMul64(q>>>0,P>>>0);i[T]=ee[1];break;case 4:M=0==P?-1:q/P,i[T]=M;break;case 5:M=0==P?4294967295:(q>>>0)/(P>>>0),i[T]=M;break;case 6:H=0==P?q:q%P,i[T]=H;break;case 7:H=0==P?q>>>0:(q>>>0)%(P>>>0),i[T]=H}break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 55:T=Y>>7&31,i[T]=4294963200&Y;break;case 23:D=4294963200&Y,T=Y>>7&31,i[T]=this.pc+D-4|0;break;case 111:x=Y>>21&1023,E=(Y>>20&1)<<10,I=(Y>>12&255)<<11,C=Y>>31<<19,D=(x|E|I|C)<<1,T=Y>>7&31,i[T]=this.pc,this.pc=this.pc+D-4|0;break;case 103:D=Y>>20,q=i[Y>>15&31],T=Y>>7&31,i[T]=this.pc,this.pc=q+D&4294967294;break;case 99:switch(x=Y>>31<<11,E=(Y>>25&63)<<4,I=Y>>8&15,C=(Y>>7&1)<<10,D=(x|E|I|C)<<1,q=i[Y>>15&31],P=i[Y>>20&31],Y>>12&7){case 0:q==P&&(this.pc=this.pc+D-4|0);break;case 1:q!=P&&(this.pc=this.pc+D-4|0);break;case 4:P>q&&(this.pc=this.pc+D-4|0);break;case 5:q>=P&&(this.pc=this.pc+D-4|0);break;case 6:P>>>0>q>>>0&&(this.pc=this.pc+D-4|0);break;case 7:q>>>0>=P>>>0&&(this.pc=this.pc+D-4|0);break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 115:switch(D=Y>>>20,q=i[Y>>15&31],T=Y>>7&31,Y>>12&7){case 1:i[T]=this.GetCSR(D),this.SetCSR(D,q);break;case 2:i[T]=this.GetCSR(D),this.SetCSR(D,this.GetCSR(D)|q);break;case 3:i[T]=this.GetCSR(D),this.SetCSR(D,this.GetCSR(D)&~q);break;case 5:i[T]=this.GetCSR(D),j=Y>>15&31,0!=j&&this.SetCSR(D,j>>0);break;case 6:i[T]=this.GetCSR(D),j=Y>>15&31,0!=j&&this.SetCSR(D,this.GetCSR(D)|j>>0);break;case 7:i[T]=this.GetCSR(D),j=Y>>15&31,0!=j&&this.SetCSR(D,this.GetCSR(D)&~(j>>0));break;case 0:switch(Y>>20&4095){case 0:switch($){case a:this.Trap(k,this.pc-4|0);break;case n:this.Trap(R,this.pc-4|0);break;case o:this.Trap(y,this.pc-4|0),this.Abort();break;case c:this.Trap(w,this.pc-4|0);break;default:s.Debug("Error in ecall: Don't know how to handle privilege level "+$),s.Abort()}break;case 1:this.Trap(m,this.pc-4|0);break;case 256:var $=(6&S[U])>>1;if(n>$){s.Debug("Error in eret: current_privilege_level isn't allowed access"),s.Abort();break}switch(this.PopPrivilegeStack(),$){case n:this.pc=0|S[_];break;case o:this.pc=0|S[L];break;case c:this.pc=0|S[z];break;default:s.Debug("Error in eret: Don't know how to handle privilege level "+$),s.Abort()}break;case 258:break;case 773:if($!=c){s.Debug("Error in mrts: current_privilege_level isn't allowed access"),s.Abort();break}S[U]=-7&S[U]|2,S[ne]=S[N],S[ae]=S[G],S[_]=S[z],this.pc=0|S[A];break;case 257:break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 7:switch(D=Y>>20,q=i[Y>>15&31],T=Y>>7&31,Y>>12&7){case 2:if(q+D&3&&(s.Debug("Error in flw: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,h),-1==J)break;i[0]=this.ram.Read32(J),g[T]=v[0];break;case 3:if(q+D&7&&(s.Debug("Error in flw: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,h),-1==J)break;b[(T<<1)+0]=this.ram.Read32(J+0),b[(T<<1)+1]=this.ram.Read32(J+4);break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 39:switch(x=Y>>25,E=Y>>7&31,D=(x<<5)+E,q=i[Y>>15&31],T=Y>>20&31,Y>>12&7){case 2:if(v[0]=g[T],q+D&3&&(s.Debug("Error in fsw: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,u),-1==J)break;this.ram.Write32(J,i[0]);break;case 3:if(q+D&7&&(s.Debug("Error in fsd: unaligned address"),s.Abort()),J=this.TranslateVM(q+D|0,u),-1==J)break;this.ram.Write32(J+0,b[(T<<1)+0]),this.ram.Write32(J+4,b[(T<<1)+1]);break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 83:switch(T=Y>>7&31,Y>>25&127){case 0:case 1:F=g[Y>>15&31],O=g[Y>>20&31],g[T]=F+O;break;case 4:case 5:F=g[Y>>15&31],O=g[Y>>20&31],g[T]=F-O;break;case 80:case 81:switch(F=g[Y>>15&31],O=g[Y>>20&31],Y>>12&7){case 0:O>=F?i[T]=1:i[T]=0;break;case 1:O>F?i[T]=1:i[T]=0;break;case 2:F==O?i[T]=1:i[T]=0;break;default:s.Debug("Error in safecpu: Instruction (fcmp) "+r.ToHex(Y)+" not found"),s.Abort()}break;case 32:case 33:F=g[Y>>15&31],g[T]=F;break;case 96:i[T]=g[Y>>15&31];break;case 97:i[T]=g[Y>>15&31];break;case 104:g[T]=i[Y>>15&31];break;case 105:g[T]=i[Y>>15&31];break;case 8:case 9:F=g[Y>>15&31],O=g[Y>>20&31],g[T]=F*O;break;case 16:case 17:switch(F=g[Y>>15&31],O=g[Y>>20&31],Y>>12&7){case 0:g[T]=0>O?-Math.abs(F):Math.abs(F);break;case 1:g[T]=0>O?Math.abs(F):-Math.abs(F);break;case 2:g[T]=0>O&&0>F||O>0&&F>0?Math.abs(F):-Math.abs(F);break;default:s.Debug("Error in safecpu: Instruction (fsgn) "+r.ToHex(Y)+" not found"),s.Abort()}break;case 120:q=i[Y>>15&31],i[0]=q,g[T]=v[0];break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 67:F=g[Y>>15&31],O=g[Y>>20&31],X=g[Y>>27&31],T=Y>>7&31,g[T]=F*O+X;break;case 71:F=g[Y>>15&31],O=g[Y>>20&31],X=g[Y>>27&31],T=Y>>7&31,g[T]=F*O-X;break;case 75:F=g[Y>>15&31],O=g[Y>>20&31],X=g[Y>>27&31],T=Y>>7&31,g[T]=-(F*O+X);break;case 79:F=g[Y>>15&31],O=g[Y>>20&31],X=g[Y>>27&31],T=Y>>7&31,g[T]=-(F*O-X);break;case 47:if(q=i[Y>>15&31],P=i[Y>>20&31],T=Y>>7&31,J=this.TranslateVM(0|q,h),-1==J)break;switch(Y>>27&31){case 1:if(i[T]=this.ram.Read32(J),J=this.TranslateVM(0|q,u),-1==J)break;this.ram.Write32(J,P);break;case 0:if(i[T]=this.ram.Read32(J),J=this.TranslateVM(0|q,u),-1==J)break;this.ram.Write32(J,i[T]+P);break;case 4:if(i[T]=this.ram.Read32(J),J=this.TranslateVM(0|q,u),-1==J)break;this.ram.Write32(J,i[T]^P);break;case 12:if(i[T]=this.ram.Read32(J),J=this.TranslateVM(0|q,u),-1==J)break;this.ram.Write32(J,i[T]&P);break;case 8:if(i[T]=this.ram.Read32(J),J=this.TranslateVM(0|q,u),-1==J)break;this.ram.Write32(J,i[T]|P);break;case 16:if(i[T]=this.ram.Read32(J),P>>0>i[T]>>0?i[0]=i[T]:i[0]=P,J=this.TranslateVM(0|q,u),-1==J)break;this.ram.Write32(J,i[0]);break;case 20:if(i[T]=this.ram.Read32(J),P<i[T]?i[0]=i[T]:i[0]=P,J=this.TranslateVM(q,u),-1==J)break;this.ram.Write32(J,i[0]);break;case 24:if(i[T]=this.ram.Read32(J),P>>>0>i[T]>>>0?i[0]=i[T]:i[0]=P,J=this.TranslateVM(q,u),-1==J)break;this.ram.Write32(J,i[0]);break;case 28:if(i[T]=this.ram.Read32(J),P>>>0<i[T]>>>0?i[0]=i[T]:i[0]=P,J=this.TranslateVM(q,u),-1==J)break;this.ram.Write32(J,i[0]);break;case 2:i[T]=this.ram.Read32(J),this.amoaddr=q,this.amovalue=i[T];break;case 3:if(q!=this.amoaddr){i[T]=1;break}if(this.ram.Read32(J)!=this.amovalue){i[T]=1;break}if(i[T]=0,J=this.TranslateVM(q,u),-1==J)break;this.ram.Write32(J,P);break;default:s.Debug("Error in Atomic Memory Instruction "+r.ToHex(Y)+" not found"),s.Abort()}break;case 15:break;default:s.Debug("Error in safecpu: Instruction "+r.ToHex(Y)+" not found at "+r.ToHex(this.pc)),s.Abort()}}while(e=e-1|0);return 0},i.exports=t}()}),define("cjs!jor1k/worker/riscv/fastcpu",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!./disassemble"],function(e,t,i){!function(){function t(e,t,i){"use asm";function s(){r()}function r(){Ye=0,Fe[ze+Re>>2]=150,Fe[ze+Ie>>2]=1920,Fe[ze+je>>2]=266541,Fe[ze+Me>>2]=1,Fe[ze+_e>>2]=0,Fe[ze+ye>>2]=256,Fe[ze+we>>2]=0,Fe[ze+Te>>2]=0,Fe[ze+De>>2]=0,Fe[ze+xe>>2]=0,Fe[ze+pe>>2]=12304,Fe[ze+be>>2]=0,Fe[ze+me>>2]=0,Fe[ze+He>>2]=0,Fe[ze+ge>>2]=262144,Je=0,Ze=0}function a(){return Xe=Qe+(et-tt)|0,Xe|0}function n(){var e=0;return e=(Fe[ze+3204>>2]>>>0)-(Ye&4294967295)|0,e=e+((e|0)<0?4294967295:0)|0,e|0}function o(){return Ye|0}function c(e){e|=0,Ye=Ye+e|0}function h(){}function u(e,t){e|=0,t|=0,It=1}function d(e,t){e|=0,t|=0}function f(e,t){e|=0,t|=0;var i=0,s=256;i=(Fe[ze+Re>>2]&6)>>1,w(),Fe[ze+Te>>2]=t,Fe[ze+De>>2]=e,Xe=s+(i<<6)|0,$e=et,Ke=1,y()}function l(e,t){switch(e|=0,t|=0,(t|0)!=(ie|0)&&(Xe=Qe+(et-tt)|0),Fe[ze+xe>>2]=e,t|0){case 0:f(ce,Xe-4|0);break;case 1:f(he,Xe-4|0);break;case 2:f(ne,Xe)}}function p(e,t){e|=0,t|=0;var i=0;switch(i=(Fe[ze+Re>>2]&6)>>1,e|0){case 2:return(t|0)==(ee|0)?1:(i|0)==(J|0)&(t|0)==(ie|0)?1:0;case 3:if(!((i|0)==(Z|0)&(t|0)==(ie|0)))return 1;break;case 4:return(t|0)==(ee|0)?1:0;case 5:if((t|0)!=(ie|0))return 1;break;case 6:if((t|0)!=(te|0))return 1;break;case 7:return 1;case 11:if((i|0)==(Z|0))return 1;break;case 13:if((i|0)==(Z|0)&(t|0)!=(ie|0))return 1;break;case 14:if((i|0)==(Z|0)&(t|0)!=(te|0))return 1;break;case 15:if((i|0)==(Z|0))return 1}return D(P|0),x(),0}function b(e,t){e|=0,t|=0;var i=0,s=0,r=1,a=0,n=0,o=0,c=0,h=0,u=0,d=0,f=0,b=0,m=0,v=0;return i=Fe[ze+Re>>2]>>17&31,s=(Fe[ze+Re>>2]&6)>>1,(i|0)==0|(s|0)==($|0)?e|0:((i|0)!=8&&(D(B|0),x()),a=e&4095,n=e>>>22|0,v=(Fe[ze+ge>>2]|0)+(n<<2)|0,o=Oe[Ge+v>>2]|0,c=o>>1&15,h=o&1,(h|0)==0?(l(e,t),-1):(c|0)>=2?(p(c,t)|0||(D(W|0),x()),(o>>10|e>>12&1023)<<12|a):(a=e&4095,u=(o&4294966272)<<2,d=e>>12&1023,v=(u|0)+(d<<2)|0,f=Oe[Ge+v>>2]|0,b=f>>1&15,m=f&1,r=r-1|0,(m|0)==0?(l(e,t),-1):p(b,t)|0?f>>10<<12|a|0:(l(e,t),-1)))}function m(e,t){e|=0,t|=0;var i=0,s=0;switch(e<<=2,e|0){case 12:Fe[ze+e>>2]=t;break;case 7744:Fe[ze+e>>2]=t,A(t|0);break;case 7748:Fe[ze+e>>2]=t,C(t|0);break;case 7680:Fe[ze+e>>2]=t,_(t|0);break;case 3348:s=-1879048192,Ne[Ge+s>>0]=t|0,(t|0)==10&&(Ne[Ge+s>>0]=13);break;case 7684:Fe[ze+e>>2]=t,H(t|0);break;case 3072:Fe[ze+e>>2]=t,y();break;case 15360:break;case 15364:Fe[ze+e>>2]=t;break;case 15424:Fe[ze+e>>2]=t;break;case 3076:Fe[ze+e>>2]=t;break;case 3344:i=10,Fe[ze+e>>2]=Fe[ze+e>>2]&~i|t&i;break;case 3088:i=42,Fe[ze+e>>2]=Fe[ze+e>>2]&~i|t&i;break;case 1284:case 3332:Fe[ze+e>>2]=t;break;case 3336:Fe[ze+e>>2]=t;break;case 13576:Fe[ze+e>>2]=t;break;case 3340:Fe[ze+e>>2]=t;break;case 13580:Fe[ze+e>>2]=t;break;case 1024:Fe[ze+pe>>2]=t,Fe[ze+Re>>2]=Fe[ze+Re>>2]&-127034,Fe[ze+Re>>2]=Fe[ze+Re>>2]|Fe[ze+pe>>2]&1,Fe[ze+Re>>2]=Fe[ze+Re>>2]|Fe[ze+pe>>2]&8,Fe[ze+Re>>2]=Fe[ze+Re>>2]|Fe[ze+pe>>2]&16,Fe[ze+Re>>2]=Fe[ze+Re>>2]|Fe[ze+pe>>2]&61440,Fe[ze+Re>>2]=Fe[ze+Re>>2]|Fe[ze+pe>>2]&65536;break;case 1028:Fe[ze+e>>2]=t;break;case 1296:i=2,Fe[ze+Ee>>2]=Fe[ze+Ee>>2]&~i|t&i;break;case 1040:i=34,Fe[ze+we>>2]=Fe[ze+we>>2]&~i|t&i;break;case 3328:Fe[ze+e>>2]=t;break;case 1280:Fe[ze+e>>2]=t;break;case 9216:Fe[ze+e>>2]=t;break;case 12288:Ye=t,Fe[ze+e>>2]=t;break;case 7172:case 13316:case 10244:Fe[ze+e>>2]=t;break;case 7428:case 13828:case 10756:Fe[ze+e>>2]=t;break;case 12292:case 9220:Fe[ze+e>>2]=t;break;case 3204:case 1156:Fe[ze+Ee>>2]=Fe[ze+Ee>>2]&-33,Fe[ze+e>>2]=t;break;case 3460:case 1536:Fe[ze+e>>2]=t;break;case 4:case 8:Fe[ze+e>>2]=t;break;default:Fe[ze+e>>2]=t,D(F|0),x()}}function v(e){e|=0;var t=0;switch(t=(Fe[ze+Re>>2]&6)>>1,e=e<<2|0,e|0){case 12:return 0;case 7744:return E()|0;case 7748:return I()|0;case 7680:return j()|0;case 3348:return 0;case 7684:return M()|0;case 3072:return Fe[ze+e>>2]|0;case 15360:return Fe[ze+e>>2]|0;case 15364:return Fe[ze+e>>2]|0;case 15424:return Fe[ze+e>>2]|0;case 3076:return Fe[ze+e>>2]|0;case 3088:return Fe[ze+e>>2]|0;case 1284:case 3332:return Fe[ze+e>>2]|0;case 3336:return Fe[ze+e>>2]|0;case 13576:return Fe[ze+e>>2]|0;case 3340:return Fe[ze+e>>2]|0;case 13580:return Fe[ze+e>>2]|0;case 1024:return Fe[ze+pe>>2]=0,Fe[ze+pe>>2]=Fe[ze+pe>>2]|Fe[ze+Re>>2]&1,Fe[ze+pe>>2]=Fe[ze+pe>>2]|Fe[ze+Re>>2]&8,Fe[ze+pe>>2]=Fe[ze+pe>>2]|Fe[ze+Re>>2]&16,Fe[ze+pe>>2]=Fe[ze+pe>>2]|Fe[ze+Re>>2]&61440,Fe[ze+pe>>2]=Fe[ze+pe>>2]|Fe[ze+Re>>2]&65536,Fe[ze+pe>>2]|0;case 1028:return Fe[ze+e>>2]|0;case 3344:return Fe[ze+e>>2]|0;case 1296:return Fe[ze+Ee>>2]&34|0;case 1040:return Fe[ze+we>>2]&34|0;case 3328:return Fe[ze+e>>2]|0;case 1280:return Fe[ze+e>>2]|0;case 9216:return Ye|0;case 12288:return Ye|0;case 7172:case 13316:case 10244:return Ye|0;case 7428:case 13828:case 10756:return Ye>>32|0;case 12292:case 9220:return Ye|0;case 3204:case 1156:return Fe[ze+e>>2]|0;case 3460:case 1536:return Fe[ze+e>>2]|0;case 4:case 8:return Fe[ze+e>>2]|0;default:return D(z|0),x(),Fe[ze+e>>2]|0}return 0}function g(e,t,i){e|=0,t|=0,i|=0;var s=0,r=0,a=0,n=0,o=0,c=0,h=0,u=0,d=0,f=0;return e>>>0<32767&&t>>>0<65536?(s=q(e|0,t|0)|0,r=(s|0)<0?-1:0,(i|0)==0?s|0:r|0):(a=e&65535,n=e>>>16,o=t&65535,c=t>>>16,h=q(a|0,o|0)|0,u=(h>>>16)+(q(n|0,o|0)|0)|0,d=u>>>16,u=(u&65535)+(q(a|0,c|0)|0)|0,d=d+(u>>>16)|0,f=d>>>16,d=(d&65535)+(q(n|0,c|0)|0)|0,f=f+(d>>>16)|0,s=(u&65535)<<16|h&65535,r=(f&65535)<<16|d&65535,(i|0)==0?s|0:r|0)}function k(e,t,i){e|=0,t|=0,i|=0;var s=0,r=0,a=0;return(e|0)==0?0:(t|0)==0?0:(e|0)>=-32768&&(e|0)<=32767&&(t|0)>=-32768&&(t|0)<=32767?(s=q(e|0,t|0)|0,r=(s|0)<0?-1:0,(i|0)==0?s|0:r|0):(a=(e|0)<0^(t|0)<0,e=L(e|0)|0,t=L(t|0)|0,s=g(e,t,0)|0,r=g(e,t,1)|0,a&&(s=~s,r=~r,s=s+1|0,(s|0)==0&&(r=r+1|0)),(i|0)==0?s|0:r|0)}function R(e,t,i){e|=0,t|=0,i|=0;var s=0,r=0,a=0;return(e|0)==0?0:(t|0)==0?0:(e|0)>=-32768&&(e|0)<=32767&&t>>>0<65536?(s=q(e|0,t|0)|0,r=(s|0)<0?-1:0,(i|0)==0?s|0:r|0):(a=(e|0)<0,e=L(e|0)|0,s=g(e,t,0)|0,r=g(e,t,1)|0,a&&(s=~s,r=~r,s=s+1|0,(s|0)==0&&(r=r+1|0)),(i|0)==0?s|0:r|0)}function y(){it=4294901760,st=-1,rt=4294901760,at=-1,nt=4294901760,ot=-1,ct=4294901760,ht=-1,ut=4294901760,dt=-1,ft=4294901760,lt=-1,pt=4294901760,bt=-1,mt=4294901760,vt=-1,gt=4294901760,kt=-1,Rt=4294901760,yt=-1,wt=4294901760,St=-1,Tt=4294901760,Dt=-1,xt=4294901760,Et=-1}function w(){var e=0,t=0,i=0;e=Fe[ze+Re>>2]|0,t=e&4095,i=(t<<2|$)<<1&4095,Fe[ze+Re>>2]=(e>>12<<12)+i&4294901759}function S(){var e=0,t=0,i=0;e=Fe[ze+Re>>2]|0,t=e&4095,i=t>>>3|(J<<1|1)<<9,Fe[ze+Re>>2]=(e>>12<<12)+i,y()}function T(e,t){e|=0,t|=0;for(var i=0,s=0,r=0,a=0,n=0,o=0,c=0,h=0,u=0,d=0,l=0,p=0,w=0,T=0,E=0,I=0,A=0,C=64;;)if(($e|0)!=(et|0))switch(A=Oe[et>>2]|0,et=et+4|0,A&127){case 3:switch(p=(qe[(A>>13&124)>>2]|0)+(A>>20)|0,A>>12&7){case 0:if((rt^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;rt=p|0,at=(w^p)&4294963200}w=at^p,qe[(A>>5&124)>>2]=Ne[Ge+w>>0]<<24>>24;continue;case 1:if((ct^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;ct=p|0,ht=(w^p)&4294963200}w=ht^p,qe[(A>>5&124)>>2]=Ve[Ge+w>>1]<<16>>16;continue;case 2:if(p&3&&(D(O|0),x()),(ft^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;ft=p|0,lt=(w^p)&4294963200}w=lt^p,qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0;continue;case 4:if((nt^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;nt=p|0,ot=(w^p)&4294963200}w=ot^p,qe[(A>>5&124)>>2]=Ne[Ge+w>>0]&255;continue;case 5:if((ut^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;ut=p|0,dt=(w^p)&4294963200}w=dt^p,qe[(A>>5&124)>>2]=Ve[Ge+w>>1]&65535;continue;default:D(N|0),x()}continue;case 35:switch(p=(qe[(A>>13&124)>>2]|0)+(A>>25<<5|A>>7&31)|0,A>>12&7){case 0:if((pt^p)&4294963200){if(w=b(p|0,te)|0,(w|0)==-1)continue;pt=p|0,bt=(w^p)&4294963200}w=bt^p,Ne[Ge+w>>0]=qe[(A>>18&124)>>2]&255;continue;case 1:if((mt^p)&4294963200){if(w=b(p|0,te)|0,(w|0)==-1)continue;mt=p|0,vt=(w^p)&4294963200}w=vt^p,Ve[Ge+w>>1]=qe[(A>>18&124)>>2]&65535;continue;case 2:if(p&3&&(D(G|0),x()),(gt^p)&4294963200){if(w=b(p|0,te)|0,(w|0)==-1)continue;gt=p|0,kt=(w^p)&4294963200}w=kt^p,Oe[Ge+w>>2]=qe[(A>>18&124)>>2]|0;continue;default:D(N|0),x()}continue;case 19:switch(o=qe[(A>>13&124)>>2]|0,A>>12&7){case 0:qe[(A>>5&124)>>2]=o+(A>>20)|0;continue;case 2:(o|0)<A>>20?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;case 3:o>>>0<A>>20>>>0?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;case 4:qe[(A>>5&124)>>2]=o^A>>20;continue;case 6:qe[(A>>5&124)>>2]=o|A>>20;continue;case 7:qe[(A>>5&124)>>2]=o&A>>20;continue;case 1:qe[(A>>5&124)>>2]=o<<(A>>20&31);continue;case 5:(A>>25&127)==0?qe[(A>>5&124)>>2]=o>>>(A>>20&31):(A>>25&127)==32&&(qe[(A>>5&124)>>2]=o>>(A>>20&31));continue;default:D(N|0),x()}continue;case 51:switch(A>>25&127){case 0:switch(o=qe[(A>>13&124)>>2]|0,c=qe[(A>>18&124)>>2]|0,A>>12&7){case 0:qe[(A>>5&124)>>2]=o+c;continue;case 2:(o|0)<(c|0)?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;case 3:o>>>0<c>>>0?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;case 7:qe[(A>>5&124)>>2]=o&c;continue;case 6:qe[(A>>5&124)>>2]=o|c;continue;case 4:qe[(A>>5&124)>>2]=o^c;continue;case 1:qe[(A>>5&124)>>2]=o<<(c&31);continue;case 5:qe[(A>>5&124)>>2]=o>>>(c&31);continue}continue;case 32:switch(o=qe[(A>>13&124)>>2]|0,c=qe[(A>>18&124)>>2]|0,A>>12&7){case 0:qe[(A>>5&124)>>2]=o-c;continue;case 5:qe[(A>>5&124)>>2]=o>>(c&31);continue}continue;case 1:switch(o=qe[(A>>13&124)>>2]|0,c=qe[(A>>18&124)>>2]|0,A>>12&7){case 0:n=q(o|0,c|0)|0,qe[(A>>5&124)>>2]=n;continue;case 1:n=k(o,c,1)|0,qe[(A>>5&124)>>2]=n;continue;case 2:n=R(o,c>>>0,1)|0,qe[(A>>5&124)>>2]=n;continue;case 3:n=g(o>>>0,c>>>0,1)|0,qe[(A>>5&124)>>2]=n;continue;case 4:r=(c|0)==0?-1:(o|0)/(c|0)|0,qe[(A>>5&124)>>2]=r;continue;case 5:r=(c|0)==0?4294967295:(o>>>0)/(c>>>0)|0,qe[(A>>5&124)>>2]=r;continue;case 6:a=(c|0)==0?o:(o|0)%(c|0)|0,qe[(A>>5&124)>>2]=a;continue;case 7:a=(c|0)==0?o>>>0:(o>>>0)%(c>>>0)|0,qe[(A>>5&124)>>2]=a;continue}continue;default:D(N|0),x()}continue;case 55:qe[(A>>5&124)>>2]=A&4294963200;continue;case 23:Xe=Qe+(et-tt)|0,qe[(A>>5&124)>>2]=Xe+(A&4294963200)-4|0;continue;case 111:Xe=Qe+(et-tt)|0,qe[(A>>5&124)>>2]=Xe,i=(A>>21&1023|(A>>20&1)<<10|(A>>12&255)<<11|A>>31<<19)<<1,Xe=Xe+i-4|0,$e=et,Ke=1,qe[0]=0;continue;case 103:Xe=Qe+(et-tt)|0,o=qe[(A>>13&124)>>2]|0,qe[(A>>5&124)>>2]=Xe,Xe=o+(A>>20)&4294967294|0,$e=et,Ke=1,qe[0]=0;continue;case 99:switch(o=qe[(A>>13&124)>>2]|0,c=qe[(A>>18&124)>>2]|0,A>>12&7){case 0:if((o|0)!=(c|0))continue;$e=et,Ke=1,i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Xe=Qe+(et-tt)|0,Xe=Xe+i-4|0;continue;case 1:if((o|0)==(c|0))continue;$e=et,Ke=1,i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Xe=Qe+(et-tt)|0,Xe=Xe+i-4|0;continue;case 4:if((o|0)>=(c|0))continue;$e=et,Ke=1,i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Xe=Qe+(et-tt)|0,Xe=Xe+i-4|0;continue;case 5:if((o|0)<(c|0))continue;$e=et,Ke=1,i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Xe=Qe+(et-tt)|0,Xe=Xe+i-4|0;continue;case 6:if(o>>>0>=c>>>0)continue;$e=et,Ke=1,i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Xe=Qe+(et-tt)|0,Xe=Xe+i-4|0;continue;case 7:if(o>>>0<c>>>0)continue;$e=et,Ke=1,i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Xe=Qe+(et-tt)|0,Xe=Xe+i-4|0;continue;default:D(N|0),x()}continue;case 115:switch(i=A>>>20,o=qe[(A>>13&124)>>2]|0,A>>12&7){case 1:qe[(A>>5&124)>>2]=v(i)|0,m(i,o),qe[0]=0;continue;case 2:qe[(A>>5&124)>>2]=v(i)|0,m(i,v(i)|0|o),qe[0]=0;continue;case 3:qe[(A>>5&124)>>2]=v(i)|0,m(i,(v(i)|0)&~o),qe[0]=0;continue;case 5:qe[(A>>5&124)>>2]=v(i)|0,s=A>>15&31,(s|0)!=0&&m(i,s>>0),qe[0]=0;continue;case 6:qe[(A>>5&124)>>2]=v(i)|0,s=A>>15&31,(s|0)!=0&&m(i,v(i)|0|s>>0),qe[0]=0;continue;case 7:qe[(A>>5&124)>>2]=v(i)|0,s=A>>15&31,(s|0)!=0&&m(i,(v(i)|0)&~(s>>0)),qe[0]=0;continue;case 0:switch(T=(Fe[ze+Re>>2]&6)>>1,$e=et,A>>20&4095){case 0:switch(Xe=Qe+(et-tt)|0,T|0){case 0:f(ue,Xe-4|0);break;case 1:f(de,Xe-4|0);break;case 2:f(fe,Xe-4|0),x();break;case 3:f(le,Xe-4|0);break;default:D(V|0),x()}continue;case 1:Xe=Qe+(et-tt)|0,f(oe,Xe-4|0);continue;case 256:if(T=(Fe[ze+Re>>2]&6)>>1,Xe=Qe+(et-tt)|0,(T|0)<(Z|0)){D(Q|0),x();break}switch(S(),T|0){case 1:Xe=Fe[ze+ve>>2]|0;break;case 2:Xe=Fe[ze+ke>>2]|0,x();break;case 3:Xe=Fe[ze+Te>>2]|0;break;default:D(X|0),x()}Ke=1,y();continue;case 258:E=Fe[ze+we>>2]&Fe[ze+Ee>>2];continue;case 773:if(Xe=Qe+(et-tt)|0,(T|0)!=($|0)){D(K|0),x();break}Fe[ze+Re>>2]=Fe[ze+Re>>2]&-7|2,Fe[ze+Ce>>2]=Fe[ze+xe>>2],Fe[ze+Ae>>2]=Fe[ze+De>>2],Fe[ze+ve>>2]=Fe[ze+Te>>2],Xe=Fe[ze+be>>2]|0,y(),Ke=1;continue;case 257:y();continue;default:D(N|0),x()}continue;default:D(N|0),x()}continue;case 7:switch(p=(qe[(A>>13&124)>>2]|0)+(A>>20)|0,A>>12&7){case 2:if((Rt^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)break;Rt=p|0,yt=(w^p)&4294963200}w=yt^p,qe[0]=Oe[Ge+w>>2]|0,Le[Ue+((A>>7&31)<<3)>>3]=+Be[0],qe[0]=0;continue;case 3:if((wt^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;wt=p|0,St=(w^p)&4294963200}w=St^p,Pe[We+((A>>7&31)<<3)+0>>2]=Oe[Ge+w+0>>2]|0,Pe[We+((A>>7&31)<<3)+4>>2]=Oe[Ge+w+4>>2]|0;continue;default:D(N|0),D(A|0),x()}continue;case 39:switch(p=(qe[(A>>13&124)>>2]|0)+(A>>25<<5|A>>7&31)|0,A>>12&7){case 2:if(Be[0]=+Le[Ue+((A>>20&31)<<3)>>3],(Tt^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;Tt=p|0,Dt=(w^p)&4294963200}w=Dt^p,Oe[Ge+w>>2]=qe[0]|0,qe[0]=0;continue;case 3:if((xt^p)&4294963200){if(w=b(p|0,ee)|0,(w|0)==-1)continue;xt=p|0,Et=(w^p)&4294963200}w=Et^p,Oe[Ge+w+0>>2]=Pe[We+((A>>20&31)<<3)+0>>2]|0,Oe[Ge+w+4>>2]=Pe[We+((A>>20&31)<<3)+4>>2]|0;continue;default:D(N|0),D(A|0),x()}continue;case 83:switch(A>>25&127){case 0:case 1:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=+h+ +u;continue;case 4:case 5:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=+h-+u;continue;case 80:case 81:switch(h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],
A>>12&7){case 0:+h<=+u?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;case 1:+h<+u?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;case 2:+h==+u?qe[(A>>5&124)>>2]=1:qe[(A>>5&124)>>2]=0;continue;default:D(N|0),D(A|0),x()}continue;case 32:case 33:Le[Ue+((A>>7&31)<<3)>>3]=+Le[Ue+((A>>15&31)<<3)>>3];continue;case 96:qe[(A>>5&124)>>2]=~~U(+Le[Ue+((A>>15&31)<<3)>>3]);continue;case 104:case 105:Le[Ue+((A>>7&31)<<3)>>3]=+(qe[(A>>13&124)>>2]|0);continue;case 8:case 9:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=+ +h*+u;continue;case 16:case 17:switch(h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],A>>12&7){case 0:Le[Ue+((A>>7&31)<<3)>>3]=+u<0?-+L(+h):+L(+h);continue;case 1:Le[Ue+((A>>7&31)<<3)>>3]=+u<0?+L(+h):-+L(+h);continue;case 2:+h*+u<0?Le[Ue+((A>>7&31)<<3)>>3]=-+L(+h):Le[Ue+((A>>7&31)<<3)>>3]=+ +L(+h);continue;default:D(N|0),D(A|0),x()}continue;case 97:qe[(A>>5&124)>>2]=~~+Le[Ue+((A>>15&31)<<3)>>3];continue;case 120:o=qe[(A>>13&124)>>2]|0,qe[0]=o,Le[Ue+((A>>7&31)<<3)>>3]=+Be[0],qe[0]=0;continue;default:D(N|0),D(A|0),x()}continue;case 67:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],d=+Le[Ue+((A>>27&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=h*u+d;continue;case 71:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],d=+Le[Ue+((A>>27&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=h*u-d;continue;case 75:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],d=+Le[Ue+((A>>27&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=-(h*u+d);continue;case 79:h=+Le[Ue+((A>>15&31)<<3)>>3],u=+Le[Ue+((A>>20&31)<<3)>>3],d=+Le[Ue+((A>>27&31)<<3)>>3],Le[Ue+((A>>7&31)<<3)>>3]=-(h*u-d);continue;case 47:if(o=qe[(A>>13&124)>>2]|0,c=qe[(A>>18&124)>>2]|0,w=b(o|0,ee)|0,(w|0)==-1)continue;switch(A>>27&31){case 1:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,Oe[Ge+w>>2]=c|0,w=b(o|0,te)|0,(w|0)==-1)continue;qe[0]=0;continue;case 0:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=(qe[(A>>5&124)>>2]|0)+(c|0)|0,qe[0]=0;continue;case 4:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=(qe[(A>>5&124)>>2]|0)^(c|0)|0,qe[0]=0;continue;case 12:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=(qe[(A>>5&124)>>2]|0)&(c|0)|0,qe[0]=0;continue;case 8:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=qe[(A>>5&124)>>2]|0|(c|0)|0,qe[0]=0;continue;case 16:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,c>>0>qe[(A>>5&124)>>2]>>0?qe[0]=qe[(A>>5&124)>>2]:qe[0]=c,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=qe[0]|0,qe[0]=0;continue;case 20:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,c>>0<qe[(A>>5&124)>>2]>>0?qe[0]=qe[(A>>5&124)>>2]:qe[0]=c,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=qe[0]|0,qe[0]=0;continue;case 24:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,c>>>0>qe[(A>>5&124)>>2]>>>0?qe[0]=qe[(A>>5&124)>>2]:qe[0]=c,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=qe[0]|0,qe[0]=0;continue;case 28:if(qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,c>>>0<qe[(A>>5&124)>>2]>>>0?qe[0]=qe[(A>>5&124)>>2]:qe[0]=c,w=b(o|0,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=qe[0]|0,qe[0]=0;continue;case 2:qe[(A>>5&124)>>2]=Oe[Ge+w>>2]|0,Je=o,Ze=qe[(A>>5&124)>>2]|0,qe[0]=0;continue;case 3:if((o|0)!=(Je|0)){qe[(A>>5&124)>>2]=1;continue}if((Oe[Ge+w>>2]|0)!=(Ze|0)){qe[(A>>5&124)>>2]=1;continue}if(qe[(A>>5&124)>>2]=0,w=b(o,te)|0,(w|0)==-1)continue;Oe[Ge+w>>2]=c|0,qe[0]=0;continue;default:D(Y|0),x()}continue;case 15:continue;case 0:default:D(N|0),D(A|0),x()}else{if(Ke|0||(Xe=Qe+(et-tt)|0),C=C-(et-tt>>2)|0,(C|0)<0){if(C=C+64|0,e=e-64|0,(e|0)<0)return 0;if(l=(Fe[ze+Se>>2]|0)-Ye|0,l=l+((l|0)<0?4294967295:0)|0,Ye=Ye+t|0,(l|0)<(t|0)&&(Fe[ze+Ee>>2]=Fe[ze+Ee>>2]|32),T=(Fe[ze+Re>>2]&6)>>1,E=Fe[ze+we>>2]&Fe[ze+Ee>>2],I=Fe[ze+Re>>2]&1,(T|0)<3|(T|0)==3&(I|0)){if((E|0)&8){f(ae,Xe);continue}if(It|0){f(re,Xe),It=0;continue}}if((T|0)<1|(T|0)==1&(I|0)){if((E|0)&2){f(ae,Xe);continue}if((E|0)&32){f(se,Xe);continue}}}if((it^Xe)&4294963200){if(et=b(Xe|0,ie)|0,(et|0)==-1){et=$e;continue}it=Xe,st=(et^Xe)&4294963200}et=Ge+(st^Xe)|0,tt=et,Qe=Xe,$e=(et>>12)+1<<12,Ke=0}return 0}var D=t.DebugMessage,x=t.abort,E=(t.Read32,t.Write32,t.Read16,t.Write16,t.Read8,t.Write8,t.ReadDEVCMDToHost),I=t.ReadDEVCMDFromHost,A=t.WriteDEVCMDToHost,C=t.WriteDEVCMDFromHost,j=t.ReadToHost,M=t.ReadFromHost,_=t.WriteToHost,H=t.WriteFromHost,q=t.imul,L=e.Math.abs,U=e.Math.floor,P=0,W=1,B=2,F=3,z=4,O=5,G=6,N=7,V=8,X=9,Q=10,K=11,Y=12,J=0,Z=1,$=3,ee=0,te=1,ie=2,se=2147483649,re=2147483650,ae=2147483648,ne=1,oe=3,ce=5,he=7,ue=8,de=9,fe=10,le=11,pe=1024,be=1028,me=1040,ve=1284,ge=1536,ke=2308,Re=3072,ye=3076,we=3088,Se=3204,Te=3332,De=3336,xe=3340,Ee=3344,Ie=7680,Ae=13576,Ce=13580,je=15360,Me=15364,_e=15424,He=12292,qe=new e.Int32Array(i),Le=new e.Float64Array(i),Ue=128,Pe=new e.Int32Array(i),We=128,Be=new e.Float32Array(i),Fe=new e.Int32Array(i),ze=8192,Oe=new e.Int32Array(i),Ge=1048576,Ne=new e.Int8Array(i),Ve=new e.Int16Array(i),Xe=512,Qe=512,Ke=1,Ye=0,Je=0,Ze=0,$e=512,et=512,tt=512,it=-32768,st=-32768,rt=-1,at=-1,nt=-1,ot=-1,ct=-1,ht=-1,ut=-1,dt=-1,ft=-1,lt=-1,pt=-1,bt=-1,mt=-1,vt=-1,gt=-1,kt=-1,Rt=-1,yt=-1,wt=-1,St=-1,Tt=-1,Dt=-1,xt=-1,Et=-1,It=0;return{Reset:r,Init:s,InvalidateTLB:y,Step:T,TranslateVM:b,GetCSR:v,SetCSR:m,GetTimeToNextInterrupt:n,ProgressTime:c,GetTicks:o,GetPC:a,AnalyzeImage:h,RaiseInterrupt:u,ClearInterrupt:d}}e("cjs!../messagehandler"),e("cjs!../utils"),e("cjs!./disassemble");i.exports=t}()}),define("cjs!jor1k/worker/riscv/dynamiccpu",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!./disassemble"],function(e,t,i){!function(){function t(e,t,i){"use asm";function s(){r()}function r(){Ke=0,Be[Fe+ke>>2]=150,Be[Fe+Ee>>2]=1920,Be[Fe+Ce>>2]=266541,Be[Fe+je>>2]=1,Be[Fe+Me>>2]=0,Be[Fe+Re>>2]=256,Be[Fe+ye>>2]=0,Be[Fe+Se>>2]=0,Be[Fe+Te>>2]=0,Be[Fe+De>>2]=0,Be[Fe+le>>2]=12304,Be[Fe+pe>>2]=0,Be[Fe+be>>2]=0,Be[Fe+_e>>2]=0,Be[Fe+ve>>2]=262144,Ye=0,Je=0}function a(){return 10}function n(){return Ke|0}function o(e){e|=0,Ke=Ke+e|0}function c(){}function h(){}function u(e,t){e|=0,t|=0,Et=1}function d(e,t){e|=0,t|=0}function f(e,t){e|=0,t|=0;var i=0,s=256;i=(Be[Fe+ke>>2]&6)>>1,w(),Be[Fe+Se>>2]=t,Be[Fe+Te>>2]=e,Ve=s+(i<<6)|0,Ze=$e,Qe=1,y()}function l(e,t){switch(e|=0,t|=0,(t|0)!=(te|0)&&(Ve=Xe+($e-et)|0),Be[Fe+De>>2]=e,t|0){case 0:f(oe,Ve-4|0);break;case 1:f(ce,Ve-4|0);break;case 2:f(ae,Ve)}}function p(e,t){e|=0,t|=0;var i=0;switch(i=(Be[Fe+ke>>2]&6)>>1,e|0){case 2:return(t|0)==($|0)?1:(i|0)==(Y|0)&(t|0)==(te|0)?1:0;case 3:if(!((i|0)==(J|0)&(t|0)==(te|0)))return 1;break;case 4:return(t|0)==($|0)?1:0;case 5:if((t|0)!=(te|0))return 1;break;case 6:if((t|0)!=(ee|0))return 1;break;case 7:return 1;case 13:if((i|0)==(J|0)&(t|0)!=(te|0))return 1;break;case 14:if((i|0)==(J|0)&(t|0)!=(ee|0))return 1;break;case 15:if((i|0)==(J|0))return 1}return D(U|0),x(),0}function b(e,t){e|=0,t|=0;var i=0,s=0,r=1,a=0,n=0,o=0,c=0,h=0,u=0,d=0,f=0,b=0,m=0,v=0;return i=Be[Fe+ke>>2]>>17&31,s=(Be[Fe+ke>>2]&6)>>1,(i|0)==0|(s|0)==(Z|0)?e|0:((i|0)!=8&&(D(W|0),x()),a=e&4095,n=e>>>22|0,v=(Be[Fe+ve>>2]|0)+(n<<2)|0,o=ze[Oe+v>>2]|0,c=o>>1&15,h=o&1,(h|0)==0?(l(e,t),-1):(c|0)>=2?(p(c,t)|0||(D(P|0),x()),(o>>10|e>>12&1023)<<12|a):(a=e&4095,u=(o&4294966272)<<2,d=e>>12&1023,v=(u|0)+(d<<2)|0,f=ze[Oe+v>>2]|0,b=f>>1&15,m=f&1,r=r-1|0,(m|0)==0?(l(e,t),-1):p(b,t)|0?f>>10<<12|a|0:(l(e,t),-1)))}function m(e,t){e|=0,t|=0;var i=0,s=0;switch(e<<=2,e|0){case 12:Be[Fe+e>>2]=t;break;case 7744:Be[Fe+e>>2]=t,A(t|0);break;case 7748:Be[Fe+e>>2]=t,C(t|0);break;case 7680:Be[Fe+e>>2]=t,_(t|0);break;case 3348:s=-1879048192,Ge[Oe+s>>0]=t|0,(t|0)==10&&(Ge[Oe+s>>0]=13);break;case 7684:Be[Fe+e>>2]=t,H(t|0);break;case 3072:Be[Fe+e>>2]=t;break;case 15360:break;case 15364:Be[Fe+e>>2]=t;break;case 15424:Be[Fe+e>>2]=t;break;case 3076:Be[Fe+e>>2]=t;break;case 3344:i=10,Be[Fe+e>>2]=Be[Fe+e>>2]&~i|t&i;break;case 3088:i=42,Be[Fe+e>>2]=Be[Fe+e>>2]&~i|t&i;break;case 1284:case 3332:Be[Fe+e>>2]=t;break;case 3336:Be[Fe+e>>2]=t;break;case 13576:Be[Fe+e>>2]=t;break;case 3340:Be[Fe+e>>2]=t;break;case 13580:Be[Fe+e>>2]=t;break;case 1024:Be[Fe+le>>2]=t,Be[Fe+ke>>2]=Be[Fe+ke>>2]&-127034,Be[Fe+ke>>2]=Be[Fe+ke>>2]|Be[Fe+le>>2]&1,Be[Fe+ke>>2]=Be[Fe+ke>>2]|Be[Fe+le>>2]&8,Be[Fe+ke>>2]=Be[Fe+ke>>2]|Be[Fe+le>>2]&16,Be[Fe+ke>>2]=Be[Fe+ke>>2]|Be[Fe+le>>2]&61440,Be[Fe+ke>>2]=Be[Fe+ke>>2]|Be[Fe+le>>2]&65536;break;case 1028:Be[Fe+e>>2]=t;break;case 1296:i=2,Be[Fe+xe>>2]=Be[Fe+xe>>2]&~i|t&i;break;case 1040:i=34,Be[Fe+ye>>2]=Be[Fe+ye>>2]&~i|t&i;break;case 3328:Be[Fe+e>>2]=t;break;case 1280:Be[Fe+e>>2]=t;break;case 9216:Be[Fe+e>>2]=t;break;case 12288:Ke=t,Be[Fe+e>>2]=t;break;case 7172:case 13316:case 10244:Be[Fe+e>>2]=t;break;case 7428:case 13828:case 10756:Be[Fe+e>>2]=t;break;case 12292:case 9220:Be[Fe+e>>2]=t;break;case 3204:case 1156:Be[Fe+xe>>2]=Be[Fe+xe>>2]&-33,Be[Fe+e>>2]=t;break;case 3460:case 1536:Be[Fe+e>>2]=t;break;case 4:case 8:Be[Fe+e>>2]=t;break;default:Be[Fe+e>>2]=t,D(B|0),x()}}function v(e){e|=0;var t=0;switch(t=(Be[Fe+ke>>2]&6)>>1,e=e<<2|0,e|0){case 12:return 0;case 7744:return E()|0;case 7748:return I()|0;case 7680:return j()|0;case 3348:return 0;case 7684:return M()|0;case 3072:return Be[Fe+e>>2]|0;case 15360:return Be[Fe+e>>2]|0;case 15364:return Be[Fe+e>>2]|0;case 15424:return Be[Fe+e>>2]|0;case 3076:return Be[Fe+e>>2]|0;case 3088:return Be[Fe+e>>2]|0;case 1284:case 3332:return Be[Fe+e>>2]|0;case 3336:return Be[Fe+e>>2]|0;case 13576:return Be[Fe+e>>2]|0;case 3340:return Be[Fe+e>>2]|0;case 13580:return Be[Fe+e>>2]|0;case 1024:return Be[Fe+le>>2]=0,Be[Fe+le>>2]=Be[Fe+le>>2]|Be[Fe+ke>>2]&1,Be[Fe+le>>2]=Be[Fe+le>>2]|Be[Fe+ke>>2]&8,Be[Fe+le>>2]=Be[Fe+le>>2]|Be[Fe+ke>>2]&16,Be[Fe+le>>2]=Be[Fe+le>>2]|Be[Fe+ke>>2]&61440,Be[Fe+le>>2]=Be[Fe+le>>2]|Be[Fe+ke>>2]&65536,Be[Fe+le>>2]|0;case 1028:return Be[Fe+e>>2]|0;case 3344:return Be[Fe+e>>2]|0;case 1296:return Be[Fe+xe>>2]&34|0;case 1040:return Be[Fe+ye>>2]&34|0;case 3328:return Be[Fe+e>>2]|0;case 1280:return Be[Fe+e>>2]|0;case 9216:return Ke|0;case 12288:return Ke|0;case 7172:case 13316:case 10244:return Ke|0;case 7428:case 13828:case 10756:return Ke>>32|0;case 12292:case 9220:return Ke|0;case 3204:case 1156:return Be[Fe+e>>2]|0;case 3460:case 1536:return Be[Fe+e>>2]|0;case 4:case 8:return Be[Fe+e>>2]|0;default:return D(F|0),x(),Be[Fe+e>>2]|0}return 0}function g(e,t,i){e|=0,t|=0,i|=0;var s=0,r=0,a=0,n=0,o=0,c=0,h=0,u=0,d=0,f=0;return e>>>0<32767&t>>>0<65536?(s=q(e|0,t|0)|0,r=(s|0)<0?-1:0,(i|0)==0?s|0:r|0):(a=e&65535,n=e>>>16,o=t&65535,c=t>>>16,h=q(a|0,o|0)|0,u=(h>>>16)+(q(n|0,o|0)|0)|0,d=u>>>16,u=(u&65535)+(q(a|0,c|0)|0)|0,d=d+(u>>>16)|0,f=d>>>16,d=(d&65535)+(q(n|0,c|0)|0)|0,f=f+(d>>>16)|0,s=(u&65535)<<16|h&65535,r=(f&65535)<<16|d&65535,(i|0)==0?s|0:r|0)}function k(e,t,i){e|=0,t|=0,i|=0;var s=0,r=0,a=0;return(e|0)==0?0:(t|0)==0?0:(e|0)>=-32768&(e|0)<=32767&((t|0)>=-32768&(t|0)<=32767)?(s=q(e|0,t|0)|0,r=(s|0)<0?-1:0,(i|0)==0?s|0:r|0):(a=(e|0)<0^(t|0)<0,e=L(e|0)|0,t=L(t|0)|0,s=g(e,t,0)|0,r=g(e,t,1)|0,a&&(s=~s,r=~r,s=s+1|0,(s|0)==0&&(r=r+1|0)),(i|0)==0?s|0:r|0)}function R(e,t,i){e|=0,t|=0,i|=0;var s=0,r=0,a=0;return(e|0)==0?0:(t|0)==0?0:(e|0)>=-32768&(e|0)<=32767&((t|0)>=-32768&t>>>0<=32767)?(s=q(e|0,t|0)|0,r=(s|0)<0?-1:0,(i|0)==0?s|0:r|0):(a=(e|0)<0^(t|0)<0,e=L(e|0)|0,t=L(t|0)|0,s=g(e,t,0)|0,r=g(e,t,1)|0,a&&(s=~s,r=~r,s=s+1|0,(s|0)==0&&(r=r+1|0)),(i|0)==0?s|0:r|0)}function y(){st=-1,rt=-1,at=-1,nt=-1,ot=-1,ct=-1,ht=-1,ut=-1,dt=-1,ft=-1,lt=-1,pt=-1,bt=-1,mt=-1,vt=-1,gt=-1,kt=-1,Rt=-1,yt=-1,wt=-1,St=-1,Tt=-1,Dt=-1,xt=-1}function w(){var e=0,t=0,i=0;e=Be[Fe+ke>>2]|0,t=e&4095,i=(t<<2|Z)<<1&4095,Be[Fe+ke>>2]=(e>>12<<12)+i&4294901759}function S(){var e=0,t=0,i=0;e=Be[Fe+ke>>2]|0,t=e&4095,i=t>>>3|(Y<<1|1)<<9,Be[Fe+ke>>2]=(e>>12<<12)+i}function T(e,t){e|=0,t|=0;for(var i=0,s=0,r=0,a=0,n=0,o=0,c=0,h=0,u=0,d=0,l=0,p=0,w=0,T=0,E=0,I=0,A=0,C=64;;)if((Ze|0)!=($e|0))switch(A=ze[$e>>2]|0,$e=$e+4|0,A&127){case 3:switch(A>>12&7){case 0:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(st^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;st=w,rt=(w^(c+i|0))&4294963200}else w=rt^(c+i|0);He[(A>>5&124)>>2]=Ge[Oe+w>>0]<<24>>24,ze[$e-4>>2]=A>>7<<7|116;continue;case 1:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(ot^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;ot=w,ct=(w^(c+i|0))&4294963200}else w=ct^(c+i|0);He[(A>>5&124)>>2]=Ne[Oe+w>>1]<<16>>16,ze[$e-4>>2]=A>>7<<7|117;continue;case 2:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,c+i&3&&(D(z|0),x()),(dt^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;dt=w,ft=(w^(c+i|0))&4294963200}else w=ft^(c+i|0);He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,ze[$e-4>>2]=A>>7<<7|118;continue;case 4:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(at^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;at=w,nt=(w^(c+i|0))&4294963200}else w=nt^(c+i|0);He[(A>>5&124)>>2]=Ge[Oe+w>>0]&255,ze[$e-4>>2]=A>>7<<7|119;continue;case 5:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(ht^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;ht=w,ut=(w^(c+i|0))&4294963200}else w=ut^(c+i|0);He[(A>>5&124)>>2]=Ne[Oe+w>>1]&65535,ze[$e-4>>2]=A>>7<<7|120;continue;default:D(G|0),x()}continue;case 35:switch(i=A>>25<<5|A>>7&31,A>>12&7){case 0:if(c=He[(A>>15&31)<<2>>2]|0,(lt^(c+i|0))&4294963200){if(w=b(c+i|0,ee)|0,(w|0)==-1)continue;lt=w,pt=(w^(c+i|0))&4294963200}else w=pt^(c+i|0);Ge[Oe+w>>0]=He[(A>>18&124)>>2]&255,ze[$e-4>>2]=A>>7<<7|121;continue;case 1:if(c=He[(A>>15&31)<<2>>2]|0,(bt^(c+i|0))&4294963200){if(w=b(c+i|0,ee)|0,(w|0)==-1)continue;bt=w,mt=(w^(c+i|0))&4294963200}else w=mt^(c+i|0);Ne[Oe+w>>1]=He[(A>>18&124)>>2]&65535,ze[$e-4>>2]=A>>7<<7|122;continue;case 2:if(c=He[(A>>15&31)<<2>>2]|0,c+i&3&&(D(O|0),x()),(vt^(c+i|0))&4294963200){if(w=b(c+i|0,ee)|0,(w|0)==-1)continue;vt=w,gt=(w^(c+i|0))&4294963200}else w=gt^(c+i|0);ze[Oe+w>>2]=He[(A>>18&124)>>2]|0,ze[$e-4>>2]=A>>7<<7|123;continue;default:D(G|0),x()}continue;case 19:switch(A>>12&7){case 0:c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c+(A>>20)|0;continue;case 2:c=He[(A>>15&31)<<2>>2]|0,(c|0)<A>>20?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;case 3:c=He[(A>>15&31)<<2>>2]|0,c>>>0<A>>20>>>0?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;case 4:i=A>>20,c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c^A>>20;continue;case 6:c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c|A>>20;continue;case 7:c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c&A>>20;continue;case 1:c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c<<(A>>20&31);continue;case 5:(A>>25&127)==0?(c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c>>>(A>>20&31)):(A>>25&127)==32&&(c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=c>>(A>>20&31));continue;default:D(G|0),x()}continue;case 51:switch(A>>25&127){case 0:switch(c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,A>>12&7){case 0:He[(A>>5&124)>>2]=c+h;continue;case 2:(c|0)<(h|0)?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;case 3:c>>>0<h>>>0?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;case 7:He[(A>>5&124)>>2]=c&h;continue;case 6:He[(A>>5&124)>>2]=c|h;continue;case 4:He[(A>>5&124)>>2]=c^h;continue;case 1:He[(A>>5&124)>>2]=c<<(h&31);continue;case 5:He[(A>>5&124)>>2]=c>>>(h&31);continue}continue;case 32:switch(c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,A>>12&7){case 0:He[(A>>5&124)>>2]=c-h;continue;case 5:He[(A>>5&124)>>2]=c>>(h&31);continue}continue;case 1:switch(c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,A>>12&7){case 0:r=q(c|0,h|0)|0,He[(A>>5&124)>>2]=r&4294967295;continue;case 1:o=k(c,h,1)|0,He[(A>>5&124)>>2]=o;continue;case 2:o=R(c,h>>>0,1)|0,He[(A>>5&124)>>2]=o;continue;case 3:o=g(c>>>0,h>>>0,1)|0,He[(A>>5&124)>>2]=o;continue;case 4:a=(h|0)==0?-1:(c|0)/(h|0)|0,He[(A>>5&124)>>2]=a;continue;case 5:a=(h|0)==0?4294967295:(c>>>0)/(h>>>0)|0,He[(A>>5&124)>>2]=a;continue;case 6:n=(h|0)==0?c:(c|0)%(h|0)|0,He[(A>>5&124)>>2]=n;continue;case 7:n=(h|0)==0?c>>>0:(c>>>0)%(h>>>0)|0,He[(A>>5&124)>>2]=n;continue}continue;default:D(G|0),x()}continue;case 55:He[(A>>5&124)>>2]=A&4294963200;continue;case 23:Ve=Xe+($e-et)|0,i=A&4294963200,He[(A>>5&124)>>2]=i+Ve-4|0,Ze=$e,Qe=1;continue;case 111:Ve=Xe+($e-et)|0,i=(A>>21&1023|(A>>20&1)<<10|(A>>12&255)<<11|A>>31<<19)<<1,He[(A>>5&124)>>2]=Ve,Ve=Ve+i-4|0,Ze=$e,Qe=1,He[0]=0;continue;case 103:Ve=Xe+($e-et)|0,i=A>>20,c=He[(A>>15&31)<<2>>2]|0,He[(A>>5&124)>>2]=Ve,Ve=c+i&4294967294|0,Ze=$e,Qe=1,He[0]=0;continue;case 99:switch(Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,A>>12&7){case 0:(c|0)==(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0),ze[$e-4>>2]=A>>7<<7|104;continue;case 1:(c|0)!=(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0),ze[$e-4>>2]=A>>7<<7|105;continue;case 4:(c|0)<(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0),ze[$e-4>>2]=A>>7<<7|106;continue;case 5:(c|0)>=(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0),ze[$e-4>>2]=A>>7<<7|107;continue;case 6:c>>>0<h>>>0&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0),ze[$e-4>>2]=A>>7<<7|108;continue;case 7:c>>>0>=h>>>0&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0),ze[$e-4>>2]=A>>7<<7|109;continue;default:D(G|0),x()}continue;case 115:switch(i=A>>>20,c=He[(A>>15&31)<<2>>2]|0,A>>12&7){case 1:He[(A>>5&124)>>2]=v(i)|0,m(i,c),He[0]=0;continue;case 2:He[(A>>5&124)>>2]=v(i)|0,m(i,v(i)|0|c),He[0]=0;continue;case 3:He[(A>>5&124)>>2]=v(i)|0,m(i,(v(i)|0)&~c),He[0]=0;continue;case 5:He[(A>>5&124)>>2]=v(i)|0,s=A>>15&31,(s|0)!=0&&m(i,s>>0),He[0]=0;continue;case 6:He[(A>>5&124)>>2]=v(i)|0,s=A>>15&31,(s|0)!=0&&m(i,v(i)|0|s>>0),He[0]=0;continue;case 7:He[(A>>5&124)>>2]=v(i)|0,s=A>>15&31,(s|0)!=0&&m(i,(v(i)|0)&~(s>>0)),He[0]=0;continue;case 0:switch(T=(Be[Fe+ke>>2]&6)>>1,Ze=$e,A>>20&4095){case 0:switch(Ve=Xe+($e-et)|0,T|0){case 0:f(he,Ve-4|0);break;case 1:f(ue,Ve-4|0);break;case 2:f(de,Ve-4|0),x();break;case 3:f(fe,Ve-4|0);break;default:D(N|0),x()}continue;case 1:Ve=Xe+($e-et)|0,f(ne,Ve-4|0);continue;case 256:if(T=(Be[Fe+ke>>2]&6)>>1,Ve=Xe+($e-et)|0,(T|0)<(J|0)){D(X|0),x();break}switch(S(),T|0){case 1:Ve=Be[Fe+me>>2]|0;break;case 2:Ve=Be[Fe+ge>>2]|0,x();break;case 3:Ve=Be[Fe+Se>>2]|0;break;default:D(V|0),x()}Qe=1,y();continue;case 258:continue;case 773:if(Ve=Xe+($e-et)|0,(T|0)!=(Z|0)){D(Q|0),x();break}Be[Fe+ke>>2]=Be[Fe+ke>>2]&-7|2,Be[Fe+Ae>>2]=Be[Fe+De>>2],Be[Fe+Ie>>2]=Be[Fe+Te>>2],Be[Fe+me>>2]=Be[Fe+Se>>2],Ve=Be[Fe+pe>>2]|0,Qe=1;continue;case 257:y();continue;default:D(G|0),x()}continue;default:D(G|0),x()}continue;case 7:switch(A>>12&7){case 2:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(kt^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)break;kt=w,Rt=(w^(c+i|0))&4294963200}else w=Rt^(c+i|0);He[0]=ze[Oe+w>>2]|0,qe[Le+((A>>7&31)<<3)>>3]=+We[0],He[0]=0;continue;case 3:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(yt^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;yt=w,wt=(w^(c+i|0))&4294963200}else w=wt^(c+i|0);Ue[Pe+((A>>7&31)+0<<2)>>2]=ze[Oe+w+0>>2]|0,Ue[Pe+((A>>7&31)+1<<2)>>2]=ze[Oe+w+4>>2]|0;continue;default:D(G|0),D(A|0),x()}continue;case 39:switch(A>>12&7){case 2:if(i=(A>>25<<5)+(A>>7&31)|0,c=He[(A>>15&31)<<2>>2]|0,We[0]=qe[Le+((A>>20&31)<<3)>>3],(St^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;St=w,Tt=(w^(c+i|0))&4294963200}else w=Tt^(c+i|0);ze[Oe+w>>2]=He[0]|0,He[0]=0;continue;case 3:if(i=(A>>25<<5)+(A>>7&31)|0,c=He[(A>>15&31)<<2>>2]|0,(Dt^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;Dt=w,xt=(w^(c+i|0))&4294963200}else w=xt^(c+i|0);ze[Oe+w+0>>2]=Ue[Pe+((A>>20&31)+0<<2)>>2]|0,ze[Oe+w+4>>2]=Ue[Pe+((A>>20&31)+1<<2)>>2]|0;continue;default:D(G|0),D(A|0),x()}continue;case 83:switch(A>>25&127){case 0:case 1:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=u+d;continue;case 4:case 5:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=u-d;continue;case 80:case 81:switch(u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],A>>12&7){case 0:+u<=+d?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;case 1:+u<+d?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;case 2:+u==+d?He[(A>>5&124)>>2]=1:He[(A>>5&124)>>2]=0;continue;default:D(G|0),D(A|0),x()}continue;case 96:He[(A>>5&124)>>2]=~~+qe[Le+((A>>15&31)<<3)>>3];continue;case 104:case 105:qe[Le+((A>>7&31)<<3)>>3]=+~~He[(A>>15&31)<<2>>2];continue;case 8:case 9:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=+q(u,d);continue;case 16:case 17:switch(u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],A>>12&7){case 0:qe[Le+((A>>7&31)<<3)>>3]=+d<0?-+L(+u):+L(+u);continue;case 1:qe[Le+((A>>7&31)<<3)>>3]=+d<0?+L(+u):-+L(+u);continue;case 3:qe[Le+((A>>7&31)<<3)>>3]=+d<0&+u<0|+d>0&+u>0?-+L(+u):+L(+u);continue;default:D(G|0),D(A|0),x()}continue;case 97:He[(A>>5&124)>>2]=~~+qe[Le+((A>>15&31)<<3)>>3];continue;case 120:c=He[(A>>15&31)<<2>>2]|0,He[0]=c,qe[Le+((A>>7&31)<<3)>>3]=+We[0],He[0]=0;continue;default:D(G|0),D(A|0),x()}continue;case 67:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],l=+qe[Le+((A>>27&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=u*d+l;continue;case 71:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],l=+qe[Le+((A>>27&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=u*d-l;continue;case 75:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],l=+qe[Le+((A>>27&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=-(u*d+l);continue;case 79:u=+qe[Le+((A>>15&31)<<3)>>3],d=+qe[Le+((A>>20&31)<<3)>>3],l=+qe[Le+((A>>27&31)<<3)>>3],qe[Le+((A>>7&31)<<3)>>3]=-(u*d-l);continue;case 47:switch(c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,A>>27&31){case 1:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=h|0,He[0]=0;continue;case 0:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=(He[(A>>5&124)>>2]|0)+(h|0)|0,He[0]=0;continue;case 4:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=(He[(A>>5&124)>>2]|0)^(h|0)|0,He[0]=0;continue;case 12:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=(He[(A>>5&124)>>2]|0)&(h|0)|0,He[0]=0;continue;case 8:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=He[(A>>5&124)>>2]|0|(h|0)|0,He[0]=0;continue;case 16:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,h>>0>He[(A>>5&124)>>2]>>0?He[0]=He[(A>>5&124)>>2]:He[0]=h,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=He[0]|0,He[0]=0;continue;case 20:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,h>>0<He[(A>>5&124)>>2]>>0?He[0]=He[(A>>5&124)>>2]:He[0]=h,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=He[0]|0,He[0]=0;continue;case 24:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,h>>>0>He[(A>>5&124)>>2]>>>0?He[0]=He[(A>>5&124)>>2]:He[0]=h,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=He[0]|0,He[0]=0;continue;case 28:if(w=b(c|0,$)|0,(w|0)==-1)break;if(He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,h>>>0<He[(A>>5&124)>>2]>>>0?He[0]=He[(A>>5&124)>>2]:He[0]=h,w=b(c|0,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=He[0]|0,He[0]=0;continue;case 2:if(c=He[(A>>15&31)<<2>>2]|0,w=b(c|0,$)|0,(w|0)==-1)break;He[(A>>5&124)>>2]=ze[Oe+w>>2]|0,Ye=c,Je=He[(A>>5&124)>>2]|0,He[0]=0;continue;case 3:if(c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,(c|0)!=(Ye|0)){He[(A>>5&124)>>2]=1;continue}if(w=b(c,$)|0,(w|0)==-1)break;if((ze[Oe+w>>2]|0)!=(Je|0)){He[(A>>5&124)>>2]=1;continue}if(He[(A>>5&124)>>2]=0,w=b(c,ee)|0,(w|0)==-1)break;ze[Oe+w>>2]=h|0,He[0]=0;continue;default:D(K|0),x()}continue;case 15:continue;case 116:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(st^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;st=w,rt=(w^(c+i|0))&4294963200}else w=rt^(c+i|0);He[(A>>5&124)>>2]=Ge[Oe+w>>0]<<24>>24;continue;case 117:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(ot^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;ot=w,ct=(w^(c+i|0))&4294963200}else w=ct^(c+i|0);He[(A>>5&124)>>2]=Ne[Oe+w>>1]<<16>>16;continue;case 118:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,c+i&3&&(D(z|0),x()),(dt^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;dt=w,ft=(w^(c+i|0))&4294963200}else w=ft^(c+i|0);He[(A>>5&124)>>2]=ze[Oe+w>>2]|0;continue;case 119:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(at^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;at=w,nt=(w^(c+i|0))&4294963200}else w=nt^(c+i|0);He[(A>>5&124)>>2]=Ge[Oe+w>>0]&255;continue;case 120:if(i=A>>20,c=He[(A>>15&31)<<2>>2]|0,(ht^(c+i|0))&4294963200){if(w=b(c+i|0,$)|0,(w|0)==-1)continue;ht=w,ut=(w^(c+i|0))&4294963200}else w=ut^(c+i|0);He[(A>>5&124)>>2]=Ne[Oe+w>>1]&65535;continue;case 121:if(i=A>>25<<5|A>>7&31,c=He[(A>>15&31)<<2>>2]|0,(lt^(c+i|0))&4294963200){if(w=b(c+i|0,ee)|0,(w|0)==-1)continue;lt=w,pt=(w^(c+i|0))&4294963200}else w=pt^(c+i|0);Ge[Oe+w>>0]=He[(A>>18&124)>>2]&255;continue;case 122:if(i=A>>25<<5|A>>7&31,c=He[(A>>15&31)<<2>>2]|0,(bt^(c+i|0))&4294963200){if(w=b(c+i|0,ee)|0,(w|0)==-1)continue;bt=w,mt=(w^(c+i|0))&4294963200}else w=mt^(c+i|0);Ne[Oe+w>>1]=He[(A>>18&124)>>2]&65535;continue;case 123:if(i=A>>25<<5|A>>7&31,c=He[(A>>15&31)<<2>>2]|0,c+i&3&&(D(O|0),x()),(vt^(c+i|0))&4294963200){if(w=b(c+i|0,ee)|0,(w|0)==-1)continue;vt=w,gt=(w^(c+i|0))&4294963200}else w=gt^(c+i|0);ze[Oe+w>>2]=He[(A>>18&124)>>2]|0;continue;case 104:Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,(c|0)==(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0);continue;case 105:Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,(c|0)!=(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0);continue;case 106:Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,(c|0)<(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0);continue;case 107:Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,(c|0)>=(h|0)&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0);continue;case 108:Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,c>>>0<h>>>0&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0);continue;case 109:Ve=Xe+($e-et)|0,Ze=$e,Qe=1,c=He[(A>>15&31)<<2>>2]|0,h=He[(A>>18&124)>>2]|0,c>>>0>=h>>>0&&(i=(A>>31<<11|(A>>25&63)<<4|A>>8&15|(A>>7&1)<<10)<<1,Ve=Ve+i-4|0);continue;default:D(G|0),D(A|0),x()}else{if(Qe|0||(Ve=Xe+($e-et)|0),C=C-($e-et>>2)|0,(C|0)<0){if(C=C+64|0,e=e-64|0,(e|0)<0)return 0;if(p=(Be[Fe+we>>2]|0)-Ke|0,p=p+((p|0)<0?4294967295:0)|0,Ke=Ke+t|0,(p|0)<(t|0)&&(Be[Fe+xe>>2]=Be[Fe+xe>>2]|32),T=(Be[Fe+ke>>2]&6)>>1,E=Be[Fe+ye>>2]&Be[Fe+xe>>2],I=Be[Fe+ke>>2]&1,(T|0)<3|(T|0)==3&(I|0)){if((E|0)&8){f(re,Ve);continue}if(Et|0){f(se,Ve),Et=0;continue}}if((T|0)<1|(T|0)==1&(I|0)){if((E|0)&2){f(re,Ve);continue}if((E|0)&32){f(ie,Ve);continue}}}if((tt^Ve)&4294963200){if($e=b(Ve,te)|0,($e|0)==-1){$e=Ze;continue}tt=Ve,it=($e^Ve)&4294963200}$e=Oe+(it^Ve)|0,et=$e,Xe=Ve,Ze=($e>>12)+1<<12,Qe=0}return 0}var D=t.DebugMessage,x=t.abort,E=(t.Read32,t.Write32,t.Read16,t.Write16,t.Read8,t.Write8,t.ReadDEVCMDToHost),I=t.ReadDEVCMDFromHost,A=t.WriteDEVCMDToHost,C=t.WriteDEVCMDFromHost,j=t.ReadToHost,M=t.ReadFromHost,_=t.WriteToHost,H=t.WriteFromHost,q=(t.IsQueueEmpty,t.mul),L=e.Math.abs,U=0,P=1,W=2,B=3,F=4,z=5,O=6,G=7,N=8,V=9,X=10,Q=11,K=12,Y=0,J=1,Z=3,$=0,ee=1,te=2,ie=2147483649,se=2147483650,re=2147483648,ae=1,ne=3,oe=5,ce=7,he=8,ue=9,de=10,fe=11,le=1024,pe=1028,be=1040,me=1284,ve=1536,ge=2308,ke=3072,Re=3076,ye=3088,we=3204,Se=3332,Te=3336,De=3340,xe=3344,Ee=7680,Ie=13576,Ae=13580,Ce=15360,je=15364,Me=15424,_e=12292,He=new e.Int32Array(i),qe=new e.Float64Array(i),Le=128,Ue=new e.Int32Array(i),Pe=128,We=new e.Float32Array(i),Be=new e.Int32Array(i),Fe=8192,ze=new e.Int32Array(i),Oe=1048576,Ge=new e.Int8Array(i),Ne=new e.Int16Array(i),Ve=512,Xe=512,Qe=1,Ke=0,Ye=0,Je=0,Ze=512,$e=512,et=512,tt=-1,it=-1,st=-1,rt=-1,at=-1,nt=-1,ot=-1,ct=-1,ht=-1,ut=-1,dt=-1,ft=-1,lt=-1,pt=-1,bt=-1,mt=-1,vt=-1,gt=-1,kt=-1,Rt=-1,yt=-1,wt=-1,St=-1,Tt=-1,Dt=-1,xt=-1,Et=0;return{Reset:r,Init:s,InvalidateTLB:y,Step:T,TranslateVM:b,GetCSR:v,SetCSR:m,Trap:f,MemTrap:l,PopPrivilegeStack:S,PushPrivilegeStack:w,IMul:g,UMul:k,SUMul:R,CheckVMPrivilege:p,GetTimeToNextInterrupt:a,ProgressTime:o,GetTicks:n,AnalyzeImage:c,CheckForInterrupt:h,RaiseInterrupt:u,ClearInterrupt:d}}e("cjs!../messagehandler"),e("cjs!../utils"),e("cjs!./disassemble");i.exports=t}()}),define("cjs!jor1k/worker/riscv/index",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!../imul","cjs!./safecpu","cjs!./fastcpu","cjs!./dynamiccpu"],function(e,t,i){!function(){function t(e,t,i,s,a){var d=null,f={DebugMessage:r.Debug,abort:r.Abort,imul:Math.imul||n,MathAbs:Math.abs,Read32:t.Read32Little.bind(t),Write32:t.Write32Little.bind(t),Read16:t.Read16Little.bind(t),Write16:t.Write16Little.bind(t),Read8:t.Read8Little.bind(t),Write8:t.Write8Little.bind(t),ReadDEVCMDToHost:i.ReadDEVCMDToHost.bind(i),ReadDEVCMDFromHost:i.ReadDEVCMDFromHost.bind(i),WriteDEVCMDToHost:i.WriteDEVCMDToHost.bind(i),WriteDEVCMDFromHost:i.WriteDEVCMDFromHost.bind(i),ReadToHost:i.ReadToHost.bind(i),ReadFromHost:i.ReadFromHost.bind(i),WriteToHost:i.WriteToHost.bind(i),WriteFromHost:i.WriteFromHost.bind(i)};if("safe"===e)return new o(t,i);if("asm"===e)return d=c(u,f,s),d.Init(),d;if("dynamic"===e)return d=h(u,f,s),d.Init(),d;throw new Error("invalid CPU name:"+e)}function s(e,i,s,r,a){return this.cpu=t(e,i,s,r,a),this.name=e,this.ncores=a,this.ram=i,this.heap=r,this.littleendian=!0,this}var r=e("cjs!../messagehandler"),a=e("cjs!../utils"),n=e("cjs!../imul"),o=e("cjs!./safecpu"),c=e("cjs!./fastcpu"),h=e("cjs!./dynamiccpu"),u={Int32Array:Int32Array,Int8Array:Int8Array,Int16Array:Int16Array,Float32Array:Float32Array,Float64Array:Float64Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Math:Math};s.prototype.switchImplementation=function(e){},s.prototype.toString=function(){var e=new Int32Array(this.heap,0),t=new Uint32Array(this.heap,8192),i="";i+="Current state of the machine\n",i+=this.cpu.pc?"PC: "+a.ToHex(this.cpu.pc)+"\n":"PC: "+a.ToHex(this.cpu.GetPC())+"\n";for(var s=0;32>s;s+=4)i+="   r"+(s+0)+": "+a.ToHex(e[s+0])+"   r"+(s+1)+": "+a.ToHex(e[s+1])+"   r"+(s+2)+": "+a.ToHex(e[s+2])+"   r"+(s+3)+": "+a.ToHex(e[s+3])+"\n";return i+="mstatus: "+a.ToBin(t[768])+"\n",i+="mcause: "+a.ToHex(t[834])+" mbadaddress: "+a.ToHex(t[835])+" mepc: "+a.ToHex(t[833])+"\n"};var d=["Reset","Step","RaiseInterrupt","Step","AnalyzeImage","GetTicks","GetTimeToNextInterrupt","ProgressTime","ClearInterrupt"];d.forEach(function(e){s.prototype[e]=function(){return this.cpu[e].apply(this.cpu,arguments)}}),i.exports=s}()}),define("cjs!jor1k/worker/dev/uart",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t,i){this.intno=i,this.intdev=t,this.id=e,s.Register("tty"+e,this.ReceiveChar.bind(this)),this.Reset()}var s=e("cjs!../messagehandler"),r=(e("cjs!../utils"),0),a=0,n=0,o=1,c=1,h=2,u=2,d=3,f=4,l=5,p=6,b=1,m=32,v=64,g=8,k=2,R=1,y=0,w=1,S=2,T=12,D=128,x=128,E=32,I=16,A=["DataTerminalReady","RTS","AuxOut1","AuxOut2","Loopback","Autoflow"],C=["FIFO enable","Reset","XMIT-FIFO-Reset","DMA-Mode","Reserved","Reserved","RecrTrig(LSB)","RecrTrig(MSB)"],j=["WordLen","WordLen","StopBits","Parity","EvenParity","StickParity","Break","DivisorLatch"],M=["DeltaCTS","DeltaDataSetReady","DeltaRingIndicator","DeltaCarrierDetect","ClearToSend","DataSetReady","RingIndicator","CarrierDetect"];t.prototype.ToBitDescription=function(e,t){e&=255;for(var i=("00000000"+e.toString(2)).substr(-8)+":",s=0;s<t.length;s++)i+=" "+t[s]+":"+(e>>s&1);return i},t.prototype.Reset=function(){this.LCR=3,this.LSR=v|m,this.MSR=x|E|I,this.ints=0,this.IIR=w,this.IER=0,this.DLL=0,this.DLH=0,this.FCR=0,this.MCR=0,this.rxbuf=new Array,this.txbuf=new Array},t.prototype.Step=function(){0!=this.txbuf.length&&(s.Send("tty"+this.id,this.txbuf),this.txbuf=new Array)},t.prototype.ReceiveChar=function(e){e.forEach(function(e){this.rxbuf.push(255&e)}.bind(this)),this.rxbuf.length>0&&(this.LSR|=b,this.ThrowInterrupt(T))},t.prototype.CheckInterrupt=function(){this.ints&1<<T&&this.IER&R?(this.IIR=T,this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<S&&this.IER&k?(this.IIR=S,this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<y&&this.IER&g?(this.IIR=y,
this.intdev.RaiseInterrupt(this.intno)):(this.IIR=w,this.intdev.ClearInterrupt(this.intno))},t.prototype.ThrowInterrupt=function(e){this.ints|=1<<e,this.CheckInterrupt()},t.prototype.ClearInterrupt=function(e){this.ints&=~(1<<e),this.CheckInterrupt()},t.prototype.ReadReg8=function(e){if(this.LCR&D)switch(e){case n:return this.DLL;case o:return this.DLH}switch(e){case r:var t=0;return this.rxbuf.length>0&&(t=this.rxbuf.shift()),0==this.rxbuf.length&&(this.LSR&=~b,this.ClearInterrupt(T)),255&t;case c:return 15&this.IER;case p:var t=this.MSR;return this.MSR&=240,this.verboseuart&&s.Debug("Get UART_MSR "+this.ToBitDescription(t,M)),t;case h:var t=15&this.IIR|192;return this.IIR==S&&this.ClearInterrupt(S),t;case d:return this.LCR;case l:return this.LSR;default:s.Debug("Error in ReadRegister: not supported"),s.Abort()}},t.prototype.WriteReg8=function(e,t){if(t&=255,this.LCR&D)switch(e){case n:return void(this.DLL=t);case o:return void(this.DLH=t)}switch(e){case a:this.LSR&=~v,this.txbuf.push(t),this.LSR|=v|m,this.ThrowInterrupt(S);break;case c:this.IER=15&t,this.CheckInterrupt();break;case u:this.verboseuart&&s.Debug("Set UART_FCR "+this.ToBitDescription(t,C)),this.FCR=201&t,2&this.FCR&&(this.ClearInterrupt(T),this.rxbuf=new Array),4&this.FCR&&(this.txbuf=new Array);break;case d:this.verboseuart&&s.Debug("Set UART_LCR "+this.ToBitDescription(t,j)),3!=(3&this.LCR)&&s.Debug("Warning in UART: Data word length other than 8 bits are not supported"),this.LCR=t;break;case f:this.verboseuart&&s.Debug("Set UART_MCR "+this.ToBitDescription(t,A)),this.MCR=t;break;default:s.Debug("Error in WriteRegister: not supported"),s.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/irq",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.intdev=e,this.regs=new Uint32Array(64),this.Reset()}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=1<<30;t.prototype.Reset=function(){for(var e=0;64>e;e++)this.regs[e]=0},t.prototype.ReadReg32=function(e){return e>>=2,e>64?(s.Debug("IRQDev: Unknown ReadReg32: "+r.ToHex(e)),0):this.regs[e]},t.prototype.WriteReg32=function(e,t){if(e>>=2,e>64)return void s.Debug("IRQDev: unknown  WriteReg32: "+r.ToHex(e)+": "+r.ToHex(t));var i=e>>1;if(1&e)s.Debug("Error in IRQDev: Write STAT of CPU "+i+" : "+r.ToHex(t));else{this.regs[e]=t;var n=65535&t,o=t>>16&16383,c=t>>30&3;if(1&c){if(o==i&&s.Debug("Warning in IRQDev: Try to raise its own IRQ"),this.regs[(o<<1)+1]&a){s.Debug("Warning in IRQDev: CPU "+i+" raised irq on cpu "+o+" without previous acknowledge");var h=new Int32Array(this.intdev.heap);s.Debug("The pc of cpu "+o+" is "+r.ToHex(h[(o<<15)+292>>2])),s.Debug("The IEE flag of cpu "+o+" is "+(4&h[(o<<15)+288>>2])),s.Debug("r9 of cpu "+o+" is "+r.ToHex(h[(o<<15)+36>>2]))}this.regs[(o<<1)+1]=a|(16383&i)<<16|n,this.intdev.RaiseSoftInterrupt(1,o)}2&c&&(this.regs[e+1]&=~a,this.intdev.ClearSoftInterrupt(1,i))}},i.exports=t}()}),define("cjs!jor1k/worker/dev/timer",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(){this.Reset()}var s=e("cjs!../messagehandler");t.prototype.Reset=function(){this.sync=0},t.prototype.ReadReg32=function(e){return this.sync},t.prototype.WriteReg32=function(e,t){s.Debug("Error in Timer: Write reg "+e+" : "+t)},i.exports=t}()}),define("cjs!jor1k/worker/dev/framebuffer",["require","exports","module","cjs!../utils","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.ram=e,this.width=640,this.height=400,this.addr=16e6,this.n=this.width*this.height>>1,this.buffer=new Int32Array(this.n),r.Register("GetFB",this.OnGetFB.bind(this))}var s=e("cjs!../utils"),r=e("cjs!../messagehandler");t.prototype.Reset=function(){},t.prototype.ReadReg32=function(e){return 0},t.prototype.WriteReg32=function(e,t){switch(e){case 20:this.addr=s.Swap32(t);break;default:return}},t.prototype.OnGetFB=function(){r.Send("GetFB",this.GetBuffer())},t.prototype.GetBuffer=function(){var e=0,t=this.buffer.length,i=this.buffer,s=this.ram.int32mem,r=this.addr>>2;for(e=0;t>e;++e)i[e]=s[r+e];return this.buffer},i.exports=t}()}),define("cjs!jor1k/worker/dev/ethmac",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t,i){this.ram=e,this.intdev=t,this.TransmitCallback=function(e){},this.toTxStat=function(e){return{LEN:e>>>16,RD:e>>>15&1,IRQ:e>>>14&1,WR:e>>>13&1,PAD:e>>>12&1,CRC:e>>>11&1,UR:e>>>8&1,RTRY:e>>>4&15,RL:e>>>3&1,LC:e>>>2&1,DF:e>>>1&1,CS:1&e}},this.fromTxStat=function(e){var t=e.LEN<<16;return t|=(1&e.RD)<<15,t|=(1&e.IRQ)<<14,t|=(1&e.WR)<<13,t|=(1&e.PAD)<<12,t|=(1&e.CRC)<<11,t|=(1&e.UR)<<8,t|=(15&e.RTRY)<<4,t|=(1&e.RL)<<3,t|=(1&e.LC)<<2,t|=(1&e.CDF)<<1,t|=1&e.CS},this.toRxStat=function(e){return{LEN:e>>>16,E:e>>>15&1,IRQ:e>>>14&1,WR:e>>>13&1,CF:e>>>8&1,M:e>>>7&1,OR:e>>>6&1,IS:e>>>5&1,DN:e>>>4&1,TL:e>>>3&1,SF:e>>>2&1,CRC:e>>>1&1,LC:1&e}},this.fromRxStat=function(e){var t=e.LEN<<16;return t|=(1&e.E)<<15,t|=(1&e.IRQ)<<14,t|=(1&e.WR)<<13,t|=(1&e.CF)<<8,t|=(1&e.M)<<7,t|=(1&e.OR)<<6,t|=(1&e.IS)<<5,t|=(1&e.DN)<<4,t|=(1&e.TL)<<3,t|=(1&e.SF)<<2,t|=(1&e.CRC)<<1,t|=1&e.LC},this.makeCRCTable=function(){for(var e,t=[],i=0;256>i;i++){e=i;for(var s=0;8>s;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t},this.crcTable=this.makeCRCTable(),this.crc32=function(e,t,i){var s=-1,r=4;e instanceof Uint16Array||e instanceof Int16Array?r=2:(e instanceof Uint8Array||e instanceof Int8Array)&&(r=1),i||(i=e.length),t||(t=0);for(var a=0,n=t;i>n;n++)a=255&e[n],s=s>>>8^this.crcTable[255&(s^a)],r>1&&(a=e[n]>>>8&255,s=s>>>8^this.crcTable[255&(s^a)],r>2&&(a=e[n]>>>16&255,s=s>>>8^this.crcTable[255&(s^a)],a=e[n]>>>24&255,s=s>>>8^this.crcTable[255&(s^a)]));return(-1^s)>>>0},this.Reset=function(){this.MODER=40960,this.INT_SOURCE=0,this.INT_MASK=0,this.IPGT=18,this.IPGR1=12,this.IPGR2=18,this.PACKETLEN=4195840,this.COLLCONF=983103,this.TX_BD_NUM=64,this.CTRLMODER=0,this.MIIMODER=100,this.MIICOMMAND=0,this.MIIADDRESS=0,this.MIITX_DATA=0,this.MIIRX_DATA=34,this.MIISTATUS=0,this.MAC_ADDR0|=Math.floor(256*Math.random())<<24,this.MAC_ADDR0|=Math.floor(256*Math.random())<<16,this.MAC_ADDR0|=Math.floor(256*Math.random())<<8,this.MAC_ADDR0|=Math.floor(256*Math.random()),this.MAC_ADDR1|=Math.floor(256*Math.random())<<8&254|2,this.MAC_ADDR1|=Math.floor(256*Math.random()),this.ETH_HASH0_ADR=0,this.ETH_HASH1_ADR=0,this.ETH_TXCTRL=0,this.BD=new Uint32Array(256);for(var e=0;256>e;e++)this.BD[e]=0;this.MIIregs=new Uint16Array(16),this.MIIregs[E]=256,this.MIIregs[I]=30756,this.MIIregs[A]=8192,this.MIIregs[C]=23696,this.MIIregs[j]=481,this.MIIregs[M]=0,this.currRX=this.TX_BD_NUM<<1},this.Receive=function(t){if(0!=(1&this.MODER)){var i=new Uint8Array(t),s=!1,r=!1,a=!1,n=0,o=0;n|=i[2]<<24,n|=i[3]<<16,n|=i[4]<<8,n|=i[5],o|=i[0]<<8,o|=i[1],n==this.MAC_ADDR0&&o==this.MAC_ADDR1?r=!0:32768&o&&(a=!0),32&this.MODER&&(s=!0);var c=this.currRX;if(s||a||r){var h=!1;if(32768&this.BD[c]){var u=this.toRxStat(this.BD[c]);r||a||!s||(u.M=1),u.DN=0,i.length>(65535&this.PACKETLEN)&&16384&this.MODER?u.TL=1:u.TL=0,0==u.DN&&(u.CRC=0);var d=0;if(d|=i[i.length-4]<<24,d|=i[i.length-3]<<16,d|=i[i.length-2]<<8,d|=i[i.length-1],!h){u.LEN=i.length;u.LEN>(65535&this.PACKETLEN)&&(u.LEN=65535&this.PACKETLEN);for(var f=this.BD[c+1],l=0;l<u.LEN;l++)e.Write8(f+l,i[l]);u.LEN+=4,u.E=0}this.BD[c]=this.fromRxStat(u),u.IRQ&&(h&&(this.INT_SOURCE|=8),this.INT_SOURCE|=4,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4))}else this.INT_SOURCE|=16,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);8192&this.BD[this.currRX]||this.currRX+2>=this.BD.length?this.currRX=this.TX_BD_NUM<<1:this.currRX+=2}}},this.Transmit=function(t){if(0!=(2&this.MODER)){var i=this.toTxStat(this.BD[t<<1]),s=this.BD[(t<<1)+1];if(0!=i.RD){var r=i.LEN,a=!1;i.CRC||8192&this.MODER;var n=!1;(i.PAD||32768&this.MODER)&&(n=!0,this.PACKETLEN>>>16>i.LEN&&(r=this.PACKETLEN>>>16));for(var o=new Uint8Array(r),c=0;c<o.length;c++)c<i.LEN?o[c]=e.Read8(s+c):o[c]=0;if(a){var h=0;h=4096&this.MODER?this.crc32(o,4,o.length-4):this.crc32(o,0,o.length-4),o[o.length-1]=h>>24,o[o.length-2]=h>>16&255,o[o.length-3]=h>>8&255,o[o.length-4]=255&h}this.TransmitCallback(o.buffer),i.UR=0,i.RTRY=0,i.RL=0,i.LC=0,i.DF=0,i.CS=0,i.RD=0,this.BD[t<<1]=this.fromTxStat(i),this.INT_SOURCE|=1,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4)}}},this.ReadReg32=function(e){var t=0;switch(e){case r:t=this.MODER;break;case a:t=this.INT_SOURCE;break;case n:t=this.INT_MASK;break;case o:t=this.IPGT;break;case c:t=this.IPGR1;break;case h:t=this.IPGR2;break;case u:t=this.PACKETLEN;break;case d:t=this.COLLCONF;break;case f:t=this.TX_BD_NUM;break;case l:t=this.CTRLMODER;break;case p:t=this.MIIMODER;break;case b:t=this.MIICOMMAND;break;case m:t=this.MIIADDRESS;break;case v:t=this.MIITX_DATA;break;case g:t=this.MIIRX_DATA;break;case k:t=this.MIISTATUS;break;case R:t=this.MAC_ADDR0;break;case y:t=this.MAC_ADDR1;break;case w:t=this.ETH_HASH0_ADR;break;case S:t=this.ETH_HASH1_ADR;break;case T:t=this.ETH_TXCTRL;break;default:e>=D&&x>=e?t=this.BD[e-D>>>2]:s.Debug("Attempt to access ethmac register beyond 0x800")}return t},this.HandleMIICommand=function(){var e=31&this.MIIADDRESS,t=this.MIIADDRESS>>8&31,i=0;switch(this.MIICOMMAND){case 0:break;case 1:break;case 2:e!=i?this.MIIRX_DATA=65535:this.MIIRX_DATA=this.MIIregs[t];break;case 4:break;default:s.Debug("Error in ethmac: Unknown mii command detected")}},this.WriteReg32=function(e,t){switch(e){case r:this.MODER=t;break;case a:this.INT_SOURCE=this.INT_SOURCE&~t,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);break;case n:this.INT_MASK=t,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);break;case o:this.IPGT=t;break;case c:this.IPGR1=t;break;case h:this.IPGR2=t;break;case u:this.PACKETLEN=t;break;case d:this.COLLCONF=t;break;case f:this.TX_BD_NUM=t,this.currRX=t<<1;break;case l:this.CTRLMODER=t;break;case p:this.MIIMODER=t;break;case b:this.MIICOMMAND=t,this.HandleMIICommand();break;case m:this.MIIADDRESS=t;break;case v:this.MIITX_DATA=t;break;case g:this.MIIRX_DATA=t;break;case k:this.MIISTATUS=t;break;case R:this.MAC_ADDR0=t;break;case y:this.MAC_ADDR1=t;break;case w:this.ETH_HASH0_ADR=t;break;case S:this.ETH_HASH1_ADR=t;break;case T:this.ETH_TXCTRL=t;break;default:if(e>=D&&x>=e){this.BD[e-D>>>2]=t;var i=e-D>>>3;(i<<3)+D==e&&0!=(32768&t)&&i<this.TX_BD_NUM&&this.Transmit(i)}else s.Debug("Attempt to access ethmac register beyond 0x800")}},this.Reset(),s.Register("ethmac",this.Receive.bind(this))}var s=e("cjs!../messagehandler"),r=(e("cjs!../utils"),0),a=4,n=8,o=12,c=16,h=20,u=24,d=28,f=32,l=36,p=40,b=44,m=48,v=52,g=56,k=60,R=64,y=68,w=72,S=76,T=80,D=1024,x=2047,E=0,I=1,A=2,C=3,j=4,M=25;i.exports=t}()}),define("cjs!jor1k/worker/dev/ata",["require","exports","module","cjs!../utils","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.intdev=e;var t=new ArrayBuffer(512);this.identifybuffer=new Uint16Array(t),this.Reset();var t=new ArrayBuffer(65536);this.SetBuffer(t)}var s=e("cjs!../utils"),r=e("cjs!../messagehandler"),a=4,n=8,o=12,c=16,h=20,u=24,d=28,f=a,l=d,p=4,b=2,m=128,v=64,g=16,k=8;t.prototype.Reset=function(){this.DCR=8,this.DR=160,this.SCR=1,this.SNR=1,this.SR=v,this.FR=0,this.ER=1,this.CR=0,this.lcyl=0,this.hcyl=0,this.select=160,this.driveselected=!0,this.readbuffer=this.identifybuffer,this.readbufferindex=0,this.readbuffermax=256},t.prototype.SetBuffer=function(e){this.diskbuffer=new Uint16Array(e),this.heads=16,this.sectors=64,this.cylinders=e.byteLength/(this.heads*this.sectors*512),this.nsectors=this.heads*this.sectors*this.cylinders,this.BuildIdentifyBuffer(this.identifybuffer)},t.prototype.BuildIdentifyBuffer=function(e){for(var t=0;256>t;t++)e[t]=0;e[0]=64,e[1]=this.cylinders,e[3]=this.heads,e[4]=512*this.sectors,e[5]=512,e[6]=this.sectors,e[20]=3,e[21]=512,e[22]=4,e[27]=27247,e[28]=29233,e[29]=27437,e[30]=25705,e[31]=29547;for(var t=32;46>=t;t++)e[t]=8224;e[47]=32896,e[48]=0,e[49]=512,e[51]=512,e[52]=512,e[54]=this.cylinders,e[55]=this.heads,e[56]=this.sectors,e[57]=this.nsectors>>0&65535,e[58]=this.nsectors>>16&65535,e[59]=0,e[60]=this.nsectors>>0&65535,e[61]=this.nsectors>>16&65535,e[80]=6,e[82]=16384,e[83]=16384,e[84]=16384,e[85]=16384,e[86]=0,e[87]=16384},t.prototype.ReadReg8=function(e){if(!this.driveselected)return 255;switch(e){case a:return this.ER;case n:return this.SNR;case o:return this.SCR;case c:return this.lcyl;case h:return this.hcyl;case u:return this.DR;case d:return this.intdev.ClearInterrupt(15),this.SR;case 256:return this.SR;default:r.Debug("ATADev: Error in ReadRegister8: register "+s.ToHex(e)+" not supported"),r.Abort()}return 0},t.prototype.GetSector=function(){return 64&this.DR||(r.Debug("ATADev: CHS mode not supported"),r.Abort()),(15&this.DR)<<24|this.hcyl<<16|this.lcyl<<8|this.SCR},t.prototype.SetSector=function(e){64&this.DR||(r.Debug("ATADev: CHS mode not supported"),r.Abort()),this.SCR=255&e,this.lcyl=e>>8&255,this.hcyl=e>>16&255,this.DR=240&this.DR|e>>24&15},t.prototype.ExecuteCommand=function(){switch(this.CR){case 236:this.readbuffer=this.identifybuffer,this.readbufferindex=0,this.readbuffermax=256,this.SR=v|g|k,this.DCR&b||this.intdev.RaiseInterrupt(15);break;case 145:this.SR=v|g,this.ER=0,this.DCR&b||this.intdev.RaiseInterrupt(15);break;case 32:case 48:var e=this.GetSector();0==this.SNR&&(this.SNR=256),this.readbuffer=this.diskbuffer,this.readbufferindex=256*e,this.readbuffermax=this.readbufferindex+256,this.SR=v|g|k,this.ER=0,32==this.CR&&(this.DCR&b||this.intdev.RaiseInterrupt(15));break;case 196:case 197:var e=this.GetSector();0==this.SNR&&(this.SNR=256),this.readbuffer=this.diskbuffer,this.readbufferindex=256*e,this.readbuffermax=this.readbufferindex+256*this.SNR,this.SR=v|g|k,this.ER=0,196==this.CR&&(this.DCR&b||this.intdev.RaiseInterrupt(15));break;default:r.Debug("ATADev: Command "+s.ToHex(this.CR)+" not supported"),r.Abort()}},t.prototype.WriteReg8=function(e,t){if(e==u)return this.DR=t,void(this.driveselected=t>>4&1?!1:!0);if(256==e)return!(t&p)&&this.DCR&p?(this.DR&=240,this.SR=v|g,this.SCR=1,this.SNR=1,this.lcyl=0,this.hcyl=0,this.ER=1,this.CR=0):t&p&&!(this.DCR&p)&&(this.ER=1,this.SR=m|g),void(this.DCR=t);if(this.driveselected)switch(e){case f:this.FR=t;break;case n:this.SNR=t;break;case o:this.SCR=t;break;case c:this.lcyl=t;break;case h:this.hcyl=t;break;case l:this.CR=t,this.ExecuteCommand();break;default:r.Debug("ATADev: Error in WriteRegister8: register "+s.ToHex(e)+" not supported (value: "+s.ToHex(t)+")"),r.Abort()}},t.prototype.ReadReg16=function(e){0!=e&&(r.Debug("ATADev: Error in ReadRegister16: register "+s.ToHex(e)+" not supported"),r.Abort());var t=s.Swap16(this.readbuffer[this.readbufferindex]);return this.readbufferindex++,this.readbufferindex>=this.readbuffermax&&(this.SR=v|g,32==this.CR&&this.SNR>1&&(this.SNR--,this.SetSector(this.GetSector()+1),this.readbuffermax+=256,this.SR=v|g|k,this.DCR&b||this.intdev.RaiseInterrupt(15))),t},t.prototype.WriteReg16=function(e,t){0!=e&&(r.Debug("ATADev: Error in WriteRegister16: register "+s.ToHex(e)+" not supported"),r.Abort()),this.readbuffer[this.readbufferindex]=s.Swap16(t),this.readbufferindex++,this.readbufferindex>=this.readbuffermax&&(this.SR=v|g,this.DCR&b||this.intdev.RaiseInterrupt(15),48==this.CR&&this.SNR>1&&(this.SNR--,this.SetSector(this.GetSector()+1),this.readbuffermax+=256,this.SR=v|g|k))},t.prototype.ReadReg32=function(e){r.Debug("ATADev: Error in ReadRegister32: register "+s.ToHex(e)+" not supported"),this.mesage.Abort()},t.prototype.WriteReg32=function(e,t){r.Debug("ATADev: Error in WriteRegister32: register "+s.ToHex(e)+" not supported"),r.Abort()},i.exports=t}()}),define("cjs!jor1k/worker/dev/rtc",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.intdev=e,this.Reset()}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=0,n=8,o=16,c=20,h=24;t.prototype.Reset=function(){this.ctrl=0},t.prototype.ReadReg32=function(e){switch(e){case a:return Math.floor((new Date).getTime()/1e3);case o:return this.ctrl;case h:return 3049340711;case n:return 0;case c:return 0;default:return s.Debug("RTC: unknown ReadReg32: "+r.ToHex(e)),0}return 0},t.prototype.WriteReg32=function(e,t){switch(e){case o:this.ctrl=t;break;default:return void s.Debug("RTC: unknown  WriteReg32: "+r.ToHex(e)+": "+r.ToHex(t))}},i.exports=t}()}),define("cjs!jor1k/worker/dev/touchscreen",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.intdev=e,this.Reset(),s.Register("tsmousedown",this.onmousedown.bind(this)),s.Register("tsmouseup",this.onmouseup.bind(this)),s.Register("tsmousemove",this.onmousemove.bind(this))}var s=e("cjs!../messagehandler"),r=(e("cjs!../utils"),0),a=4,n=8,o=12,c=16,h=20,u=24,d=28,f=32,l=36,p=40,b=44,m=48,v=52,g=56,k=60,R=1,y=128,w=1<<31;t.prototype.Reset=function(){this.control=0,this.status=y,this.ispressed=!1,this.mousemovecount=0,this.fifo=0,this.fifosize=0},t.prototype.onmousedown=function(e){if(this.control&R){var t=e.x,i=e.y;this.status&=~y,this.fifosize=4,this.fifo=0,this.fifo|=(1023-t&1023)<<16,this.fifo|=1023-i&1023,this.ispressed=!0,this.intdev.RaiseInterrupt(9)}},t.prototype.onmousemove=function(e){if(this.control&R&&this.ispressed&&(this.mousemovecount++,!(3&this.mousemovecount))){var t=e.x,i=e.y;this.status&=~y,this.fifosize=4,this.fifo=0,this.fifo|=(1023-t&1023)<<16,this.fifo|=1023-i&1023,this.intdev.RaiseInterrupt(9)}},t.prototype.onmouseup=function(e){if(this.control&R){e.x,e.y;this.status&=~y,this.fifosize=0,this.fifo=w,this.ispressed=!1,this.intdev.RaiseInterrupt(9)}},t.prototype.ReadReg32=function(e){switch(e){case n:return this.control;case r:return this.intdev.ClearInterrupt(9),this.status;case o:return this.fifosize<=0&&(this.status|=y),this.fifosize--,this.fifo}return 0},t.prototype.WriteReg32=function(e,t){switch(e){case n:return void(this.control=t);case a:case l:case p:case b:case m:case v:case g:case k:case h:case c:case d:case f:case u:return}},i.exports=t}()}),define("cjs!jor1k/worker/dev/keyboard",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.intdev=e,s.Register("keydown",this.OnKeyDown.bind(this)),s.Register("keyup",this.OnKeyUp.bind(this)),this.Reset()}var s=e("cjs!../messagehandler"),r=[0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,119,58,0,0,0,0,0,0,1,0,0,0,0,57,104,109,107,102,105,103,106,108,0,0,0,0,110,111,0,11,2,3,4,5,6,7,8,9,10,0,39,,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,0,0,0,0,0,82,79,80,81,75,76,77,71,72,73,55,77,0,12,83,181,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,0,0,0,0,0,0];t.prototype.Reset=function(){this.key=0,this.fifo=[]},t.prototype.OnKeyDown=function(e){this.key=0|r[e.keyCode],0!=this.key&&(this.fifo.push(this.key),this.intdev.RaiseInterrupt(5))},t.prototype.OnKeyUp=function(e){this.key=r[e.keyCode],0!=this.key&&(this.key=128|this.key,this.fifo.push(this.key),this.intdev.RaiseInterrupt(5))},t.prototype.ReadReg8=function(e){var t=this.fifo.shift();return 0==this.fifo.length&&this.intdev.ClearInterrupt(5),t},i.exports=t}()}),define("cjs!jor1k/worker/dev/sound",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t){s.Debug("Start sound"),this.intdev=e,this.ramdev=t,this.Reset()}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=0,n=4,o=8,c=12,h=16,u=20,d=24,f=28;t.prototype.Reset=function(){this.addr=0,this.status=0,this.periods=0,this.period_size=0,this.rate=22050,this.channels=1,this.offset=0,this.playing=!1,this.nextperiod=0,this.starttime=0,this.lasttotalframe=0},t.prototype.GetTimeToNextInterrupt=function(){return this.playing?1e3*this.nextperiod/this.rate:-1},t.prototype.Progress=function(){},t.prototype.Elapsed=function(){var e=new Int8Array(this.period_size),t=this.periods*this.period_size;if(1==this.format)for(var i=0;i<this.period_size;i++)e[i]=this.ramdev.uint8mem[this.addr+(this.offset++<<0^3)]-128,this.offset==t&&(this.offset=0);else for(var i=0;i<this.period_size;i++)e[i]=this.ramdev.sint8mem[this.addr+1+(this.offset++<<1^3)],this.offset==t&&(this.offset=0);s.Send("sound",e)},t.prototype.ReadReg32=function(e){switch(e){case a:return this.intdev.ClearInterrupt(7),this.Elapsed(),this.playing?1:0;case h:return this.offset;default:return s.Debug("Sound: unknown ReadReg32: "+r.ToHex(e)),0}return 0},t.prototype.WriteReg32=function(e,t){switch(e){case a:this.playing=t?!0:!1,this.nextperiod=this.period_size,this.starttime=r.GetMilliseconds(),this.lasttotalframe=0,this.offset=0,s.Send("sound.rate",this.rate),this.Elapsed();break;case n:this.addr=t;break;case o:this.periods=t;break;case c:this.period_size=t;break;case u:this.rate=t;break;case d:this.channels=t;break;case f:this.format=t;break;default:return void s.Debug("sound: unknown  WriteReg32: "+r.ToHex(e)+": "+r.ToHex(t))}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio",["require","exports","module","cjs!../utils","cjs!./virtio/marshall","cjs!../messagehandler"],function(e,t,i){!function(){function t(e,t,i,s){for(var r=0;s>r;r++)t[r]=e.Read8(i+r)}function s(e,t,i,s){this.dev=s,this.dev.SendReply=this.SendReply.bind(this),this.intdev=e,this.intno=t,this.ramdev=i,this.queuenum=new Uint32Array(16),this.queueready=new Uint32Array(16),this.queuepfn=new Uint32Array(16),this.descaddr=new Uint32Array(16),this.usedaddr=new Uint32Array(16),this.availaddr=new Uint32Array(16),this.lastavailidx=new Uint32Array(16),this.version=2,this.Reset()}var r=e("cjs!../utils"),a=e("cjs!./virtio/marshall"),n=e("cjs!../messagehandler"),o=0,c=4,h=8,u=12,d=16,f=20,l=32,p=36,b=40,m=48,v=52,g=56,k=60,R=64,y=68,w=80,S=96,T=100,D=112,x=128,E=132,I=144,A=148,C=160,j=164,M=252,_=2,H=4;s.prototype.Reset=function(){this.status=0,this.intstatus=0,this.pagesize=8192,this.align=8192,this.availidx=0,this.hostfeaturewordselect=0,this.queuesel=0;for(var e=0;16>e;e++)this.queueready[e]=0,this.queuenum[e]=16,this.queuepfn[e]=0,this.descaddr[e]=0,this.usedaddr[e]=0,this.availaddr[e]=0,this.lastavailidx[e]=0},s.prototype.UpdateAddr=function(){if(1==this.version){var e=this.queuesel;if(this.descaddr[e]=this.queuepfn[e]*this.pagesize,this.availaddr[e]=this.descaddr[e]+16*this.queuenum[e],this.usedaddr[e]=this.availaddr[e]+2+2+2*this.queuenum[e]+2,this.usedaddr[e]&this.align-1){var t=~(this.align-1);this.usedaddr[e]=(this.usedaddr[e]&t)+this.align}this.lastavailidx[e]=this.ramdev.Read16Little(this.availaddr[e]+2)}},s.prototype.ReadReg8=function(e){return this.dev.configspace[e-256]},s.prototype.ReadReg16=function(e){return"little"==this.ramdev.nativeendian?this.dev.configspace[e-256+1]<<8|this.dev.configspace[e-256]:this.dev.configspace[e-256]<<8|this.dev.configspace[e-256+1]},s.prototype.WriteReg8=function(e,t){this.dev.WriteConfig(e-256,t)},s.prototype.ReadReg32=function(e){var t=0;if(e>=256)return this.dev.configspace[e-256+0]<<24|this.dev.configspace[e-256+1]<<16|this.dev.configspace[e-256+2]<<8|this.dev.configspace[e-256+3]<<0;switch(e){case o:t=1953655158;break;case c:t=this.version;break;case h:t=this.dev.deviceid;break;case u:t=4294967295;break;case d:t=0,0==this.hostfeaturewordselect?t=this.dev.hostfeature:1==this.hostfeaturewordselect&&(t=1);break;case v:t=this.queuenum[this.queuesel];break;case R:t=this.queuepfn[this.queuesel];break;case y:t=this.queueready[this.queuesel];break;case S:t=this.intstatus;break;case D:t=this.status;break;case M:t=0;break;default:n.Debug("Error in VirtIODev: Attempt to read register "+r.ToHex(e)),n.Abort()}return"little"==this.ramdev.nativeendian?t:r.Swap32(t)},s.prototype.GetDescriptor=function(e,i){var s=this.descaddr[e]+16*i,r=new Uint8Array(16);t(this.ramdev,r,s,16);var n=a.Unmarshall(["d","w","h","h"],r,0);return{addr:n[0],len:n[1],flags:n[2],next:n[3]}},s.prototype.ConsumeDescriptor=function(e,t,i){var s=this.usedaddr[e]+2,r=this.ramdev.Read16Little(s);this.ramdev.Write16Little(s,r+1);var a=this.usedaddr[e]+4+8*(r&this.queuenum[e]-1);this.ramdev.Write32Little(a+0,t),this.ramdev.Write32Little(a+4,i)},s.prototype.SendReply=function(e,t){this.ConsumeDescriptor(e,t,this.dev.replybuffersize);this.ramdev.Read16Little(this.availaddr[e]);if(0==this.dev.replybuffersize)return this.intstatus=1,void this.intdev.RaiseInterrupt(this.intno);for(var i=this.GetDescriptor(e,t);0==(i.flags&_);)1&i.flags?i=this.GetDescriptor(e,i.next):(n.Debug("Error in virtiodev: Descriptor is not continuing"),n.Abort());0==(i.flags&_)&&(n.Debug("Error in virtiodev: Descriptor is not allowed to write"),n.Abort());for(var s=0,r=0;r<this.dev.replybuffersize;r++)s>=i.len&&(i=this.GetDescriptor(0,i.next),s=0,0==(i.flags&_)&&(n.Debug("Error in virtiodev: Descriptor is not allowed to write"),n.Abort())),this.ramdev.Write8(i.addr+s,this.dev.replybuffer[r]),s++;this.intstatus=1,this.intdev.RaiseInterrupt(this.intno)},s.prototype.GetDescriptorBufferSize=function(e,t){for(var i=0,s=0,r=this.GetDescriptor(e,t);r.flags&H&&(n.Debug("Error in VirtIO: Indirect descriptors not supported"),n.Abort()),r.flags&_?i+=r.len:s+=r.len,0!=(1&r.flags);)var r=this.GetDescriptor(e,r.next);return{write:i,read:s}},s.prototype.WriteReg32=function(e,t){switch("big"==this.ramdev.nativeendian&&(t=r.Swap32(t)),e){case b:this.pagesize=t,this.UpdateAddr();break;case f:this.hostfeaturewordselect=t;break;case p:break;case l:break;case m:this.queuesel=t;break;case g:this.queuenum[this.queuesel]=t,this.UpdateAddr();break;case k:this.align=t,this.pagesize=t,this.UpdateAddr();break;case R:this.queuepfn[this.queuesel]=t,this.UpdateAddr();break;case w:for(var i=t,s=this.ramdev.Read16Little(this.availaddr[i]+2);this.lastavailidx[i]!=s;){var a=this.lastavailidx[i]&this.queuenum[i]-1,o=this.ramdev.Read16Little(this.availaddr[t]+4+2*a),c=this.GetDescriptorBufferSize(i,o),h=0,u=this.GetDescriptor(i,o),d=function(e,t,i){return function(){t>=i.len&&(t=0,1&i.flags?i=this.GetDescriptor(e,i.next):(n.Debug("Error in virtiodev: Descriptor is not continuing"),n.Abort()));var s=this.ramdev.Read8(i.addr+t);return t++,s}.bind(this)}.bind(this)(i,h,u);this.dev.ReceiveRequest(i,o,d,c),this.lastavailidx[i]++,this.lastavailidx[i]&=65535}break;case y:this.queueready[this.queuesel]=t;break;case T:this.intstatus&=~t,this.intdev.ClearInterrupt(this.intno);break;case D:switch(this.status=t,this.status){case 0:this.intdev.ClearInterrupt(this.intno),this.intstatus=0,this.Reset();break;case 1:break;case 3:break;case 7:break;case 11:break;case 15:break;case 131:n.Debug("Error: virtio device initialization failed with status "+this.status),n.Abort();case 139:n.Debug("Error: virtio device initialization failed with status "+this.status),n.Abort();break;default:n.Debug("Error in virtio status register: Unknown status "+this.status),n.Abort()}break;case x:this.descaddr[this.queuesel]=t;break;case E:break;case I:this.availaddr[this.queuesel]=t,this.lastavailidx[this.queuesel]=this.ramdev.Read16Little(this.availaddr[this.queuesel]+2);break;case A:break;case C:this.usedaddr[this.queuesel]=t;break;case j:break;default:n.Debug("Error in VirtIODev: Attempt to write register "+r.ToHex(e)+":"+r.ToHex(t)),n.Abort()}},i.exports=s}()}),define("cjs!jor1k/worker/dev/virtio/9p",["require","exports","module","cjs!./marshall","cjs!../../messagehandler","cjs!../../utils"],function(e,t,i){!function(){function t(e,t){this.fs=t,this.SendReply=function(){},this.deviceid=9,this.hostfeature=1,this.configspace=[9,0,47,100,101,118,47,114,111,111,116],this.VERSION="9P2000.L",this.BLOCKSIZE=8192,this.msize=8192,this.replybuffer=new Uint8Array(2*this.msize),this.replybuffersize=0,this.Reset()}var s=e("cjs!./marshall"),r=e("cjs!../../messagehandler"),a=(e("cjs!../../utils"),16384),n=2,o=39,c=1,h=2,u=4,d=8,f=16,l=32,p=64,b=128,m=256,v=-1,g=1,k=2;t.prototype.Createfid=function(e,t,i){return{inodeid:e,type:t,uid:i}},t.prototype.Reset=function(){this.fids=[]},t.prototype.BuildReply=function(e,t,i){s.Marshall(["w","b","h"],[i+7,e+1,t],this.replybuffer,0),i+7>=this.replybuffer.length&&r.Debug("Error in 9p: payloadsize exceeds maximum length"),this.replybuffersize=i+7},t.prototype.SendError=function(e,t,i){var r=s.Marshall(["w"],[i],this.replybuffer,7);this.BuildReply(6,e,r)},t.prototype.ReceiveRequest=function(e,t,i){var R=s.Unmarshall2(["w","b","h"],i),y=R[0],w=R[1],S=R[2];switch(w){case 8:var y=this.fs.GetTotalSize(),T=[];T[0]=16914839,T[1]=this.BLOCKSIZE,T[2]=Math.floor(1073741824/T[1]),T[3]=T[2]-Math.floor(y/T[1]),T[4]=T[2]-Math.floor(y/T[1]),T[5]=this.fs.inodes.length,T[6]=1048576,T[7]=0,T[8]=256;var y=s.Marshall(["w","w","d","d","d","d","d","d","w"],T,this.replybuffer,7);this.BuildReply(w,S,y),this.SendReply(0,t);break;case 112:case 12:var T=s.Unmarshall2(["w","w"],i),D=T[0],x=T[1],E=this.fids[D].inodeid,I=this.fs.GetInode(E),A=this.fs.OpenInode(E,x),C=function(e,t,i,r){return function(){var a=this.fs.GetInode(e);T[0]=a.qid,T[1]=this.msize-24,s.Marshall(["Q","w"],T,this.replybuffer,7),this.BuildReply(t,i,17),this.SendReply(0,r)}.bind(this)}.bind(this)(E,w,S,t);this.fs.AddEvent(E,C);break;case 70:var T=s.Unmarshall2(["w","w","s"],i),j=T[0],D=T[1],M=T[2],I=this.fs.CreateInode(),_=this.fs.GetInode(this.fids[D].inodeid);I.mode=_.mode,I.size=_.size,I.symlink=_.symlink,I.data=new Uint8Array(I.size);for(var H=0;H<I.size;H++)I.data[H]=this.fs.ReadByte(_,H);I.name=M,I.parentid=this.fids[j].inodeid,this.fs.PushInode(I),this.BuildReply(w,S,0),this.SendReply(0,t);break;case 16:var T=s.Unmarshall2(["w","s","s","w"],i),D=T[0],M=T[1],q=T[2],L=T[3],E=this.fs.CreateSymlink(M,this.fids[D].inodeid,q),I=this.fs.GetInode(E);I.uid=this.fids[D].uid,I.gid=L,s.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(w,S,13),this.SendReply(0,t);break;case 18:var T=s.Unmarshall2(["w","s","w","w","w","w"],i),D=T[0],M=T[1],x=T[2],U=T[3],P=T[4],L=T[5],E=this.fs.CreateNode(M,this.fids[D].inodeid,U,P),I=this.fs.GetInode(E);I.mode=x,I.uid=this.fids[D].uid,I.gid=L,s.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(w,S,13),this.SendReply(0,t);break;case 22:var T=s.Unmarshall2(["w"],i),D=T[0],I=this.fs.GetInode(this.fids[D].inodeid),y=s.Marshall(["s"],[I.symlink],this.replybuffer,7);this.BuildReply(w,S,y),this.SendReply(0,t);break;case 72:var T=s.Unmarshall2(["w","s","w","w"],i),D=T[0],M=T[1],x=T[2],L=T[3],E=this.fs.CreateDirectory(M,this.fids[D].inodeid),I=this.fs.GetInode(E);I.mode=x|a,I.uid=this.fids[D].uid,I.gid=L,s.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(w,S,13),this.SendReply(0,t);break;case 14:var T=s.Unmarshall2(["w","s","w","w","w"],i),D=T[0],M=T[1],x=(T[2],T[3]),L=T[4],E=this.fs.CreateFile(M,this.fids[D].inodeid);this.fids[D].inodeid=E,this.fids[D].type=g;var I=this.fs.GetInode(E);I.uid=this.fids[D].uid,I.gid=L,I.mode=x,s.Marshall(["Q","w"],[I.qid,this.msize-24],this.replybuffer,7),this.BuildReply(w,S,17),this.SendReply(0,t);break;case 52:s.Marshall(["w"],[0],this.replybuffer,7),this.BuildReply(w,S,1),this.SendReply(0,t);break;case 24:var T=s.Unmarshall2(["w","d"],i),D=T[0],I=this.fs.GetInode(this.fids[D].inodeid);T[0]|=4096,T[0]=T[1],T[1]=I.qid,T[2]=I.mode,T[3]=I.uid,T[4]=I.gid,T[5]=1,T[6]=I.major<<8|I.minor,T[7]=I.size,T[8]=this.BLOCKSIZE,T[9]=Math.floor(I.size/512+1),T[10]=I.atime,T[11]=0,T[12]=I.mtime,T[13]=0,T[14]=I.ctime,T[15]=0,T[16]=0,T[17]=0,T[18]=0,T[19]=0,s.Marshall(["d","Q","w","w","w","d","d","d","d","d","d","d","d","d","d","d","d","d","d","d"],T,this.replybuffer,7),this.BuildReply(w,S,153),this.SendReply(0,t);break;case 26:var T=s.Unmarshall2(["w","w","w","w","w","d","d","d","d","d"],i),D=T[0],I=this.fs.GetInode(this.fids[D].inodeid);T[1]&c&&(I.mode=T[2]),T[1]&h&&(I.uid=T[3]),T[1]&u&&(I.gid=T[4]),T[1]&b&&(I.atime=T[6]),T[1]&m&&(I.atime=T[8]),T[1]&f&&(I.atime=Math.floor((new Date).getTime()/1e3)),T[1]&l&&(I.mtime=Math.floor((new Date).getTime()/1e3)),
T[1]&p&&(I.ctime=Math.floor((new Date).getTime()/1e3)),T[1]&d&&this.fs.ChangeSize(this.fids[D].inodeid,T[5]),this.BuildReply(w,S,0),this.SendReply(0,t);break;case 50:var T=s.Unmarshall2(["w","d"],i),D=T[0];this.BuildReply(w,S,0),this.SendReply(0,t);break;case 40:case 116:var T=s.Unmarshall2(["w","d","w"],i),D=T[0],W=T[1],B=T[2],I=this.fs.GetInode(this.fids[D].inodeid);if(this.fids[D].type==k){I.caps.length<W+B&&(B=I.caps.length-W);for(var H=0;B>H;H++)this.replybuffer[11+H]=I.caps[W+H]}else{I.size<W+B&&(B=I.size-W);for(var H=0;B>H;H++)this.replybuffer[11+H]=this.fs.ReadByte(I,W+H)}s.Marshall(["w"],[B],this.replybuffer,7),this.BuildReply(w,S,4+B),this.SendReply(0,t);break;case 118:var T=s.Unmarshall2(["w","d","w"],i),D=T[0],W=T[1],B=T[2];this.fs.Write(this.fids[D].inodeid,W,B,i),s.Marshall(["w"],[B],this.replybuffer,7),this.BuildReply(w,S,4),this.SendReply(0,t);break;case 74:var T=s.Unmarshall2(["w","s","w","s"],i),F=T[0],z=T[1],O=T[2],G=T[3],A=this.fs.Rename(this.fids[F].inodeid,z,this.fids[O].inodeid,G);if(0==A){this.SendError(S,"No such file or directory",n),this.SendReply(0,t);break}this.BuildReply(w,S,0),this.SendReply(0,t);break;case 76:var T=s.Unmarshall2(["w","s","w"],i),N=T[0],M=T[1],w=(T[2],this.fs.Search(this.fids[N].inodeid,M));if(-1==w){this.SendError(S,"No such file or directory",n),this.SendReply(0,t);break}var A=this.fs.Unlink(w);if(!A){this.SendError(S,"Directory not empty",o),this.SendReply(0,t);break}this.BuildReply(w,S,0),this.SendReply(0,t);break;case 100:var V=s.Unmarshall2(["w","s"],i);this.msize=V[0];var y=s.Marshall(["w","s"],[this.msize,this.VERSION],this.replybuffer,7);this.BuildReply(w,S,y),this.SendReply(0,t);break;case 104:var T=s.Unmarshall2(["w","w","s","s","w"],i),D=T[0],X=T[4];this.fids[D]=this.Createfid(0,g,X);var I=this.fs.GetInode(this.fids[D].inodeid);s.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(w,S,13),this.SendReply(0,t);break;case 108:var T=s.Unmarshall2(["h"],i);T[0];this.BuildReply(w,S,0),this.SendReply(0,t);break;case 110:var T=s.Unmarshall2(["w","w","h"],i),D=T[0],Q=T[1],K=T[2];if(0==K){this.fids[Q]=this.Createfid(this.fids[D].inodeid,g,this.fids[D].uid),this.fids[Q].inodeid=this.fids[D].inodeid,s.Marshall(["h"],[0],this.replybuffer,7),this.BuildReply(w,S,2),this.SendReply(0,t);break}for(var Y=[],H=0;K>H;H++)Y.push("s");for(var J=s.Unmarshall2(Y,i),E=this.fids[D].inodeid,W=9,Z=0,H=0;K>H&&(E=this.fs.Search(E,J[H]),-1!=E);H++)W+=s.Marshall(["Q"],[this.fs.inodes[E].qid],this.replybuffer,W),Z++,this.fids[Q]=this.Createfid(E,g,this.fids[D].uid);s.Marshall(["h"],[Z],this.replybuffer,7),this.BuildReply(w,S,W-7),this.SendReply(0,t);break;case 120:var T=s.Unmarshall2(["w"],i);this.fids[T[0]]&&this.fids[T[0]].inodeid>=0&&(this.fs.CloseInode(this.fids[T[0]].inodeid),this.fids[T[0]].inodeid=-1,this.fids[T[0]].type=v),this.BuildReply(w,S,0),this.SendReply(0,t);break;case 30:var T=s.Unmarshall2(["w","w","s"],i),D=T[0],$=T[1],M=T[2];this.fids[$]=this.Createfid(this.fids[D].inodeid,v,this.fids[D].uid);var ee=0;"security.capability"==M&&(ee=this.fs.PrepareCAPs(this.fids[D].inodeid),this.fids[$].type=k),s.Marshall(["d"],[ee],this.replybuffer,7),this.BuildReply(w,S,8),this.SendReply(0,t);break;default:r.Debug("Error in Virtio9p: Unknown id "+w+" received"),r.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/dummy",["require","exports","module","cjs!../../messagehandler","cjs!../../utils"],function(e,t,i){!function(){function t(e){this.configspace=[0],this.deviceid=0,this.hostfeature=0,this.Reset()}e("cjs!../../messagehandler"),e("cjs!../../utils");t.prototype.Reset=function(){},t.prototype.ReceiveRequest=function(e,t){},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/input",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=new Uint8Array(256),this.deviceid=18,this.hostfeature=0,s.Register("virtio.kbd.keydown",this.OnKeyDown.bind(this)),s.Register("virtio.kbd.keyup",this.OnKeyUp.bind(this)),this.replybuffersize=8,this.replybuffer=new Uint8Array(8),this.Reset()}var s=e("cjs!../../messagehandler"),r=(e("cjs!../../utils"),e("cjs!./marshall")),a=0,n=1,o=2,c=3,h=16,u=17,d=18,f=1,l=20;t.prototype.Reset=function(){this.receivebufferdesc=new Array},t.prototype.OnKeyDown=function(e){if(0!=this.receivebufferdesc.length){var t=this.receivebufferdesc[0];this.receivebufferdesc.shift(),this.replybuffersize=8,r.Marshall(["h","h","w"],[f,e.keyCode,1],this.replybuffer,0),this.SendReply(0,t.idx)}},t.prototype.OnKeyUp=function(e){if(0!=this.receivebufferdesc.length){var t=this.receivebufferdesc[0];this.receivebufferdesc.shift(),this.replybuffersize=8,r.Marshall(["h","h","w"],[f,e.keyCode,0],this.replybuffer,0),this.SendReply(0,t.idx)}},t.prototype.WriteConfig=function(e,t){if(this.configspace[e]=t,1==e)switch(this.configspace[0]){case a:break;case n:this.configspace[2]=5,this.configspace[8]=86,this.configspace[9]=75,this.configspace[10]=66,this.configspace[11]=68,this.configspace[12]=0;break;case o:this.configspace[2]=0,this.configspace[8]=0;break;case c:this.configspace[2]=0;break;case h:this.configspace[2]=0;break;case u:switch(this.configspace[1]){case l:this.configspace[2]=0;break;case f:this.configspace[2]=16,this.configspace[8]=255,this.configspace[9]=255,this.configspace[10]=255,this.configspace[11]=255,this.configspace[12]=255,this.configspace[13]=255,this.configspace[14]=255,this.configspace[15]=255,this.configspace[16]=255,this.configspace[17]=255,this.configspace[18]=255,this.configspace[19]=255,this.configspace[20]=255,this.configspace[21]=255,this.configspace[22]=255,this.configspace[22]=255;break;default:this.configspace[2]=0}break;case d:this.configspace[2]=0,s.Debug("Virtioinput: abs_info not implemented"),s.Abort();break;default:s.Debug("Error in virtio input: Unknown config"),s.Abort()}},t.prototype.ReceiveRequest=function(e,t,i,r){if(e>=1&&(s.Debug("Error in Virtio input: Unsupported queue index"),s.Abort()),0==e){for(var a=0;a<this.receivebufferdesc.length;a++)if(this.receivebufferdesc[a].idx==t)return;return void this.receivebufferdesc.push({idx:t,size:r})}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/net",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=[0,0,0,0,0,0],this.deviceid=1,this.hostfeature=32,this.replybuffer=new Uint8Array(65550),this.replybuffersize=0;for(var t=1;6>t;t++)this.configspace[t]=Math.floor(256*Math.random());s.Register("virtio.net.transfer",this.Receive.bind(this)),this.Reset()}var s=e("cjs!../../messagehandler"),r=(e("cjs!../../utils"),e("cjs!./marshall"));t.prototype.Reset=function(){this.receivebufferdesc=new Array,this.receivebuffer=new Array},t.prototype.Receive=function(e){this.receivebuffer.push(e),this.HandleReceive()},t.prototype.HandleReceive=function(){if(0!=this.receivebuffer.length&&0!=this.receivebufferdesc.length){var e=new Uint8Array(this.receivebuffer[0]),t=this.receivebufferdesc[0];e.length>t.size.write&&(s.Debug("Error in VirtioNET: Received packet is larger than the next receive buffer"),s.Abort()),this.receivebuffer.shift(),this.receivebufferdesc.shift(),this.replybuffersize=e.length+12,r.Marshall(["b","b","h","h","h","h","h"],[0,0,0,0,0,0,0],this.replybuffer,0);for(var i=0;i<e.length;i++)this.replybuffer[i+12]=e[i];this.SendReply(0,t.idx)}},t.prototype.ReceiveRequest=function(e,t,i,a){if(e>1&&(s.Debug("Error in VirtioNET: Unsupported ringbuffer"),s.Abort()),0==e){for(var n=0;n<this.receivebufferdesc.length;n++)if(this.receivebufferdesc[n].idx==t)return;return this.receivebufferdesc.push({idx:t,size:a}),void this.HandleReceive()}for(var o=(r.Unmarshall2(["b","b","h","h","h","h","h"],i),new Uint8Array(a.read-12)),n=0;n<a.read-12;n++)o[n]=i();s.Send("ethmac",o.buffer),this.replybuffersize=0,this.SendReply(e,t)},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/block",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.blocks=100,this.configspace=[this.blocks>>0&255,this.blocks>>8&255,this.blocks>>16&255,0,0,0,0,0],this.deviceid=2,this.hostfeature=0,this.replybuffer=new Uint8Array(65536),this.replybuffersize=0,this.buffer=new Uint8Array(512*this.blocks),this.Reset()}var s=e("cjs!../../messagehandler"),r=(e("cjs!../../utils"),e("cjs!./marshall")),a=0,n=1,o=4,c=5,h=0;t.prototype.Reset=function(){},t.prototype.ReceiveRequest=function(e,t,i,u){var d=r.Unmarshall2(["w","w","d"],i),f=d[0],l=d[2];switch(f){case a:u.write>65536&&(s.Debug("Error in virtioblock: replybuffer too small"),s.Abort());for(var p=0;p<u.write-1;p++)this.replybuffer[p]=this.buffer[512*l+p];this.replybuffersize=u.write,this.replybuffer[u.write-1]=h,this.SendReply(0,t);break;case n:for(var p=0;p<u.read-16;p++)this.buffer[512*l+p]=i();this.replybuffersize=1,this.replybuffer[0]=h,this.SendReply(0,t);break;case o:break;case c:break;default:s.Debug("Error in VirtioBlock: Unknown request type "+f),s.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/gpu",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],this.deviceid=16,this.hostfeature=0,this.replybuffersize=0,this.replybuffer=new Uint8Array(1024),this.Reset()}var s=e("cjs!../../messagehandler"),r=e("cjs!../../utils"),a=e("cjs!./marshall"),n=256,o=257,c=258,h=259,u=262,d=263,f=4352,l=4353;t.prototype.Reset=function(){this.resource=new Array},t.prototype.ReplyOk=function(e){a.Marshall(["w","w","d","w","w"],[f,0,0,0,0],this.replybuffer,0),this.replybuffersize=24,this.SendReply(0,e)},t.prototype.ReceiveRequest=function(e,t,i,f){s.Debug(""),s.Debug("Virtio GPU request of ringbuffer "+e+" "+t+" "+f.read+" "+f.write),0!=e&&(s.Debug("Error in virtio gpu: queue no. "+e+" unknown"),s.Abort());var p=a.Unmarshall2(["w","w","d","w","w"],i),b=p[0],m=p[3];switch(s.Debug("type: "+b+" flags: "+p[1]+" fence: "+p[2]+" ctx_id: "+m),p[0]){case n:a.Marshall(["w","w","d","w","w"],[l,0,0,0,0],this.replybuffer,0);for(var v=0;408>v;v++)this.replybuffersize[v]=0;a.Marshall(["w","w","w","w","w","w"],[0,0,1024,768,1,0],this.replybuffer,24),s.Debug("get display info"),this.replybuffersize=408,this.SendReply(e,t);break;case o:var p=a.Unmarshall2(["w","w","w","w"],i),g=p[0],k=p[2],R=p[3],y=p[1];0==g&&s.Debug("Error in virtio gpu: resource_id is 0"),this.resource[g]={valid:!0,width:k,height:R,format:y,addr:0,length:0,scanout_id:-1},s.Debug("create 2d: "+k+"x"+R+" format: "+y+" resource_id: "+p[0]),this.ReplyOk(t);break;case c:var p=a.Unmarshall2(["w"],i),g=p[0];this.resource[g].valid=!1,s.Debug("resource unref: resource_id: "+p[0]),this.ReplyOk(t);break;case u:var p=a.Unmarshall2(["w","w"],i),w=p[1],g=p[0];s.Debug("attach backing: resource_id: "+g+" nr_entries:"+p[1]);for(var v=0;w>v;v++){var p=a.Unmarshall2(["d","w","w"],i);s.Debug("attach backing: addr:"+r.ToHex(p[0])+" length: "+p[1]),this.resource[g].addr=p[0],this.resource[g].length=p[1]}this.ReplyOk(t);break;case d:var p=a.Unmarshall2(["w"],i),g=p[0];s.Debug("detach backing: resource_id: "+g),this.resource[g].addr=0,this.resource[g].length=0,this.ReplyOk(t);break;case h:var p=a.Unmarshall2(["w","w","w","w","w","w"],i),S=p[0],T=p[1],k=p[2],R=p[3],D=p[4],g=p[5];s.Debug("set scanout: x: "+S+" y: "+T+" width: "+k+" height: "+R+" scanout_id: "+D+" resource_id: "+g),0!=g&&(this.resource[g].scanout_id=D),this.ReplyOk(t);break;default:s.Debug("Error in virtio gpu: Unknown type "+b),s.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/console",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=[80,0,24,0,1,0,0,0],this.deviceid=3,this.hostfeature=0,this.replybuffersize=0,this.replybuffer=new Uint8Array(8),this.Reset()}var s=e("cjs!../../messagehandler"),r=(e("cjs!../../utils"),e("cjs!./marshall")),a=0;t.prototype.Receive=function(e){},t.prototype.Reset=function(){},t.prototype.ReceiveRequest=function(e,t,i,n){if(s.Debug("Virtio console request of ringbuffer "+e+" "+t+" "+n.read+" "+n.write),1==e){for(var o="",c=0;c<n.read;c++)o+=String.fromCharCode(i());s.Debug("Write: "+o),this.replybuffersize=0,this.SendReply(e,t)}if(3==e){var h=r.Unmarshall2(["w","h","h"],i),u=h[0],d=h[1],f=h[2];switch(s.Debug("virtio console: "+u+" "+d+" "+f),d){case a:this.replybuffersize=0,this.SendReply(e,t);break;default:s.Debug("Error in virtio console: Unknown event"),s.Abort()}}},i.exports=t}()}),define("cjs!jor1k/worker/filesystem/tar",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.fs=e,this.tarbuffer=new Uint8Array(512),this.tarbufferofs=0,this.tarmode=0,this.tarfileoffset=0}function s(e,t,i){for(var s="",r=0;i>r;r++){if(e[t+r]<32)return s;s+=String.fromCharCode(e[t+r])}return s}function r(e,t,i,s){for(var r=Math.min(s,e.length+1),a=0;r>a;a++)t[i+a]=e.charCodeAt(a);t[i+r-1]=0}var a=e("cjs!../messagehandler"),n=61440,o=40960,c=32768,h=16384;t.prototype.Unpack=function(e){if(this.tarbuffer[this.tarbufferofs++]=e,512==this.tarbufferofs){if(this.tarbufferofs=0,1==this.tarmode){for(var t=Math.min(512,this.tarfilebuffer.length-this.tarfileoffset),i=0;t>i;i++)this.tarfilebuffer[this.tarfileoffset++]=this.tarbuffer[i];return void(this.tarfileoffset>=this.tarfilebuffer.length&&(this.tarmode=0))}var r=s(this.tarbuffer,257,5);if("ustar"==r){var a=String.fromCharCode(this.tarbuffer[156]),n=s(this.tarbuffer,0,100),u=n.split("/"),t=u.length;0==u[t-1].length&&u.pop();for(var t=u.length,d=0,f=-1,i=0;t-1>i;i++){if(f=this.fs.Search(d,u[i]),-1==f)throw"Error in untar: Could not find inode.";d=f}if(f=this.fs.Search(d,u[u.length-1]),-1==f&&!(-1!=f&&"5"!=a||-1!=f&&"5"==a)){var l=this.fs.CreateInode();l.name=u[t-1],l.parentid=d,l.mode=parseInt(s(this.tarbuffer,100,8),8),l.uid=parseInt(s(this.tarbuffer,108,8),8),l.gid=parseInt(s(this.tarbuffer,116,8),8),l.atime=parseInt(s(this.tarbuffer,136,12),8),l.ctime=this.atime,l.mtime=this.atime;var p=parseInt(s(this.tarbuffer,124,12),8);switch(a){case"5":l.mode|=h;break;case"0":if(l.mode|=c,l.data=new Uint8Array(p),l.size=p,0==p)break;this.tarmode=1,this.tarfileoffset=0,this.tarfilebuffer=l.data;break;case"1":l.mode|=o,l.symlink="/"+s(this.tarbuffer,157,100);break;case"2":l.mode|=o,l.symlink=s(this.tarbuffer,157,100)}this.fs.PushInode(l)}}}},t.prototype.Pack=function(e){a.Debug("tar: "+e);var t=this.fs.SearchPath(e).id;if(-1==t)return new Uint8Array(0);var i=[];this.fs.GetRecursiveList(t,i);for(var s=0,u=0;u<i.length;u++)switch(this.fs.inodes[i[u]].mode&n){case o:case h:s+=512;break;case c:s+=512,s+=this.fs.inodes[i[u]].size,511&s&&(s=-512&s,s+=512)}a.Debug("tar: "+this.fs.GetFullPath(t)+" size: "+s+" files: "+i.length),a.Debug(i);for(var d=new Uint8Array(s),f=0,u=0;u<i.length;u++){var l=this.fs.inodes[i[u]],p=l.mode&n;if(p==o||p==h||p==c){switch(r("ustar  ",d,f+257,8),r(this.fs.GetFullPath(i[u]),d,f+0,100),r("00000000000",d,f+124,12),r((4095&l.mode).toString(8),d,f+100,8),r(l.uid.toString(8),d,f+108,8),r(l.gid.toString(8),d,f+116,8),r(l.mtime.toString(8),d,f+136,12),d[f+148+0]=32,d[f+148+1]=32,d[f+148+2]=32,d[f+148+3]=32,d[f+148+4]=32,d[f+148+5]=32,d[f+148+6]=32,d[f+148+7]=32,p){case o:d[f+156]="2".charCodeAt(0),r(l.symlink,d,f+157,100);break;case h:d[f+156]="5".charCodeAt(0);break;case c:d[f+156]="0".charCodeAt(0),r(l.size.toString(8),d,f+124,12)}for(var b=0,m=0;512>m;m++)b+=d[f+m];if(r(b.toString(8),d,f+148,7),f+=512,p==c){for(var m=0;m<l.size;m++)d[f++]=l.data[m];511&f&&(f=-512&f,f+=512)}}}return d},i.exports=t}()}),define("cjs!jor1k/worker/filesystem/fsloader",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.fs=e}var s=e("cjs!../messagehandler"),r=e("cjs!../utils"),a=511,n=40960,o=32768,c=16384,h=2;t.prototype.HandleDirContents=function(e,t){for(var i in e){var r=e[i],u=this.fs.Search(t,r.name);if(-1!=u){if(!r.path&&!r.size){r.child&&this.HandleDirContents(r.child,u);continue}s.Debug("Overwriting non-directory!")}var d=this.fs.CreateInode();if(d.name=r.name,d.uid=0|r.uid,d.gid=0|r.gid,d.parentid=t,d.mode=parseInt(r.mode,8),r.path)d.mode=n|a,d.symlink=r.path,this.fs.PushInode(d);else if(r.size){r.lazy&&(d.lazy=r.lazy),d.mode|=o;var f=this.fs.inodes.length;d.status=h,d.compressed=!!r.c,d.size=0|r.size,this.fs.PushInode(d);var l=this.sysrootdir+(r.src?r.src:this.fs.GetFullPath(f));d.url=l,(r.load||this.fs.CheckEarlyload(this.fs.GetFullPath(f)))&&this.fs.LoadFile(f)}else d.mode|=c,d.updatedir=!0,this.fs.PushInode(d),r.child&&this.HandleDirContents(r.child,-1!=u?u:this.fs.inodes.length-1)}},t.prototype.OnJSONLoaded=function(e){var t=JSON.parse(e);this.sysrootdir=t.src,String(this.sysrootdir)!==this.sysrootdir&&s.Debug("No sysroot (src tag)!"),this.sysrootdir+="/",this.HandleDirContents(t.fs,0),s.Debug("processed "+this.fs.inodes.length+" inodes"),this.fs.Check()},t.prototype.LoadJSON=function(e){s.Debug("Load filesystem information from "+e),r.LoadTextResource(e,this.OnJSONLoaded.bind(this),function(e){throw e})},i.exports=t}()}),define("cjs!jor1k/worker/filesystem/lazyUint8Array",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(){return this.lengthKnown||this.CacheLength(),this._length}function s(){return this.lengthKnown||this.CacheLength(),this._chunkSize}function r(e,i){this.fallbackLength=i,this.overlay=[],this.url=e,this.lengthKnown=!1,this.chunks=[],Object.defineProperty(this,"length",{get:t}),Object.defineProperty(this,"chunkSize",{get:s})}var a=e("cjs!../messagehandler");r.prototype.Set=function(e,t){return e>this.length-1||0>e?void 0:void(this.overlay[e]=t)},r.prototype.Get=function(e){if(e>this.length-1||0>e)return void 0;if("undefined"!=typeof this.overlay[e])return this.overlay[e];var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.GetChunk(i)[t]},r.prototype.DoXHR=function(e,t){e>t&&a.Error("Invalid range ("+e+", "+t+") or no bytes requested!"),t>this._length-1&&a.Error("Only "+this._length+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",this.url,!1),this._length!==this._chunkSize&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+this.url+". Status: "+i.status);return new Uint8Array(i.response||[])},r.prototype.GetChunk=function(e){var t=e*this._chunkSize,i=(e+1)*this._chunkSize-1;return i=Math.min(i,this._length-1),"undefined"==typeof this.chunks[e]&&(this.chunks[e]=this.DoXHR(t,i)),this.chunks[e]},r.prototype.CacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",this.url+"?"+(new Date).getTime(),!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+this.url+". Status: "+e.status);this._length=Number(e.getResponseHeader("Content-length")),0===this._length&&(a.Warning("Server doesn't return Content-length, even though we have a cache defeating URL query-string appended"),this._length=this.fallbackLength),this._chunkSize=1048576;var t,i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t;i||(this._chunkSize=this._length),this.lengthKnown=!0},i.exports=r}()}),define("cjs!jor1k/worker/filesystem/filesystem",["require","exports","module","cjs!./tar","cjs!./fsloader","cjs!../utils","cjs!../bzip2","cjs!../dev/virtio/marshall","cjs!../../lib/utf8","cjs!../messagehandler","cjs!./lazyUint8Array"],function(e,t,i){!function(){function t(){this.inodes=[],this.events=[],this.qidnumber=0,this.filesinloadingqueue=0,this.OnLoaded=function(){},this.tar=new s(this),this.fsloader=new r(this),this.userinfo=[],this.watchFiles={},this.watchDirectories={},h.Register("LoadFilesystem",this.LoadFilesystem.bind(this)),h.Register("MergeFile",this.MergeFile.bind(this)),h.Register("DeleteNode",this.DeleteNode.bind(this)),h.Register("DeleteDirContents",this.RecursiveDelete.bind(this)),h.Register("CreateDirectory",function(e){var t=this.SearchPath(e);-1==t.id&&-1!=t.parentid&&this.CreateDirectory(t.name,t.parentid)}.bind(this)),h.Register("Rename",function(e){var t=this.SearchPath(e.oldPath),i=this.SearchPath(e.newPath);if(-1!=t.id&&-1!=i.parentid)if(-1==i.id){if((this.inodes[i.parentid].mode&d)!=b)return;this.Rename(this.inodes[t.id].parentid,this.inodes[t.id].name,i.parentid,i.name)}else this.Rename(this.inodes[t.id].parentid,this.inodes[t.id].name,this.inodes[i.id].parentid,this.inodes[i.id].name)}.bind(this)),h.Register("WatchFile",function(e){this.watchFiles[e.name]=!0}.bind(this)),h.Register("WatchDirectory",function(e){this.watchDirectories[e.name]=!0}.bind(this)),h.Register("ReadFile",function(e){h.Send("ReadFile",this.ReadFile.bind(this)(e))}.bind(this)),h.Register("tar",function(e){h.Send("tar",this.tar.Pack(e))}.bind(this)),h.Register("sync",function(e){h.Send("sync",this.tar.Pack(e))}.bind(this)),this.CreateDirectory("",-1)}var s=e("cjs!./tar"),r=e("cjs!./fsloader"),a=e("cjs!../utils"),n=e("cjs!../bzip2"),o=e("cjs!../dev/virtio/marshall"),c=e("cjs!../../lib/utf8"),h=e("cjs!../messagehandler"),u=e("cjs!./lazyUint8Array"),d=61440,f=49152,l=40960,p=32768,b=16384,m=-1,v=0,g=2,k=3,R=4;t.prototype.LoadFilesystem=function(e){this.userinfo=e,this.fsloader.LoadJSON(this.userinfo.basefsURL),this.OnLoaded=function(){this.userinfo.extendedfsURL&&this.fsloader.LoadJSON(this.userinfo.extendedfsURL);for(var e=0;e<this.userinfo.lazyloadimages.length;e++)this.LoadImage(this.userinfo.lazyloadimages[e])}.bind(this)},t.prototype.AddEvent=function(e,t){var i=this.GetInode(e);return i.status==v?void t():void this.events.push({id:e,OnEvent:t})},t.prototype.HandleEvent=function(e){0==this.filesinloadingqueue&&(this.OnLoaded(),this.OnLoaded=function(){});for(var t=[],i=0;i<this.events.length;i++)this.events[i].id==e?this.events[i].OnEvent():t.push(this.events[i]);this.events=t},t.prototype.LoadImage=function(e){e&&a.LoadBinaryResource(e,function(e){var t=new Uint8Array(e);0!=e.byteLength&&n.simple(t,this.tar.Unpack.bind(this.tar))}.bind(this),function(t){h.Debug("Error: Could not load "+e+". Skipping.")}.bind(this))},t.prototype.CheckEarlyload=function(e){for(var t=0;t<this.userinfo.earlyload.length;t++)if(this.userinfo.earlyload[t]==e)return!0;return!1},t.prototype.AppendDateHack=function(e){if("home/user/.profile"==this.GetFullPath(e)){var t=this.inodes[e],i=new Date,s='\ndate -s "'+i.getUTCFullYear()+"-"+(i.getUTCMonth()+1)+"-"+i.getUTCDate()+" "+i.getUTCHours()+":"+i.getUTCMinutes()+":"+i.getUTCSeconds()+'" &>/dev/null\n',r=t.size;this.ChangeSize(e,r+s.length);for(var a=0;a<s.length;a++)t.data[a+r]=s.charCodeAt(a)}},t.prototype.LoadFile=function(e){var t=this.inodes[e];if(t.status==g){if(t.status=k,this.filesinloadingqueue++,t.compressed){t.data=new Uint8Array(t.size);var i=function(e){return function(t){var i=this.GetInode(e),s=new Uint8Array(t),r=0;n.simple(s,function(e){i.data[r++]=e}.bind(this)),i.status=v,this.filesinloadingqueue--,this.HandleEvent(e)}.bind(this)}.bind(this)(e);return void a.LoadBinaryResource(t.url+".bz2",i,function(e){throw e})}if(t.lazy){h.Debug("Using lazy file for "+t.url),t.data=new u(t.url,t.size);var s=t.size;return t.size=t.data.length,s!=t.size&&h.Warning("Size wrong for lazy loaded file: "+t.name),t.status=v,this.filesinloadingqueue--,void this.HandleEvent(e)}var i=function(e){return function(t){var i=this.GetInode(e);i.data=new Uint8Array(t),i.size!=i.data.length&&h.Warning("Size wrong for uncompressed non-lazily loaded file: "+i.name),i.size=i.data.length,i.status=v,this.filesinloadingqueue--,this.HandleEvent(e)}.bind(this)}.bind(this)(e);a.LoadBinaryResource(t.url,i,function(e){throw e})}},t.prototype.PushInode=function(e){return-1!=e.parentid?(this.inodes.push(e),this.inodes[e.parentid].updatedir=!0,e.nextid=this.inodes[e.parentid].firstid,void(this.inodes[e.parentid].firstid=this.inodes.length-1)):0==this.inodes.length?void this.inodes.push(e):(h.Debug("Error in Filesystem: Pushed inode with name = "+e.name+" has no parent"),void h.Abort())},t.prototype.CreateInode=function(){return this.qidnumber++,{updatedir:!1,parentid:-1,firstid:-1,nextid:-1,status:0,name:"",size:0,uid:0,gid:0,ctime:Math.floor((new Date).getTime()/1e3),atime:Math.floor((new Date).getTime()/1e3),mtime:Math.floor((new Date).getTime()/1e3),major:0,minor:0,data:new Uint8Array(0),symlink:"",mode:493,qid:{type:0,version:0,path:this.qidnumber},url:"",compressed:!1}},t.prototype.CreateDirectory=function(e,t){var i=this.CreateInode();return i.name=e,i.parentid=t,i.mode=511|b,i.updatedir=!0,t>=0&&(i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.mode=511&this.inodes[t].mode|b),i.qid.type=b>>8,this.PushInode(i),this.NotifyListeners(this.inodes.length-1,"newdir"),this.inodes.length-1},t.prototype.CreateFile=function(e,t){var i=this.CreateInode();return i.name=e,i.parentid=t,i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.qid.type=p>>8,i.mode=438&this.inodes[t].mode|p,this.PushInode(i),this.NotifyListeners(this.inodes.length-1,"newfile"),this.inodes.length-1},t.prototype.CreateNode=function(e,t,i,s){var r=this.CreateInode();return r.name=e,r.parentid=t,r.major=i,r.minor=s,r.uid=this.inodes[t].uid,r.gid=this.inodes[t].gid,r.qid.type=f>>8,r.mode=438&this.inodes[t].mode,this.PushInode(r),this.inodes.length-1},t.prototype.CreateSymlink=function(e,t,i){var s=this.CreateInode();return s.name=e,s.parentid=t,s.uid=this.inodes[t].uid,s.gid=this.inodes[t].gid,s.qid.type=l>>8,s.symlink=i,s.mode=l,this.PushInode(s),this.inodes.length-1},t.prototype.CreateTextFile=function(e,t,i){var s=this.CreateFile(e,t),r=this.inodes[s];r.data=new Uint8Array(i.length),r.size=i.length;for(var a in i)r.data[a]=i.charCodeAt(a);return s},t.prototype.OpenInode=function(e,t){var i=this.GetInode(e);return(i.mode&d)==b&&this.FillDirectory(e),i.status==g?(this.LoadFile(e),!1):(".profile"==i.name&&this.AppendDateHack(e),!0)},t.prototype.CloseInode=function(e){var t=this.GetInode(e);t.status==R&&(t.status==m,t.data=new Uint8Array(0),t.size=0)},t.prototype.Rename=function(e,t,i,s){if(e==i&&t==s)return!0;var r=this.Search(e,t),a=this.GetFullPath(r);if(-1==r)return!1;var n=this.Search(i,s);-1!=n&&this.Unlink(n);var o=r,c=this.inodes[o];if(this.inodes[c.parentid].firstid==o)this.inodes[c.parentid].firstid=c.nextid;else{var u=this.FindPreviousID(o);-1==u&&(h.Debug("Error in Filesystem: Cannot find previous id of inode"),h.Abort()),this.inodes[u].nextid=c.nextid}return c.parentid=i,c.name=s,c.qid.version++,c.nextid=this.inodes[c.parentid].firstid,this.inodes[c.parentid].firstid=o,this.inodes[e].updatedir=!0,this.inodes[i].updatedir=!0,this.NotifyListeners(o,"rename",{oldpath:a}),!0},t.prototype.Write=function(e,t,i,s){this.NotifyListeners(e,"write");var r=this.inodes[e];if(r.data.length<t+i?(this.ChangeSize(e,Math.floor(3*(t+i)/2)),r.size=t+i):r.size<t+i&&(r.size=t+i),r.data instanceof Uint8Array)for(var a=0;i>a;a++)r.data[t+a]=s();else for(var a=0;i>a;a++)r.data.Set(t+a,s())},t.prototype.Search=function(e,t){for(var i=this.inodes[e].firstid;-1!=i;){if(this.inodes[i].parentid!=e&&h.Debug("Error in Filesystem: Found inode with wrong parent id"),this.inodes[i].name==t)return i;i=this.inodes[i].nextid}return-1},t.prototype.GetTotalSize=function(){for(var e=0,t=0;t<this.inodes.length;t++)e+=this.inodes[t].data.length;return e},t.prototype.GetFullPath=function(e){for(var t="";0!=e;)t="/"+this.inodes[e].name+t,e=this.inodes[e].parentid;return t.substring(1)},t.prototype.FindPreviousID=function(e){for(var t=this.GetInode(e),i=this.inodes[t.parentid].firstid;-1!=i;){if(this.inodes[i].nextid==e)return i;i=this.inodes[i].nextid}return i},t.prototype.Unlink=function(e){if(this.NotifyListeners(e,"delete"),0==e)return!1;var t=this.GetInode(e);if((t.mode&d)==b&&-1!=t.firstid)return!1;if(this.inodes[t.parentid].firstid==e)this.inodes[t.parentid].firstid=t.nextid;else{var i=this.FindPreviousID(e);-1==i&&(h.Debug("Error in Filesystem: Cannot find previous id of inode"),h.Abort()),this.inodes[i].nextid=t.nextid}return this.inodes[t.parentid].updatedir=!0,t.status=R,t.nextid=-1,t.firstid=-1,t.parentid=-1,!0},t.prototype.GetInode=function(e){return isNaN(e)?(h.Debug("Error in filesystem: id is not a number "),0):0>e||e>this.inodes.length?(h.Debug("Error in filesystem: Attempt to get inode with id "+e),0):this.inodes[e]},t.prototype.ChangeSize=function(e,t){var i=this.GetInode(e);if(t!=i.size){var s=new Uint8Array(t);i.size=t;for(var r=Math.min(i.data.length,i.size),a=0;r>a;a++)s[a]=this.ReadByte(i,a);i.data=s}},t.prototype.ReadByte=function(e,t){return e.data instanceof Uint8Array?e.data[t]:e.data.Get(t)},t.prototype.SearchPath=function(e){e=e.replace("//","/");var t=e.split("/"),i=t.length;0==t[i-1].length&&t.pop(),0==t[0].length&&t.shift();for(var i=t.length,s=0,r=-1,a=0;i>a;a++){if(r=this.Search(s,t[a]),-1==r)return i-1>a?{id:-1,parentid:-1,name:t[a]}:{id:-1,parentid:s,name:t[a]};s=r}return{id:r,parentid:s,name:t[a]}},t.prototype.GetRecursiveList=function(e,t){for(var i=this.inodes[e].firstid;-1!=i;)t.push(i),(this.inodes[i].mode&d)==b&&this.GetRecursiveList(i,t),i=this.inodes[i].nextid},t.prototype.ReadFile=function(e){var t=this.SearchPath(e.name);if(-1!=t.parentid)return-1==t.id?null:(e.data=this.inodes[t.id].data,e.size=this.inodes[t.id].size,e)},t.prototype.MergeFile=function(e){h.Debug("Merge path:"+e.name);var t=this.SearchPath(e.name);-1!=t.parentid&&(-1==t.id&&(t.id=this.CreateFile(t.name,t.parentid)),this.inodes[t.id].data=e.data,this.inodes[t.id].size=e.data.length)},t.prototype.RecursiveDelete=function(e){var t=[],i=this.SearchPath(e);if(-1!=i.parentid&&-1!=i.id){this.GetRecursiveList(i.id,t);for(var s=t.length-1;s>=0;s--)this.Unlink(t[s])}},t.prototype.DeleteNode=function(e){var t=this.SearchPath(e);if(-1!=t.parentid&&-1!=t.id){if((this.inodes[t.id].mode&d)==p)return void this.Unlink(t.id);if((this.inodes[t.id].mode&d)==b){var i=[];this.GetRecursiveList(t.id,i);for(var s=i.length-1;s>=0;s--)this.Unlink(i[s]);return void this.Unlink(t.id)}}},t.prototype.NotifyListeners=function(e,t,i){void 0==i&&(i={});var s=this.GetFullPath(e);1==this.watchFiles[s]&&"write"==t&&h.Send("WatchFileEvent",s);for(var r in this.watchDirectories)if(this.watchDirectories.hasOwnProperty(r)){var a=s.indexOf(r);(0==a||1==a)&&h.Send("WatchDirectoryEvent",{path:s,event:t,info:i})}},t.prototype.Check=function(){for(var e=1;e<this.inodes.length;e++)if(this.inodes[e].status!=m){this.inodes[e].nextid==e&&(h.Debug("Error in filesystem: file points to itself"),h.Abort());var t=this.GetInode(e);t.parentid<0&&h.Debug("Error in filesystem: negative parent id "+e);var i=t.name.length;0==i&&h.Debug("Error in filesystem: inode with no name and id "+e);for(var s in t.name){var r=t.name.charCodeAt(s);32>r&&h.Debug("Error in filesystem: Unallowed char in filename")}}},t.prototype.FillDirectory=function(e){var t=this.GetInode(e);if(t.updatedir){var i=t.parentid;-1==i&&(i=0);for(var s=0,r=this.inodes[e].firstid;-1!=r;)s+=24+c.UTF8Length(this.inodes[r].name),r=this.inodes[r].nextid;s+=25,s+=26,t.data=new Uint8Array(s),t.size=s;var a=0;a+=o.Marshall(["Q","d","b","s"],[this.inodes[e].qid,a+13+8+1+2+1,this.inodes[e].mode>>12,"."],t.data,a),a+=o.Marshall(["Q","d","b","s"],[this.inodes[i].qid,a+13+8+1+2+2,this.inodes[i].mode>>12,".."],t.data,a);for(var r=this.inodes[e].firstid;-1!=r;)a+=o.Marshall(["Q","d","b","s"],[this.inodes[r].qid,a+13+8+1+2+c.UTF8Length(this.inodes[r].name),this.inodes[r].mode>>12,this.inodes[r].name],t.data,a),r=this.inodes[r].nextid;t.updatedir=!1}},t.prototype.PrepareCAPs=function(e){var t=this.GetInode(e);return t.caps?t.caps.length:(t.caps=new Uint8Array(12),t.caps[0]=0,t.caps[1]=0,t.caps[2]=0,t.caps[3]=1,t.caps[4]=255,t.caps[5]=255,t.caps[6]=255,t.caps[7]=255,t.caps[8]=255,t.caps[9]=255,t.caps[10]=255,t.caps[11]=255,t.caps.length)},i.exports=t}()}),define("cjs!jor1k/worker/system",["require","exports","module","cjs!./messagehandler","cjs!./utils","cjs!./ram","cjs!./bzip2","cjs!./elf","cjs!./timer","cjs!./riscv/htif","cjs!./or1k","cjs!./riscv","cjs!./dev/uart","cjs!./dev/irq","cjs!./dev/timer","cjs!./dev/framebuffer","cjs!./dev/ethmac","cjs!./dev/ata","cjs!./dev/rtc","cjs!./dev/touchscreen","cjs!./dev/keyboard","cjs!./dev/sound","cjs!./dev/virtio","cjs!./dev/virtio/9p","cjs!./dev/virtio/dummy","cjs!./dev/virtio/input","cjs!./dev/virtio/net","cjs!./dev/virtio/block","cjs!./dev/virtio/gpu","cjs!./dev/virtio/console","cjs!./filesystem/filesystem"],function(e,t,i){
!function(){function t(){s.Register("LoadAndStart",this.LoadImageAndStart.bind(this)),s.Register("execute",this.MainLoop.bind(this)),s.Register("Init",this.Init.bind(this)),s.Register("Reset",this.Reset.bind(this)),s.Register("ChangeCore",this.ChangeCPU.bind(this)),s.Register("PrintOnAbort",this.PrintState.bind(this)),s.Register("GetIPS",function(e){s.Send("GetIPS",this.ips),this.ips=0}.bind(this))}var s=e("cjs!./messagehandler"),r=e("cjs!./utils"),a=e("cjs!./ram"),n=e("cjs!./bzip2"),o=e("cjs!./elf"),c=e("cjs!./timer"),h=e("cjs!./riscv/htif"),u=e("cjs!./or1k"),d=e("cjs!./riscv"),f=e("cjs!./dev/uart"),l=e("cjs!./dev/irq"),p=e("cjs!./dev/timer"),b=e("cjs!./dev/framebuffer"),m=e("cjs!./dev/ethmac"),v=e("cjs!./dev/ata"),g=e("cjs!./dev/rtc"),k=e("cjs!./dev/touchscreen"),R=e("cjs!./dev/keyboard"),y=e("cjs!./dev/sound"),w=e("cjs!./dev/virtio"),S=e("cjs!./dev/virtio/9p"),T=e("cjs!./dev/virtio/dummy"),D=e("cjs!./dev/virtio/input"),x=e("cjs!./dev/virtio/net"),E=e("cjs!./dev/virtio/block"),I=e("cjs!./dev/virtio/gpu"),A=e("cjs!./dev/virtio/console"),C=e("cjs!./filesystem/filesystem"),j=1,M=2,_=3;t.prototype.CreateCPU=function(e,t){try{if("or1k"==t)this.cpu=new u(e,this.ram,this.heap,this.ncores);else{if("riscv"!=t)throw"Architecture "+t+" not supported";this.cpu=new d(e,this.ram,this.htif,this.heap,this.ncores)}}catch(i){s.Debug("Error: failed to create CPU:"+i)}},t.prototype.ChangeCPU=function(e){this.cpu.switchImplementation(e)},t.prototype.Reset=function(){this.status=M;for(var e=0;e<this.devices.length;e++)this.devices[e].Reset();this.ips=0},t.prototype.Init=function(e){this.status=M,this.memorysize=e.memorysize,this.ncores=e.ncores,e.ncores||(e.ncores=1);var t=1048576;this.heap=new ArrayBuffer(1048576*this.memorysize),this.memorysize--,this.ram=new a(this.heap,t),"riscv"==e.arch&&(this.htif=new h(this.ram,this)),this.CreateCPU(e.cpu,e.arch),this.devices=[],this.devices.push(this.cpu),"or1k"==e.arch?(this.irqdev=new l(this),this.timerdev=new p,this.uartdev0=new f(0,this,2),this.uartdev1=new f(1,this,3),this.ethdev=new m(this.ram,this),this.ethdev.TransmitCallback=function(e){s.Send("ethmac",e)},this.fbdev=new b(this.ram),this.atadev=new v(this),this.tsdev=new k(this),this.kbddev=new R(this),this.snddev=new y(this,this.ram),this.rtcdev=new g(this),this.filesystem=new C,this.virtio9pdev=new S(this.ram,this.filesystem),this.virtiodev1=new w(this,6,this.ram,this.virtio9pdev),this.virtioinputdev=new D(this.ram),this.virtionetdev=new x(this.ram),this.virtioblockdev=new E(this.ram),this.virtiodummydev=new T(this.ram),this.virtiogpudev=new I(this.ram),this.virtioconsoledev=new A(this.ram),this.virtiodev2=new w(this,11,this.ram,this.virtiodummydev),this.virtiodev3=new w(this,12,this.ram,this.virtiodummydev),this.devices.push(this.irqdev),this.devices.push(this.timerdev),this.devices.push(this.uartdev0),this.devices.push(this.uartdev1),this.devices.push(this.ethdev),this.devices.push(this.fbdev),this.devices.push(this.atadev),this.devices.push(this.tsdev),this.devices.push(this.kbddev),this.devices.push(this.snddev),this.devices.push(this.rtcdev),this.devices.push(this.virtio9pdev),this.devices.push(this.virtiodev1),this.devices.push(this.virtiodev2),this.devices.push(this.virtiodev3),this.devices.push(this.virtioinputdev),this.devices.push(this.virtionetdev),this.devices.push(this.virtioblockdev),this.devices.push(this.virtiodummydev),this.devices.push(this.virtiogpudev),this.devices.push(this.virtioconsoledev),this.ram.AddDevice(this.uartdev0,2415919104,7),this.ram.AddDevice(this.fbdev,2432696320,4096),this.ram.AddDevice(this.ethdev,2449473536,4096),this.ram.AddDevice(this.tsdev,2466250752,4096),this.ram.AddDevice(this.kbddev,2483027968,256),this.ram.AddDevice(this.uartdev1,2516582400,7),this.ram.AddDevice(this.virtiodev1,2533359616,4096),this.ram.AddDevice(this.snddev,2550136832,1024),this.ram.AddDevice(this.rtcdev,2566914048,4096),this.ram.AddDevice(this.irqdev,2583691264,4096),this.ram.AddDevice(this.timerdev,2600468480,4096),this.ram.AddDevice(this.virtiodev2,2617245696,4096),this.ram.AddDevice(this.virtiodev3,2634022912,4096),this.ram.AddDevice(this.atadev,2650800128,4096)):"riscv"==e.arch&&(this.uartdev0=new f(0,this,2),this.devices.push(this.uartdev0),this.ram.AddDevice(this.uartdev0,2415919104,7)),this.ips=0,this.idletime=0,this.idlemaxwait=0,this.ticksperms=2e4,this.loopspersecond=100,this.timer=new c(this.ticksperms,this.loopspersecond)},t.prototype.RaiseInterrupt=function(e){if(this.cpu.RaiseInterrupt(e,-1),this.status==_){this.status=j,clearTimeout(this.idletimeouthandle);var t=(r.GetMilliseconds()-this.idletime)*this.ticksperms;t>this.idlemaxwait&&(t=this.idlemaxwait),this.cpu.ProgressTime(t),this.MainLoop()}},t.prototype.ClearInterrupt=function(e){this.cpu.ClearInterrupt(e,-1)},t.prototype.RaiseSoftInterrupt=function(e,t){this.cpu.RaiseInterrupt(e,t)},t.prototype.ClearSoftInterrupt=function(e,t){this.cpu.ClearInterrupt(e,t)},t.prototype.PrintState=function(){this.uartdev0&&this.uartdev0.Step(),this.uartdev1&&this.uartdev1.Step(),s.Debug(this.cpu.toString())},t.prototype.SendStringToTerminal=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e.charCodeAt(i));s.Send("tty0",t)},t.prototype.LoadImageAndStart=function(e){this.SendStringToTerminal("\r================================================================================"),"string"==typeof e?(this.SendStringToTerminal("\r\nLoading kernel and hard and basic file system from web server. Please wait ...\r\n"),r.LoadBinaryResource(e,this.OnKernelLoaded.bind(this),function(e){throw e})):this.OnKernelLoaded(e)},t.prototype.PatchKernel=function(e){for(var t=this.ram.uint8mem,i=0;e>i;i++)109===t[i+0]&&101===t[i+1]&&109===t[i+2]&&111===t[i+3]&&114===t[i+4]&&121===t[i+5]&&0===t[i+6]&&1===t[i+24]&&240===t[i+25]&&0===t[i+26]&&0===t[i+27]&&(t[i+24]=1048576*this.memorysize>>24,t[i+25]=1048576*this.memorysize>>16,t[i+26]=0,t[i+27]=0)},t.prototype.OnKernelLoaded=function(e){this.SendStringToTerminal("Decompressing kernel...\r\n");var t=new Uint8Array(e),i=0;if(o.IsELF(t))o.Extract(t,this.ram.uint8mem);else if(n.IsBZIP2(t)){if(n.simple(t,function(e){this.ram.uint8mem[i++]=e}.bind(this)),o.IsELF(this.ram.uint8mem)){for(var r=new Uint8Array(i),a=0;i>a;a++)r[a]=this.ram.uint8mem[a];o.Extract(r,this.ram.uint8mem)}}else{i=t.length;for(var a=0;i>a;a++)this.ram.uint8mem[a]=t[a]}this.PatchKernel(i),0==this.cpu.littleendian&&this.ram.Little2Big(i),s.Debug("Kernel loaded: "+i+" bytes"),this.SendStringToTerminal("Booting\r\n"),this.SendStringToTerminal("================================================================================"),this.cpu.Reset(),this.cpu.AnalyzeImage(),s.Debug("Starting emulation"),this.status=j,s.Send("execute",0)},t.prototype.HandleHalt=function(){var e=this.cpu.GetTimeToNextInterrupt();if(-1!=e){this.idlemaxwait=e;var t=Math.floor(e/this.ticksperms/this.timer.correction+.5);1>=t||(t>1e3&&s.Debug("Warning: idle for "+t+"ms"),this.idletime=r.GetMilliseconds(),this.status=_,this.idletimeouthandle=setTimeout(function(){this.status==_&&(this.status=j,this.cpu.ProgressTime(e),this.MainLoop())}.bind(this),t))}},t.prototype.MainLoop=function(){if(this.status==j){s.Send("execute",0);var e=this.cpu.Step(this.timer.instructionsperloop,this.timer.timercyclesperinstruction),t=this.timer.instructionsperloop-e;t++,this.ips+=t,this.uartdev0&&this.uartdev0.Step(),this.uartdev1&&this.uartdev1.Step();var i=e?!0:!1;this.timer.Update(t,this.cpu.GetTicks(),i),i&&this.HandleHalt()}},i.exports=t}()}),define("cjs!jor1k/worker/worker",["require","exports","module","cjs!./messagehandler","cjs!./system"],function(e,t,i){!function(){var t=e("cjs!./messagehandler"),i=e("cjs!./system");new i,t.Send("WorkerReady",0)}()}),require.config({baseUrl:".",paths:{text:"bower_modules/requirejs-text/text",cjs:"bower_modules/cjs/cjs","amd-loader":"bower_modules/amd-loader/amd-loader",bootstrap:"bower_modules/bootstrap-sass/assets/javascripts/bootstrap.min",modernizr:"bower_modules/modernizr/modernizr",crossroads:"bower_modules/crossroads/dist/crossroads.min",hasher:"bower_modules/hasher/dist/js/hasher.min",jquery:"bower_modules/jquery/dist/jquery",knockout:"bower_modules/knockout/dist/knockout","knockout-projections":"bower_modules/knockout-projections/dist/knockout-projections",signals:"bower_modules/js-signals/dist/signals.min",marked:"bower_modules/marked/marked.min",videojs:"bower_modules/videojs/dist/video.min","jquery-ui":"bower_modules/jquery-ui/jquery-ui.min","jquery-ui-layout":"bower_modules/jquery-ui-layout/source/stable/jquery.layout_and_plugins.min","jquery-fullscreen":"bower_modules/jquery-fullscreen/jquery.fullscreen-min","jquery-notific8":"bower_modules/jquery-notific8/dist/jquery.notific8.min",ace:"bower_modules/ace/lib/ace","typeahead-jquery":"bower_modules/typeahead.js/dist/typeahead.jquery.min",bloodhound:"bower_modules/typeahead.js/dist/bloodhound.min",FileSaver:"bower_modules/FileSaver/FileSaver.min",Blob:"bower_modules/Blob/Blob","bootstrap-contextmenu":"bower_modules/bootstrap-contextmenu/bootstrap-contextmenu",bootbox:"bower_modules/bootbox.js/bootbox","github-api":"bower_modules/github-api/github",jszip:"bower_modules/jszip/dist/jszip.min","app/config":"app/config/config.dev","js-base64":"app/github-int/github-base64",xmlhttprequest:"app/github-int/github-xmlhttpreq"},shim:{"github-api":{},bootstrap:{deps:["jquery"]},"jquery-ui":{deps:["jquery"]},"jquery-ui-layout":{deps:["jquery","jquery-ui"]},"jquery-fullscreen":{deps:["jquery"]},"typeahead-jquery":{deps:["jquery"]},bootbox:{deps:["jquery"]},"bootstrap-contextmenu":{deps:["bootstrap"]}},packages:[{name:"jor1k",location:"bower_modules/jor1k/js"}],map:{"jor1k/worker/system":{"jor1k/worker/or1k":"jor1k/worker/or1k/index","jor1k/worker/or1k/index":"jor1k/worker/or1k/index","jor1k/worker/riscv":"jor1k/worker/riscv/index","jor1k/worker/riscv/index":"jor1k/worker/riscv/index","jor1k/worker/riscv/htif":"jor1k/worker/riscv/htif"}}}),define("app/require.config",function(){}),require(["cjs!jor1k/worker/worker"]),require.config({bundles:{}});